<style data-page="event">* {
                padding: 0;
                margin: 0;
                box-sizing: border-box;
            }
    
    
    
      
    
            .event-items {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
                list-style-type: none;
            }
    
           .event-items li{
                position: relative;
                border: 2px solid black;
                overflow: hidden;
                cursor: pointer;
                background: white;
                height: 300px;
            }
    
       
    
            .machines img {
                width: 100%;
                height: 200px;
                object-fit: cover;
                display: block;
            }
    
            .overlay {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                padding: 10px;
                display: flex;
                flex-direction: column;
                justify-content: flex-end;
                border-top: 2px black solid;
            }
    
            .title {
                font-size: 18px;
                margin-bottom: 5px;
            }
    
            .price {
                font-size: 15px;
                color: black;
            }
    
            /* 添加更多商品项的演示样式 */
            .placeholder-img {
                width: 100%;
                height: 200px;
                display: flex;
                align-items: center;
                justify-content: center;
            
                font-size: 24px;
            }
            .retro-console {
                border: 2px black solid;
                padding: 5px;
                margin-bottom: 20px;
            }
            .events{
                border: 2px black solid;
                padding: 5px;
                margin-bottom: 20px;
            }
            .taobao{
                margin-top: 20px;
                border: 2px black solid;
                padding: 5px;
            }
          
    
    
            @media(max-width:899px) {
             
                .event-items {
     
                grid-template-columns: repeat(2,  1fr);
                gap: 10px;
             
            }
    
            .events{
             
                margin-bottom: 10px;
            }
        }</style><link href="/css/styles.c6120c67c82cba3af7ca.css" rel="stylesheet"><body><div class="events"><h1>When Events Connect</h1><p>Utilizing game-like mechanics to foster social interaction and explore the construction of self-consciousness</p></div><div class="section"><ul class="event-items"><li data-id="4"><div class="overlay"><span class="title">Doodle Gallery</span></div></li><li data-id="3"><div class="overlay"><span class="title">T-Shirt System</span></div></li><li data-id="2"><div class="overlay"><span class="title">GUI Printer</span></div></li></ul></div><script defer="defer" src="/js/vendors.59606a4d8afa88538fd5.js"></script><script defer="defer" src="/js/styles.7aae21adbc8ce89b8327.js"></script><script defer="defer" src="/js/global.38c5e8752c5a40c88fe4.js"></script></body><script>(function() {
        console.log('[Merch] Page script starting at:', new Date().toISOString());
        
        // 使用唯一的命名空间避免冲突
        const NAMESPACE = 'merchPage_' + Date.now();
        
        // 清理函数
        function cleanupMerchPage() {
            console.log('[Merch] Cleaning up...');
            
            // 移除所有可能的事件监听器
            const containers = document.querySelectorAll('.machines, .software-items, #machinesContainer');
            containers.forEach(container => {
                // 克隆节点以移除所有事件监听器
                const newContainer = container.cloneNode(true);
                container.parentNode.replaceChild(newContainer, container);
            });
            
            // 清理全局变量
            if (window[NAMESPACE]) {
                delete window[NAMESPACE];
            }
            delete window.cleanupMerchPage;
        }
        
        // 立即注册清理函数
        window.cleanupMerchPage = cleanupMerchPage;
        
        // 先清理
        const existingCleanup = Object.keys(window).find(key => 
            key.startsWith('merchPage_') && key !== NAMESPACE
        );
        if (existingCleanup) {
            delete window[existingCleanup];
        }
        
        // 处理产品点击 - 使用防抖
        let isProcessing = false;
        function handleProductClick(e) {
            // 防止重复处理
            if (isProcessing) {
                console.log('[Merch] Click ignored - already processing');
                return;
            }
            
            const productItem = e.target.closest('.product-item, li[data-id]');
            if (!productItem) {
                return;
            }
            
            // 立即阻止事件传播
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            
            isProcessing = true;
            
            // 获取产品数据
            const productData = {
                id: productItem.getAttribute('data-id'),
                name: productItem.getAttribute('data-name'),
                year: productItem.getAttribute('data-year'),
                price: productItem.getAttribute('data-price'),
                timestamp: Date.now() // 添加时间戳用于验证
            };
            
            console.log('[Merch] Product clicked:', productData);
            
            // 使用更可靠的存储方式
            try {
                // 先清除旧数据
                sessionStorage.removeItem('pendingProduct');
                sessionStorage.removeItem('lastProductClick');
                
                // 存储新数据
                sessionStorage.setItem('pendingProduct', JSON.stringify(productData));
                sessionStorage.setItem('lastProductClick', productData.timestamp.toString());
                
                // 验证存储
                const stored = sessionStorage.getItem('pendingProduct');
                const storedTime = sessionStorage.getItem('lastProductClick');
                console.log('[Merch] Stored product:', stored);
                console.log('[Merch] Stored timestamp:', storedTime);
                
                // 使用 Promise 确保存储完成后再导航
                Promise.resolve().then(() => {
                    // 再次验证数据
                    const finalCheck = sessionStorage.getItem('pendingProduct');
                    if (finalCheck === stored) {
                        console.log('[Merch] Storage verified, navigating...');
                        
                        // 清理当前页面
                        if (window.cleanupMerchPage) {
                            window.cleanupMerchPage();
                        }
                        
                        // 导航到详情页
                        if (typeof window.loadPage === 'function') {
                            window.loadPage('event-content');
                        } else {
                            console.error('[Merch] loadPage not found');
                        }
                    } else {
                        console.error('[Merch] Storage verification failed');
                        isProcessing = false;
                    }
                });
                
            } catch (error) {
                console.error('[Merch] Storage error:', error);
                isProcessing = false;
            }
        }
        
        // 初始化
        function initMerchPage() {
            console.log('[Merch] Initializing...');
            
            // 使用 setTimeout 确保 DOM 完全就绪
            setTimeout(() => {
        // 获取所有产品容器
        const machinesContainer = document.querySelector('.machines');
        const softwareContainer = document.querySelector('.software-items');
        
        if (!machinesContainer) {
            console.error('[Merch] Machines container not found');
        }
        
        if (!softwareContainer) {
            console.error('[Merch] Software container not found');
        }
        
        // 存储处理器引用
        window[NAMESPACE] = { handleProductClick };
        
        // 为两个容器都添加事件监听
        if (machinesContainer) {
            machinesContainer.addEventListener('click', handleProductClick, true);
            console.log('[Merch] Event listener attached to machines');
        }
        
        if (softwareContainer) {
            softwareContainer.addEventListener('click', handleProductClick, true);
            console.log('[Merch] Event listener attached to software');
        }
        
        // 重置处理标志
        isProcessing = false;
    }, 100);
}
        
        // 确保 DOM 加载完成后初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initMerchPage);
        } else {
            initMerchPage();
        }
        
        // 调试信息
        console.log('[Merch] Script complete');
    })();</script>