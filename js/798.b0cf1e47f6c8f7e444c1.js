"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[798],{59798:(e,t,n)=>{var a=n(50697),r=n.n(a),s=n(26100),i=n.n(s),o=n(96319),d=n.n(o),l=n(78928),c=n.n(l),u=n(36751),p=n.n(u),f=n(25110),g=n.n(f),m=n(53930),b=n.n(m),v=n(85073),y=n(27842),x=n(49859),h=n(34963),w=n(44828),k=n.n(w),E=n(56255),A=n.n(E),I=n(86226),_=n.n(I),P=n(36586),S=n.n(P),D=n(48079),C=n.n(D),L=n(11393),T=n.n(L),q=n(43981),N=n.n(q),z=n(8628),F=n.n(z),B=n(66615),U=n.n(B),M=n(59261),O=n.n(M),R=n(11265),j=n.n(R),H=n(385),G=n.n(H),V=n(61240),K=n.n(V);function X(e,t){var n=r()(e);if(i()){var a=i()(e);t&&(a=d()(a).call(a,function(t){return c()(e,t).enumerable})),n.push.apply(n,a)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n,a,r=null!=arguments[t]?arguments[t]:{};t%2?_()(n=X(Object(r),!0)).call(n,function(t){(0,x.A)(e,t,r[t])}):p()?g()(e,p()(r)):_()(a=X(Object(r))).call(a,function(t){b()(e,t,c()(r,t))})}return e}var Y=!1,J=!1;document.querySelectorAll(".menu-item"),document.querySelectorAll(".content-section");function Q(){Y||(Y=!0,document.addEventListener("click",Z),document.addEventListener("keydown",function(e){"Escape"===e.key&&oe()}))}function Z(e){if(e.target.classList.contains("menu-item")){var t,n,a=e.target.getAttribute("data-target");if(!a)return;_()(t=document.querySelectorAll(".menu-item")).call(t,function(e){return e.classList.remove("active")}),e.target.classList.add("active"),_()(n=document.querySelectorAll(".content-section")).call(n,function(e){return e.classList.remove("active")});var r=document.getElementById(a);return r&&r.classList.add("active"),"draft"===a&&ee(),"order"===a&&pe(),void("setting"===a&&ye())}if(e.target.classList.contains("load-draft-btn")){e.preventDefault(),e.stopPropagation();var s=e.target.getAttribute("data-draft-id");s&&function(e){re.apply(this,arguments)}(s)}else if(e.target.classList.contains("delete-draft-btn")){e.preventDefault(),e.stopPropagation();var i=e.target.getAttribute("data-draft-id");i&&!J&&function(e){ae.apply(this,arguments)}(i)}else if(e.target.classList.contains("edit-draft")){e.preventDefault(),e.stopPropagation();var o=e.target.getAttribute("data-draft-id");o&&function(e){de.apply(this,arguments)}(o)}else if(e.target.classList.contains("add-to-cart-tshirt")){e.preventDefault(),e.stopPropagation();var d=e.target.getAttribute("data-draft-id");if(d){var l=document.querySelectorAll("#draftPreviewModal .quantity-input"),c={},u=!1;if(_()(l).call(l,function(e){var t=e.getAttribute("data-size"),n=S()(e.value)||0;n>0&&(c[t]=n,u=!0)}),!u)return void alert("Please select at least one size");!function(e,t){$.apply(this,arguments)}(d,c)}}else if(e.target.classList.contains("add-in-gallery")){e.preventDefault(),e.stopPropagation();var p=e.target.getAttribute("data-draft-id");p&&function(e){le.apply(this,arguments)}(p)}else if(e.target.classList.contains("modal-overlay"))"draftPreviewModal"===e.target.id&&oe();else if(e.target.classList.contains("view-order-details-btn")){e.preventDefault(),e.stopPropagation();var f=e.target.getAttribute("data-order-id");f&&viewOrderDetails(f)}else if(e.target.classList.contains("cancel-order-btn")){e.preventDefault(),e.stopPropagation();var g=e.target.getAttribute("data-order-id");g&&function(e){ve.apply(this,arguments)}(g)}else if(e.target.classList.contains("track-order-btn")){e.preventDefault(),e.stopPropagation();var m=e.target.getAttribute("data-order-id"),b=e.target.getAttribute("data-tracking-number");m&&function(e,t,n){me.apply(this,arguments)}(m,b)}else if(e.target.classList.contains("reorder-items-btn")){e.preventDefault(),e.stopPropagation();var v=e.target.getAttribute("data-order-id");v&&reorderItems(v)}else{if(e.target.classList.contains("close-tracking-modal-x-btn"))return e.preventDefault(),e.stopPropagation(),void closeTrackingModal();if(e.target.classList.contains("close-tracking-modal-btn"))return e.preventDefault(),e.stopPropagation(),void closeTrackingModal();if(e.target.classList.contains("open-courier-website-btn")){e.preventDefault(),e.stopPropagation();var y=e.target.getAttribute("data-tracking-number");y&&window.open("https://www.example-courier.com/track/".concat(y),"_blank")}else e.target.classList.contains("modal-overlay")?"draftPreviewModal"===e.target.id&&oe():"trackingModal"!==e.target.id||closeTrackingModal()}}function $(){return($=(0,h.A)(k().mark(function e(t,n){var a,r,s,i,o,d,l,c,u,p,f,g;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.from("drafts").select("*").eq("id",t).single();case 1:if(a=e.sent,r=a.data,!a.error&&r){e.next=2;break}return alert("Unable to add to cart"),e.abrupt("return");case 2:return s=29.99,r.data&&(i=r.data,o=i.color||"white",d=i.backImages&&i.backImages.length>0,l=d?"double-sided":"single-sided",window.TSHIRT_PRICING&&window.TSHIRT_PRICING[l]&&(s="white"===o?window.TSHIRT_PRICING[l].white:"black"===o?window.TSHIRT_PRICING[l].black:window.TSHIRT_PRICING[l].colored)),e.next=3,supabase.auth.getUser();case 3:if(c=e.sent,u=c.data.user){e.next=4;break}return alert("Please login first"),e.abrupt("return");case 4:return p=W(W({},r.data),{},{sizeQuantities:n}),e.next=5,supabase.from("drafts").update({data:p,sizes:n,updated_at:(new Date).toISOString()}).eq("id",t);case 5:if(f=e.sent,f.error,!window.CartManager||!window.CartManager.addOrUpdateCartItem){e.next=7;break}return e.next=6,window.CartManager.addOrUpdateCartItem({draftId:t,itemData:{type:"custom-design",designType:"custom",color:(null===(g=r.data)||void 0===g?void 0:g.color)||"white",title:r.title||"Custom T-shirt Design",unitPrice:s},sizes:n,userId:u.id});case 6:e.sent;case 7:e.next=9;break;case 8:e.prev=8,e.catch(0),alert("Operation failed, please try again.");case 9:case"end":return e.stop()}},e,null,[[0,8]])}))).apply(this,arguments)}function ee(){return te.apply(this,arguments)}function te(){return(te=(0,h.A)(k().mark(function e(){var t,n,a,r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:if(t=e.sent,n=t.data.user){e.next=2;break}return e.abrupt("return");case 2:return e.next=3,supabase.from("drafts").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});case 3:if(a=e.sent,r=a.data,!a.error){e.next=4;break}return e.abrupt("return");case 4:ne(r),e.next=6;break;case 5:e.prev=5,e.catch(0);case 6:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}function ne(e){var t=document.getElementById("draft");if(t){var n=C()(e).call(e,function(e){var t,n,a,r,s,i="";return("svg"===e.type||"tshirt"===e.type)&&(i=e.front_preview_image),T()(t=T()(n=T()(a=T()(r=T()(s='\n        <div class="draft-item" data-id="'.concat(e.id,'">\n            <div style="display: flex; align-items: center; gap: 10px;">\n                <img src="')).call(s,i,'" alt="预览" \n                     style="width: 80px; height: 80px; object-fit: cover;  border: 2px solid black; ">\n                <div style="flex: 1;">\n                    <p>')).call(r,"svg"===e.type?"DOODLE":"T-SHIRT","</p>\n                    <p>CREATED: ")).call(a,new Date(e.created_at).toLocaleString(),'</p>\n                </div>\n                <div>\n                    <button class="load-draft-btn" data-draft-id="')).call(n,e.id,'" style="margin-right: 10px; border: 2px solid black; background:white; width:100px;font-size: 15px">LOAD</button>\n                    <button class="delete-draft-btn" data-draft-id="')).call(t,e.id,'" style="color: black;border: 2px solid black; background:white; width:100px; font-size: 15px">DELETE</button>\n                </div>\n            </div>\n        </div>\n        ')}).join("");t.innerHTML=n}}function ae(){return(ae=(0,h.A)(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!J){e.next=1;break}return e.abrupt("return");case 1:J=!0,A()((0,h.A)(k().mark(function e(){var n,a,r,s,i,o,d,l,c,u,p,f,g,m;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(confirm("确定要删除这个草稿吗？")){e.next=1;break}return J=!1,e.abrupt("return");case 1:return e.prev=1,e.next=2,supabase.from("drafts").select("*").eq("id",t).single();case 2:if(n=e.sent,a=n.data,!n.error){e.next=3;break}return alert("删除失败"),J=!1,e.abrupt("return");case 3:if(r=[],s=function(e){if(!e||"string"!=typeof e)return null;var t=e.match(/\/storage\/v1\/object\/public\/design-files\/(.+)/);return t?t[1]:null},"svg"===a.type?(a.data&&(a.data.storageUrl&&(i=s(a.data.storageUrl))&&r.push(i),a.data.fileName&&(F()(r).call(r,a.data.fileName)||r.push(a.data.fileName))),a.front_preview_image&&(o=s(a.front_preview_image))&&!F()(r).call(r,o)&&r.push(o)):"tshirt"===a.type&&((d=a.data)&&(d.frontImages&&U()(d.frontImages)&&_()(l=d.frontImages).call(l,function(e,t){if(e.storageFile)if(e.storageFile.fileName)r.push(e.storageFile.fileName);else if(e.storageFile.publicUrl){var n=s(e.storageFile.publicUrl);n&&!F()(r).call(r,n)&&r.push(n)}}),d.backImages&&U()(d.backImages)&&_()(c=d.backImages).call(c,function(e,t){if(e.storageFile)if(e.storageFile.fileName)r.push(e.storageFile.fileName);else if(e.storageFile.publicUrl){var n=s(e.storageFile.publicUrl);n&&!F()(r).call(r,n)&&r.push(n)}}),d.frontPreviewFile&&d.frontPreviewFile.fileName&&r.push(d.frontPreviewFile.fileName),d.backPreviewFile&&d.backPreviewFile.fileName&&r.push(d.backPreviewFile.fileName)),a.front_preview_image&&(u=s(a.front_preview_image))&&!F()(r).call(r,u)&&r.push(u),a.back_preview_image&&(p=s(a.back_preview_image))&&!F()(r).call(r,p)&&r.push(p)),!((f=(0,y.A)(new(O())(r))).length>0)){e.next=5;break}return e.next=4,supabase.storage.from("design-files").remove(f);case 4:g=e.sent,g.data,g.error;case 5:return e.next=6,supabase.from("drafts").delete().eq("id",t);case 6:if(m=e.sent,!m.error){e.next=7;break}alert("删除失败"),e.next=8;break;case 7:return alert("草稿已删除"),e.next=8,ee();case 8:e.next=10;break;case 9:e.prev=9,e.catch(1),alert("删除失败");case 10:return e.prev=10,A()(function(){J=!1},500),e.finish(10);case 11:case"end":return e.stop()}},e,null,[[1,9,10,11]])})),0);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function re(){return(re=(0,h.A)(k().mark(function e(t){var n,a;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.from("drafts").select("*").eq("id",t).single();case 1:if(n=e.sent,a=n.data,!n.error){e.next=2;break}return e.abrupt("return");case 2:"svg"===a.type?se(a):"tshirt"===a.type&&ie(a),e.next=4;break;case 3:e.prev=3,e.catch(0);case 4:case"end":return e.stop()}},e,null,[[0,3]])}))).apply(this,arguments)}function se(e){var t,n,a=T()(t=T()(n='\n        <div id="draftPreviewModal" class="modal-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000;  display: flex; justify-content: center; align-items: center;">\n            <div class="modal-content" style="background: white; padding: 25px; max-width: 70vh; max-height: 80vh; overflow-y: auto; border: 2px solid black;">\n                <div class="preview-container" style="display: flex; gap: 30px; justify-content: center; margin-bottom: 20px;">\n                    <div class="preview-item" style="text-align: center;">\n                        <span style="font-size: 18px; margin-bottom: 10px; display: block;">PREVIEW</span>\n                        <div class="preview-tshirt" style="width: 200px; height: 250px; background-image: url(\''.concat(e.front_preview_image,'\'); background-size: contain; background-repeat: no-repeat; background-position: center; margin: 0 auto; outline: none; box-shadow: none;border: 2px solid black;"></div>\n                    </div>\n                </div>\n              \n                <div class="modal-buttons" style="display: flex; gap: 20px; justify-content: space-between;">\n                    <button class="edit-draft" data-draft-id="')).call(n,e.id,'" style="width: 200px; font-size: 16px; border: 2px solid black; background: white; cursor: pointer; min-width: 150px;">BACK TO EDIT</button>\n                    <button class="add-in-gallery" data-draft-id="')).call(t,e.id,'" style="width: 200px; font-size: 16px; border: 2px solid black; background: white; cursor: pointer; min-width: 150px;">ADD TO GALLERY</button>\n                </div>\n            </div>\n        </div>\n    ');document.body.insertAdjacentHTML("beforeend",a)}function ie(e){var t,n,a,r,s,i,o=(null===(t=e.data)||void 0===t?void 0:t.sizeQuantities)||e.sizes||{XS:0,S:0,M:0,L:0,XL:0,"2XL":0,"3XL":0},d=T()(n=T()(a=T()(r=T()(s='\n    <div id="draftPreviewModal" class="modal-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; display: flex; justify-content: center; align-items: center;">\n    <div class="modal-content" style="background: white; padding: 25px; max-width: 70vh; max-height: 80vh; overflow-y: auto; border: 2px solid black; position: relative;">\n        <div class="preview-container" style="display: flex; gap: 30px; justify-content: center; margin-bottom: 20px;">\n            <div class="preview-item" style="text-align: center;">\n                <span style="font-size: 18px; margin-bottom: 10px; display: block;">FRONT</span>\n                <div style="border: 2px black solid;">\n                    <div class="preview-tshirt" style="width: 200px; height: 250px; background-image: url(\''.concat(e.front_preview_image,'\'); background-size: contain; background-repeat: no-repeat; background-position: center; margin: 0 auto;"></div>\n                </div>\n            </div>\n            <div class="preview-item" style="text-align: center;">\n                <span style="font-size: 18px; margin-bottom: 10px; display: block;">BACK</span>\n                <div style="border: 2px black solid;">\n                    <div class="preview-tshirt" style="width: 200px; height: 250px; background-image: url(\'')).call(s,e.back_preview_image,'\'); background-size: contain; background-repeat: no-repeat; background-position: center; margin: 0 auto;"></div>\n                </div>\n            </div>\n        </div>\n        \n        <div class="size-selection-horizontal" style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-bottom: 20px;">\n            ')).call(r,C()(i=["XS","S","M","L","XL","2XL","3XL"]).call(i,function(e){var t,n;return T()(t=T()(n='\n                <div class="size-option">\n                    <label>'.concat(e,'</label>\n                    <div class="quantity-control" style="display: flex; align-items: center; overflow: hidden;">\n                        <input type="number" class="quantity-input" data-size="')).call(n,e,'" value="')).call(t,o[e]||0,'" min="0" max="99" style="width: 45px; height: 30px; text-align: center; border: 2px solid black;">\n                    </div>\n                </div>\n            ')}).join(""),'\n        </div>\n        \n        <div class="modal-buttons" style="display: flex; gap: 20px; justify-content: space-between;">\n            <button class="edit-draft" data-draft-id="')).call(a,e.id,'" style="width: 200px; font-size: 16px; border: 2px solid black; background: white; cursor: pointer; min-width: 150px;">BACK TO EDIT</button>\n            <button class="add-to-cart-tshirt" data-draft-id="')).call(n,e.id,'" style="width: 200px; font-size: 16px; border: 2px solid black; background: white; cursor: pointer; min-width: 150px;">UPDATE CART</button>\n        </div>\n    </div>\n</div>\n    ');document.body.insertAdjacentHTML("beforeend",d)}function oe(){var e=document.getElementById("draftPreviewModal");e&&e.remove()}function de(){return(de=(0,h.A)(k().mark(function e(t){var n,a;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.from("drafts").select("*").eq("id",t).single();case 1:if(n=e.sent,a=n.data,!n.error&&a){e.next=2;break}return alert("无法加载草稿"),e.abrupt("return");case 2:"svg"===a.type?window.location.href="/home?loadSvgDraft=".concat(t):"tshirt"===a.type&&(window.location.href="/home?loadTshirtDraft=".concat(t)),e.next=4;break;case 3:e.prev=3,e.catch(0),alert("加载失败，请重试");case 4:case"end":return e.stop()}},e,null,[[0,3]])}))).apply(this,arguments)}function le(){return(le=(0,h.A)(k().mark(function e(t){var n,a,r,s,i,o,d,l,c,u,p,f,g;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:if(s=e.sent,i=s.data.user){e.next=2;break}return alert("请先登录"),e.abrupt("return");case 2:return e.next=3,supabase.from("drafts").select("*").eq("id",t).single();case 3:if(o=e.sent,d=o.data,!o.error&&d){e.next=4;break}return alert("无法获取草稿信息"),e.abrupt("return");case 4:if("svg"===d.type){e.next=5;break}return alert("只能将SVG草稿添加到Gallery"),e.abrupt("return");case 5:return e.next=6,supabase.from("gallery").select("id").eq("draft_id",t).maybeSingle();case 6:if(l=e.sent,!l.data){e.next=7;break}return alert("This artwork is already in the gallery!"),e.abrupt("return");case 7:return c=prompt("Give your artwork a title:","My Doodle")||"Untitled",u=prompt("Add a description (optional):","")||"",p={user_id:i.id,draft_id:t,title:c,description:u,preview_image:d.front_preview_image,svg_url:(null===(n=d.data)||void 0===n?void 0:n.storageUrl)||null,svg_data:(null===(a=d.data)||void 0===a?void 0:a.svgContent)||(null===(r=d.data)||void 0===r?void 0:r.svgData)||null},e.next=8,supabase.from("gallery").insert([p]).select().single();case 8:if(f=e.sent,f.data,!(g=f.error)){e.next=9;break}return alert("添加失败："+g.message),e.abrupt("return");case 9:if(!confirm("Successfully added to gallery! Do you want to delete this draft?")){e.next=11;break}return e.next=10,ce(t);case 10:e.next=13;break;case 11:if(oe(),!confirm("View in gallery now?")){e.next=12;break}"function"==typeof loadPage?loadPage("gallery"):window.location.href="/gallery",e.next=13;break;case 12:return e.next=13,ee();case 13:e.next=15;break;case 14:e.prev=14,e.catch(0),alert("添加失败，请重试");case 15:case"end":return e.stop()}},e,null,[[0,14]])}))).apply(this,arguments)}function ce(e){return ue.apply(this,arguments)}function ue(){return(ue=(0,h.A)(k().mark(function e(t){var n,a,r,s,i,o,d,l,c,u;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.from("drafts").select("*").eq("id",t).single();case 1:if(n=e.sent,a=n.data,!n.error){e.next=2;break}return e.abrupt("return");case 2:if(r=[],s=function(e){if(!e||"string"!=typeof e)return null;var t=e.match(/\/storage\/v1\/object\/public\/design-files\/(.+)/);return t?t[1]:null},"svg"===a.type&&(null!==(i=a.data)&&void 0!==i&&i.storageUrl&&(d=s(a.data.storageUrl))&&r.push(d),null!==(o=a.data)&&void 0!==o&&o.fileName&&r.push(a.data.fileName)),!((l=(0,y.A)(new(O())(r))).length>0)){e.next=4;break}return e.next=3,supabase.storage.from("design-files").remove(l);case 3:c=e.sent,c.error;case 4:return e.next=5,supabase.from("drafts").delete().eq("id",t);case 5:if(u=e.sent,!u.error){e.next=6;break}alert("草稿删除失败"),e.next=8;break;case 6:if(oe(),!confirm("Draft deleted. View in gallery now?")){e.next=7;break}"function"==typeof loadPage?loadPage("gallery"):window.location.href="/gallery",e.next=8;break;case 7:return e.next=8,ee();case 8:e.next=10;break;case 9:e.prev=9,e.catch(0);case 10:case"end":return e.stop()}},e,null,[[0,9]])}))).apply(this,arguments)}function pe(){return fe.apply(this,arguments)}function fe(){return(fe=(0,h.A)(k().mark(function e(){var t,n,a,r,s;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:if(t=e.sent,n=t.data.user,!t.error&&n){e.next=2;break}return(a=document.getElementById("order"))&&(a.innerHTML='<p style="text-align: center; padding: 20px;">Please login to view your orders</p>'),e.abrupt("return");case 2:return e.next=3,supabase.from("orders").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});case 3:if(r=e.sent,s=r.data,!r.error){e.next=4;break}return e.abrupt("return");case 4:ge(s),e.next=6;break;case 5:e.prev=5,e.catch(0);case 6:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}function ge(e){var t=document.getElementById("order");if(t)if(e&&0!==e.length){var n="";_()(e).call(e,function(e){var t,a,r,s,i,o,d,l,c,u,p,f,g,m,b,v,y,x,h,w,k,E,A,I,_,P=new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),S=e.paid_at?new Date(e.paid_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Not paid",D="",L="#666";switch(e.status){case"awaiting_verification":D="AWAITING VERIFICATION (等待审核)",L="#FFA500";break;case"verified":D="PAYMENT VERIFIED (付款已确认)",L="#28a745";break;case"shipped":D="SHIPPED (已发货)",L="#17a2b8";break;case"delivered":D="DELIVERED (已送达)",L="#28a745";break;case"cancelled":D="CANCELLED (已取消)",L="#dc3545";break;default:D=e.status.toUpperCase()}var q=N()(e.amount)||0,z=N()(e.shipping_cost)||0,F=N()(e.tax_amount)||0,B=q+z+F,U="";if("awaiting_verification"===e.status||"verified"===e.status)U+='\n         <button class="cancel-order-btn" data-order-id="'.concat(e.order_id,'"  style="\n             padding: 5px 20px;\n             font-size:15px;\n             background: white;\n             color: black;\n             cursor: pointer;\n             border: 2px black solid;\n         ">CANCEL ORDER</button>\n     ');else if("shipped"===e.status||"delivered"===e.status){var M;U+=T()(M='\n         <button class="track-order-btn" data-order-id="'.concat(e.order_id,'" data-tracking-number="')).call(M,e.tracking_number||"",'"  style="\n         padding: 5px 20px;\n         font-size:15px;\n         background: white;\n         color: black;\n         cursor: pointer;\n         border: 2px black solid;\n         ">ORDER TRACKING</button>\n     ')}n+=T()(t=T()(a=T()(r=T()(s=T()(i=T()(o=T()(d=T()(l=T()(c=T()(u=T()(p=T()(f=T()(g=T()(m=T()(b='\n            <div class="order-item" style="\n                background: white;\n                border: 2px solid black;\n                padding: 20px;\n                margin-bottom: 20px;\n                position: relative;\n            ">\n                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">\n                    <div>\n                        <h3 style="margin: 0; font-size: 20px;">ORDER #'.concat(e.order_id,'</h3>\n                        <p style="color: #666; margin: 5px 0; font-size: 14px;">Placed on ')).call(b,P,'</p>\n                    </div>\n                    <div style="text-align: right;">\n                        <span style="\n                            background: ')).call(m,L,';\n                            color: white;\n                            padding: 5px 10px;\n                            font-size: 15px;\n                            font-weight: bold;\n                            display: inline-block;\n                        ">')).call(g,D,'</span>\n                    </div>\n                </div>\n\n                <div style="  margin-bottom: 15px; font-size: 15px;">\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">\n                        <span>Manifesto#:</span>\n                        <span>')).call(f,e.manifesto||"Anonymous",'</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">\n                        <span>Payment Method:</span>\n                        <span>')).call(p,"alipay"===e.payment_method?"Alipay (支付宝)":"wechat"===e.payment_method?"WeChat Pay (微信支付)":e.payment_method,"</span>\n                    </div>\n                    ")).call(u,e.paid_at?'\n                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">\n                            <span>Paid At:</span>\n                            <span>'.concat(S,"</span>\n                        </div>\n                    "):"",'\n                </div>\n\n                <div style="border-top: 2px solid black; padding-top: 15px; margin-bottom: 15px;">\n                    <h4 style="margin-bottom: 10px;">Items (')).call(c,e.items?e.items.length:0,")</h4>\n                    ")).call(l,e.items&&e.items.length>0?'\n                        <div style="max-height: 200px; overflow-y: auto;">\n                            '.concat(C()(v=e.items).call(v,function(e){var t,n,a;return T()(t=T()(n=T()(a='\n                                <div style="\n                                    display: flex;\n                                    justify-content: space-between;\n                                   \n                                    margin-bottom: 5px;\n                                ">\n                                    <div>\n                                        <strong>'.concat(e.drafts?e.drafts.title:"Item","</strong>\n                                        ")).call(a,e.size?'<span style="color: #666; ">Size: '.concat(e.size,"</span>"):"","\n                                        ")).call(n,e.quantity>1?'<span style="color: #666; margin-left: 10px;">× '.concat(e.quantity,"</span>"):"","\n                                    </div>\n                                    <div>\n                                        ¥")).call(t,(N()(e.price)*(e.quantity||1)).toFixed(2),"\n                                    </div>\n                                </div>\n                            ")}).join(""),"\n                        </div>\n                    "):'<p style="color: #999;">No item details available</p>','\n                </div>\n\n                <div style="border-top: black 2px solid ; padding-top: 15px; margin-bottom: 15px;">\n                    <h4 style="margin-bottom: 10px;">Shipping Address</h4>\n                    ')).call(d,e.shipping_address?T()(y=T()(x=T()(h=T()(w=T()(k=T()(E=T()(A=T()(I='\n                        <div style="  font-size: 14px;">\n                       '.concat(e.shipping_address.fullName||e.shipping_address.name||"","<br>\n                        ")).call(I,e.shipping_address.email?"Email: ".concat(e.shipping_address.email,"<br>"):"","\n                        ")).call(A,e.shipping_address.phone?"Phone: ".concat(e.shipping_address.phone,"<br>"):"","\n                        ")).call(E,e.shipping_address.address1||e.shipping_address.street||"","<br>\n                        ")).call(k,e.shipping_address.address2?"".concat(e.shipping_address.address2,"<br>"):"","\n                        ")).call(w,e.shipping_address.city||""," ")).call(h,e.shipping_address.state||""," ")).call(x,e.shipping_address.zipCode||"","<br>\n                        ")).call(y,e.shipping_address.country||"","\n                        </div>\n                    "):'<p style="color: #999;">No shipping address provided</p>','\n                </div>\n\n                <div style="border-top: 2px solid black; padding-top: 15px;">\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size:15px;">\n                        <span>Subtotal:</span>\n                        <span>¥')).call(o,q.toFixed(2),'</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size:15px;">\n                        <span>Shipping:</span>\n                        <span>¥')).call(i,z.toFixed(2),'</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size:15px;">\n                        <span>Tax:</span>\n                        <span>¥')).call(s,F.toFixed(2),'</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: bold;">\n                        <span>Total:</span>\n                        <span>¥')).call(r,B.toFixed(2),"</span>\n                    </div>\n                </div>\n\n               \n                ")).call(a,e.tracking_number?T()(_='\n                    <div style="margin-top: 15px; padding: 10px;  border: 2px solid black;">\n                        <strong>Tracking Number:</strong> '.concat(e.tracking_number,"<br>\n                        <strong>Courier:</strong> ")).call(_,e.courier,"\n                    </div>\n                "):"",'\n\n                <div style="margin-top: 20px; display: flex; flex-wrap: wrap; gap: 10px;">\n                    ')).call(t,U,"\n                </div>\n          \n               \n        </div>\n        ")}),t.innerHTML=n}else t.innerHTML='\n            <div style="text-align: center; padding: 40px;">\n                <h2 style="color: black; margin-bottom: 20px;">NO ORDERS YET</h2>\n                <p style="color: #999;">Your orders will appear here after purchase</p>\n            </div>\n        '}function me(){return(me=(0,h.A)(k().mark(function e(t,n,a){var r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=1;break}return alert("Tracking number not available yet.\n追踪号码尚未生成。\n\nPlease check back later.\n请稍后再查看。"),e.abrupt("return");case 1:r="https://www.17track.net/en#nums=".concat(n,"&auto=1"),window.open(r,"_blank");case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}document.addEventListener("DOMContentLoaded",function(){A()((0,h.A)(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof window.displayUserProfile){e.next=2;break}return e.next=1,window.displayUserProfile();case 1:e.next=3;break;case 2:A()((0,h.A)(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof window.displayUserProfile){e.next=1;break}return e.next=1,window.displayUserProfile();case 1:case"end":return e.stop()}},e)})),1e3);case 3:case"end":return e.stop()}},e)})),200),Q()}),"undefined"!=typeof window&&"undefined"!=typeof displayUserProfile&&(window.displayUserProfile=displayUserProfile),window.reloadProfileBarcode=(0,h.A)(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,displayUserProfile();case 1:e.next=3;break;case 2:e.prev=2,e.catch(0);case 3:case"end":return e.stop()}},e,null,[[0,2]])})),window.addEventListener("profilePageLoaded",(0,h.A)(k().mark(function e(){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof displayUserProfile){e.next=1;break}return e.next=1,displayUserProfile();case 1:case"end":return e.stop()}},e)}))),function e(){try{if("undefined"!=typeof supabase&&document.getElementById("draft")){var t,n=document.querySelector('.menu-item[data-target="draft"]');if(n&&!n.classList.contains("active"))_()(t=document.querySelectorAll(".menu-item")).call(t,function(e){return e.classList.remove("active")}),n.classList.add("active");var a,r=document.getElementById("draft");if(r&&!r.classList.contains("active"))_()(a=document.querySelectorAll(".content-section")).call(a,function(e){return e.classList.remove("active")}),r.classList.add("active");ee()}else A()(e,200)}catch(t){A()(e,200)}}(),document.addEventListener("DOMContentLoaded",function(){Q();var e=window.handleGlobalClick;window.handleGlobalClick=function(t){if(t.target.classList.contains("menu-item")){var n=t.target.getAttribute("data-target");if("order"===n){var a,r;_()(a=document.querySelectorAll(".menu-item")).call(a,function(e){return e.classList.remove("active")}),t.target.classList.add("active"),_()(r=document.querySelectorAll(".content-section")).call(r,function(e){return e.classList.remove("active")});var s=document.getElementById(n);return s&&s.classList.add("active"),void pe()}}e&&e.call(this,t)}}),window.addEventListener("orderSubmitted",function(e){var t=document.getElementById("order");t&&t.classList.contains("active")&&pe()});var be=window.confirmPayment;function ve(){return(ve=(0,h.A)(k().mark(function e(t){var n,a,r,s,i,o,d,l;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(confirm(T()(n="Are you sure you want to cancel order #".concat(t,"?\n您确定要取消订单 #")).call(n,t," 吗？\n\nThis action cannot be undone.\n此操作无法撤销。"))){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,e.next=2,supabase.auth.getUser();case 2:if(r=e.sent,s=r.data.user,!r.error&&s){e.next=3;break}return alert("Please login to cancel order"),e.abrupt("return");case 3:return e.next=4,supabase.from("orders").update({status:"cancelled",cancelled_at:(new Date).toISOString()}).eq("order_id",t).eq("user_id",s.id).select().single();case 4:if(i=e.sent,i.data,!(o=i.error)){e.next=8;break}if("PGRST204"!==o.code&&!F()(d=o.message).call(d,"column")){e.next=7;break}return e.next=5,supabase.from("orders").update({status:"cancelled"}).eq("order_id",t).eq("user_id",s.id).select().single();case 5:if(l=e.sent,l.data,!l.error){e.next=6;break}return alert("Failed to cancel order. Please try again.\n取消订单失败，请重试。"),e.abrupt("return");case 6:(0,v.A)("data"),e.next=8;break;case 7:return alert("Failed to cancel order. Please try again.\n取消订单失败，请重试。"),e.abrupt("return");case 8:return alert(T()(a="Order #".concat(t," has been cancelled successfully.\n订单 #")).call(a,t," 已成功取消。\n\nRefund will be processed within 3-5 business days.\n退款将在3-5个工作日内处理。")),e.next=9,pe();case 9:e.next=11;break;case 10:e.prev=10,e.catch(1),alert("An unexpected error occurred. Please try again.\n发生意外错误，请重试。");case 11:case"end":return e.stop()}},e,null,[[1,10]])}))).apply(this,arguments)}function ye(){return xe.apply(this,arguments)}function xe(){return(xe=(0,h.A)(k().mark(function e(){var t,n,a,r,s,i,o,d,l,c,u;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("setting")){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,e.next=2,supabase.auth.getUser();case 2:if(d=e.sent,l=d.data.user,!d.error&&l){e.next=3;break}return t.innerHTML='<p style="text-align: center; padding: 20px;">Please login to access settings</p>',e.abrupt("return");case 3:return e.next=4,supabase.from("profiles").select("manifesto, shipping_addresses").eq("user_id",l.id).single();case 4:c=e.sent,u=c.data,c.error,window.currentAddresses=(null==u?void 0:u.shipping_addresses)||[],t.innerHTML=T()(n=T()(a=T()(r=T()(s=T()(i='\n            <style>\n                .settings-section {\n                    border: 2px solid black;\n                    padding: 20px;\n                    margin-bottom: 20px;\n                    background: white;\n                }\n                \n                .settings-section h3 {\n                    margin-top: 0;\n                    margin-bottom: 20px;\n                    font-size: 20px;\n                    border-bottom: 2px solid black;\n                    padding-bottom: 10px;\n                }\n                \n                .form-group {\n                    margin-bottom: 15px;\n                }\n                \n                .form-group label {\n                    display: block;\n                    margin-bottom: 5px;\n                    font-weight: bold;\n                    font-size: 14px;\n                }\n                \n                .form-group input, .form-group select {\n                    width: 100%;\n                    padding: 10px;\n                    border: 2px solid black;\n                    font-size: 14px;\n                    box-sizing: border-box;\n                    background: white;\n                }\n                \n                .form-group input[type="checkbox"] {\n                    width: auto;\n                    margin-right: 10px;\n                    transform: scale(1.2);\n                }\n                \n                .form-group label input[type="checkbox"] {\n                    display: inline;\n                    margin-right: 8px;\n                }\n                \n                .settings-btn {\n                    padding: 8px 20px;\n                    background: black;\n                    color: white;\n                    border: none;\n                    cursor: pointer;\n                    font-size: 16px;\n                    margin-right: 10px;\n                    margin-bottom: 5px;\n                }\n                \n                .settings-btn:hover {\n                    background: #333;\n                }\n                \n                .settings-btn:disabled {\n                    background: #999;\n                    cursor: not-allowed;\n                }\n                \n                .settings-btn.secondary {\n                    background: #666;\n                }\n                \n                .settings-btn.secondary:hover {\n                    background: #555;\n                }\n                \n                .success-message, .error-message {\n                    background: black;\n                    color: white;\n                    padding: 5px;\n                    margin-bottom: 10px;\n                    display: none;\n                    border-radius:0;\n                    position: relative;\n                    font-size:16px;\n                }\n                \n                \n                .two-columns {\n                    display: grid;\n                    grid-template-columns: 1fr 1fr;\n                    gap: 15px;\n                }\n                \n                .address-card {\n                    border: 2px solid black;\n                    padding: 15px;\n                    margin-bottom: 15px;\n                    position: relative;\n                }\n                \n                .address-card .address-header {\n                    display: flex;\n                    align-items: center;\n                    margin-bottom: 10px;\n                }\n                \n                .address-card .default-badge {\n                    background: black;\n                    color: white;\n                    padding: 2px 8px;\n                    font-size: 12px;\n                    margin-left: 15px;\n                    font-weight: bold;\n                }\n                \n                .address-card .address-info {\n                    font-size: 14px;\n                    color: #555;\n                    line-height: 1.4;\n                }\n                \n                .address-card .address-actions {\n                    margin-top: 15px;\n                    display: flex;\n                    gap: 10px;\n                    flex-wrap: wrap;\n                }\n                \n                .address-card .settings-btn {\n                    padding: 5px 12px;\n                    font-size: 12px;\n                    margin: 0;\n                }\n                \n                @media (max-width: 768px) {\n                    .two-columns {\n                        grid-template-columns: 1fr;\n                    }\n                    \n                    .address-card .address-actions {\n                        flex-direction: column;\n                    }\n                    \n                    .address-card .settings-btn {\n                        width: 100%;\n                        margin-bottom: 5px;\n                    }\n                }\n            </style>\n            \n            \x3c!-- Manifesto Section --\x3e\n            <div class="settings-section">\n                <h3>MANIFESTO USERNAME</h3>\n                <div id="manifestoMessage" class="success-message">Manifesto updated successfully!</div>\n                <div id="manifestoError" class="error-message"></div>\n                \n                <form id="manifestoForm">\n                    <div class="form-group">\n                        <label for="manifesto">Your Manifesto:</label>\n                        <input type="text" \n                               id="manifesto" \n                               name="manifesto" \n                               value="'.concat((null==u?void 0:u.manifesto)||"",'" \n                               placeholder="Enter your manifesto"\n                               maxlength="50">\n                    </div>\n                    <button type="submit" class="settings-btn save-manifesto-btn">SAVE MANIFESTO</button>\n                </form>\n            </div>\n            \n            \x3c!-- Shipping Information Section --\x3e\n            <div class="settings-section">\n                <h3>SHIPPING INFORMATION</h3>\n                <div id="shippingMessage" class="success-message">Shipping information updated successfully!</div>\n                <div id="shippingError" class="error-message"></div>\n                \n                \x3c!-- 已保存的地址列表 --\x3e\n                ')).call(i,null!=u&&u.shipping_addresses&&u.shipping_addresses.length>0?'\n                    <div style="margin-bottom: 25px;">\n                        <h4 style="margin-bottom: 15px; font-size: 16px;">Saved Addresses:</h4>\n                        '.concat(C()(o=u.shipping_addresses).call(o,function(e,t){var n,a,r,s,i,o,d,l,c,u,p;return T()(n=T()(a=T()(r=T()(s=T()(i=T()(o=T()(d=T()(l=T()(c=T()(u=T()(p='\n                            <div class="address-card">\n                                <div class="address-header">\n                                    <strong style="font-size: 16px;">'.concat(e.fullName,"</strong>\n                                    ")).call(p,e.isDefault?'<span class="default-badge">DEFAULT</span>':"",'\n                                </div>\n                                <div class="address-info">\n                                    ')).call(u,e.phone,"<br>\n                                    ")).call(c,e.address1," ")).call(l,e.address2||"","<br>\n                                    ")).call(d,e.city,", ")).call(o,e.state," ")).call(i,e.zipCode,"<br>\n                                    ")).call(s,e.country,'\n                                </div>\n                                <div class="address-actions">\n                                    <button class="settings-btn edit-address-btn" \n                                            data-address-index="')).call(r,t,'" style="background:white; border:black 2px solid;color:black; padding:0 10px; ">\n                                        EDIT\n                                    </button>\n                                    <button class="settings-btn delete-address-btn" \n                                            data-address-index="')).call(a,t,'"\n                                            style="background:white; border:black 2px solid; color:black; padding:0 10px;">\n                                        DELETE\n                                    </button>\n                                    ')).call(n,e.isDefault?"":'\n                                        <button class="settings-btn set-default-btn" \n                                                data-address-index="'.concat(t,'"\n                                                style="background:white; border:black 2px solid;color:black; padding:0 10px;">\n                                            SET AS DEFAULT\n                                        </button>\n                                    '),"\n                                </div>\n                            </div>\n                        ")}).join(""),"\n                    </div>\n                "):"",'\n                \n                \x3c!-- 添加/编辑地址表单 --\x3e\n                <div id="addressFormContainer">\n                    <h4 style="margin-bottom: 15px; font-size: 16px;">\n                        <span id="addressFormTitle">Add New Address</span>\n                    </h4>\n                    <form id="shippingForm">\n                        <input type="hidden" id="addressIndex" value="">\n                        \n                        <div class="two-columns">\n                            <div class="form-group">\n                                <label for="fullName">Full Name:</label>\n                                <input type="text" \n                                       id="fullName" \n                                       name="fullName" \n                                       value=""\n                                       required>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="phone">Phone Number:</label>\n                                <input type="tel" \n                                       id="phone" \n                                       name="phone" \n                                       value=""\n                                       required>\n                            </div>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label for="email">Email:</label>\n                            <input type="email" \n                                   id="email" \n                                   name="email" \n                                   value="')).call(s,l.email||"",'"\n                                   required>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label for="address1">Address Line 1:</label>\n                            <input type="text" \n                                   id="address1" \n                                   name="address1" \n                                   value=""\n                                   required>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label for="address2">Address Line 2 (Optional):</label>\n                            <input type="text" \n                                   id="address2" \n                                   name="address2" \n                                   value="">\n                        </div>\n                        \n                        <div class="two-columns">\n                            <div class="form-group">\n                                <label for="city">City:</label>\n                                <input type="text" \n                                       id="city" \n                                       name="city" \n                                       value=""\n                                       required>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="state">State/Province:</label>\n                                <input type="text" \n                                       id="state" \n                                       name="state" \n                                       value=""\n                                       required>\n                            </div>\n                        </div>\n                        \n                        <div class="two-columns">\n                            <div class="form-group">\n                                <label for="zipCode">ZIP/Postal Code:</label>\n                                <input type="text" \n                                       id="zipCode" \n                                       name="zipCode" \n                                       value=""\n                                       required>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="country">Country:</label>\n                                <select id="country" name="country" required>\n                                    <option value="">Select Country</option>\n                                    <option value="CN">中国</option>\n                                    <option value="HK">Hong Kong</option>\n                                    <option value="TW">臺灣</option>\n                                    <option value="JP">Japan</option>\n                                    <option value="UK">United Kingdom</option>\n                                <option value="US">United States</option>\n                                <option value="OTHER">Other</option>\n                                </select>\n                            </div>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label>\n                                <input type="checkbox" id="setAsDefault" name="setAsDefault">\n                                Set as default address\n                            </label>\n                        </div>\n                        \n                        <button type="submit" class="settings-btn save-shipping-btn">SAVE ADDRESS</button>\n                        <button type="button" class="settings-btn secondary cancel-edit-btn" style="display: none;">CANCEL</button>\n                    </form>\n                </div>\n            </div>\n            \n            \x3c!-- Change Password Section --\x3e\n            <div class="settings-section">\n                <h3>CHANGE PASSWORD</h3>\n                <div id="passwordMessage" class="success-message">Password updated successfully!</div>\n                <div id="passwordError" class="error-message"></div>\n                \n                <form id="passwordForm">\n                    <div class="form-group">\n                        <label for="currentPassword">Current Password:</label>\n                        <input type="password" \n                               id="currentPassword" \n                               name="currentPassword" \n                               placeholder="Enter current password"\n                               required>\n                    </div>\n                    \n                    <div class="form-group">\n                        <label for="newPassword">New Password:</label>\n                        <input type="password" \n                               id="newPassword" \n                               name="newPassword" \n                               placeholder="Enter new password"\n                               minlength="6"\n                               required>\n                    </div>\n                    \n                    <div class="form-group">\n                        <label for="confirmPassword">Confirm New Password:</label>\n                        <input type="password" \n                               id="confirmPassword" \n                               name="confirmPassword" \n                               placeholder="Confirm new password"\n                               minlength="6"\n                               required>\n                    </div>\n                    \n                    <button type="submit" class="settings-btn change-password-btn">CHANGE PASSWORD</button>\n                </form>\n            </div>\n            \n            \x3c!-- Account Info Section --\x3e\n            <div class="settings-section">\n                <h3>ACCOUNT INFORMATION</h3>\n                <div style="line-height: 1.6;">\n                    <p><strong>Email:</strong> ')).call(r,l.email,"</p>\n                    <p><strong>User ID:</strong> ")).call(a,l.id,"</p>\n                    <p><strong>Account Created:</strong> ")).call(n,new Date(l.created_at).toLocaleDateString(),"</p>\n                </div>\n            </div>\n        "),he(),e.next=6;break;case 5:e.prev=5,e.catch(1),t.innerHTML='<p style="text-align: center; padding: 20px; color: red;">Error loading settings. Please try again.</p>';case 6:case"end":return e.stop()}},e,null,[[1,5]])}))).apply(this,arguments)}function he(){var e,t,n,a=document.getElementById("manifestoForm");a&&a.addEventListener("submit",function(){var e=(0,h.A)(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=1,we();case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());var r=document.getElementById("shippingForm");r&&r.addEventListener("submit",function(){var e=(0,h.A)(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=1,Ee();case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());var s=document.getElementById("passwordForm");s&&s.addEventListener("submit",function(){var e=(0,h.A)(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=1,Pe();case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),_()(e=document.querySelectorAll(".edit-address-btn")).call(e,function(e){e.addEventListener("click",function(e){!function(e){var t=(window.currentAddresses||[])[e];if(!t)return;document.getElementById("addressIndex").value=e,document.getElementById("fullName").value=t.fullName||"",document.getElementById("phone").value=t.phone||"",document.getElementById("email").value=t.email||"",document.getElementById("address1").value=t.address1||"",document.getElementById("address2").value=t.address2||"",document.getElementById("city").value=t.city||"",document.getElementById("state").value=t.state||"",document.getElementById("zipCode").value=t.zipCode||"",document.getElementById("country").value=t.country||"",document.getElementById("setAsDefault").checked=t.isDefault||!1,document.getElementById("addressFormTitle").textContent="Edit Address",document.querySelector(".save-shipping-btn").textContent="UPDATE ADDRESS",document.querySelector(".cancel-edit-btn").style.display="inline-block",document.getElementById("addressFormContainer").scrollIntoView({behavior:"smooth",block:"start"})}(S()(e.target.dataset.addressIndex))})}),_()(t=document.querySelectorAll(".delete-address-btn")).call(t,function(e){e.addEventListener("click",function(e){!function(e){Ie.apply(this,arguments)}(S()(e.target.dataset.addressIndex))})}),_()(n=document.querySelectorAll(".set-default-btn")).call(n,function(e){e.addEventListener("click",function(e){!function(e){_e.apply(this,arguments)}(S()(e.target.dataset.addressIndex))})});var i=document.querySelector(".cancel-edit-btn");i&&i.addEventListener("click",function(){!function(){document.getElementById("shippingForm").reset(),document.getElementById("addressIndex").value="",document.getElementById("addressFormTitle").textContent="Add New Address",document.querySelector(".cancel-edit-btn").style.display="none";var e=supabase.auth.getUser().data.user;e&&(document.getElementById("email").value=e.email||"")}()})}function we(){return ke.apply(this,arguments)}function ke(){return(ke=(0,h.A)(k().mark(function e(){var t,n,a,r,s,i,o,d,l;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=j()(t=document.getElementById("manifesto").value).call(t),a=document.getElementById("manifestoMessage"),r=document.getElementById("manifestoError"),s=document.querySelector(".save-manifesto-btn"),a.style.display="none",r.style.display="none",n){e.next=1;break}return r.textContent="Manifesto name cannot be empty",r.style.display="block",e.abrupt("return");case 1:return s.disabled=!0,s.textContent="SAVING...",e.prev=2,e.next=3,supabase.auth.getUser();case 3:return i=e.sent,o=i.data.user,e.next=4,supabase.from("profiles").update({manifesto:n}).eq("user_id",o.id);case 4:if(d=e.sent,!(l=d.error)){e.next=5;break}throw l;case 5:if(a.style.display="block","function"!=typeof displayUserProfile){e.next=6;break}return e.next=6,displayUserProfile();case 6:A()(function(){a.style.display="none"},3e3),e.next=8;break;case 7:e.prev=7,e.catch(2),r.textContent="Failed to update manifesto. Please try again.",r.style.display="block";case 8:return e.prev=8,s.disabled=!1,s.textContent="SAVE MANIFESTO",e.finish(8);case 9:case"end":return e.stop()}},e,null,[[2,7,8,9]])}))).apply(this,arguments)}function Ee(){return Ae.apply(this,arguments)}function Ae(){return(Ae=(0,h.A)(k().mark(function e(){var t,n,a,r,s,i,o,d,l,c,u,p,f,g;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("shippingForm"),n=new FormData(t),a=document.getElementById("shippingMessage"),r=document.getElementById("shippingError"),s=document.querySelector(".save-shipping-btn"),i=document.getElementById("addressIndex").value,a.style.display="none",r.style.display="none",o={fullName:n.get("fullName"),phone:n.get("phone"),email:n.get("email"),address1:n.get("address1"),address2:n.get("address2")||"",city:n.get("city"),state:n.get("state"),zipCode:n.get("zipCode"),country:n.get("country"),isDefault:"on"===n.get("setAsDefault")},s.disabled=!0,s.textContent="SAVING...",e.prev=1,e.next=2,supabase.auth.getUser();case 2:return d=e.sent,l=d.data.user,e.next=3,supabase.from("profiles").select("shipping_addresses").eq("user_id",l.id).single();case 3:return c=e.sent,u=c.data,p=(null==u?void 0:u.shipping_addresses)||[],o.isDefault&&(p=C()(p).call(p,function(e){return W(W({},e),{},{isDefault:!1})})),""!==i?p[S()(i)]=o:(0===p.length&&(o.isDefault=!0),p.push(o)),e.next=4,supabase.from("profiles").update({shipping_addresses:p}).eq("user_id",l.id);case 4:if(f=e.sent,!(g=f.error)){e.next=5;break}throw g;case 5:a.style.display="block",A()(function(){a.style.display="none",ye()},2e3),e.next=7;break;case 6:e.prev=6,e.catch(1),r.textContent="Failed to update shipping information. Please try again.",r.style.display="block";case 7:return e.prev=7,s.disabled=!1,s.textContent="SAVE ADDRESS",e.finish(7);case 8:case"end":return e.stop()}},e,null,[[1,6,7,8]])}))).apply(this,arguments)}function Ie(){return(Ie=(0,h.A)(k().mark(function e(t){var n,a,r,s,i,o,d,l,c,u;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(confirm("Are you sure you want to delete this address?")){e.next=1;break}return e.abrupt("return");case 1:return e.prev=1,e.next=2,supabase.auth.getUser();case 2:return n=e.sent,a=n.data.user,e.next=3,supabase.from("profiles").select("shipping_addresses").eq("user_id",a.id).single();case 3:return r=e.sent,s=r.data,i=(null==s?void 0:s.shipping_addresses)||[],o=i[t],G()(i).call(i,t,1),null!=o&&o.isDefault&&i.length>0&&(i[0].isDefault=!0),e.next=4,supabase.from("profiles").update({shipping_addresses:i}).eq("user_id",a.id);case 4:if(d=e.sent,!(l=d.error)){e.next=5;break}throw l;case 5:(c=document.getElementById("shippingMessage")).textContent="Address deleted successfully!",c.style.display="block",A()(function(){c.style.display="none",ye()},2e3),e.next=7;break;case 6:e.prev=6,e.catch(1),(u=document.getElementById("shippingError")).textContent="Failed to delete address. Please try again.",u.style.display="block",A()(function(){u.style.display="none"},5e3);case 7:case"end":return e.stop()}},e,null,[[1,6]])}))).apply(this,arguments)}function _e(){return(_e=(0,h.A)(k().mark(function e(t){var n,a,r,s,i,o,d,l,c;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:return n=e.sent,a=n.data.user,e.next=2,supabase.from("profiles").select("shipping_addresses").eq("user_id",a.id).single();case 2:if(r=e.sent,s=r.data,(i=(null==s?void 0:s.shipping_addresses)||[])[t]){e.next=3;break}throw new Error("Address not found");case 3:return i=C()(i).call(i,function(e,n){return W(W({},e),{},{isDefault:n===t})}),e.next=4,supabase.from("profiles").update({shipping_addresses:i}).eq("user_id",a.id);case 4:if(o=e.sent,!(d=o.error)){e.next=5;break}throw d;case 5:(l=document.getElementById("shippingMessage")).textContent="Default address updated successfully!",l.style.display="block",A()(function(){l.style.display="none",ye()},2e3),e.next=7;break;case 6:e.prev=6,e.catch(0),(c=document.getElementById("shippingError")).textContent="Failed to set default address. Please try again.",c.style.display="block",A()(function(){c.style.display="none"},5e3);case 7:case"end":return e.stop()}},e,null,[[0,6]])}))).apply(this,arguments)}function Pe(){return Se.apply(this,arguments)}function Se(){return(Se=(0,h.A)(k().mark(function e(){var t,n,a,r,s,i,o,d,l,c,u;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.getElementById("currentPassword").value,n=document.getElementById("newPassword").value,a=document.getElementById("confirmPassword").value,r=document.getElementById("passwordMessage"),s=document.getElementById("passwordError"),i=document.querySelector(".change-password-btn"),r.style.display="none",s.style.display="none",n===a){e.next=1;break}return s.textContent="New passwords do not match",s.style.display="block",e.abrupt("return");case 1:if(!(n.length<6)){e.next=2;break}return s.textContent="Password must be at least 6 characters",s.style.display="block",e.abrupt("return");case 2:if(t!==n){e.next=3;break}return s.textContent="New password must be different from current password",s.style.display="block",e.abrupt("return");case 3:return i.disabled=!0,i.textContent="UPDATING...",e.prev=4,o=supabase.auth.updateUser({password:n}),d=new(K())(function(e,t){return A()(function(){return t(new Error("Request timeout"))},1e4)}),e.next=5,K().race([o,d]);case 5:if(l=e.sent,!(c=l.error)){e.next=6;break}throw c;case 6:r.style.display="block",document.getElementById("currentPassword").value="",document.getElementById("newPassword").value="",document.getElementById("confirmPassword").value="",A()(function(){r.style.display="none"},5e3),e.next=8;break;case 7:e.prev=7,u=e.catch(4),s.textContent="Request timeout"===u.message?"Request timed out. Please check your connection and try again.":u.message||"Failed to update password. Please try again.",s.style.display="block";case 8:return e.prev=8,i.disabled=!1,i.textContent="CHANGE PASSWORD",e.finish(8);case 9:case"end":return e.stop()}},e,null,[[4,7,8,9]])}))).apply(this,arguments)}window.confirmPayment=(0,h.A)(k().mark(function e(){var t,n,a,r,s,i,o,d,l,c,u,p,f,g;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,be.call(this);case 1:return window.dispatchEvent(new CustomEvent("orderSubmitted",{detail:{orderId:null===(t=window.currentOrder)||void 0===t?void 0:t.orderId}})),e.prev=2,e.next=3,supabase.auth.getUser();case 3:if(n=e.sent,a=n.data.user,!n.error&&a){e.next=4;break}return alert("Please login to complete payment"),e.abrupt("return");case 4:return e.next=5,getCartItems();case 5:return r=e.sent,s=generateOrderId(),i=calculateSubtotal(r),o=calculateShipping(),d=calculateTax(i),l=C()(r).call(r,function(e){return{draft_id:e.draft_id,size:e.size,quantity:e.quantity,price:e.price,title:e.title||"Custom Design"}}),c={order_id:s,user_id:a.id,items:l,status:"awaiting_verification",amount:i,shipping_cost:o,tax_amount:d,payment_method:window.selectedPaymentMethod||"pending",shipping_address:window.shippingAddress||{},manifesto:window.currentManifesto||null,created_at:(new Date).toISOString(),paid_at:(new Date).toISOString()},e.next=6,supabase.from("orders").insert([c]).select().single();case 6:if(u=e.sent,p=u.data,!u.error){e.next=7;break}return alert("Failed to create order"),e.abrupt("return");case 7:return e.next=8,saveDraftImagesToOrderStorage(p.order_id,l);case 8:if(!((f=e.sent)&&f.length>0)){e.next=10;break}return e.next=9,supabase.from("orders").update({saved_images:f}).eq("order_id",p.order_id);case 9:g=e.sent,g.error;case 10:return e.next=11,clearCart();case 11:return showPaymentSuccessModal(p.order_id),window.dispatchEvent(new CustomEvent("orderSubmitted",{detail:{orderId:p.order_id}})),window.currentOrder={orderId:p.order_id},e.abrupt("return",p);case 12:return e.prev=12,e.catch(2),alert("Payment processing failed. Please try again."),e.abrupt("return",null);case 13:case"end":return e.stop()}},e,this,[[2,12]])}))}}]);