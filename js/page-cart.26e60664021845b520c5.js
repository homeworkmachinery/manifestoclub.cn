(()=>{"use strict";var e,n,t,a={71033:(e,n,t)=>{var a=t(49763),r=t.n(a),i=t(16781),s=t.n(i),o=t(39841),c=t.n(o),l=t(26100),d=t.n(l),p=t(96319),u=t.n(p),m=t(78928),g=t.n(m),f=t(36751),b=t.n(f),y=t(25110),h=t.n(y),v=t(53930),x=t.n(v),w=t(49859),k=t(5773),I=t(34963),S=t(44828),E=t.n(S),P=t(56255),A=t.n(P),T=t(14607),C=t.n(T),O=t(36586),_=t.n(O),D=t(61240),N=t.n(D),R=t(50697),q=t.n(R),F=t(86226),H=t.n(F),L=t(38573),M=t.n(L),U=t(11393),z=t.n(U),B=(t(43981),t(29550)),G=t.n(B),j=t(165),Y=t.n(j),W=t(8628),V=t.n(W),K=t(18979),Q=t.n(K),Z=(t(73363),t(57119),t(48079)),J=t.n(Z),$=t(71426),X=t.n($),ee=t(385),ne=t.n(ee),te=t(66615),ae=t.n(te);function re(e,n){var t=q()(e);if(d()){var a=d()(e);n&&(a=u()(a).call(a,function(n){return g()(e,n).enumerable})),t.push.apply(t,a)}return t}function ie(e){for(var n=1;n<arguments.length;n++){var t,a,r=null!=arguments[n]?arguments[n]:{};n%2?H()(t=re(Object(r),!0)).call(t,function(n){(0,w.A)(e,n,r[n])}):b()?h()(e,b()(r)):H()(a=re(Object(r))).call(a,function(n){x()(e,n,g()(r,n))})}return e}function se(e,n){var t=void 0!==s()&&c()(e)||e["@@iterator"];if(!t){if(ae()(e)||(t=function(e,n){if(e){var t;if("string"==typeof e)return oe(e,n);var a=Q()(t={}.toString.call(e)).call(t,8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?r()(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?oe(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){t&&(e=t);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,d=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return l=e.done,e},e:function(e){d=!0,o=e},f:function(){try{l||null==t.return||t.return()}finally{if(d)throw o}}}}function oe(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=Array(n);t<n;t++)a[t]=e[t];return a}function ce(){return le.apply(this,arguments)}function le(){return(le=(0,I.A)(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Ve(),de(),e.next=1,fe();case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function de(){document.addEventListener("click",pe)}function pe(e){var n=e.target;if(n.classList.contains("back-button")||n.closest(".back-button")){e.preventDefault();var t=n.closest(".back-button");if(t){var a=t.getAttribute("data-action");if("back-to-cart"===a)!function(){Ue.apply(this,arguments)}();else if("back-to-shipping"===a)Ae();else if("back-to-review"===a)return void Qe()}}else if(n.classList.contains("quantity-btn")){e.preventDefault();var r=n.getAttribute("data-cart-id"),i=n.getAttribute("data-size"),s=_()(n.getAttribute("data-change"));r&&i&&s&&ve(r,i,s)}else if(n.classList.contains("cart-item-remove")){e.preventDefault();var o=n.getAttribute("data-cart-id");o&&we(o)}else{if(n.classList.contains("proceed-checkout-btn")||"proceedCheckoutBtn"===n.id)return e.preventDefault(),void Ee();if("confirmPaymentBtn"===n.id||n.classList.contains("confirm-payment-btn"))return e.preventDefault(),void $e();if(n.classList.contains("cart-btn"))switch(e.preventDefault(),n.getAttribute("data-action")){case"go-home":case"continue-shopping":Se();break;case"complete-purchase":completePurchase()}else;}}function ue(){return me.apply(this,arguments)}function me(){return(me=(0,I.A)(E().mark(function e(){var n,t,a,r,i,s,o,c,l,d,p,u,m,g,f,b,y,h,v,x,w,I,S,P,A,T,C,O,_,D;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:if(r=e.sent,i=r.data.user){e.next=2;break}return e.abrupt("return");case 2:return e.next=3,supabase.from("cart_items").select("*, drafts(*)").eq("user_id",i.id);case 3:if(s=e.sent,(o=s.data)&&0!==o.length){e.next=4;break}return(c=document.getElementById("cartSummary"))&&(c.style.display="none"),e.abrupt("return");case 4:(l=document.getElementById("cartSummary"))&&(l.style.display="block"),d=0,p={},u=se(o);try{for(u.s();!(m=u.n()).done;)b=m.value,y=b.price||29.99,h=b.quantity||0,d+=y*h,v="",b.type&&Y()(g=b.type).call(g,"console-")?b.item_data&&b.item_data.productName?v=b.item_data.productName.toUpperCase():(x=b.type.replace("console-",""),v="RETRO CONSOLE #".concat(x)):v=b.type&&V()(f=b.type).call(f,"blank-tshirt")?"BLANK T-SHIRT":b.draft_id&&b.drafts?"CUSTOMIZED T-SHIRT":"T-SHIRT",p[v]||(p[v]=0),p[v]+=h}catch(e){u.e(e)}finally{u.f()}for(w="",I=0,S=M()(p);I<S.length;I++)A=(0,k.A)(S[I],2),T=A[0],C=A[1],w+=z()(P='\n                <div class="summary-item-line">\n                    <span>'.concat(C,'x</span>\n                    <span style="font-weight: bold;">')).call(P,T,"</span>\n                </div>\n            ");O=null!==document.getElementById("checkoutForm"),_=z()(n=z()(t=z()(a='\n            <h3>ORDER SUMMARY</h3>\n            <br>\n            <div class="summary-items" style="border-bottom: black 2px solid; padding: 10px 0; margin-bottom: 15px;">\n                '.concat(w,'\n            </div>\n            <div id="summaryDetails">\n                <div class="summary-row">\n                    <span>Subtotal:</span>\n                    <span id="subtotalAmount">¥')).call(a,d.toFixed(2),"</span>\n                </div>\n                ")).call(t,O?"":'\n                    <div id="addressPrompt" class="summary-row">\n                        <span style="color: black; font-style:italic;">Please enter a valid address to calculate total</span>\n                    </div>\n                ','\n            </div>\n            <div class="cart-actions" id="checkoutButtonContainer">\n                ')).call(n,O?'<button class="cart-btn primary" id="validateAndProceedBtn" style="background: black; color: white; padding: 5px; border: 2px solid black; cursor: pointer; width: 100%; text-transform: uppercase;">PROCEED TO CHECKOUT</button>':'<button class="cart-btn primary proceed-checkout-btn" id="proceedCheckoutBtn">PROCEED TO CHECKOUT</button>',"\n            </div>\n        "),(D=document.getElementById("cartSummary"))&&(D.innerHTML=_),window.currentSubtotal=d,O&&ge(),e.next=6;break;case 5:e.prev=5,e.catch(0);case 6:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}function ge(){var e=document.getElementById("validateAndProceedBtn");e&&e.addEventListener("click",function(e){e.preventDefault();var n=document.getElementById("checkoutForm");n&&(n.checkValidity()?n.dispatchEvent(new Event("submit",{cancelable:!0})):n.reportValidity())})}function fe(){return be.apply(this,arguments)}function be(){return(be=(0,I.A)(E().mark(function e(){var n,t,a,r,i,s,o,c,l,d,p,u,m,g,f,b,y,h,v,x,w,k,I,S,P,A,T,C,O,_,D,N,R,q,F,H,L,M,U,B,G,j,W,K,Z,J,$,X,ee,ne,te,ae,re,ie,oe,ce,le,de,pe,me,ge,fe,be,ve,xe,we,ke,Ie,Se,Ee;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:if(n=e.sent,t=n.data.user){e.next=2;break}return document.getElementById("cartContent").innerHTML='\n            <div class="cart-empty">\n                <h2>Please login first</h2>\n                <button class="cart-btn" data-action="go-home">GO TO LOGIN</button>\n            </div>\n        ',(a=document.getElementById("cartSummary"))&&(a.style.display="none"),e.abrupt("return");case 2:return e.next=3,supabase.from("cart_items").select("\n            *,\n            drafts (\n                id,\n                type,\n                data,\n                front_preview_image,\n                back_preview_image,\n                sizes\n            )\n        ").eq("user_id",t.id).order("added_at",{ascending:!1});case 3:if(r=e.sent,i=r.data,!(s=r.error)){e.next=4;break}throw s;case 4:if(o=document.getElementById("cartContent"),i&&0!==i.length){e.next=5;break}return o.innerHTML='\n            <div class="cart-empty">\n                <h2>Your cart is empty</h2>\n                <p>Add some awesome designs to your cart!</p>\n                <button class="cart-btn" data-action="continue-shopping">CONTINUE SHOPPING</button>\n            </div>\n        ',(c=document.getElementById("cartSummary"))&&(c.style.display="none"),e.abrupt("return");case 5:l='<div class="cart-items">',d=se(i),e.prev=6,d.s();case 7:if((p=d.n()).done){e.next=13;break}if(m=p.value,g="",f="",b="",y=0,h="white",v="./images/default-tshirt.png",x="./images/default-tshirt.png",w=!1,k="GAME CONSOLE",I="console",S=null,m.type&&Y()(u=m.type).call(u,"console-")?(w=!0,P=m.type.replace("console-","").split("-")[0],m.item_data?(S=m.item_data,b=S.productName||"Retro Product #".concat(P),y=m.price||1450,S.productCategory&&(A=S.productCategory.toLowerCase(),V()(A).call(A,"cartridge")||V()(A).call(A,"software")||V()(A).call(A,"game")&&!V()(A).call(A,"console")||V()(A).call(A,"disc")||V()(A).call(A,"cassette")?(k="SOFTWARE",I="software"):(V()(A).call(A,"console")||V()(A).call(A,"system")||V()(A).call(A,"hardware"))&&(k="GAME CONSOLE",I="console")),S.productType&&(T=S.productType.toLowerCase(),(V()(T).call(T,"software")||V()(T).call(T,"game")&&!V()(T).call(T,"console"))&&(k="SOFTWARE",I="software")),v=S.productImage||"images/merch/".concat(P,".jpg"),x=v):((C=window.getConsoleProductInfo&&window.getConsoleProductInfo(m.type))?(b=C.name||"Retro Product #".concat(P),v=C.image||"images/merch/".concat(P,".jpg"),x=v,C.category&&(O=C.category.toLowerCase(),(V()(O).call(O,"cartridge")||V()(O).call(O,"software")||V()(O).call(O,"game")&&!V()(O).call(O,"console"))&&(k="SOFTWARE",I="software"))):(b="Retro Product #".concat(P),v="images/merch/".concat(P,".jpg"),x=v),y=m.price||1450),g=I):(m.type&&(V()(_=m.type).call(_,"blank-tshirt")?(b="BLANK T-SHIRT",g="blank",h=m.type.replace("blank-tshirt-","")||"white"):V()(D=m.type).call(D,"single-sided")?(b="CUSTOMIZED T-SHIRT",g="single-sided",h=m.type.replace("single-sided-","")||"white"):V()(N=m.type).call(N,"double-sided")?(b="CUSTOMIZED T-SHIRT",g="double-sided",h=m.type.replace("double-sided-","")||"white"):"custom-design"===m.type&&(b="CUSTOMIZED T-SHIRT",g="custom")),m.draft_id&&m.drafts&&((R=m.drafts).data&&R.data.color&&(h=R.data.color),R.front_preview_image&&(v=R.front_preview_image),R.back_preview_image&&(x=R.back_preview_image),!g&&R.data&&(q=R.data.frontImages&&R.data.frontImages.length>0,F=R.data.backImages&&R.data.backImages.length>0,q||F?q&&F?(b="CUSTOMIZED T-SHIRT",g="double-sided"):(b="CUSTOMIZED T-SHIRT",g="single-sided"):(b="BLANK T-SHIRT",g="blank")))),g||(b="BLANK T-SHIRT",g="blank"),"blank"!==g){e.next=11;break}if(v&&"./images/default-tshirt.png"!==v){e.next=9;break}return e.next=8,ye(h,"front");case 8:v=e.sent;case 9:if(x&&"./images/default-tshirt.png"!==x){e.next=11;break}return e.next=10,ye(h,"back");case 10:x=e.sent;case 11:f="white"===h?"white":"colored",window.TSHIRT_PRICING&&window.TSHIRT_PRICING[g]&&(y=window.TSHIRT_PRICING[g][h]||window.TSHIRT_PRICING[g][f]),y||(y=m.price||29.99),H=m.quantity||0,L=y*H,w?(ae=(null===(M=S)||void 0===M?void 0:M.productName)||b,re=k,l+=z()(U=z()(B=z()(G=z()(j=z()(W=z()(K=z()(Z=z()(J=z()($=z()(X=z()(ee=z()(ne=z()(te='\n                <div class="cart-item" data-cart-id="'.concat(m.id,'" data-product-type="single">\n                    \x3c!-- Single Product Preview --\x3e\n                    <div class="cart-item-previews">\n                        <div class="preview-container">\n                            <div class="preview-image">\n                                <img src="')).call(te,v,'" alt="')).call(ne,b,'" onerror="this.src=\'./images/default-product.png\'">\n                            </div>\n                        </div>\n                    </div>\n                    \n                    \x3c!-- Item Details --\x3e\n                    <div class="cart-item-details">\n                        <div class="cart-item-title">')).call(ee,ae,'</div>\n                        <div class="cart-item-type">\n                            <span class="type-badge">')).call(X,re,"</span>\n                            ")).call($,S&&S.productYear?'<span class="product-year">'.concat(S.productYear,"</span>"):"","\n                            ")).call(J,S&&S.variantName?'<span class="variant-name" style="margin-left: 10px; color: #666;">- '.concat(S.variantName,"</span>"):"",'\n                        </div>\n                        \n                        \x3c!-- Quantity Control --\x3e\n                        <div class="cart-item-quantity">\n                            <div class="quantity-controls">\n                                <button class="quantity-btn quantity-btn-left" \n                                        data-cart-id="')).call(Z,m.id,'" \n                                        data-size="default" \n                                        data-change="-1">−</button>\n                                <input type="text" class="quantity-value" value="')).call(K,H,'" readonly>\n                                <button class="quantity-btn quantity-btn-right" \n                                        data-cart-id="')).call(W,m.id,'" \n                                        data-size="default" \n                                        data-change="1">+</button>\n                            </div>\n                        </div>\n                        \n                        \x3c!-- Pricing Information --\x3e\n                        <div class="cart-item-pricing">\n                            <div class="price-row">\n                                <span>Unit Price:</span>\n                                <span>¥')).call(j,y.toFixed(2),'</span>\n                            </div>\n                            <div class="price-row">\n                                <span>Quantity:</span>\n                                <span>')).call(G,H,'</span>\n                            </div>\n                            <div class="price-row total">\n                                <span>Subtotal:</span>\n                                <span>¥')).call(B,L.toFixed(2),'</span>\n                            </div>\n                        </div>\n                        \n                        <button class="cart-item-remove" data-cart-id="')).call(U,m.id,'">Remove</button>\n                    </div>\n                </div>\n                ')):(ke="",ke="blank"===g?"Blank Design":"double-sided"===g?"Double-Sided Design":"Single-Sided Design",Ie="white"===h?"White T-Shirt":"".concat(h.charAt(0).toUpperCase()+Q()(h).call(h,1)," T-Shirt"),l+=z()(ie=z()(oe=z()(ce=z()(le=z()(de=z()(pe=z()(me=z()(ge=z()(fe=z()(be=z()(ve=z()(xe=z()(we='\n            <div class="cart-item" data-cart-id="'.concat(m.id,'">\n                \x3c!-- Dual Preview Section --\x3e\n                <div class="cart-item-previews">\n                    <div class="preview-container">\n                        <div class="preview-image">\n                            <img src="')).call(we,v,'" alt="')).call(xe,b,' - Front" onerror="this.src=\'./images/default-tshirt.png\'">\n                        </div>\n                    </div>\n                    <div class="preview-container">\n                        <div class="preview-image">\n                            <img src="')).call(ve,x,'" alt="')).call(be,b,' - Back" onerror="this.src=\'./images/default-tshirt.png\'">\n                        </div>\n                    </div>\n                </div>\n                \n                \x3c!-- Item Details --\x3e\n                <div class="cart-item-details">\n                    <div class="cart-item-title">')).call(fe,b,'</div>\n                    <div class="cart-item-type">\n                        <div>\n                            <span class="type-badge">')).call(ge,ke,'</span>\n                            <span class="color-indicator">\n                                <span class="color-dot" style="background-color: ')).call(me,"white"===h?"#ffffff":h,'; "></span>\n                                ')).call(pe,Ie,'\n                            </span>\n                        </div>\n                    </div>\n                    \n                    \x3c!-- Size Controls --\x3e\n                    <div class="cart-item-sizes">\n                        ')).call(de,he(m.id,m.sizes),'\n                    </div>\n                    \n                    \x3c!-- Pricing Information --\x3e\n                    <div class="cart-item-pricing">\n                        <div class="price-row">\n                            <span>Unit Price:</span>\n                            <span>¥')).call(le,y.toFixed(2),'</span>\n                        </div>\n                        <div class="price-row">\n                            <span>Quantity:</span>\n                            <span>')).call(ce,H,'</span>\n                        </div>\n                        <div class="price-row total">\n                            <span>Subtotal:</span>\n                            <span>¥')).call(oe,L.toFixed(2),'</span>\n                        </div>\n                    </div>\n                    \n                    <button class="cart-item-remove" data-cart-id="')).call(ie,m.id,'">Remove</button>\n                </div>\n            </div>\n        '));case 12:e.next=7;break;case 13:e.next=15;break;case 14:e.prev=14,Ee=e.catch(6),d.e(Ee);case 15:return e.prev=15,d.f(),e.finish(15);case 16:return l+="</div>",o.innerHTML=l,e.next=17,ue();case 17:e.next=19;break;case 18:e.prev=18,e.catch(0),document.getElementById("cartContent").innerHTML='\n        <div class="cart-empty">\n            <h2>Error loading cart</h2>\n            <p>Please refresh the page and try again.</p>\n        </div>\n    ',(Se=document.getElementById("cartSummary"))&&(Se.style.display="none");case 19:case"end":return e.stop()}},e,null,[[0,18],[6,14,15,16]])}))).apply(this,arguments)}function ye(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"white",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"front";return new(N())(function(t){var a,r=document.createElement("canvas"),i=r.getContext("2d");r.width=100,r.height=125,i.fillStyle="#ffffff",i.fillRect(0,0,r.width,r.height);var s=new Image;s.crossOrigin="anonymous",s.width=100,s.height=125,s.onload=function(){var e=Math.min(r.width/this.naturalWidth,r.height/this.naturalHeight),n=this.naturalWidth*e,a=this.naturalHeight*e,s=(r.width-n)/2,o=(r.height-a)/2;i.drawImage(this,s,o,n,a);var c=r.toDataURL("image/jpeg",.9);t(c)},s.onerror=function(){i.fillStyle="black"===e?"#333333":"#f0f0f0",i.fillRect(0,0,r.width,r.height);var n=r.toDataURL("image/jpeg",.9);t(n)};var o={front:{white:"./images/white-front.png",black:"./images/black-front.png"},back:{white:"./images/white-back.png",black:"./images/black-back.png"}};s.src=(null===(a=o[n])||void 0===a?void 0:a[e])||o.front.white})}function he(e,n){var t;if(!n||0===q()(n).length)return"<p>No sizes selected</p>";var a="";return H()(t=M()(n)).call(t,function(n){var t,r,i,s,o,c=(0,k.A)(n,2),l=c[0],d=c[1];a+=z()(t=z()(r=z()(i=z()(s=z()(o='\n        <div class="size-quantity-group">\n            <span class="size-label">'.concat(l,':</span>\n            <div class="quantity-controls">\n                <button class="quantity-btn quantity-btn-left" \n                        data-cart-id="')).call(o,e,'" \n                        data-size="')).call(s,l,'" \n                        data-change="-1">-</button>\n                <input type="text" class="quantity-value" value="')).call(i,d,'" readonly>\n                <button class="quantity-btn quantity-btn-right" data-cart-id="')).call(r,e,'" \n                        data-size="')).call(t,l,'" \n                        data-change="1")">+</button>\n            </div>\n        </div>\n    ')}),a}function ve(e,n,t){return xe.apply(this,arguments)}function xe(){return(xe=(0,I.A)(E().mark(function e(n,t,a){var r,i,s;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.from("cart_items").select("sizes").eq("id",n).single();case 1:if(r=e.sent,i=r.data){e.next=2;break}return e.abrupt("return");case 2:return(s=ie({},i.sizes))[t]=Math.max(0,(s[t]||0)+a),0===s[t]&&delete s[t],e.next=3,updateCartItemQuantity(n,s);case 3:if(!e.sent){e.next=4;break}return e.next=4,fe();case 4:e.next=6;break;case 5:e.prev=5,e.catch(0);case 6:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}function we(e){return ke.apply(this,arguments)}function ke(){return(ke=(0,I.A)(E().mark(function e(n){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,removeFromCart(n);case 1:if(!e.sent){e.next=2;break}return e.next=2,fe();case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Ie(){return(Ie=(0,I.A)(E().mark(function e(){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,clearCart();case 1:if(!e.sent){e.next=2;break}return e.next=2,fe();case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function Se(){"function"==typeof loadPage?loadPage("home"):window.location.href="/home"}function Ee(){return Pe.apply(this,arguments)}function Pe(){return(Pe=(0,I.A)(E().mark(function e(){var n,t,a,r,i;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:if(n=e.sent,t=n.data.user){e.next=2;break}return alert("Please login to continue"),e.abrupt("return");case 2:return e.next=3,supabase.from("cart_items").select("*").eq("user_id",t.id);case 3:if(a=e.sent,(r=a.data)&&0!==r.length){e.next=4;break}return alert("Your cart is empty"),e.abrupt("return");case 4:i=0,H()(r).call(r,function(e){var n=e.price||29.99,t=e.quantity||0;i+=n*t}),window.currentSubtotal=i,Ae(),e.next=6;break;case 5:e.prev=5,e.catch(0),alert("Error proceeding to checkout");case 6:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}function Ae(){return Te.apply(this,arguments)}function Te(){return(Te=(0,I.A)(E().mark(function e(){var n,t,a,r,i,s,o,c,l;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.querySelector(".cart-header"),t=document.getElementById("cartContent"),n&&(n.innerHTML='\n            <h1>SHIPPING INFORMATION</h1>\n            <button class="back-button" data-action="back-to-cart" style="\n                padding: 5px;\n                border: 2px solid black;\n                background: white;\n                cursor: pointer;\n                font-size: 14px;\n            ">← BACK TO CART</button>\n        '),a=[],e.prev=1,e.next=2,supabase.auth.getUser();case 2:if(r=e.sent,!(i=r.data.user)){e.next=4;break}return e.next=3,supabase.from("profiles").select("shipping_addresses").eq("user_id",i.id).single();case 3:s=e.sent,o=s.data,a=(null==o?void 0:o.shipping_addresses)||[];case 4:e.next=6;break;case 5:e.prev=5,e.catch(1);case 6:window.currentSavedAddresses=a,c="",c=a.length>0?'\n        <div class="address-selection" style="margin-bottom: 30px;">\n        <h3 style="margin-bottom: 15px;">SELECT SHIPPING ADDRESS</h3>\n        <div class="saved-addresses">\n            '.concat(J()(a).call(a,function(e,n){var t,a,r,i,s,o,c,l,d,p,u,m,g,f;return z()(t=z()(a=z()(r=z()(i=z()(s=z()(o=z()(c=z()(l=z()(d=z()(p=z()(u=z()(m=z()(g=z()(f='\n                <div class="address-option '.concat(e.isDefault?"default-address":"",'" data-address-index="')).call(f,n,'" style="\n                    border: 2px solid #ccc;\n                    padding: 15px;\n                    margin-bottom: 10px;\n                    cursor: pointer;\n                   \n                    position: relative;\n                    ')).call(g,e.isDefault,'\n                ">\n                    <label style="cursor: pointer; display: block; width: 100%;">\n                        <input type="radio" name="selectedAddress" value="')).call(m,n,'" \n                               ')).call(u,e.isDefault?"checked":"",' \n                               style="margin-right: 10px;">\n                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 80px);">\n                            <div style="display: flex; align-items: center; margin-bottom: 8px;">\n                                <strong style="font-size: 16px;">')).call(p,e.fullName,"</strong>\n                                ")).call(d,e.isDefault?'<span style="background: black; color: white; padding: 2px 8px; font-size: 12px; margin-left: 15px;">DEFAULT</span>':"",'\n                            </div>\n                            <div style="color: #555; font-size: 14px; line-height: 1.4;">\n                                ')).call(l,e.phone,"<br>\n                                ")).call(c,e.address1," ")).call(o,e.address2||"","<br>\n                                ")).call(s,e.city,", ")).call(i,e.state," ")).call(r,e.zipCode,"<br>\n                                ")).call(a,e.country,'\n                            </div>\n                        </div>\n                    </label>\n                    <button class="delete-address-btn" data-address-index="')).call(t,n,'" style="\n                        position: absolute;\n                        bottom: 15px;\n                        right: 15px;\n\n                    padding:0 5px;\n                        border: 2px black solid;\n                        padding: 5px 8px;\n                        font-size: 12px;\n                        cursor: pointer;\n                    background:white;\n                     \n                    " title="Delete Address">DELETE</button>\n                </div>\n            ')}).join(""),'\n        </div>\n                <div style="text-align: center; margin: 20px 0;">\n                    <button id="useNewAddress" style="\n                        background: white;\n                        color: black;\n                        border: 2px solid black;\n                        padding: 8px 20px;\n                        cursor: pointer;\n                        font-size: 14px;\n                    ">+ ADD NEW ADDRESS</button>\n                </div>\n            </div>\n        '):'\n            <div class="address-selection" style="margin-bottom: 30px;">\n                <h3 style="margin-bottom: 15px;">NO SAVED ADDRESSES</h3>\n                <p style="color: #666; margin-bottom: 20px;">Please add a new shipping address</p>\n                <button id="useNewAddress" style="\n                    background: black;\n                    color: white;\n                    border: none;\n                    padding: 8px 20px;\n                    cursor: pointer;\n                    font-size: 14px;\n                ">+ ADD NEW ADDRESS</button>\n            </div>\n        ',l='\n        <style>\n            .checkout-form-container {\n                background: white;\n                padding: 0;\n            }\n            \n            .address-option:hover {\n                border-color: black !important;\n               \n            }\n            \n            .address-option:has(input[type="radio"]:checked) {\n                border-color: black !important;\n              \n            }\n\n            .checkout-form {\n                max-width: 100%;\n                display: none;\n            }\n            \n            .form-group {\n                margin-bottom: 20px;\n            }\n            \n            .form-group label {\n                display: block;\n                margin-bottom: 8px;\n                font-weight: bold;\n                font-size: 14px;\n            }\n            \n            .form-group input,\n            .form-group select {\n                width: 100%;\n                padding: 10px;\n                border: 2px solid black;\n                font-size: 14px;\n                background: white;\n            }\n            \n            .form-group input:focus,\n            .form-group select:focus {\n                outline: none;\n                border-color: #555;\n            }\n            \n            .form-group input[type="checkbox"] {\n                width: auto;\n                margin-right: 8px;\n                vertical-align: middle;\n                transform: scale(1.1);\n            }\n\n .checkbox-label {\n            display: flex !important;\n            align-items: center;\n            margin-bottom: 0 !important;\n            font-weight: normal !important;\n        }\n        \n\n            .form-row {\n                display: flex;\n                gap: 20px;\n            }\n            \n            .form-row .form-group {\n                flex: 1;\n            }\n            \n            .required-asterisk {\n                color: red;\n            }\n        </style>\n        \n        <div class="checkout-form-container">\n            '.concat(c,'\n            \n            <form id="checkoutForm" class="checkout-form">\n                <h3 style="margin-bottom: 20px;">ADD NEW SHIPPING ADDRESS</h3>\n                \n                <div class="form-group">\n                    <label>Full Name <span class="required-asterisk">*</span></label>\n                    <input type="text" id="fullName" name="fullName" required placeholder="Enter your full name">\n                </div>\n                \n                <div class="form-group">\n                    <label>Email Address </label>\n                    <input type="email" id="email" name="email" required placeholder="your@email.com">\n                </div>\n                \n                <div class="form-group">\n                    <label>Phone Number <span class="required-asterisk">*</span></label>\n                    <input type="tel" id="phone" name="phone" required placeholder="+86">\n                </div>\n                \n                <h4 style="margin-top: 30px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid black;">DELIVERY ADDRESS</h4>\n                \n                <div class="form-group">\n                    <label>Address Line 1 <span class="required-asterisk">*</span></label>\n                    <input type="text" id="address1" name="address1" required placeholder="Street address, P.O. box">\n                </div>\n                \n                <div class="form-group">\n                    <label>Address Line 2</label>\n                    <input type="text" id="address2" name="address2" placeholder="Apartment, suite, unit, building, floor, etc.">\n                </div>\n                \n                <div class="form-row">\n                    <div class="form-group">\n                        <label>City <span class="required-asterisk">*</span></label>\n                        <input type="text" id="city" name="city" required placeholder="City">\n                    </div>\n                    <div class="form-group">\n                        <label>State/Province <span class="required-asterisk">*</span></label>\n                        <input type="text" id="state" name="state" required placeholder="State or Province">\n                    </div>\n                </div>\n                \n                <div class="form-row">\n                    <div class="form-group">\n                        <label>ZIP/Postal Code <span class="required-asterisk">*</span></label>\n                        <input type="text" id="zipCode" name="zipCode" required placeholder="12345">\n                    </div>\n                    <div class="form-group">\n                        <label>Country <span class="required-asterisk">*</span></label>\n                        <select id="country" name="country" required>\n                            <option value="">Select Country</option>\n                            <option value="CN">中国</option>\n                            <option value="HK">Hong Kong</option>\n                            <option value="TW">臺灣</option>\n                            <option value="JP">Japan</option>\n                            <option value="UK">United Kingdom</option>\n                            <option value="US">United States</option>\n                            <option value="OTHER">Other</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <div class="form-group">\n                    <label>\n                        <input type="checkbox" id="setAsDefault" name="setAsDefault">\n                        Set as default address\n                    </label>\n                </div>\n                \n                <div style="display: flex; gap: 10px; margin-top: 30px;">\n                    <button type="submit" style="\n                        flex: 1;\n                        background: black;\n                        color: white;\n                        border: none;\n                        padding: 12px;\n                        font-size: 16px;\n                        cursor: pointer;\n                    ">SAVE ADDRESS</button>\n                    <button type="button" id="cancelNewAddress" style="\n                        flex: 1;\n                        background: white;\n                        color: black;\n                        border: 2px solid black;\n                        padding: 12px;\n                        font-size: 16px;\n                        cursor: pointer;\n                    ">CANCEL</button>\n                </div>\n            </form>\n        </div>\n    '),t.innerHTML=l,Fe(),Ce(a),Oe(),a.length>0&&qe(X()(a).call(a,function(e){return e.isDefault})||a[0]);case 7:case"end":return e.stop()}},e,null,[[1,5]])}))).apply(this,arguments)}function Ce(e){var n,t;H()(n=document.querySelectorAll('input[name="selectedAddress"]')).call(n,function(n){n.addEventListener("change",function(n){var t;if(H()(t=document.querySelectorAll(".address-option")).call(t,function(e){e.classList.remove("selected"),e.style.borderColor="#ccc"}),n.target.checked){var a=n.target.closest(".address-option");a.classList.add("selected"),a.style.borderColor="black";var r=_()(n.target.value);qe(e[r]);var i=document.getElementById("proceedToPayment");i&&(i.disabled=!1,i.style.background="black",i.style.color="white",i.style.cursor="pointer")}})});var a=document.querySelector('input[name="selectedAddress"]:checked');if(a){var r=a.closest(".address-option");r.classList.add("selected"),r.style.borderColor="black"}H()(t=document.querySelectorAll(".delete-address-btn")).call(t,function(e){e.addEventListener("click",function(){var e=(0,I.A)(E().mark(function e(n){var t;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.stopPropagation(),t=_()(n.target.dataset.addressIndex),!confirm("Are you sure you want to delete this address?")){e.next=1;break}return e.next=1,_e(t);case 1:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}())});var i=document.getElementById("useNewAddress");i&&i.addEventListener("click",function(){document.querySelector(".address-selection").style.display="none",document.querySelector(".checkout-form").style.display="block",Le();var e=document.getElementById("proceedToPayment");e&&(e.disabled=!0,e.style.background="#ccc",e.style.color="#666",e.style.cursor="not-allowed")})}function Oe(){var e=document.getElementById("checkoutForm");e&&e.addEventListener("submit",function(){var e=(0,I.A)(E().mark(function e(n){return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=1,Ne();case 1:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}());var n=document.getElementById("cancelNewAddress");n&&n.addEventListener("click",function(){document.querySelector(".checkout-form").style.display="none",document.querySelector(".address-selection").style.display="block"});var t=document.getElementById("country");t&&t.addEventListener("change",function(e){var n=e.target.value;n?He(n):Le()})}function _e(e){return De.apply(this,arguments)}function De(){return(De=(0,I.A)(E().mark(function e(n){var t,a,r,i,s,o,c,l;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:return t=e.sent,a=t.data.user,e.next=2,supabase.from("profiles").select("shipping_addresses").eq("user_id",a.id).single();case 2:return r=e.sent,i=r.data,s=(null==i?void 0:i.shipping_addresses)||[],o=s[n],ne()(s).call(s,n,1),null!=o&&o.isDefault&&s.length>0&&(s[0].isDefault=!0),e.next=3,supabase.from("profiles").update({shipping_addresses:s}).eq("user_id",a.id);case 3:if(c=e.sent,!(l=c.error)){e.next=4;break}throw l;case 4:Ae(),e.next=6;break;case 5:e.prev=5,e.catch(0),alert("Failed to delete address. Please try again.");case 6:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}function Ne(){return Re.apply(this,arguments)}function Re(){return(Re=(0,I.A)(E().mark(function e(){var n,t,a,r,i,s,o,c,l;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new FormData(document.getElementById("checkoutForm")),e.next=1,supabase.auth.getUser();case 1:return t=e.sent,a=t.data.user,r={fullName:n.get("fullName"),email:n.get("email"),phone:n.get("phone"),address1:n.get("address1"),address2:n.get("address2")||"",city:n.get("city"),state:n.get("state"),zipCode:n.get("zipCode"),country:n.get("country"),isDefault:"on"===n.get("setAsDefault")},e.next=2,supabase.from("profiles").select("shipping_addresses").eq("user_id",a.id).single();case 2:return i=e.sent,s=i.data,o=(null==s?void 0:s.shipping_addresses)||[],r.isDefault&&(o=J()(o).call(o,function(e){return ie(ie({},e),{},{isDefault:!1})})),0===o.length&&(r.isDefault=!0),o.push(r),e.next=3,supabase.from("profiles").update({shipping_addresses:o}).eq("user_id",a.id);case 3:if(c=e.sent,!(l=c.error)){e.next=4;break}throw l;case 4:Ae(),e.next=6;break;case 5:e.prev=5,e.catch(0),alert("Failed to save address. Please try again.");case 6:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}function qe(e){if(e&&e.country){var n=window.SHIPPING_CONFIG[e.country]||window.SHIPPING_CONFIG.OTHER,t=window.currentSubtotal||0,a=n.shipping,r=t*(n.tax/100);Be({subtotal:t,shipping:a,tax:r,total:t+a+r,config:n,address:e})}else Le()}function Fe(){var e=document.getElementById("cartSummary");if(e){e.innerHTML='\n            <h3>ORDER SUMMARY</h3>\n            <div id="summaryDetails">\n                <div class="summary-row">\n                    <span>Subtotal:</span>\n                    <span>¥'.concat((window.currentSubtotal||0).toFixed(2),'</span>\n                </div>\n                <div id="addressPrompt" class="summary-row">\n                    <span style="color: #666; font-style: italic;">Select address to calculate total</span>\n                </div>\n            </div>\n            <button id="proceedToPayment" disabled style="\n                width: 100%;\n                margin-top: 15px;\n                padding: 12px;\n                background: #ccc;\n                color: #666;\n                border: none;\n                font-size: 16px;\n                cursor: not-allowed;\n            ">PROCEED TO CHECKOUT</button>\n        ');var n=document.getElementById("proceedToPayment");n&&(n.onclick=null,n.addEventListener("click",window.proceedToPayment))}}function He(e){var n=window.SHIPPING_CONFIG[e]||window.SHIPPING_CONFIG.OTHER,t=window.currentSubtotal||0,a=n.shipping,r=t*(n.tax/100);Be({subtotal:t,shipping:a,tax:r,total:t+a+r,config:n,address:{country:e}})}function Le(){var e=document.getElementById("summaryDetails");if(e){var n=window.currentSubtotal||0;e.innerHTML='\n                <div class="summary-row">\n                    <span>Subtotal:</span>\n                    <span id="subtotalAmount">¥'.concat(n.toFixed(2),'</span>\n                </div>\n                <div id="addressPrompt" class="summary-row">\n                    <span style="color: black; font-style:italic;">Please select a country to calculate total</span>\n                </div>\n            ')}}function Me(e){var n=e.country||"OTHER",t=window.SHIPPING_CONFIG[n]||window.SHIPPING_CONFIG.OTHER,a=window.currentSubtotal||0,r=t.shipping,i=a*(t.tax/100),s=a+r+i;window.shippingCost=r,window.taxAmount=i,window.orderTotal=s,window.shippingConfig=t,Ge(e,r,i,s)}function Ue(){return(Ue=(0,I.A)(E().mark(function e(){var n;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=document.querySelector(".cart-header"))&&(n.innerHTML="<h1>SHOPPING CART</h1>"),e.next=1,fe();case 1:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ze(e){var n=e.country||"OTHER",t=SHIPPING_CONFIG[n]||SHIPPING_CONFIG.OTHER,a=window.currentSubtotal||0,r=t.shipping,i=a*(t.tax/100),s=a+r+i;Be({subtotal:a,shipping:r,tax:i,total:s,config:t,address:e}),window.shippingCost=r,window.taxAmount=i,window.orderTotal=s,window.shippingConfig=t,Ge(e,r,i,s)}function Be(e){var n,t=document.getElementById("summaryDetails");if(t){var a,r=z()(n='\n            <div class="summary-row">\n                <span>Subtotal:</span>\n                <span id="subtotalAmount">¥'.concat(e.subtotal.toFixed(2),'</span>\n            </div>\n            <div class="summary-row" id="shippingRow">\n                <span>Shipping:</span>\n                <span id="shippingAmount">')).call(n,0===e.shipping?'<span style="color: black;">FREE</span>':"¥"+e.shipping.toFixed(2),"</span>\n            </div>\n        ");if(e.tax>0)r+=z()(a='\n                <div class="summary-row" id="taxRow">\n                    <span>Tax ('.concat(e.config.tax,'%):</span>\n                    <span id="taxAmount">¥')).call(a,e.tax.toFixed(2),"</span>\n                </div>\n            ");r+='\n            <div class="summary-row summary-total" id="totalRow" style="font-weight: bold; font-size: 18px; margin-top: 10px; padding-top: 10px; border-top: 2px solid black;">\n                <span>Total:</span>\n                <span id="totalAmount">¥'.concat(e.total.toFixed(2),"</span>\n            </div>\n        "),t.innerHTML=r;var i=document.getElementById("proceedToPayment");i&&(i.disabled=!1,i.style.background="black",i.style.color="white",i.style.cursor="pointer")}}function Ge(e,n,t,a){var r,i,s,o,c,l,d,p,u,m,g,f,b,y,h=document.querySelector(".cart-header"),v=document.getElementById("cartContent");h&&(h.innerHTML='\n                <h1>REVIEW & PAYMENT</h1>\n                <button class="back-button" data-action="back-to-shipping" style="\n                    padding: 8px 15px;\n                    border: 2px solid black;\n                    background: white;\n                    cursor: pointer;\n                    font-size: 14px;\n                ">← EDIT SHIPPING INFO</button>\n            ');var x=window.shippingConfig;var w=z()(r=z()(i=z()(s=z()(o=z()(c=z()(l=z()(d=z()(p=z()(u=z()(m=z()(g=z()(f=z()(b='\n            <style>\n                .payment-methods {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 15px;\n                    margin: 20px 0;\n                }\n                \n                .payment-option {\n                    display: flex;\n                    align-items: center;\n                    gap: 15px;\n                    padding: 15px;\n                    border: 2px solid black;\n                    cursor: pointer;\n                    transition: all 0.3s;\n                }\n                \n                .payment-option:hover {\n                    border-color: black;\n                  \n                }\n                \n                .payment-option input[type="radio"]:checked + span {\n                    font-weight: bold;\n                }\n                \n                .order-summary-final {\n             \n                    padding: 20px;\n                    margin: 20px 0;\n                    border: 2px solid black;\n                }\n                \n                .payment-qr-container {\n                    display: none;\n                    text-align: center;\n                    padding: 20px;\n                    background: white;\n                    border: 2px solid black;\n                    margin: 20px 0;\n                }\n                \n                .payment-qr-container.active {\n                    display: block;\n                }\n                \n                .order-info {\n           \n                    padding: 15px;\n                    margin-bottom: 20px;\n                    border: 2px solid black;\n                }\n                \n                .qr-code-img {\n                    width: 250px;\n                    height: 250px;\n                    border: 2px solid black;\n                    padding: 10px;\n                    background: white;\n                }\n                \n                .payment-note {\n                    color: black;\n                    margin: 10px 0;\n                    font-size: 14px;\n                }\n                \n            \n            </style>\n            \n            <div class="payment-container">\n                <div class="order-review" style=" padding: 20px; margin-bottom: 25px; border: 2px solid black;">\n                    <h3 style="margin-bottom: 10px;">DELIVERY INFORMATION</h3>\n                    <p style="line-height: 1.6;">\n                        '.concat(e.fullName,"<br>\n                        ")).call(b,e.address1,"<br>\n                        ")).call(f,e.address2?e.address2+"<br>":"","\n                        ")).call(g,e.city,", ")).call(m,e.state," ")).call(u,e.zipCode,"<br>\n                        ")).call(p,x.name,"<br>\n                        <strong>Carrier:</strong> ")).call(d,x.carrier,"<br>\n                        <strong>Estimated Delivery:</strong> ")).call(l,x.estimatedDays,' business days\n                    </p>\n                </div>\n                \n                <div class="payment-form">\n                    <h3 style="margin-bottom: 20px;">SELECT PAYMENT METHOD</h3>\n                    ')).call(c,'\n                <div class="payment-methods">\n                    <label class="payment-option">\n                        <input type="radio" name="payment" value="paypal" checked>\n                        <span>PayPal</span>\n                        </label>\n                    <label class="payment-option">\n                        <input type="radio" name="payment" value="alipay" checked>\n                        <span>Alipay(支付宝)</span>\n                    </label>\n                    <label class="payment-option">\n                        <input type="radio" name="payment" value="wechat">\n                        <span>WeChat Pay(微信支付)</span>\n                    </label>\n                </div>\n            ','\n                </div>\n                \n                <div class="order-summary-final">\n                    <h4 style="margin-bottom: 15px;">ORDER TOTAL</h4>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Subtotal:</span>\n                        <span>¥')).call(o,window.currentSubtotal.toFixed(2),'</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Shipping:</span>\n                        <span>')).call(s,0===n?'<span style="color: black;">FREE</span>':"¥"+n.toFixed(2),"</span>\n                    </div>\n                    ")).call(i,t>0?z()(y='\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Tax ('.concat(x.tax,"%):</span>\n                        <span>¥")).call(y,t.toFixed(2),"</span>\n                    </div>\n                    "):"",'\n                    <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 20px; margin-top: 10px; padding-top: 10px; border-top: 2px solid #333;">\n                        <span>Total to Pay:</span>\n                        <span>¥')).call(r,a.toFixed(2),"</span>\n                    </div>\n                </div>\n            </div>\n        ");v.innerHTML=w,function(e){var n=document.getElementById("cartSummary");n&&(n.innerHTML='\n                <h3>COMPLETE ORDER</h3>\n                <div>\n                    <div style="text-align: center; margin-top:15px;">\n                        <span style="font-size: 24px; font-weight: bold;">¥'.concat(e.toFixed(2),'</span>\n                    </div>\n                    <button id="placeOrderBtn" style="\n                        width: 100%;\n                        margin-top:15px;\n                        padding: 5px;\n                        background: black;\n                        color: white;\n                        border: none;\n                        font-size: 18px;\n                        font-weight: bold;\n                        cursor: pointer;\n                        text-transform: uppercase;\n                        transition: all 0.3s;\n                    " onmouseover="this.style.background=\'#333\'" onmouseout="this.style.background=\'black\'">\n                        PLACE ORDER\n                    </button>\n                    <p style="margin-top: 15px;margin-bottom: 0px;padding:0; font-size: 12px; color: #666; text-align: center;">\n                        Click to generate payment QR code\n                    </p>\n                </div>\n            '),document.getElementById("placeOrderBtn").addEventListener("click",je))}(a),window.pendingPayment={amount:a,address:e,shipping:n,tax:t},window.showPaymentView=Ge}function je(){return Ye.apply(this,arguments)}function Ye(){return(Ye=(0,I.A)(E().mark(function e(){var n,t,a,r,i,s,o,c,l,d,p,u,m,g,f,b,y,h,v,x,w;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.querySelector('input[name="payment"]:checked')){e.next=1;break}return alert("Please select a payment method"),e.abrupt("return");case 1:if(t=n.value,a=Ke(),r=window.pendingPayment?window.pendingPayment.amount:window.orderTotal||0,i=null,s=null,"paypal"!==t){e.next=6;break}return e.prev=2,e.next=3,fetch("https://api.exchangerate-api.com/v4/latest/USD");case 3:return o=e.sent,e.next=4,o.json();case 4:c=e.sent,i=c.rates.CNY,s=r/i,e.next=6;break;case 5:e.prev=5,e.catch(2),s=r/(i=7.2);case 6:return l="",e.prev=7,e.next=8,supabase.auth.getUser();case 8:if(d=e.sent,!(p=d.data.user)){e.next=10;break}return e.next=9,supabase.from("profiles").select("manifesto").eq("user_id",p.id).single();case 9:u=e.sent,(m=u.data)&&m.manifesto&&(l=m.manifesto);case 10:e.next=12;break;case 11:e.prev=11,e.catch(7),l="User"+Math.random().toString(36).substr(2,5).toUpperCase();case 12:if(window.currentOrder={orderId:a,paymentMethod:t,amount:r,usdAmount:s,exchangeRate:i,manifesto:l,status:"pending",createdAt:(new Date).toISOString()},g={alipay:"Alipay(支付宝)",wechat:"WeChat Pay(微信支付)",paypal:"PayPal"},f={alipay:"/images/alipay-qr.png",wechat:"/images/wechat-qr.png",paypal:"./images/paypal-qr.png"}[t]||"./images/default-qr.png",b=document.querySelector(".cart-container")){e.next=13;break}return(y=document.getElementById("cartContent"))&&We(y,a,r,t,g,f,l,s,i),e.abrupt("return");case 13:We(b,a,r,t,g,f,l,s,i),(h=document.getElementById("cartSummary"))&&(h.innerHTML=z()(v=z()(x='\n                <h3>PAYMENT PENDING</h3>\n                <div style="padding: 20px; text-align: center;">\n                    <p style="color: black; font-size: 20px; margin-bottom: 10px;">\n                        Waiting for payment\n                    </p>\n                    <p style="font-size: 15px; color: #666;">\n                        Order #'.concat(a,'\n                    </p>\n                    <p style="font-size: 25px; font-weight: bold; margin-top: 10px;">\n                        ')).call(x,"paypal"===t&&s?"$".concat(s.toFixed(2)," USD"):"¥".concat(r.toFixed(2)),"\n                    </p>\n                    ")).call(v,"paypal"===t&&i?z()(w='<p style="font-size: 12px; color: #666; margin-top: 5px;">\n                            (¥'.concat(r.toFixed(2)," @ 1 USD = ")).call(w,i.toFixed(4)," CNY)\n                        </p>"):"","\n                </div>\n            "));case 14:case"end":return e.stop()}},e,null,[[2,5],[7,11]])}))).apply(this,arguments)}function We(e,n,t,a,r,i,s){var o,c,l,d,p,u,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,f=document.querySelector(".cart-header"),b=document.getElementById("cartContent");f&&(f.innerHTML='\n                <h1>PAYMENT</h1>\n                <button class="back-button" data-action="back-to-review" style="\n                    padding: 8px 15px;\n                    border: 2px solid black;\n                    background: white;\n                    cursor: pointer;\n                    font-size: 14px;\n                ">← BACK TO REVIEW</button>\n            ');var y,h;"paypal"===a&&m&&g?z()(y=z()(h='\n            <p><strong>Amount:</strong> \n            <span style="font-size: 20px; font-weight: bold;">$'.concat(m.toFixed(2),' USD</span><br>\n            <span style="font-size: 14px; color: #666;">(¥')).call(h,t.toFixed(2)," CNY @ 1 USD = ")).call(y,g.toFixed(2)," CNY)</span>\n            </p>\n        "):'<p><strong>Amount:</strong> <span style="font-size: 20px; font-weight: bold;">¥'.concat(t.toFixed(2),"</span></p>");var v=z()(o=z()(c=z()(l=z()(d=z()(p=z()(u='\n            <style>\n                .payment-display-container {\n                    padding: 20px;\n                    border: black 2px solid;\n                }\n                \n                .order-info {\n                    padding: 20px;\n                    margin-bottom: 20px;\n                    border: 2px solid black;\n                }\n                \n                .order-info h3 {\n                    margin-top: 0;\n                    text-transform: uppercase;\n                }\n                \n                .order-info p {\n                    margin: 10px 0;\n                    line-height: 1.6;\n                }\n                \n                .qr-section {\n                    text-align: center;\n                }\n                \n                .qr-section h4 {\n                    font-size: 20px;\n                    margin-bottom: 10px;\n                    text-transform: uppercase;\n                }\n                \n                .payment-note {\n                    margin-top: 10px;\n                    line-height: 1.8;\n                }\n            </style>\n            \n            <div class="payment-display-container">\n                <div class="order-info">\n                    <h3>ORDER INFORMATION</h3>\n                    <p><strong>Order Number:</strong> <span style="font-size: 18px; color: black;">'.concat(n,'</span></p>\n                    <p><strong>Manifesto#:</strong> <span style="font-size: 18px; color: black;">')).call(u,s||"Anonymous",'</span></p>\n                    <p><strong>Amount:</strong> <span style="font-size: 20px; font-weight: bold;">¥')).call(p,t.toFixed(2),"</span></p>\n                    <p><strong>Payment Method:</strong> ")).call(d,r[a]||a,'</p>\n                </div>\n                \n                <div class="qr-section">\n                    <h4>SCAN TO PAY</h4>\n                    <div style="margin-top:5px; border: 2px solid black; padding: 10px; display: inline-block; background: white;">\n                        <img src="')).call(l,i,'" \n                             alt="')).call(c,r[a]," QR Code\" \n                             class=\"qr-code-img\"\n                             style=\"width: 250px; height: 250px; display: block;\"\n                             onerror=\"this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'250\\' height=\\'250\\'%3E%3Crect fill=\\'%23f0f0f0\\' width=\\'250\\' height=\\'250\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' text-anchor=\\'middle\\' dy=\\'.3em\\' fill=\\'%23999\\'%3EQR Code%3C/text%3E%3C/svg%3E'; this.onerror=null;\">\n                    </div>\n                    <p class=\"payment-note\">\n                        <span style=\"color: black;\">Please include your manifesto in payment note(付款时请备注你的宣言)</span><br>\n                        <span style=\"color: black; font-weight: bold; font-size: 18px;\">宣言 Manifesto#: ")).call(o,s||"Anonymous",'</span>\n                    </p>\n                </div>\n                \n                <button id="confirmPaymentBtn" class="confirm-payment-btn"  style="\n                    background: black;\n                    color: white;\n                    padding: 5px;\n                    border: none;\n                    font-size: 18px;\n                    cursor: pointer;\n                    width: 100%;\n                    margin-top:5px;\n                ">\n                    I HAVE PAID(我已完成支付)\n                </button>\n            </div>\n        ');b.innerHTML=v}function Ve(){window.PAYMENT_QR_CODES||(window.PAYMENT_QR_CODES={alipay:"/images/alipay-qr.png",wechat:"/images/wechat-qr.png",paypal:"/images/paypal-qr.png"})}function Ke(){var e,n=G()().toString(36).toUpperCase(),t=Math.random().toString(36).substr(2,5).toUpperCase();return z()(e="ORD".concat(n)).call(e,t)}function Qe(){var e=null;if(window.pendingPayment&&window.pendingPayment.address)e=window.pendingPayment;else if(sessionStorage.getItem("pendingPayment"))try{e=JSON.parse(sessionStorage.getItem("pendingPayment")),window.pendingPayment=e}catch(e){}else window.checkoutAddress&&window.orderTotal&&(e={address:window.checkoutAddress,shipping:window.shippingCost||0,tax:window.taxAmount||0,amount:window.orderTotal},window.pendingPayment=e);e&&e.address?"function"==typeof window.showPaymentView&&window.showPaymentView(e.address,e.shipping,e.tax,e.amount):(alert("Payment information lost. Please restart checkout."),"function"==typeof window.loadCartItems&&window.loadCartItems())}function Ze(e,n){return Je.apply(this,arguments)}function Je(){return Je=(0,I.A)(E().mark(function e(n,t){var a,r,i,s,o;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=[],r=se(t),e.prev=1,s=E().mark(function e(){var t,r,s,o,c,l,d,p,u,m,g,f,b,y,h,v,x,w,k,S,P;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((t=i.value).draft_id){e.next=1;break}return e.abrupt("return",0);case 1:return e.prev=1,r=function(){var e=(0,I.A)(E().mark(function e(t,a){var r,i,s,o,c,l,d,p;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t){e.next=1;break}return e.abrupt("return",null);case 1:if(!Y()(t).call(t,"data:")){e.next=4;break}return e.next=2,fetch(t);case 2:return s=e.sent,e.next=3,s.blob();case 3:case 7:i=e.sent,e.next=9;break;case 4:if(!Y()(t).call(t,"http")){e.next=8;break}return e.next=5,fetch(t);case 5:if((o=e.sent).ok){e.next=6;break}throw new Error("Failed to fetch image");case 6:return e.next=7,o.blob();case 8:return e.abrupt("return",null);case 9:return c=z()(r="".concat(n,"/")).call(r,a),e.next=10,supabase.storage.from("orders").upload(c,i,{contentType:i.type||"image/png",upsert:!0});case 10:if(l=e.sent,l.data,!l.error){e.next=11;break}return e.abrupt("return",null);case 11:return d=supabase.storage.from("orders").getPublicUrl(c),p=d.data.publicUrl,e.abrupt("return",p);case 12:return e.prev=12,e.catch(0),e.abrupt("return",null);case 13:case"end":return e.stop()}},e,null,[[0,12]])}));return function(n,t){return e.apply(this,arguments)}}(),e.next=2,supabase.from("drafts").select("*").eq("id",t.draft_id).single();case 2:if(s=e.sent,o=s.data,!s.error&&o){e.next=3;break}return e.abrupt("return",0);case 3:if("tshirt"!==o.type){e.next=16;break}if(!o.front_preview_image){e.next=5;break}return e.next=4,r(o.front_preview_image,"tshirt_".concat(t.draft_id,"_front_preview.png"));case 4:(c=e.sent)&&a.push({type:"front_preview",url:c});case 5:if(!o.back_preview_image){e.next=7;break}return e.next=6,r(o.back_preview_image,"tshirt_".concat(t.draft_id,"_back_preview.png"));case 6:(l=e.sent)&&a.push({type:"back_preview",url:l});case 7:if(!o.data){e.next=15;break}if(!o.data.frontImages||!ae()(o.data.frontImages)){e.next=11;break}d=0;case 8:if(!(d<o.data.frontImages.length)){e.next=11;break}if(u=o.data.frontImages[d],m=null,null!==(p=u.storageFile)&&void 0!==p&&p.publicUrl?m=u.storageFile.publicUrl:u.url?m=u.url:u.src&&(m=u.src),!m){e.next=10;break}return e.next=9,r(m,z()(g="tshirt_".concat(t.draft_id,"_front_design_")).call(g,d,".png"));case 9:(f=e.sent)&&a.push({type:"front_design",index:d,url:f});case 10:d++,e.next=8;break;case 11:if(!o.data.backImages||!ae()(o.data.backImages)){e.next=15;break}b=0;case 12:if(!(b<o.data.backImages.length)){e.next=15;break}if(h=o.data.backImages[b],v=null,null!==(y=h.storageFile)&&void 0!==y&&y.publicUrl?v=h.storageFile.publicUrl:h.url?v=h.url:h.src&&(v=h.src),!v){e.next=14;break}return e.next=13,r(v,z()(x="tshirt_".concat(t.draft_id,"_back_design_")).call(x,b,".png"));case 13:(w=e.sent)&&a.push({type:"back_design",index:b,url:w});case 14:b++,e.next=12;break;case 15:e.next=20;break;case 16:if("svg"!==o.type){e.next=20;break}if(!o.front_preview_image){e.next=18;break}return e.next=17,r(o.front_preview_image,"svg_".concat(t.draft_id,"_preview.png"));case 17:(S=e.sent)&&a.push({type:"svg_preview",url:S});case 18:if(null===(k=o.data)||void 0===k||!k.storageUrl){e.next=20;break}return e.next=19,r(o.data.storageUrl,"svg_".concat(t.draft_id,".svg"));case 19:(P=e.sent)&&a.push({type:"svg_file",url:P});case 20:e.next=22;break;case 21:e.prev=21,e.catch(1);case 22:case"end":return e.stop()}},e,null,[[1,21]])}),r.s();case 2:if((i=r.n()).done){e.next=5;break}return e.delegateYield(s(),"t0",3);case 3:if(0!==e.t0){e.next=4;break}return e.abrupt("continue",4);case 4:e.next=2;break;case 5:e.next=7;break;case 6:e.prev=6,o=e.catch(1),r.e(o);case 7:return e.prev=7,r.f(),e.finish(7);case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}},e,null,[[1,6,7,8]])})),Je.apply(this,arguments)}function $e(){return Xe.apply(this,arguments)}function Xe(){return(Xe=(0,I.A)(E().mark(function e(){var n,t,a,r,i,s,o,c,l,d;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(n=document.getElementById("confirmPaymentBtn")).disabled=!0,n.textContent="AWAITING VERIFICATION(请等待审核)",n.style.background="#999",window.currentOrder.status="awaiting_verification",window.currentOrder.paidAt=(new Date).toISOString(),e.prev=1,e.next=2,supabase.auth.getUser();case 2:if(t=e.sent,a=t.data.user,!t.error&&a){e.next=3;break}return alert("Please login to continue"),n.disabled=!1,n.textContent="I HAVE PAID(我已完成支付)",n.style.background="black",e.abrupt("return");case 3:return e.next=4,supabase.from("cart_items").select("*, drafts(*)").eq("user_id",a.id);case 4:if(r=e.sent,i=r.data,r.error,!(i&&i.length>0)){e.next=8;break}return n.textContent="SAVING DESIGNS(保存设计中)",e.prev=5,e.next=6,Ze(window.currentOrder.orderId,i);case 6:e.sent,e.next=8;break;case 7:e.prev=7,e.catch(5);case 8:return n.textContent="SUBMITTING ORDER(提交订单中)",s={order_id:window.currentOrder.orderId,user_id:a.id,manifesto:window.currentOrder.manifesto||"Anonymous",items:i||[],shipping_address:window.pendingPayment?window.pendingPayment.address:window.checkoutAddress,payment_method:window.currentOrder.paymentMethod,amount:window.currentOrder.amount,shipping_cost:window.pendingPayment?window.pendingPayment.shipping:window.shippingCost||0,tax_amount:window.pendingPayment?window.pendingPayment.tax:window.taxAmount||0,status:"awaiting_verification",payment_status:"pending_verification",created_at:window.currentOrder.createdAt,paid_at:window.currentOrder.paidAt},e.next=9,supabase.from("orders").insert([s]).select().single();case 9:if(o=e.sent,o.data,!(c=o.error)){e.next=10;break}return"42501"===c.code?alert("Database permission error. Please contact support.\n\nError: RLS policy violation\nOrder ID: "+window.currentOrder.orderId):alert("Error saving order: "+c.message+"\n\nPlease save your order number: "+window.currentOrder.orderId),n.disabled=!1,n.textContent="I HAVE PAID(我已完成支付)",n.style.background="black",e.abrupt("return");case 10:return(l=document.getElementById("cartContent"))&&(l.innerHTML='\n                <div style="text-align: center; padding: 40px;">\n                    <h2 style="color: black;">✓ PAYMENT SUBMITTED</h2>\n                    <p style="font-size: 18px; margin: 20px 0;">\n                        Order #'.concat(window.currentOrder.orderId,'\n                    </p>\n                    <p style="color: black;">\n                        We will verify your payment within 24 hours<br>\n                        付款将在24小时内审核\n                    </p><br>\n                    <p style="color: black;">\n                    You can check your order progress in your profile<br>\n                    您可以在档案中查看订单进展\n                </p>\n                    <button class="cart-btn" data-action="go-home" style="\n                        margin-top: 30px;\n                        padding: 15px 30px;\n                        background: black;\n                        color: white;\n                        border: none;\n                        cursor: pointer;\n                        font-size: 16px;\n                    ">CONTINUE SHOPPING</button>\n                </div>\n            ')),e.next=11,supabase.from("cart_items").delete().eq("user_id",a.id);case 11:if(d=e.sent,d.error,!window.CartManager){e.next=12;break}return e.next=12,window.CartManager.updateCartBadge();case 12:sessionStorage.removeItem("pendingPayment"),alert("Order submitted successfully!\n订单提交成功！\n\nOrder #".concat(window.currentOrder.orderId,"\n\nWe will verify your payment within 24 hours.\n我们将在24小时内验证您的付款。")),e.next=14;break;case 13:e.prev=13,e.catch(1),alert("Unexpected error. Please save your order number: "+window.currentOrder.orderId),n.disabled=!1,n.textContent="I HAVE PAID(我已完成支付)",n.style.background="black";case 14:case"end":return e.stop()}},e,null,[[1,13],[5,7]])}))).apply(this,arguments)}window.SHIPPING_CONFIG={CN:{name:"China (Mainland)",carrier:"ZTO Express (中通快递)",shipping:0,tax:0,currency:"CNY",estimatedDays:"2-5",trackingPrefix:"ZTO"},HK:{name:"Hong Kong",carrier:"SF Express International (顺丰国际)",shipping:25,tax:0,currency:"USD",estimatedDays:"3-7",trackingPrefix:"SF"},TW:{name:"Taiwan",carrier:"SF Express International (顺丰国际)",shipping:30,tax:5,currency:"USD",estimatedDays:"5-10",trackingPrefix:"SF"},JP:{name:"Japan",carrier:"SF Express International (顺丰国际)",shipping:45,tax:10,currency:"USD",estimatedDays:"7-14",trackingPrefix:"SF"},UK:{name:"United Kingdom",carrier:"SF Express International (顺丰国际)",shipping:65,tax:20,currency:"USD",estimatedDays:"10-15",trackingPrefix:"SF"},US:{name:"United States",carrier:"SF Express International (顺丰国际)",shipping:60,tax:8,currency:"USD",estimatedDays:"10-15",trackingPrefix:"SF"},OTHER:{name:"Other Countries",carrier:"SF Express International (顺丰国际)",shipping:75,tax:15,currency:"USD",estimatedDays:"15-30",trackingPrefix:"SF"}},void 0===window.PAYMENT_QR_CODES&&(window.PAYMENT_QR_CODES={alipay:"/images/alipay-qr.png",wechat:"/images/wechat-qr.png",paypal:"/images/paypal-qr.png"}),A()(function(){if("undefined"!=typeof supabase)ce();else var e=C()(function(){"undefined"!=typeof supabase&&(clearInterval(e),ce())},100)},100),window.proceedToPayment=function(){var e=document.querySelector('input[name="selectedAddress"]:checked');if(e){var n=_()(e.value),t=(window.currentSavedAddresses||[])[n];t?(window.checkoutAddress=t,Me(t)):alert("Selected address not found")}else alert("Please select a shipping address")},document.getElementById("checkoutForm").addEventListener("submit",function(){var e=(0,I.A)(E().mark(function e(n){var t,a;return E().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.preventDefault(),t=new FormData(n.target),a={fullName:t.get("fullName"),email:t.get("email"),phone:t.get("phone"),address1:t.get("address1"),address2:t.get("address2"),city:t.get("city"),state:t.get("state"),zipCode:t.get("zipCode"),country:t.get("country")},window.checkoutAddress=a,ze(a);case 1:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}()),window.updateQuantity=ve,window.removeItem=we,window.clearAllItems=function(){return Ie.apply(this,arguments)},window.proceedToCheckout=Ee,window.goToHome=Se,window.showPaymentView=Ge,window.generatePaymentOrder=je,window.initializePaymentQRCodes=Ve,window.confirmPayment=$e,window.displayPaymentInfo=We,window.handleBackToReview=Qe,window.handleCartClick=pe,window.saveOrderImagesToStorage=Ze}},r={};function i(e){var n=r[e];if(void 0!==n)return n.exports;var t=r[e]={exports:{}};return a[e].call(t.exports,t,t.exports,i),t.exports}i.m=a,e=[],i.O=(n,t,a,r)=>{if(!t){var s=1/0;for(d=0;d<e.length;d++){for(var[t,a,r]=e[d],o=!0,c=0;c<t.length;c++)(!1&r||s>=r)&&Object.keys(i.O).every(e=>i.O[e](t[c]))?t.splice(c--,1):(o=!1,r<s&&(s=r));if(o){e.splice(d--,1);var l=a();void 0!==l&&(n=l)}}return n}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[t,a,r]},i.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return i.d(n,{a:n}),n},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var r=Object.create(null);i.r(r);var s={};n=n||[null,t({}),t([]),t(t)];for(var o=2&a&&e;("object"==typeof o||"function"==typeof o)&&!~n.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(n=>s[n]=()=>e[n]);return s.default=()=>e,i.d(r,s),r},i.d=(e,n)=>{for(var t in n)i.o(n,t)&&!i.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=553,(()=>{var e={553:0};i.O.j=n=>0===e[n];var n=(n,t)=>{var a,r,[s,o,c]=t,l=0;if(s.some(n=>0!==e[n])){for(a in o)i.o(o,a)&&(i.m[a]=o[a]);if(c)var d=c(i)}for(n&&n(t);l<s.length;l++)r=s[l],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(d)},t=self.webpackChunk=self.webpackChunk||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var s=i.O(void 0,[96],()=>i(71033));s=i.O(s)})();