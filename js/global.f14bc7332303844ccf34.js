(()=>{"use strict";var e,t={15230:(e,t,n)=>{var r=n(5773),a=n(39653),s=n(56213),o=n(34963),u=n(44828),i=n.n(u),c=n(11265),d=n.n(c),l=n(56255),p=n.n(l),m=n(54929),f=n.n(m),g=n(18979),y=n.n(g),h=n(61240),b=n.n(h),v=n(29550),w=n.n(v),x=n(11393),k=n.n(x),E=n(74707),I=n.n(E),C=n(86226),B=n.n(C),L=n(15413),_=n.n(L),M=n(66512),A=n.n(M),S=n(8628),q=n.n(S),T=n(49763),O=n.n(T),U=n(48079),D=n.n(U),P=n(71426),z=n.n(P),F=n(86129),H=n.n(F);function N(){var e,t,n,r=document.getElementById("manifesto"),a=(e=(0,o.A)(i().mark(function e(){var t,n;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=d()(t=this.value).call(t))){e.next=2;break}return e.next=1,R(n);case 1:e.next=3;break;case 2:return e.next=3,R("MANIFESTOCLUB");case 3:case"end":return e.stop()}},e,this)})),t=300,function(){var r=this,a=arguments;clearTimeout(n),n=p()(function(){e.apply(r,a)},t)});r.addEventListener("input",a)}function R(e){return j.apply(this,arguments)}function j(){return j=(0,o.A)(i().mark(function e(t){var n,r,a,s,o,u=arguments;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:"barcode",r="ManifestoClub",a="MANIFESTOCLUB",!t||"MANIFESTOCLUB"===t){e.next=2;break}return e.next=1,G(t);case 1:s=e.sent,r=y()(s).call(s,0,15),a=s,e.next=4;break;case 2:return e.next=3,G("MANIFESTOCLUB");case 3:a=e.sent;case 4:try{(o=document.getElementById(n)).innerHTML="",H(),H()(o,a,{format:"CODE128",displayValue:!0,text:r,font:'"Lucida Console"',width:2,height:80,margin:0}),o.setAttribute("data-barcode",a)}catch(e){}return e.abrupt("return",a);case 5:case"end":return e.stop()}},e)})),j.apply(this,arguments)}function G(e){return Y.apply(this,arguments)}function Y(){return(Y=(0,o.A)(i().mark(function e(t){var n,r,a,s,o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"==typeof crypto||!crypto.subtle){e.next=4;break}return e.prev=1,n=new TextEncoder,r=n.encode(t),e.next=2,crypto.subtle.digest("SHA-256",r);case 2:return a=e.sent,s=O()(new Uint8Array(a)),o=D()(s).call(s,function(e){var t;return f()(t=e.toString(16)).call(t,2,"0")}).join(""),e.abrupt("return",y()(o).call(o,0,15));case 3:return e.prev=3,e.catch(1),e.abrupt("return",Q(t));case 4:return e.abrupt("return",Q(t));case 5:case"end":return e.stop()}},e,null,[[1,3]])}))).apply(this,arguments)}function Q(e){for(var t,n=0,r=e+"MANIFESTOCLUB_SALT",a=0;a<r.length;a++){n=(n<<5)-n+r.charCodeAt(a),n&=n}for(var s=Math.abs(n),o=f()(t=s.toString(16)).call(t,8,"0");o.length<15;)o+=s.toString(16);return y()(o).call(o,0,15)}function V(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;return new(b())(function(n,r){var a=document.getElementById(e);if(a)n(a);else{var s=w()(),o=function(){var a,u=document.getElementById(e);u?n(u):w()()-s>t?r(new Error(k()(a="Element ".concat(e," not found within ")).call(a,t,"ms"))):p()(o,50)};o()}})}window.addEventListener("load",function(){R("MANIFESTOCLUB"),N()});var X=new(function(){return(0,s.A)(function e(){(0,a.A)(this,e),this.cache=new(I()),this.isReady=!0},[{key:"generateBarcodeImage",value:(n=(0,o.A)(i().mark(function e(t,n){var r,a,s,o=arguments;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:"member-barcode-complete",e.prev=1,e.next=2,V(r,5e3);case 2:return a=e.sent,e.next=3,this.createBarcodeCanvas(t,n,a);case 3:return s=e.sent,a&&s&&(a.style.width="100%",a.style.height="auto",a.style.objectFit="contain",a.style.display="block"),e.abrupt("return",s);case 4:e.prev=4,e.catch(1);case 5:case"end":return e.stop()}},e,this,[[1,4]])})),function(e,t){return n.apply(this,arguments)})},{key:"createBarcodeCanvas",value:(t=(0,o.A)(i().mark(function e(t,n,r){var a,s,o,u,c,l,p,m,f,g,y,h,b,v,w,x,E,I,C,L,M;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=k()(a="barcode_".concat(t,"_")).call(a,n),!this.cache.has(s)){e.next=1;break}return o=this.cache.get(s),r.src=o,r.style.display="block",e.abrupt("return",o);case 1:if(e.prev=1,u=function(e,t,n,r,a,s){for(var o=t.split(" "),u="",i=[],l=0;l<o.length;l++){var p=u+o[l]+" ";e.measureText(p).width>a&&l>0?(i.push(d()(u).call(u)),u=o[l]+" "):u=p}i.push(d()(u).call(u));var m=[];B()(i).call(i,function(t){if(e.measureText(t).width>a){for(var n="",r=0;r<t.length;r++){var s=n+t[r];e.measureText(s).width>a&&n.length>0?(m.push(n),n=t[r]):n=s}n&&m.push(n)}else m.push(t)});var f=m.length*s,g=r-f/2+s/2,y=c.width,h=0;return B()(m).call(m,function(t,r){var a=g+r*s;e.fillText(t,n,a);var o=e.measureText(t).width,u=n-o/2,i=n+o/2;y=Math.min(y,u),h=Math.max(h,i)}),{endY:g+f,minX:y,maxX:h,startY:g,height:f}},c=document.createElement("canvas"),l=c.getContext("2d"),c.width=1500,c.height=800,l.fillStyle="#000000",l.font="".concat(90,"px Arial, sans-serif"),l.textAlign="center",p=c.width,m=u(l,t,c.width/2,200,p,108),f=Math.max(m.endY-65,-200),(g=document.createElement("canvas")).width=1500,g.height=500,g.getContext("2d").clearRect(0,0,g.width,g.height),H()(g,n,{format:"CODE128",displayValue:!0,width:10,height:300,margin:0,background:"transparent",font:'"Lucida Console"',fontSize:100}),y=(c.width-g.width)/2,l.drawImage(g,y,f),!(h=this.getContentBounds(l,c.width,c.height))){e.next=2;break}return b=Math.max(0,h.minX-20),v=Math.max(0,h.minY-20),w=Math.min(c.width,h.maxX+20)-b,x=Math.min(c.height,h.maxY+20)-v,(E=document.createElement("canvas")).width=w,E.height=x,E.getContext("2d").drawImage(c,b,v,w,x,0,0,w,x),I=E.toDataURL("image/png"),this.cache.size>50&&(L=_()(C=this.cache).call(C).next().value,this.cache.delete(L)),this.cache.set(s,I),r.src=I,r.style.display="block",e.abrupt("return",I);case 2:return M=c.toDataURL("image/png"),this.cache.set(s,M),r.src=M,r.style.display="block",e.abrupt("return",M);case 3:return e.prev=3,e.catch(1),e.abrupt("return",null);case 4:case"end":return e.stop()}},e,this,[[1,3]])})),function(e,n,r){return t.apply(this,arguments)})},{key:"getContentBounds",value:function(e,t,n){try{for(var r=e.getImageData(0,0,t,n).data,a=t,s=0,o=n,u=0,i=!1,c=0;c<n;c++)for(var d=0;d<t;d++){var l=4*(c*t+d),p=r[l],m=r[l+1],f=r[l+2];r[l+3]>0&&(p<250||m<250||f<250)&&(i=!0,a=Math.min(a,d),s=Math.max(s,d),o=Math.min(o,c),u=Math.max(u,c))}return i?{minX:a,maxX:s,minY:o,maxY:u}:null}catch(e){return null}}},{key:"preloadBarcode",value:(e=(0,o.A)(i().mark(function e(t,n){var r,a,s;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=k()(r="barcode_".concat(t,"_")).call(r,n),this.cache.has(a)){e.next=1;break}return s=document.createElement("img"),e.next=1,this.createBarcodeCanvas(t,n,s);case 1:case"end":return e.stop()}},e,this)})),function(t,n){return e.apply(this,arguments)})}]);var e,t,n}());function W(){return $.apply(this,arguments)}function $(){return($=(0,o.A)(i().mark(function e(){var t,n,r,a;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,"undefined"!=typeof supabase){e.next=1;break}return e.abrupt("return");case 1:return e.next=2,supabase.auth.getUser();case 2:if(t=e.sent,n=t.data.user){e.next=3;break}return e.abrupt("return");case 3:return e.next=4,supabase.from("profiles").select("manifesto, barcode").eq("user_id",n.id).single();case 4:if(r=e.sent,a=r.data,!r.error){e.next=5;break}return e.abrupt("return");case 5:if(!a||!a.barcode){e.next=7;break}return e.next=6,X.generateBarcodeImage(a.manifesto||"No manifesto",a.barcode,"member-barcode-complete");case 6:case 7:e.next=9;break;case 8:e.prev=8,e.catch(0);case 9:case"end":return e.stop()}},e,null,[[0,8]])}))).apply(this,arguments)}function K(){return(K=(0,o.A)(i().mark(function e(){var t,n,r,a,s,o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,R("MANIFESTOCLUB");case 1:return N(),e.next=2,J();case 2:if(t=window.location.hash,!q()(t).call(t,"access_token")&&!q()(t).call(t,"refresh_token")){e.next=4;break}return e.next=3,supabase.auth.getSession();case 3:n=e.sent,r=n.data,n.error||r.session&&(a=new(A())(window.location.search),s="password_update"===a.get("type"),o=a.get("email"),s&&o&&Ce(decodeURIComponent(o))),window.history.replaceState({},"",window.location.pathname);case 4:ke(),Ae(),e.next=6;break;case 5:e.prev=5,e.catch(0);case 6:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}function J(){return Z.apply(this,arguments)}function Z(){return(Z=(0,o.A)(i().mark(function e(){var t,n,r,a,s,u,c,l,m,f,g,y,h,b,v,w,x,k,E;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return document.documentElement.classList.remove("lock"),e.next=1,supabase.auth.getUser();case 1:t=e.sent,n=t.data.user,r=document.querySelector(".header__nav li:last-child"),a=document.querySelector(".header__nav--mobile ul"),n?(r&&(r.innerHTML='\n        <div class="user-menu">\n          <span class="user-menu-trigger">(ME)</span>\n          <div class="user-dropdown" id="user-dropdown" style="display: none;">\n            <div class="user-info">\n              <a class="profile" href="profile" data-page="profile">Profile</a>\n            </div>\n            <div class="user-actions">\n              <span class="logout-btn">LOGOUT</span>\n            </div>\n          </div>\n        </div>\n      '),a&&(s=a.querySelector("li .profile"),u=a.querySelector("li .logout-btn"),c=a.querySelector("li .cart-link"),s&&u&&c||(m=z()(l=O()(a.querySelectorAll("li"))).call(l,function(e){var t,n=e.querySelector("span");return n&&"LOGIN"===d()(t=n.textContent).call(t)}),c||((f=document.createElement("li")).innerHTML='\n   <div class="cart-link" href="cart" data-page="cart">CART(<span id="cartBadgeMobile">0</span>)</div>',m.insertAdjacentElement("beforebegin",f)),m&&(m.innerHTML='<a class="profile" href="profile" data-page="profile">PROFILE</a>',u||((g=document.createElement("li")).innerHTML='<span class="logout-btn">LOGOUT</span>',a.appendChild(g))))),p()((0,o.A)(i().mark(function e(){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,W();case 1:case"end":return e.stop()}},e)})),100)):(r&&(r.innerHTML='<span id="login-trigger">Login</span>'),a&&(w=null===(y=a.querySelector("li .profile"))||void 0===y?void 0:y.parentElement,x=null===(h=a.querySelector("li .logout-btn"))||void 0===h?void 0:h.parentElement,w&&w.remove(),x&&x.remove(),"LOGIN"===(null===(b=a.querySelector("li span"))||void 0===b?void 0:d()(v=b.textContent).call(v))||((k=document.createElement("li")).innerHTML="<span>LOGIN</span>",a.appendChild(k))),(E=document.getElementById("member-barcode-complete"))&&(E.style.display="none",E.src=""));case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ee(){return te.apply(this,arguments)}function te(){return(te=(0,o.A)(i().mark(function e(){var t,n,r,a,s,o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.getElementById("manifesto"),r=document.querySelector(".check-manifesto"),(a=document.getElementById("manifesto-error")).style.display="none",r.innerHTML="",d()(t=n.value).call(t)){e.next=1;break}return a.textContent="Please enter your manifesto",a.style.display="block",e.abrupt("return",!1);case 1:return e.next=2,ne(n.value);case 2:return s=e.sent,(o=r.querySelector("img"))||((o=document.createElement("img")).alt=s?"Valid":"Invalid",r.appendChild(o)),s?(o.src="/images/yes.png",a.style.display="none"):(o.src="/images/no.png",a.textContent="This manifesto already exists",a.style.display="block"),e.abrupt("return",s);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ne(e){return re.apply(this,arguments)}function re(){return(re=(0,o.A)(i().mark(function e(t){var n,r;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d()(t).call(t)){e.next=1;break}return e.abrupt("return",!1);case 1:return e.next=2,supabase.from("profiles").select("manifesto").eq("manifesto",t);case 2:if(n=e.sent,r=n.data,!n.error){e.next=3;break}return e.abrupt("return",!1);case 3:return e.abrupt("return",0===r.length);case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ae(){return se.apply(this,arguments)}function se(){return(se=(0,o.A)(i().mark(function e(){var t,n,r,a,s;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("signup-email"),n=document.querySelector(".check-email"),r=document.getElementById("email-error"),n.innerHTML="",r.style.display="none",e.next=1,oe(t.value);case 1:if((a=e.sent).valid){e.next=7;break}s=a.reason,e.next="empty"===s?2:"invalid_format"===s?3:"registered"===s?4:5;break;case 2:return e.abrupt("return",!1);case 3:return r.textContent="Please enter a valid email address",e.abrupt("continue",6);case 4:return r.textContent="This email is already registered",e.abrupt("continue",6);case 5:r.textContent="Validation error";case 6:return r.style.display="block",n.innerHTML='<img src="/images/no.png" alt="Invalid">',e.abrupt("return",!1);case 7:return n.innerHTML='<img src="/images/yes.png" alt="Valid">',e.abrupt("return",!0);case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function oe(e){return ue.apply(this,arguments)}function ue(){return(ue=(0,o.A)(i().mark(function e(t){var n,r;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d()(t).call(t)){e.next=1;break}return e.abrupt("return",{valid:!1,reason:"empty"});case 1:if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){e.next=2;break}return e.abrupt("return",{valid:!1,reason:"invalid_format"});case 2:return e.next=3,supabase.from("profiles").select("email").eq("email",t);case 3:if(n=e.sent,r=n.data,!n.error){e.next=4;break}return e.abrupt("return",{valid:!1,reason:"error"});case 4:return e.abrupt("return",{valid:0===r.length,reason:0===r.length?"available":"registered"});case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}function ie(){return ce.apply(this,arguments)}function ce(){return(ce=(0,o.A)(i().mark(function e(){var t,n,r,a,s,o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=document.getElementById("signup-password"),r=document.querySelector(".check-password"),a=document.getElementById("password-error"),r.innerHTML="",a.style.display="none",0!==(s=d()(t=n.value).call(t)).length){e.next=1;break}return e.abrupt("return",!1);case 1:return(o=s.length>=8)?r.innerHTML='<img src="/images/yes.png" alt="Valid">':(r.innerHTML='<img src="/images/no.png" alt="Invalid">',a.textContent="Password must be longer than 8 characters",a.style.display="block"),e.abrupt("return",o);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function de(){return le.apply(this,arguments)}function le(){return(le=(0,o.A)(i().mark(function e(){var t,n,a,s,o,u,c,d,l,m,f,g,y,h,v;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,b().all([ee(),ae(),ie()]);case 1:if(t=e.sent,n=(0,r.A)(t,3),a=n[0],s=n[1],o=n[2],a&&s&&o){e.next=2;break}return u=function(e){e.style.display="none",p()(function(){return e.style.display="block"},10)},a||(u(document.getElementById("manifesto-error")),document.getElementById("manifesto").focus()),s||(u(document.getElementById("email-error")),document.getElementById("signup-email").focus()),o||(u(document.getElementById("password-error")),document.getElementById("signup-password").focus()),e.abrupt("return");case 2:return c=document.getElementById("signup-email").value,d=document.getElementById("signup-password").value,l=document.getElementById("manifesto").value,e.next=3,R(l);case 3:return m=e.sent,e.next=4,supabase.auth.signUp({email:c,password:d,options:{data:{manifesto:l,barcode:m}}});case 4:if(f=e.sent,g=f.data,!(y=f.error)){e.next=5;break}throw y;case 5:return e.next=6,supabase.from("profiles").upsert({user_id:g.user.id,email:c,manifesto:l,barcode:m,created_at:new Date});case 6:if(h=e.sent,!(v=h.error)){e.next=7;break}throw v;case 7:pe({email:c,manifesto:l});case 8:case"end":return e.stop()}},e)}))).apply(this,arguments)}function pe(e){document.querySelector(".auth-modal-header").style.display="none",document.getElementById("login-form").style.display="none",document.getElementById("signup-form").style.display="none",document.getElementById("password-reset-form").style.display="none",document.getElementById("signup-success-form").style.display="block",document.getElementById("manifesto-code").textContent=e.manifesto,document.getElementById("success-email").textContent=e.email,R(e.manifesto,"barcode-success")}function me(){return fe.apply(this,arguments)}function fe(){return(fe=(0,o.A)(i().mark(function e(){var t,n,r,a;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("success-email").textContent,n=document.getElementById("resend-button"),e.prev=1,n.disabled=!0,n.textContent="Sending...",e.next=2,new(b())(function(e){return p()(e,50)});case 2:return e.next=3,supabase.auth.resend({type:"signup",email:t});case 3:if(r=e.sent,!(a=r.error)){e.next=4;break}throw a;case 4:n.textContent="✓ Email Resent",e.next=6;break;case 5:e.prev=5,e.catch(1),n.textContent="Resend Verification Email",n.disabled=!1;case 6:case"end":return e.stop()}},e,null,[[1,5]])}))).apply(this,arguments)}function ge(){document.getElementById("auth-modal").style.display="none",ye()}function ye(){var e,t;document.querySelector(".auth-modal-header").style.display="block",document.getElementById("login-form").style.display="block",document.getElementById("signup-form").style.display="none",document.getElementById("signup-success-form").style.display="none",document.getElementById("password-reset-form").style.display="none",document.getElementById("signup-email").value="",document.getElementById("signup-password").value="",document.getElementById("manifesto").value="",document.getElementById("login-email").value="",document.getElementById("login-password").value="",B()(e=document.querySelectorAll(".check-icon")).call(e,function(e){e.innerHTML=""}),B()(t=document.querySelectorAll(".error-message")).call(t,function(e){e.style.display="none"}),R("MANIFESTOCLUB")}function he(){document.getElementById("login-form").style.display="none",document.getElementById("password-reset-form").style.display="block"}function be(){document.getElementById("login-form").style.display="block",document.getElementById("signup-form").style.display="none",document.getElementById("password-reset-form").style.display="none",document.getElementById("update-password-form").style.display="none"}function ve(){document.getElementById("login-form").style.display="none",document.getElementById("signup-form").style.display="block"}document.addEventListener("visibilitychange",function(){document.hidden||"profile"!==window.currentPage||p()((0,o.A)(i().mark(function e(){return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,W();case 1:case"end":return e.stop()}},e)})),100)}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".member-code-container");e&&(e.style.width="100%",e.style.boxSizing="border-box");var t=document.querySelector(".barcode-wrapper");t&&(t.style.width="100%")}),document.addEventListener("DOMContentLoaded",function(){return K.apply(this,arguments)}),"undefined"!=typeof window&&(window.barcodeGenerator=X,window.generateBarcode=R),window.openAuthModal=function(){var e=document.getElementById("auth-modal");if(e){e.style.display="block";var t=sessionStorage.getItem("resetEmail"),n=new(A())(window.location.search),r="password_update"===n.get("type"),a=n.get("email");r&&a?(Ce(decodeURIComponent(a)),window.history.replaceState({},document.title,window.location.pathname)):t?Ce(t):n.has("login")&&be()}},window.handleModalClick=function(e){e.target===document.getElementById("auth-modal")&&(document.getElementById("auth-modal").style.display="none",ye())};var we,xe=sessionStorage.getItem("resetEmail")||"";function ke(){var e=new(A())(window.location.search),t=e.get("email"),n="password_update"===e.get("type");t&&n&&(xe=decodeURIComponent(t),sessionStorage.setItem("resetEmail",xe),Ce(xe),window.history.replaceState({},"",window.location.pathname))}function Ee(){return Ie.apply(this,arguments)}function Ie(){return(Ie=(0,o.A)(i().mark(function e(){var t,n,r,a,s,o,u,c,l,m;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d()(t=document.getElementById("reset-email").value).call(t),r=document.getElementById("reset-link"),(a=document.getElementById("reset-error")).style.display="none",a.textContent="",n){e.next=1;break}return a.textContent="Please enter your email address",a.style.display="block",e.abrupt("return");case 1:if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)){e.next=2;break}return a.textContent="Please enter a valid email address",a.style.display="block",e.abrupt("return");case 2:return e.prev=2,r.disabled=!0,r.textContent="Sending...",e.next=3,supabase.from("profiles").select("email").eq("email",n).single();case 3:if(u=e.sent,c=u.data,!u.error&&c){e.next=4;break}throw a.textContent="This email is not registered",a.style.display="block",new Error("Email not registered");case 4:return e.next=5,supabase.auth.resetPasswordForEmail(n,{redirectTo:k()(s=k()(o="".concat(window.location.origin)).call(o,window.location.pathname,"?type=password_update&email=")).call(s,encodeURIComponent(n))});case 5:if(l=e.sent,!(m=l.error)){e.next=6;break}throw m;case 6:r.textContent="✓ Email Sent",sessionStorage.setItem("resetEmail",n),p()(function(){r.textContent="SEND RESET LINK",r.disabled=!1},3e3),e.next=8;break;case 7:e.prev=7,e.catch(2),a.textContent="Failed to send reset link. Please try again.",a.style.display="block",r.textContent="SEND RESET LINK",r.disabled=!1;case 8:case"end":return e.stop()}},e,null,[[2,7]])}))).apply(this,arguments)}function Ce(e){document.getElementById("login-form").style.display="none",document.getElementById("signup-form").style.display="none",document.getElementById("password-reset-form").style.display="none",document.getElementById("update-password-form").style.display="block",document.getElementById("reset-email-display").value=e,document.getElementById("new-password").value="",document.getElementById("confirm-password").value="",document.getElementById("update-password-error").style.display="none",document.getElementById("confirm-password-error").style.display="none",Be()}function Be(){var e=document.getElementById("new-password").value,t=document.getElementById("confirm-password").value,n=document.querySelector(".check-new-password"),r=document.querySelector(".check-confirm-password"),a=document.getElementById("update-password-error"),s=document.getElementById("confirm-password-error"),o=document.getElementById("update-password");a.style.display="none",s.style.display="none",n.innerHTML="",r.innerHTML="";var u=!0;return e.length>0&&e.length<8?(Le(n,!1),a.textContent="Password must be at least 8 characters",a.style.display="block",u=!1):e.length>=8&&Le(n,!0),e&&t&&e!==t?(Le(r,!1),s.textContent="Passwords do not match",s.style.display="block",u=!1):t&&e===t&&Le(r,!0),o.disabled=!u,u}function Le(e,t){e.innerHTML="";var n=document.createElement("img");n.src=t?".../images/yes.png":".../images/no.png",n.alt=t?"Valid":"Invalid",e.appendChild(n)}function _e(){return Me.apply(this,arguments)}function Me(){return(Me=(0,o.A)(i().mark(function e(){var t,n,r,a,s,o,u,c,d,l;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(Be()){e.next=1;break}return e.abrupt("return");case 1:return t=document.getElementById("new-password").value,n=document.getElementById("update-password"),r=document.getElementById("update-password-error"),e.prev=2,n.disabled=!0,n.textContent="Updating...",e.next=3,supabase.auth.getSession();case 3:if(a=e.sent,s=a.data.session,!a.error&&s){e.next=4;break}throw new Error("Your password reset link has expired. Please request a new one.");case 4:return e.next=5,supabase.auth.updateUser({password:t});case 5:if(o=e.sent,!(u=o.error)){e.next=6;break}throw u;case 6:n.textContent="✓ Password Updated",sessionStorage.removeItem("resetEmail"),p()(function(){be(),document.getElementById("new-password").value="",document.getElementById("confirm-password").value="",alert("Password updated successfully! Please log in with your new password.")},1500),e.next=8;break;case 7:e.prev=7,l=e.catch(2),r.textContent=q()(c=l.message).call(c,"expired")||q()(d=l.message).call(d,"Auth session missing")?"Your password reset link has expired. Please request a new one.":"Error: ".concat(l.message),r.style.display="block",n.textContent="UPDATE PASSWORD",n.disabled=!1;case 8:case"end":return e.stop()}},e,null,[[2,7]])}))).apply(this,arguments)}function Ae(){document.getElementById("new-password").addEventListener("input",function(){clearTimeout(we),we=p()(Be,300)}),document.getElementById("confirm-password").addEventListener("input",function(){clearTimeout(we),we=p()(Be,300)})}function Se(){return qe.apply(this,arguments)}function qe(){return(qe=(0,o.A)(i().mark(function e(){var t,n,r,a,s,o,u,c,l,p;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d()(t=document.getElementById("login-email").value).call(t),r=document.getElementById("login-password").value,document.getElementById("login-error"),Oe(),n&&r){e.next=1;break}return Te("Please enter both email/manifesto and password"),e.abrupt("return");case 1:if(e.prev=1,a=n,q()(n).call(n,"@")){e.next=4;break}return e.next=2,supabase.from("profiles").select("email").eq("manifesto",n).single();case 2:if(s=e.sent,o=s.data,!s.error&&o){e.next=3;break}return Te("Manifesto not found. Please check your manifesto or use your email instead."),e.abrupt("return");case 3:a=o.email;case 4:return e.next=5,supabase.auth.signInWithPassword({email:a,password:r});case 5:if(u=e.sent,u.data,!(c=u.error)){e.next=6;break}q()(l=c.message).call(l,"Invalid login credentials")?Te("Invalid credentials. Please check your password."):q()(p=c.message).call(p,"Email not confirmed")?Te("Please verify your email address first."):Te("Login failed: "+c.message),e.next=7;break;case 6:return Oe(),ge(),e.next=7,J();case 7:e.next=9;break;case 8:e.prev=8,e.catch(1),Te("An error occurred during login. Please try again.");case 9:case"end":return e.stop()}},e,null,[[1,8]])}))).apply(this,arguments)}function Te(e){var t=document.getElementById("login-error");t&&(t.textContent=e,t.style.display="block",t.style.opacity="0",p()(function(){t.style.opacity="1"},10))}function Oe(){var e=document.getElementById("login-error");e&&(e.style.display="none",e.textContent="")}function Ue(){var e=document.getElementById("login-email"),t=document.getElementById("login-password");e&&(e.addEventListener("blur",function(){var e,t=function(e){if(!d()(e).call(e))return{valid:!1,message:"Please enter your email or manifesto"};if(q()(e).call(e,"@")&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return{valid:!1,message:"Please enter a valid email address"};return{valid:!0}}(this.value);!t.valid&&d()(e=this.value).call(e)&&Te(t.message)}),e.addEventListener("input",function(){Oe()})),t&&t.addEventListener("input",function(){Oe()})}function De(){return(De=(0,o.A)(i().mark(function e(){var t,n;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.signOut();case 1:if(t=e.sent,!(n=t.error)){e.next=2;break}throw n;case 2:return e.next=3,J();case 3:e.next=5;break;case 4:e.prev=4,e.catch(0);case 5:case"end":return e.stop()}},e,null,[[0,4]])}))).apply(this,arguments)}document.addEventListener("DOMContentLoaded",(0,o.A)(i().mark(function e(){var t,n,r,a,s,o;return i().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,J();case 1:if(t=window.location.hash,!q()(t).call(t,"access_token")&&!q()(t).call(t,"refresh_token")){e.next=6;break}return e.prev=2,e.next=3,supabase.auth.getSession();case 3:n=e.sent,r=n.data,n.error||r.session&&(a=new(A())(window.location.search),s="password_update"===a.get("type"),o=a.get("email"),s&&o&&Ce(decodeURIComponent(o))),e.next=5;break;case 4:e.prev=4,e.catch(2);case 5:window.history.replaceState({},"",window.location.pathname);case 6:ke(),Ae();case 7:case"end":return e.stop()}},e,null,[[2,4]])}))),document.addEventListener("DOMContentLoaded",function(){Ue()}),document.addEventListener("click",function(e){var t=document.querySelector(".user-menu"),n=document.getElementById("user-dropdown");t&&!t.contains(e.target)&&n&&(n.style.display="none")}),document.addEventListener("DOMContentLoaded",function(){document.addEventListener("keydown",function(e){if("Enter"===e.code||"Enter"===e.key){var t=document.getElementById("auth-modal"),n=document.getElementById("login-form"),r=t&&"block"===t.style.display,a=n&&"none"!==n.style.display,s=document.activeElement,o=s&&("login-email"===s.id||"login-password"===s.id);r&&a&&o&&(e.preventDefault(),Se())}});var e=document.getElementById("auth-modal"),t=document.querySelector(".auth-modal-container");function n(){var e=document.getElementById("auth-modal");e&&(e.style.display="none"),ye(),document.documentElement.classList.remove("lock")}e&&t&&(e.addEventListener("click",function(t){t.target===e&&n()}),t.addEventListener("click",function(e){e.stopPropagation()})),document.addEventListener("click",function(t){var n,r,a=t.target.closest("#login-trigger"),s=t.target.closest(".header__nav--mobile span");if(a||s&&q()(n=s.textContent).call(n,"LOGIN"))return t.preventDefault(),e&&(e.style.display="block",document.documentElement.classList.add("lock")),void closeMobileMenu();if(t.target.closest(".user-menu-trigger"))return t.preventDefault(),void("none"===(r=document.getElementById("user-dropdown")).style.display||""===r.style.display?r.style.display="block":r.style.display="none");if(t.target.closest(".logout-btn"))return t.preventDefault(),function(){De.apply(this,arguments)}(),void closeMobileMenu();if(t.target.closest(".header__nav--mobile .profile"))closeMobileMenu();else if(t.target.closest(".header__mob-toggle")){var o=document.getElementById("mobileNav");o&&(o.style.display="block"===o.style.display?"none":"block")}});var r=document.getElementById("login-button");r&&r.addEventListener("click",Se);var a=document.querySelector(".auth-form-toggle.signup");a&&a.addEventListener("click",ve);var s=document.getElementById("signup-button");s&&s.addEventListener("click",de);var o=document.querySelector("#signup-form .auth-form-toggle");o&&o.addEventListener("click",be);var u=document.querySelector(".forgot-password-link");u&&u.addEventListener("click",he);var i=document.getElementById("reset-link");i&&i.addEventListener("click",Ee);var c=document.querySelector("#password-reset-form .auth-form-toggle");c&&c.addEventListener("click",be);var d=document.getElementById("update-password");d&&d.addEventListener("click",_e);var l=document.getElementById("resend-button");l&&l.addEventListener("click",me);var p=document.getElementById("verify-button");p&&p.addEventListener("click",n);var m=document.getElementById("manifesto");m&&m.addEventListener("input",ee);var f=document.getElementById("signup-email");f&&f.addEventListener("input",ae);var g=document.getElementById("signup-password");g&&g.addEventListener("input",ie)}),"undefined"!=typeof window&&(window.displayUserProfile=W,window.generateBarcode=R,window.barcodeGenerator=X)},38399:(e,t,n)=>{var r,a,s,o,u,i,c,d,l,p=n(50697),m=n.n(p),f=n(26100),g=n.n(f),y=n(96319),h=n.n(y),b=n(78928),v=n.n(b),w=n(36751),x=n.n(w),k=n(25110),E=n.n(k),I=n(53930),C=n.n(I),B=n(18979),L=n.n(B),_=n(49763),M=n.n(_),A=n(16781),S=n.n(A),q=n(39841),T=n.n(q),O=n(66615),U=n.n(O),D=n(49859),P=n(34963),z=n(73363),F=n.n(z),H=n(57119),N=n.n(H),R=n(86226),j=n.n(R),G=n(165),Y=n.n(G),Q=n(29550),V=n.n(Q),X=n(11393),W=n.n(X),$=n(56255),K=n.n($),J=n(94870),Z=n.n(J),ee=n(44828),te=n.n(ee);function ne(e,t){var n=void 0!==S()&&T()(e)||e["@@iterator"];if(!n){if(U()(e)||(n=function(e,t){if(e){var n;if("string"==typeof e)return re(e,t);var r=L()(n={}.toString.call(e)).call(n,8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?M()(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?re(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,s=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw s}}}}function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ae(e,t){var n=m()(e);if(g()){var r=g()(e);t&&(r=h()(r).call(r,function(t){return v()(e,t).enumerable})),n.push.apply(n,r)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?j()(n=ae(Object(a),!0)).call(n,function(t){(0,D.A)(e,t,a[t])}):x()?E()(e,x()(a)):j()(r=ae(Object(a))).call(r,function(t){C()(e,t,v()(a,t))})}return e}window.CartManager||(window.TSHIRT_PRICING={blank:{white:69,black:69,colored:69},"single-sided":{white:79,black:89,colored:89},"double-sided":{white:89,black:99,colored:99}},window.CartManager=(0,D.A)((0,D.A)((0,D.A)((0,D.A)((0,D.A)((0,D.A)((0,D.A)((0,D.A)((0,D.A)((0,D.A)({initialized:!1,getCart:function(e){return(0,P.A)(te().mark(function t(){var n,r;return te().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=1,supabase.from("cart_items").select("*").eq("user_id",e);case 1:if(n=t.sent,r=n.data,!n.error){t.next=2;break}return t.abrupt("return",[]);case 2:return t.abrupt("return",r||[]);case 3:return t.prev=3,t.catch(0),t.abrupt("return",[]);case 4:case"end":return t.stop()}},t,null,[[0,3]])}))()},generateMergeKey:function(e,t,n){return"blank-tshirt"===e?"blank-tshirt-".concat(t):n?"custom-design":"tshirt"},addOrUpdateCartItem:function(e){var t=this;return(0,P.A)(te().mark(function n(){var r,a,s,o,u,i,c,d,l,p,m,f,g,y,h,b,v,w,x,k,E,I,C,B;return te().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=e.draftId,a=e.itemData,s=e.sizes,o=e.userId,n.prev=1,i=null,!r){n.next=3;break}return n.next=2,supabase.from("cart_items").select("*").eq("user_id",o).eq("draft_id",r);case 2:c=n.sent,d=c.data,!c.error&&d&&d.length>0&&(i=d[0]);case 3:if(l=a.unitPrice||29.99,p=F()(u=N()(s)).call(u,function(e,t){return e+t},0),!i){n.next=11;break}if(0!==p){n.next=7;break}return n.next=4,supabase.from("cart_items").delete().eq("id",i.id).eq("user_id",o);case 4:if(m=n.sent,!(f=m.error)){n.next=5;break}return n.abrupt("return",{success:!1,error:f.message});case 5:return n.next=6,t.updateCartBadge();case 6:return n.abrupt("return",{success:!0,action:"removed",itemId:i.id});case 7:return g=l*p,n.next=8,supabase.from("cart_items").update({sizes:s,quantity:p,total_price:g,price:l,updated_at:(new Date).toISOString()}).eq("id",i.id).eq("user_id",o).select().single();case 8:if((y=n.sent).data,!(h=y.error)){n.next=9;break}return n.abrupt("return",{success:!1,error:h.message});case 9:return n.next=10,t.updateCartBadge();case 10:return t.showCartAddedEffect(),n.abrupt("return",{success:!0,action:"updated",itemId:i.id,totalQuantity:p});case 11:if(0!==p){n.next=12;break}return n.abrupt("return",{success:!1,error:"Please select at least one size"});case 12:return v={user_id:o,sizes:s,quantity:p,price:l,total_price:b=l*p,type:a.type,draft_id:r,added_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},n.next=13,supabase.from("cart_items").insert([v]).select().single();case 13:if(w=n.sent,x=w.data,!(k=w.error)){n.next=18;break}if("23505"!==k.code){n.next=17;break}return n.next=14,supabase.from("cart_items").update({sizes:s,quantity:p,total_price:b,price:l,updated_at:(new Date).toISOString()}).eq("user_id",o).eq("draft_id",r).select().single();case 14:if(E=n.sent,I=E.data,!(C=E.error)){n.next=15;break}return n.abrupt("return",{success:!1,error:C.message});case 15:return n.next=16,t.updateCartBadge();case 16:return t.showCartAddedEffect(),n.abrupt("return",{success:!0,action:"updated",itemId:I.id,totalQuantity:p});case 17:return n.abrupt("return",{success:!1,error:k.message});case 18:return n.next=19,t.updateCartBadge();case 19:return t.showCartAddedEffect(),n.abrupt("return",{success:!0,action:"added",itemId:x.id,totalQuantity:p});case 20:n.next=22;break;case 21:return n.prev=21,B=n.catch(1),n.abrupt("return",{success:!1,error:B.message});case 22:case"end":return n.stop()}},n,null,[[1,21]])}))()},syncDraftFromCart:function(e,t){return(0,P.A)(te().mark(function n(){var r,a,s,o,u;return te().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=1,supabase.from("cart_items").select("*").eq("id",e).single();case 1:if(r=n.sent,a=r.data,!r.error&&a){n.next=2;break}return n.abrupt("return",!1);case 2:if(!a.draft_id){n.next=7;break}return n.next=3,supabase.from("drafts").select("*").eq("id",a.draft_id).single();case 3:if(s=n.sent,o=s.data,!s.error&&o){n.next=4;break}return n.abrupt("return",!1);case 4:return u=se(se({},o.data),{},{sizeQuantities:t}),n.next=5,supabase.from("drafts").update({data:u,sizes:t,updated_at:(new Date).toISOString()}).eq("id",a.draft_id);case 5:if(!n.sent.error){n.next=6;break}return n.abrupt("return",!1);case 6:case 7:return n.abrupt("return",!0);case 8:return n.prev=8,n.catch(0),n.abrupt("return",!1);case 9:case"end":return n.stop()}},n,null,[[0,8]])}))()},updateCartItemQuantity:function(e,t){var n=this;return(0,P.A)(te().mark(function r(){var a,s,o,u,i,c,d;return te().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=1,supabase.auth.getUser();case 1:if(s=r.sent,o=s.data.user){r.next=2;break}return r.abrupt("return",!1);case 2:if(u=0,j()(a=N()(t)).call(a,function(e){u+=e}),0!==u){r.next=4;break}return r.next=3,n.syncDraftFromCart(e,{});case 3:return r.abrupt("return",n.removeFromCart(e));case 4:return r.next=5,supabase.from("cart_items").select("price").eq("id",e).single();case 5:return i=r.sent,c=i.data,d=((null==c?void 0:c.price)||29.99)*u,r.next=6,supabase.from("cart_items").update({quantity:u,sizes:t,total_price:d,updated_at:(new Date).toISOString()}).eq("id",e).eq("user_id",o.id);case 6:if(!r.sent.error){r.next=7;break}return r.abrupt("return",!1);case 7:return r.next=8,n.syncDraftFromCart(e,t);case 8:return r.next=9,n.updateCartBadge();case 9:return r.abrupt("return",!0);case 10:return r.prev=10,r.catch(0),r.abrupt("return",!1);case 11:case"end":return r.stop()}},r,null,[[0,10]])}))()},addToCart:function(e,t){var n=this;return(0,P.A)(te().mark(function r(){var a,s,o,u,i,c,d,l;return te().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=1,supabase.auth.getUser();case 1:if(s=r.sent,o=s.data.user){r.next=2;break}return alert("请先登录"),r.abrupt("return",!1);case 2:if("string"!=typeof e||!Y()(e).call(e,"blank-")){r.next=4;break}return u=e.replace("blank-",""),r.next=3,n.addOrMergeItem({draftId:null,itemData:{type:"blank-tshirt",color:u,title:"空白T恤 (".concat(u,")")},sizes:t,userId:o.id});case 3:return i=r.sent,r.abrupt("return",!!i.success&&i);case 4:return r.next=5,supabase.from("drafts").select("*").eq("id",e).single();case 5:if(c=r.sent,d=c.data,!c.error&&d){r.next=6;break}return alert("无法获取产品信息"),r.abrupt("return",!1);case 6:return r.next=7,n.addOrMergeItem({draftId:e,itemData:{type:"custom-design",color:(null===(a=d.data)||void 0===a?void 0:a.color)||"white",title:d.title||"自定义T恤设计"},sizes:t||d.sizes||{default:1},userId:o.id});case 7:return l=r.sent,r.abrupt("return",!!l.success&&l);case 8:return r.prev=8,r.catch(0),alert("操作失败，请重试"),r.abrupt("return",!1);case 9:case"end":return r.stop()}},r,null,[[0,8]])}))()},getCartItems:function(){return(0,P.A)(te().mark(function e(){var t,n,r,a,s,o,u,i,c,d,l,p,m,f,g;return te().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:if(t=e.sent,n=t.data.user){e.next=2;break}return e.abrupt("return",[]);case 2:return e.next=3,supabase.from("cart_items").select("*").eq("user_id",n.id).order("added_at",{ascending:!1});case 3:if(r=e.sent,a=r.data,!r.error){e.next=4;break}return e.abrupt("return",[]);case 4:s=[],o=ne(a),e.prev=5,o.s();case 6:if((u=o.n()).done){e.next=11;break}if(c=u.value,d=se({},c),!c.draft_id){e.next=8;break}return e.next=7,supabase.from("drafts").select("*").eq("id",c.draft_id).single();case 7:l=e.sent,(p=l.data)&&(d.draft=p,d.title=p.title||"自定义T恤设计",d.previewImage=p.front_preview_image,d.color=(null===(m=p.data)||void 0===m?void 0:m.color)||"white"),e.next=9;break;case 8:c.type&&Y()(i=c.type).call(i,"blank-tshirt-")&&(f=c.type.replace("blank-tshirt-",""),d.title="空白T恤 (".concat(f,")"),d.color=f,d.previewImage=null,d.isBlankTshirt=!0);case 9:s.push(d);case 10:e.next=6;break;case 11:e.next=13;break;case 12:e.prev=12,g=e.catch(5),o.e(g);case 13:return e.prev=13,o.f(),e.finish(13);case 14:return e.abrupt("return",s);case 15:return e.prev=15,e.catch(0),e.abrupt("return",[]);case 16:case"end":return e.stop()}},e,null,[[0,15],[5,12,13,14]])}))()},getCartCount:function(){return(0,P.A)(te().mark(function e(){var t,n,r,a;return te().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:if(t=e.sent,n=t.data.user){e.next=2;break}return e.abrupt("return",0);case 2:return e.next=3,supabase.from("cart_items").select("quantity").eq("user_id",n.id);case 3:if(r=e.sent,a=r.data,!r.error&&a){e.next=4;break}return e.abrupt("return",0);case 4:return e.abrupt("return",F()(a).call(a,function(e,t){return e+(t.quantity||0)},0));case 5:return e.prev=5,e.catch(0),e.abrupt("return",0);case 6:case"end":return e.stop()}},e,null,[[0,5]])}))()}},"updateCartItemQuantity",function(e,t){var n=this;return(0,P.A)(te().mark(function r(){var a,s,o,u,i,c,d;return te().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=1,supabase.auth.getUser();case 1:if(s=r.sent,o=s.data.user){r.next=2;break}return r.abrupt("return",!1);case 2:if(u=0,j()(a=N()(t)).call(a,function(e){u+=e}),0!==u){r.next=3;break}return r.abrupt("return",n.removeFromCart(e));case 3:return r.next=4,supabase.from("cart_items").select("price").eq("id",e).single();case 4:return i=r.sent,c=i.data,d=((null==c?void 0:c.price)||29.99)*u,r.next=5,supabase.from("cart_items").update({quantity:u,sizes:t,total_price:d,updated_at:(new Date).toISOString()}).eq("id",e).eq("user_id",o.id);case 5:if(!r.sent.error){r.next=6;break}return r.abrupt("return",!1);case 6:return r.next=7,n.updateCartBadge();case 7:return r.abrupt("return",!0);case 8:return r.prev=8,r.catch(0),r.abrupt("return",!1);case 9:case"end":return r.stop()}},r,null,[[0,8]])}))()}),"removeFromCart",function(e){var t=this;return(0,P.A)(te().mark(function n(){var r,a;return te().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=1,supabase.auth.getUser();case 1:if(r=n.sent,a=r.data.user){n.next=2;break}return n.abrupt("return",!1);case 2:if(confirm("确定要从购物车中移除这个商品吗？")){n.next=3;break}return n.abrupt("return",!1);case 3:return n.next=4,supabase.from("cart_items").delete().eq("id",e).eq("user_id",a.id);case 4:if(!n.sent.error){n.next=5;break}return n.abrupt("return",!1);case 5:return n.next=6,t.updateCartBadge();case 6:return n.abrupt("return",!0);case 7:return n.prev=7,n.catch(0),n.abrupt("return",!1);case 8:case"end":return n.stop()}},n,null,[[0,7]])}))()}),"clearCart",function(){var e=this;return(0,P.A)(te().mark(function t(){var n,r;return te().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=1,supabase.auth.getUser();case 1:if(n=t.sent,r=n.data.user){t.next=2;break}return t.abrupt("return",!1);case 2:if(confirm("确定要清空购物车吗？")){t.next=3;break}return t.abrupt("return",!1);case 3:return t.next=4,supabase.from("cart_items").delete().eq("user_id",r.id);case 4:if(!t.sent.error){t.next=5;break}return t.abrupt("return",!1);case 5:return t.next=6,e.updateCartBadge();case 6:return t.abrupt("return",!0);case 7:return t.prev=7,t.catch(0),t.abrupt("return",!1);case 8:case"end":return t.stop()}},t,null,[[0,7]])}))()}),"getCartTotal",function(){return(0,P.A)(te().mark(function e(){var t,n,r,a;return te().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:if(t=e.sent,n=t.data.user){e.next=2;break}return e.abrupt("return",0);case 2:return e.next=3,supabase.from("cart_items").select("total_price").eq("user_id",n.id);case 3:if(r=e.sent,a=r.data,!r.error&&a){e.next=4;break}return e.abrupt("return",0);case 4:return e.abrupt("return",F()(a).call(a,function(e,t){return e+(t.total_price||0)},0));case 5:return e.prev=5,e.catch(0),e.abrupt("return",0);case 6:case"end":return e.stop()}},e,null,[[0,5]])}))()}),"checkout",function(){var e=this;return(0,P.A)(te().mark(function t(){var n,r,a,s,o,u,i,c;return te().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=1,supabase.auth.getUser();case 1:if(r=t.sent,a=r.data.user){t.next=2;break}return alert("请先登录"),t.abrupt("return",null);case 2:return t.next=3,e.getCartItems();case 3:if(0!==(s=t.sent).length){t.next=4;break}return alert("购物车是空的"),t.abrupt("return",null);case 4:return t.next=5,e.getCartTotal();case 5:return o=t.sent,u="ORD-"+V()()+"-"+Math.random().toString(36).substr(2,9).toUpperCase(),t.next=6,supabase.from("orders").insert([{user_id:a.id,order_number:u,items:s,total_amount:o,status:"pending"}]).select().single();case 6:if(i=t.sent,c=i.data,!i.error){t.next=7;break}return alert("创建订单失败"),t.abrupt("return",null);case 7:return t.next=8,supabase.from("cart_items").delete().eq("user_id",a.id);case 8:return t.next=9,e.updateCartBadge();case 9:return alert(W()(n="订单创建成功！\n订单号: ".concat(u,"\n总金额: ¥")).call(n,o.toFixed(2))),t.abrupt("return",c);case 10:return t.prev=10,t.catch(0),alert("结账失败，请重试"),t.abrupt("return",null);case 11:case"end":return t.stop()}},t,null,[[0,10]])}))()}),"initCartIcon",function(){var e=this;return(0,P.A)(te().mark(function t(){return te().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.initialized){t.next=1;break}return t.abrupt("return");case 1:return t.prev=2,t.next=3,supabase.auth.getUser();case 3:if(t.sent.data.user){t.next=4;break}return e.hideCartIcon(),e.initialized=!0,t.abrupt("return");case 4:return t.next=5,e.updateCartBadge();case 5:e.initialized=!0,supabase.auth.onAuthStateChange(function(){var t=(0,P.A)(te().mark(function t(n,r){return te().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=2;break}return t.next=1,e.updateCartBadge();case 1:t.next=3;break;case 2:e.hideCartIcon();case 3:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}()),t.next=7;break;case 6:t.prev=6,t.catch(2),e.hideCartIcon(),e.initialized=!0;case 7:case"end":return t.stop()}},t,null,[[2,6]])}))()}),"updateCartBadge",function(){var e=this;return(0,P.A)(te().mark(function t(){var n,r,a,s;return te().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=1,e.getCartCount();case 1:n=t.sent,r=document.getElementById("cartIcon"),a=document.getElementById("cartBadge"),s=document.getElementById("cartBadgeMobile"),a&&(a.textContent=n,a.classList.add("updated"),K()(function(){a.classList.remove("updated")},200)),r&&(n>0?e.showCartIcon():e.hideCartIcon()),s&&(s.textContent=n,s.classList.add("updated"),K()(function(){return s.classList.remove("updated")},200)),t.next=3;break;case 2:t.prev=2,t.catch(0),e.hideCartIcon();case 3:case"end":return t.stop()}},t,null,[[0,2]])}))()}),"showCartIcon",function(){var e=document.getElementById("cartIcon");window.innerWidth<=768?e&&(e.style.display="none"):e&&(e.style.display="block",e.classList.add("show"),e.classList.add("bounce"),K()(function(){e.classList.remove("bounce")},300))}),"hideCartIcon",function(){var e=document.getElementById("cartIcon");window.innerWidth<=899?e&&(e.style.display="none"):e&&(e.style.display="none",e.classList.remove("show"))}),"showCartAddedEffect",function(){var e=document.createElement("div");e.className="cart-notification",e.textContent="Added to cart!",e.style.cssText="\n            position: fixed;\n            top: 0px;\n            right: 0px;\n            background: black;\n            color: white;\n            z-index: 9999;\n            font-size: 20px;\n            animation: slideIn 0.3s ease-out;\n            ",document.body.appendChild(e),K()(function(){e.style.animation="slideOut 0.3s ease",K()(function(){document.body.contains(e)&&document.body.removeChild(e)},300)},2e3)}),window.addToCart=Z()(r=CartManager.addToCart).call(r,CartManager),window.getCartItems=Z()(a=CartManager.getCartItems).call(a,CartManager),window.getCartCount=Z()(s=CartManager.getCartCount).call(s,CartManager),window.updateCartItemQuantity=Z()(o=CartManager.updateCartItemQuantity).call(o,CartManager),window.removeFromCart=Z()(u=CartManager.removeFromCart).call(u,CartManager),window.clearCart=Z()(i=CartManager.clearCart).call(i,CartManager),window.getCartTotal=Z()(c=CartManager.getCartTotal).call(c,CartManager),window.checkout=Z()(d=CartManager.checkout).call(d,CartManager),window.updateCartBadge=Z()(l=CartManager.updateCartBadge).call(l,CartManager)),document.addEventListener("DOMContentLoaded",function(){K()((0,P.A)(te().mark(function e(){return te().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.CartManager||"function"!=typeof window.CartManager.initCartIcon){e.next=2;break}return e.next=1,window.CartManager.initCartIcon();case 1:e.next=3;break;case 2:case 3:case"end":return e.stop()}},e)})),500)}),"loading"!==document.readyState&&K()((0,P.A)(te().mark(function e(){return te().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.CartManager||"function"!=typeof window.CartManager.initCartIcon){e.next=1;break}return e.next=1,window.CartManager.initCartIcon();case 1:case"end":return e.stop()}},e)})),100)}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var s=n[e]={exports:{}};return t[e].call(s.exports,s,s.exports,r),s.exports}r.m=t,e=[],r.O=(t,n,a,s)=>{if(!n){var o=1/0;for(d=0;d<e.length;d++){for(var[n,a,s]=e[d],u=!0,i=0;i<n.length;i++)(!1&s||o>=s)&&Object.keys(r.O).every(e=>r.O[e](n[i]))?n.splice(i--,1):(u=!1,s<o&&(o=s));if(u){e.splice(d--,1);var c=a();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,a,s]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.j=682,(()=>{var e={682:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var a,s,[o,u,i]=n,c=0;if(o.some(t=>0!==e[t])){for(a in u)r.o(u,a)&&(r.m[a]=u[a]);if(i)var d=i(r)}for(t&&t(n);c<o.length;c++)s=o[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(d)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),r.O(void 0,[96,869],()=>r(96443)),r.O(void 0,[96,869],()=>r(30001)),r.O(void 0,[96,869],()=>r(15230));var a=r.O(void 0,[96,869],()=>r(38399));a=r.O(a)})();