"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[798],{59798:(e,t,a)=>{var r=a(50697),n=a.n(r),i=a(26100),s=a.n(i),o=a(96319),l=a.n(o),c=a(78928),d=a.n(c),u=a(36751),p=a.n(u),f=a(25110),v=a.n(f),g=a(53930),b=a.n(g),m=a(27842),x=a(49859),w=a(34963),y=a(44828),h=a.n(y),k=a(56255),P=a.n(k),A=a(86226),L=a.n(A),I=a(36586),_=a.n(I),T=a(48079),U=a.n(T),D=a(11393),S=a.n(D),z=a(8628),q=a.n(z),E=a(66615),C=a.n(E),N=a(59261),F=a.n(N);function j(e,t){var a=n()(e);if(s()){var r=s()(e);t&&(r=l()(r).call(r,function(t){return d()(e,t).enumerable})),a.push.apply(a,r)}return a}function R(e){for(var t=1;t<arguments.length;t++){var a,r,n=null!=arguments[t]?arguments[t]:{};t%2?L()(a=j(Object(n),!0)).call(a,function(t){(0,x.A)(e,t,n[t])}):p()?v()(e,p()(n)):L()(r=j(Object(n))).call(r,function(t){b()(e,t,d()(n,t))})}return e}var M=!1,O=!1;document.querySelectorAll(".menu-item"),document.querySelectorAll(".content-section");function B(e){if(e.target.classList.contains("menu-item")){var t,a,r=e.target.getAttribute("data-target");if(!r)return;L()(t=document.querySelectorAll(".menu-item")).call(t,function(e){return e.classList.remove("active")}),e.target.classList.add("active"),L()(a=document.querySelectorAll(".content-section")).call(a,function(e){return e.classList.remove("active")});var n=document.getElementById(r);return n&&n.classList.add("active"),void("draft"===r&&H())}if(e.target.classList.contains("load-draft-btn")){e.preventDefault(),e.stopPropagation();var i=e.target.getAttribute("data-draft-id");i&&function(e){K.apply(this,arguments)}(i)}else if(e.target.classList.contains("delete-draft-btn")){e.preventDefault(),e.stopPropagation();var s=e.target.getAttribute("data-draft-id");s&&!O&&function(e){Q.apply(this,arguments)}(s)}else if(e.target.classList.contains("edit-draft")){e.preventDefault(),e.stopPropagation();var o=e.target.getAttribute("data-draft-id");o&&function(e){Z.apply(this,arguments)}(o)}else if(e.target.classList.contains("add-to-cart-tshirt")){e.preventDefault(),e.stopPropagation();var l=e.target.getAttribute("data-draft-id");if(l){var c=document.querySelectorAll("#draftPreviewModal .quantity-input"),d={},u=!1;if(L()(c).call(c,function(e){var t=e.getAttribute("data-size"),a=_()(e.value)||0;a>0&&(d[t]=a,u=!0)}),!u)return void alert("Please select at least one size");!function(e,t){G.apply(this,arguments)}(l,d)}}else if(e.target.classList.contains("add-in-gallery")){e.preventDefault(),e.stopPropagation();var p=e.target.getAttribute("data-draft-id");p&&function(e){$.apply(this,arguments)}(p)}else e.target.classList.contains("modal-overlay")&&"draftPreviewModal"===e.target.id&&J()}function G(){return(G=(0,w.A)(h().mark(function e(t,a){var r,n,i,s,o,l,c,d,u,p,f,v,g,b;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.from("drafts").select("*").eq("id",t).single();case 1:if(r=e.sent,n=r.data,!r.error&&n){e.next=2;break}return alert("Unable to add to cart"),e.abrupt("return");case 2:return i=29.99,n.data&&(s=n.data,o=s.color||"white",l=s.backImages&&s.backImages.length>0,c=l?"double-sided":"single-sided",window.TSHIRT_PRICING&&window.TSHIRT_PRICING[c]&&(i="white"===o?window.TSHIRT_PRICING[c].white:"black"===o?window.TSHIRT_PRICING[c].black:window.TSHIRT_PRICING[c].colored)),e.next=3,supabase.auth.getUser();case 3:if(d=e.sent,u=d.data.user){e.next=4;break}return alert("Please login first"),e.abrupt("return");case 4:return p=R(R({},n.data),{},{sizeQuantities:a}),e.next=5,supabase.from("drafts").update({data:p,sizes:a,updated_at:(new Date).toISOString()}).eq("id",t);case 5:if(f=e.sent,f.error,!window.CartManager||!window.CartManager.addOrUpdateCartItem){e.next=7;break}return e.next=6,window.CartManager.addOrUpdateCartItem({draftId:t,itemData:{type:"custom-design",designType:"custom",color:(null===(v=n.data)||void 0===v?void 0:v.color)||"white",title:n.title||"Custom T-shirt Design",unitPrice:i},sizes:a,userId:u.id});case 6:(g=e.sent).success?(J(),b="added"===g.action?"Successfully added to cart!":"Cart updated! Quantity: ".concat(g.totalQuantity),alert(b),confirm("View cart now?")&&("function"==typeof loadPage?loadPage("cart"):window.location.href="/cart")):alert("Failed to update cart: "+(g.error||"Unknown error"));case 7:e.next=9;break;case 8:e.prev=8,e.catch(0),alert("Operation failed, please try again.");case 9:case"end":return e.stop()}},e,null,[[0,8]])}))).apply(this,arguments)}function H(){return X.apply(this,arguments)}function X(){return(X=(0,w.A)(h().mark(function e(){var t,a,r,n;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:if(t=e.sent,a=t.data.user){e.next=2;break}return e.abrupt("return");case 2:return e.next=3,supabase.from("drafts").select("*").eq("user_id",a.id).order("created_at",{ascending:!1});case 3:if(r=e.sent,n=r.data,!r.error){e.next=4;break}return e.abrupt("return");case 4:V(n),e.next=6;break;case 5:e.prev=5,e.catch(0);case 6:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}function V(e){var t=document.getElementById("draft");if(t){var a=U()(e).call(e,function(e){var t,a,r,n,i,s="";return("svg"===e.type||"tshirt"===e.type)&&(s=e.front_preview_image),S()(t=S()(a=S()(r=S()(n=S()(i='\n        <div class="draft-item" data-id="'.concat(e.id,'">\n            <div style="display: flex; align-items: center; gap: 10px;">\n                <img src="')).call(i,s,'" alt="预览" \n                     style="width: 80px; height: 80px; object-fit: cover;  border: 2px solid black; ">\n                <div style="flex: 1;">\n                    <p>')).call(n,"svg"===e.type?"DOODLE":"T-SHIRT","</p>\n                    <p>CREATED: ")).call(r,new Date(e.created_at).toLocaleString(),'</p>\n                </div>\n                <div>\n                    <button class="load-draft-btn" data-draft-id="')).call(a,e.id,'" style="margin-right: 10px; border: 2px solid black; background:white; width:100px;font-size: 15px">LOAD</button>\n                    <button class="delete-draft-btn" data-draft-id="')).call(t,e.id,'" style="color: black;border: 2px solid black; background:white; width:100px; font-size: 15px">DELETE</button>\n                </div>\n            </div>\n        </div>\n        ')}).join("");t.innerHTML=a}}function Q(){return(Q=(0,w.A)(h().mark(function e(t){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!O){e.next=1;break}return e.abrupt("return");case 1:O=!0,P()((0,w.A)(h().mark(function e(){var a,r,n,i,s,o,l,c,d,u,p,f,v,g;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(confirm("确定要删除这个草稿吗？")){e.next=1;break}return O=!1,e.abrupt("return");case 1:return e.prev=1,e.next=2,supabase.from("drafts").select("*").eq("id",t).single();case 2:if(a=e.sent,r=a.data,!a.error){e.next=3;break}return alert("删除失败"),O=!1,e.abrupt("return");case 3:if(n=[],i=function(e){if(!e||"string"!=typeof e)return null;var t=e.match(/\/storage\/v1\/object\/public\/design-files\/(.+)/);return t?t[1]:null},"svg"===r.type?(r.data&&(r.data.storageUrl&&(s=i(r.data.storageUrl))&&n.push(s),r.data.fileName&&(q()(n).call(n,r.data.fileName)||n.push(r.data.fileName))),r.front_preview_image&&(o=i(r.front_preview_image))&&!q()(n).call(n,o)&&n.push(o)):"tshirt"===r.type&&((l=r.data)&&(l.frontImages&&C()(l.frontImages)&&L()(c=l.frontImages).call(c,function(e,t){if(e.storageFile)if(e.storageFile.fileName)n.push(e.storageFile.fileName);else if(e.storageFile.publicUrl){var a=i(e.storageFile.publicUrl);a&&!q()(n).call(n,a)&&n.push(a)}}),l.backImages&&C()(l.backImages)&&L()(d=l.backImages).call(d,function(e,t){if(e.storageFile)if(e.storageFile.fileName)n.push(e.storageFile.fileName);else if(e.storageFile.publicUrl){var a=i(e.storageFile.publicUrl);a&&!q()(n).call(n,a)&&n.push(a)}}),l.frontPreviewFile&&l.frontPreviewFile.fileName&&n.push(l.frontPreviewFile.fileName),l.backPreviewFile&&l.backPreviewFile.fileName&&n.push(l.backPreviewFile.fileName)),r.front_preview_image&&(u=i(r.front_preview_image))&&!q()(n).call(n,u)&&n.push(u),r.back_preview_image&&(p=i(r.back_preview_image))&&!q()(n).call(n,p)&&n.push(p)),!((f=(0,m.A)(new(F())(n))).length>0)){e.next=5;break}return e.next=4,supabase.storage.from("design-files").remove(f);case 4:v=e.sent,v.data,v.error;case 5:return e.next=6,supabase.from("drafts").delete().eq("id",t);case 6:if(g=e.sent,!g.error){e.next=7;break}alert("删除失败"),e.next=8;break;case 7:return alert("草稿已删除"),e.next=8,H();case 8:e.next=10;break;case 9:e.prev=9,e.catch(1),alert("删除失败");case 10:return e.prev=10,P()(function(){O=!1},500),e.finish(10);case 11:case"end":return e.stop()}},e,null,[[1,9,10,11]])})),0);case 2:case"end":return e.stop()}},e)}))).apply(this,arguments)}function K(){return(K=(0,w.A)(h().mark(function e(t){var a,r;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.from("drafts").select("*").eq("id",t).single();case 1:if(a=e.sent,r=a.data,!a.error){e.next=2;break}return e.abrupt("return");case 2:"svg"===r.type?W(r):"tshirt"===r.type&&Y(r),e.next=4;break;case 3:e.prev=3,e.catch(0);case 4:case"end":return e.stop()}},e,null,[[0,3]])}))).apply(this,arguments)}function W(e){var t,a,r=S()(t=S()(a='\n        <div id="draftPreviewModal" class="modal-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000;  display: flex; justify-content: center; align-items: center;">\n            <div class="modal-content" style="background: white; padding: 25px; max-width: 70vh; max-height: 80vh; overflow-y: auto; border: 2px solid black;">\n                <div class="preview-container" style="display: flex; gap: 30px; justify-content: center; margin-bottom: 20px;">\n                    <div class="preview-item" style="text-align: center;">\n                        <span style="font-size: 18px; margin-bottom: 10px; display: block;">PREVIEW</span>\n                        <div class="preview-tshirt" style="width: 200px; height: 250px; background-image: url(\''.concat(e.front_preview_image,'\'); background-size: contain; background-repeat: no-repeat; background-position: center; margin: 0 auto; outline: none; box-shadow: none;border: 2px solid black;"></div>\n                    </div>\n                </div>\n              \n                <div class="modal-buttons" style="display: flex; gap: 20px; justify-content: space-between;">\n                    <button class="edit-draft" data-draft-id="')).call(a,e.id,'" style="width: 200px; font-size: 16px; border: 2px solid black; background: white; cursor: pointer; min-width: 150px;">BACK TO EDIT</button>\n                    <button class="add-in-gallery" data-draft-id="')).call(t,e.id,'" style="width: 200px; font-size: 16px; border: 2px solid black; background: white; cursor: pointer; min-width: 150px;">ADD TO GALLERY</button>\n                </div>\n            </div>\n        </div>\n    ');document.body.insertAdjacentHTML("beforeend",r)}function Y(e){var t,a,r,n,i,s,o=(null===(t=e.data)||void 0===t?void 0:t.sizeQuantities)||e.sizes||{XS:0,S:0,M:0,L:0,XL:0,"2XL":0,"3XL":0},l=S()(a=S()(r=S()(n=S()(i='\n    <div id="draftPreviewModal" class="modal-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10000; display: flex; justify-content: center; align-items: center;">\n    <div class="modal-content" style="background: white; padding: 25px; max-width: 70vh; max-height: 80vh; overflow-y: auto; border: 2px solid black; position: relative;">\n        <div class="preview-container" style="display: flex; gap: 30px; justify-content: center; margin-bottom: 20px;">\n            <div class="preview-item" style="text-align: center;">\n                <span style="font-size: 18px; margin-bottom: 10px; display: block;">FRONT</span>\n                <div style="border: 2px black solid;">\n                    <div class="preview-tshirt" style="width: 200px; height: 250px; background-image: url(\''.concat(e.front_preview_image,'\'); background-size: contain; background-repeat: no-repeat; background-position: center; margin: 0 auto;"></div>\n                </div>\n            </div>\n            <div class="preview-item" style="text-align: center;">\n                <span style="font-size: 18px; margin-bottom: 10px; display: block;">BACK</span>\n                <div style="border: 2px black solid;">\n                    <div class="preview-tshirt" style="width: 200px; height: 250px; background-image: url(\'')).call(i,e.back_preview_image,'\'); background-size: contain; background-repeat: no-repeat; background-position: center; margin: 0 auto;"></div>\n                </div>\n            </div>\n        </div>\n        \n        <div class="size-selection-horizontal" style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-bottom: 20px;">\n            ')).call(n,U()(s=["XS","S","M","L","XL","2XL","3XL"]).call(s,function(e){var t,a;return S()(t=S()(a='\n                <div class="size-option">\n                    <label>'.concat(e,'</label>\n                    <div class="quantity-control" style="display: flex; align-items: center; overflow: hidden;">\n                        <input type="number" class="quantity-input" data-size="')).call(a,e,'" value="')).call(t,o[e]||0,'" min="0" max="99" style="width: 45px; height: 30px; text-align: center; border: 2px solid black;">\n                    </div>\n                </div>\n            ')}).join(""),'\n        </div>\n        \n        <div class="modal-buttons" style="display: flex; gap: 20px; justify-content: space-between;">\n            <button class="edit-draft" data-draft-id="')).call(r,e.id,'" style="width: 200px; font-size: 16px; border: 2px solid black; background: white; cursor: pointer; min-width: 150px;">BACK TO EDIT</button>\n            <button class="add-to-cart-tshirt" data-draft-id="')).call(a,e.id,'" style="width: 200px; font-size: 16px; border: 2px solid black; background: white; cursor: pointer; min-width: 150px;">UPDATE CART</button>\n        </div>\n    </div>\n</div>\n    ');document.body.insertAdjacentHTML("beforeend",l)}function J(){var e=document.getElementById("draftPreviewModal");e&&e.remove()}function Z(){return(Z=(0,w.A)(h().mark(function e(t){var a,r;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.from("drafts").select("*").eq("id",t).single();case 1:if(a=e.sent,r=a.data,!a.error&&r){e.next=2;break}return alert("无法加载草稿"),e.abrupt("return");case 2:"svg"===r.type?window.location.href="/home?loadSvgDraft=".concat(t):"tshirt"===r.type&&(window.location.href="/home?loadTshirtDraft=".concat(t)),e.next=4;break;case 3:e.prev=3,e.catch(0),alert("加载失败，请重试");case 4:case"end":return e.stop()}},e,null,[[0,3]])}))).apply(this,arguments)}function $(){return($=(0,w.A)(h().mark(function e(t){var a,r,n,i,s,o,l,c,d,u,p,f,v;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.auth.getUser();case 1:if(i=e.sent,s=i.data.user){e.next=2;break}return alert("请先登录"),e.abrupt("return");case 2:return e.next=3,supabase.from("drafts").select("*").eq("id",t).single();case 3:if(o=e.sent,l=o.data,!o.error&&l){e.next=4;break}return alert("无法获取草稿信息"),e.abrupt("return");case 4:if("svg"===l.type){e.next=5;break}return alert("只能将SVG草稿添加到Gallery"),e.abrupt("return");case 5:return e.next=6,supabase.from("gallery").select("id").eq("draft_id",t).maybeSingle();case 6:if(c=e.sent,!c.data){e.next=7;break}return alert("This artwork is already in the gallery!"),e.abrupt("return");case 7:return d=prompt("Give your artwork a title:","My Doodle")||"Untitled",u=prompt("Add a description (optional):","")||"",p={user_id:s.id,draft_id:t,title:d,description:u,preview_image:l.front_preview_image,svg_url:(null===(a=l.data)||void 0===a?void 0:a.storageUrl)||null,svg_data:(null===(r=l.data)||void 0===r?void 0:r.svgContent)||(null===(n=l.data)||void 0===n?void 0:n.svgData)||null},e.next=8,supabase.from("gallery").insert([p]).select().single();case 8:if(f=e.sent,f.data,!(v=f.error)){e.next=9;break}return alert("添加失败："+v.message),e.abrupt("return");case 9:if(!confirm("Successfully added to gallery! Do you want to delete this draft?")){e.next=11;break}return e.next=10,ee(t);case 10:e.next=13;break;case 11:if(J(),!confirm("View in gallery now?")){e.next=12;break}"function"==typeof loadPage?loadPage("gallery"):window.location.href="/gallery",e.next=13;break;case 12:return e.next=13,H();case 13:e.next=15;break;case 14:e.prev=14,e.catch(0),alert("添加失败，请重试");case 15:case"end":return e.stop()}},e,null,[[0,14]])}))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=(0,w.A)(h().mark(function e(t){var a,r,n,i,s,o,l,c,d,u;return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,supabase.from("drafts").select("*").eq("id",t).single();case 1:if(a=e.sent,r=a.data,!a.error){e.next=2;break}return e.abrupt("return");case 2:if(n=[],i=function(e){if(!e||"string"!=typeof e)return null;var t=e.match(/\/storage\/v1\/object\/public\/design-files\/(.+)/);return t?t[1]:null},"svg"===r.type&&(null!==(s=r.data)&&void 0!==s&&s.storageUrl&&(l=i(r.data.storageUrl))&&n.push(l),null!==(o=r.data)&&void 0!==o&&o.fileName&&n.push(r.data.fileName)),!((c=(0,m.A)(new(F())(n))).length>0)){e.next=4;break}return e.next=3,supabase.storage.from("design-files").remove(c);case 3:d=e.sent,d.error;case 4:return e.next=5,supabase.from("drafts").delete().eq("id",t);case 5:if(u=e.sent,!u.error){e.next=6;break}alert("草稿删除失败"),e.next=8;break;case 6:if(J(),!confirm("Draft deleted. View in gallery now?")){e.next=7;break}"function"==typeof loadPage?loadPage("gallery"):window.location.href="/gallery",e.next=8;break;case 7:return e.next=8,H();case 8:e.next=10;break;case 9:e.prev=9,e.catch(0);case 10:case"end":return e.stop()}},e,null,[[0,9]])}))).apply(this,arguments)}document.addEventListener("DOMContentLoaded",function(){P()((0,w.A)(h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof window.displayUserProfile){e.next=2;break}return e.next=1,window.displayUserProfile();case 1:e.next=3;break;case 2:P()((0,w.A)(h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof window.displayUserProfile){e.next=1;break}return e.next=1,window.displayUserProfile();case 1:case"end":return e.stop()}},e)})),1e3);case 3:case"end":return e.stop()}},e)})),200),function(){if(M)return;M=!0,document.addEventListener("click",B),document.addEventListener("keydown",function(e){"Escape"===e.key&&J()})}()}),"undefined"!=typeof window&&"undefined"!=typeof displayUserProfile&&(window.displayUserProfile=displayUserProfile),window.reloadProfileBarcode=(0,w.A)(h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=1,displayUserProfile();case 1:e.next=3;break;case 2:e.prev=2,e.catch(0);case 3:case"end":return e.stop()}},e,null,[[0,2]])})),window.addEventListener("profilePageLoaded",(0,w.A)(h().mark(function e(){return h().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof displayUserProfile){e.next=1;break}return e.next=1,displayUserProfile();case 1:case"end":return e.stop()}},e)}))),function e(){try{if("undefined"!=typeof supabase&&document.getElementById("draft")){var t,a=document.querySelector('.menu-item[data-target="draft"]');if(a&&!a.classList.contains("active"))L()(t=document.querySelectorAll(".menu-item")).call(t,function(e){return e.classList.remove("active")}),a.classList.add("active");var r,n=document.getElementById("draft");if(n&&!n.classList.contains("active"))L()(r=document.querySelectorAll(".content-section")).call(r,function(e){return e.classList.remove("active")}),n.classList.add("active");H()}else P()(e,200)}catch(t){P()(e,200)}}()}}]);