"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[33],{71033:(n,e,t)=>{var a=t(49763),r=t.n(a),i=t(16781),o=t.n(i),s=t(39841),d=t.n(s),c=t(66615),l=t.n(c),p=t(26100),u=t.n(p),m=t(96319),g=t.n(m),y=t(78928),f=t.n(y),b=t(36751),h=t.n(b),v=t(25110),w=t.n(v),x=t(53930),k=t.n(x),I=t(49859),S=t(5773),E=t(34963),P=t(44828),A=t.n(P),T=t(56255),C=t.n(T),D=t(14607),O=t.n(D),N=t(36586),R=t.n(N),_=t(61240),H=t.n(_),q=t(50697),F=t.n(q),L=t(86226),z=t.n(L),M=t(38573),B=t.n(M),U=t(11393),G=t.n(U),Y=(t(43981),t(29550)),K=t.n(Y),V=t(8628),W=t.n(V),j=t(18979),Q=t.n(j),Z=(t(73363),t(57119),t(48079)),J=t.n(Z),$=t(71426),X=t.n($),nn=t(385),en=t.n(nn);function tn(n,e){var t=F()(n);if(u()){var a=u()(n);e&&(a=g()(a).call(a,function(e){return f()(n,e).enumerable})),t.push.apply(t,a)}return t}function an(n){for(var e=1;e<arguments.length;e++){var t,a,r=null!=arguments[e]?arguments[e]:{};e%2?z()(t=tn(Object(r),!0)).call(t,function(e){(0,I.A)(n,e,r[e])}):h()?w()(n,h()(r)):z()(a=tn(Object(r))).call(a,function(e){k()(n,e,f()(r,e))})}return n}function rn(n,e){var t=void 0!==o()&&d()(n)||n["@@iterator"];if(!t){if(l()(n)||(t=function(n,e){if(n){var t;if("string"==typeof n)return on(n,e);var a=Q()(t={}.toString.call(n)).call(t,8,-1);return"Object"===a&&n.constructor&&(a=n.constructor.name),"Map"===a||"Set"===a?r()(n):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?on(n,e):void 0}}(n))||e&&n&&"number"==typeof n.length){t&&(n=t);var a=0,i=function(){};return{s:i,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(n){throw n},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,c=!0,p=!1;return{s:function(){t=t.call(n)},n:function(){var n=t.next();return c=n.done,n},e:function(n){p=!0,s=n},f:function(){try{c||null==t.return||t.return()}finally{if(p)throw s}}}}function on(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,a=Array(e);t<e;t++)a[t]=n[t];return a}function sn(){return dn.apply(this,arguments)}function dn(){return(dn=(0,E.A)(A().mark(function n(){return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return Vn(),cn(),n.next=1,gn();case 1:case"end":return n.stop()}},n)}))).apply(this,arguments)}function cn(){document.addEventListener("click",ln)}function ln(n){var e=n.target;if(e.classList.contains("back-button")||e.closest(".back-button")){n.preventDefault();var t=e.closest(".back-button");if(t){var a=t.getAttribute("data-action");if("back-to-cart"===a)!function(){zn.apply(this,arguments)}();else if("back-to-shipping"===a)Pn();else if("back-to-review"===a)return void jn()}}else if(e.classList.contains("quantity-btn")){n.preventDefault();var r=e.getAttribute("data-cart-id"),i=e.getAttribute("data-size"),o=R()(e.getAttribute("data-change"));r&&i&&o&&hn(r,i,o)}else if(e.classList.contains("cart-item-remove")){n.preventDefault();var s=e.getAttribute("data-cart-id");s&&wn(s)}else{if(e.classList.contains("proceed-checkout-btn")||"proceedCheckoutBtn"===e.id)return n.preventDefault(),void Sn();if("confirmPaymentBtn"===e.id||e.classList.contains("confirm-payment-btn"))return n.preventDefault(),void Qn();if(e.classList.contains("cart-btn"))switch(n.preventDefault(),e.getAttribute("data-action")){case"go-home":case"continue-shopping":In();break;case"complete-purchase":completePurchase()}else;}}function pn(){return un.apply(this,arguments)}function un(){return(un=(0,E.A)(A().mark(function n(){var e,t,a,r,i,o,s,d,c,l,p,u,m,g,y,f,b,h,v,w,x,k,I,E,P,T,C,D;return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=1,supabase.auth.getUser();case 1:if(r=n.sent,i=r.data.user){n.next=2;break}return n.abrupt("return");case 2:return n.next=3,supabase.from("cart_items").select("*, drafts(*)").eq("user_id",i.id);case 3:if(o=n.sent,(s=o.data)&&0!==s.length){n.next=4;break}return(d=document.getElementById("cartSummary"))&&(d.style.display="none"),n.abrupt("return");case 4:(c=document.getElementById("cartSummary"))&&(c.style.display="block"),l=0,p={},u=rn(s);try{for(u.s();!(m=u.n()).done;)y=m.value,f=y.price||29.99,b=y.quantity||0,l+=f*b,h="",h=y.type&&W()(g=y.type).call(g,"blank-tshirt")?"BLANK T-SHIRT":y.draft_id&&y.drafts?"CUSTOMIZED T-SHIRT":"T-SHIRT",p[h]||(p[h]=0),p[h]+=b}catch(n){u.e(n)}finally{u.f()}for(v="",w=0,x=B()(p);w<x.length;w++)I=(0,S.A)(x[w],2),E=I[0],P=I[1],v+=G()(k='\n                <div class="summary-item-line">\n                    <span>'.concat(P,'x</span>\n                    <span style="font-weight: bold;">')).call(k,E,"</span>\n                </div>\n            ");T=null!==document.getElementById("checkoutForm"),C=G()(e=G()(t=G()(a='\n            <h3>ORDER SUMMARY</h3>\n            <br>\n            <div class="summary-items" style="border-bottom: black 2px solid; padding: 10px 0; margin-bottom: 15px;">\n                '.concat(v,'\n            </div>\n            <div id="summaryDetails">\n                <div class="summary-row">\n                    <span>Subtotal:</span>\n                    <span id="subtotalAmount">Â¥')).call(a,l.toFixed(2),"</span>\n                </div>\n                ")).call(t,T?"":'\n                    <div id="addressPrompt" class="summary-row">\n                        <span style="color: black; font-style:italic;">Please enter a valid address to calculate total</span>\n                    </div>\n                ','\n            </div>\n            <div class="cart-actions" id="checkoutButtonContainer">\n                ')).call(e,T?'<button class="cart-btn primary" id="validateAndProceedBtn" style="background: black; color: white; padding: 5px; border: 2px solid black; cursor: pointer; width: 100%; text-transform: uppercase;">PROCEED TO CHECKOUT</button>':'<button class="cart-btn primary proceed-checkout-btn" id="proceedCheckoutBtn">PROCEED TO CHECKOUT</button>',"\n            </div>\n        "),(D=document.getElementById("cartSummary"))&&(D.innerHTML=C),window.currentSubtotal=l,T&&mn(),n.next=6;break;case 5:n.prev=5,n.catch(0);case 6:case"end":return n.stop()}},n,null,[[0,5]])}))).apply(this,arguments)}function mn(){var n=document.getElementById("validateAndProceedBtn");n&&n.addEventListener("click",function(n){n.preventDefault();var e=document.getElementById("checkoutForm");e&&(e.checkValidity()?e.dispatchEvent(new Event("submit",{cancelable:!0})):e.reportValidity())})}function gn(){return yn.apply(this,arguments)}function yn(){return(yn=(0,E.A)(A().mark(function n(){var e,t,a,r,i,o,s,d,c,l,p,u,m,g,y,f,b,h,v,w,x,k,I,S,E,P,T,C,D,O,N,R,_,H,q,F,L,z,M,B,U,Y,K,V;return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=1,supabase.auth.getUser();case 1:if(e=n.sent,t=e.data.user){n.next=2;break}return document.getElementById("cartContent").innerHTML='\n            <div class="cart-empty">\n                <h2>Please login first</h2>\n                <button class="cart-btn" data-action="go-home">GO TO LOGIN</button>\n            </div>\n        ',(a=document.getElementById("cartSummary"))&&(a.style.display="none"),n.abrupt("return");case 2:return n.next=3,supabase.from("cart_items").select("\n            *,\n            drafts (\n                id,\n                type,\n                data,\n                front_preview_image,\n                back_preview_image,\n                sizes\n            )\n        ").eq("user_id",t.id).order("added_at",{ascending:!1});case 3:if(r=n.sent,i=r.data,!(o=r.error)){n.next=4;break}throw o;case 4:if(s=document.getElementById("cartContent"),i&&0!==i.length){n.next=5;break}return s.innerHTML='\n            <div class="cart-empty">\n                <h2>Your cart is empty</h2>\n                <p>Add some awesome designs to your cart!</p>\n                <button class="cart-btn" data-action="continue-shopping">CONTINUE SHOPPING</button>\n            </div>\n        ',(d=document.getElementById("cartSummary"))&&(d.style.display="none"),n.abrupt("return");case 5:c='<div class="cart-items">',l=rn(i),n.prev=6,l.s();case 7:if((p=l.n()).done){n.next=13;break}if(E=p.value,P="",T="",C="",D=0,O="white",N="./images/default-tshirt.png",R="./images/default-tshirt.png",E.type&&(W()(_=E.type).call(_,"blank-tshirt")?(C="BLANK T-SHIRT",P="blank",O=E.type.replace("blank-tshirt-","")||"white"):W()(H=E.type).call(H,"single-sided")?(C="CUSTOMIZED T-SHIRT",P="single-sided",O=E.type.replace("single-sided-","")||"white"):W()(q=E.type).call(q,"double-sided")?(C="CUSTOMIZED T-SHIRT",P="double-sided",O=E.type.replace("double-sided-","")||"white"):"custom-design"===E.type&&(C="CUSTOMIZED T-SHIRT",P="custom")),E.draft_id&&E.drafts&&((F=E.drafts).data&&F.data.color&&(O=F.data.color),F.front_preview_image&&(N=F.front_preview_image),F.back_preview_image&&(R=F.back_preview_image),!P&&F.data&&(L=F.data.frontImages&&F.data.frontImages.length>0,z=F.data.backImages&&F.data.backImages.length>0,L||z?L&&z?(C="CUSTOMIZED T-SHIRT",P="double-sided"):(C="CUSTOMIZED T-SHIRT",P="single-sided"):(C="BLANK T-SHIRT",P="blank"))),P||(C="BLANK T-SHIRT",P="blank"),"blank"!==P){n.next=11;break}if(N&&"./images/default-tshirt.png"!==N){n.next=9;break}return n.next=8,fn(O,"front");case 8:N=n.sent;case 9:if(R&&"./images/default-tshirt.png"!==R){n.next=11;break}return n.next=10,fn(O,"back");case 10:R=n.sent;case 11:T="white"===O?"white":"colored",window.TSHIRT_PRICING&&window.TSHIRT_PRICING[P]&&(D=window.TSHIRT_PRICING[P][O]||window.TSHIRT_PRICING[P][T]),D||(D=E.price||29.99),M=E.quantity||0,B=D*M,U="",U="blank"===P?"Blank Design":"double-sided"===P?"Double-Sided Design":"Single-Sided Design",Y="white"===O?"White T-Shirt":"".concat(O.charAt(0).toUpperCase()+Q()(O).call(O,1)," T-Shirt"),c+=G()(u=G()(m=G()(g=G()(y=G()(f=G()(b=G()(h=G()(v=G()(w=G()(x=G()(k=G()(I=G()(S='\n            <div class="cart-item" data-cart-id="'.concat(E.id,'">\n                \x3c!-- Dual Preview Section --\x3e\n                <div class="cart-item-previews">\n                    <div class="preview-container">\n                        <div class="preview-image">\n                            <img src="')).call(S,N,'" alt="')).call(I,C,' - Front" onerror="this.src=\'./images/default-tshirt.png\'">\n                        </div>\n                    </div>\n                    <div class="preview-container">\n                        <div class="preview-image">\n                            <img src="')).call(k,R,'" alt="')).call(x,C,' - Back" onerror="this.src=\'./images/default-tshirt.png\'">\n                        </div>\n                    </div>\n                </div>\n                \n                \x3c!-- Item Details --\x3e\n                <div class="cart-item-details">\n                    <div class="cart-item-title">')).call(w,C,'</div>\n                    <div class="cart-item-type">\n                        <div>\n                            <span class="type-badge">')).call(v,U,'</span>\n                            <span class="color-indicator">\n                                <span class="color-dot" style="background-color: ')).call(h,"white"===O?"#ffffff":O,'; "></span>\n                                ')).call(b,Y,'\n                            </span>\n                        </div>\n                    </div>\n                    \n                    \x3c!-- Size Controls --\x3e\n                    <div class="cart-item-sizes">\n                        ')).call(f,bn(E.id,E.sizes),'\n                    </div>\n                    \n                    \x3c!-- Pricing Information --\x3e\n                    <div class="cart-item-pricing">\n                        <div class="price-row">\n                            <span>Unit Price:</span>\n                            <span>Â¥')).call(y,D.toFixed(2),'</span>\n                        </div>\n                        <div class="price-row">\n                            <span>Quantity:</span>\n                            <span>')).call(g,M,'</span>\n                        </div>\n                        <div class="price-row total">\n                            <span>Subtotal:</span>\n                            <span>Â¥')).call(m,B.toFixed(2),'</span>\n                        </div>\n                    </div>\n                    \n                    <button class="cart-item-remove" data-cart-id="')).call(u,E.id,'">Remove</button>\n                </div>\n            </div>\n        ');case 12:n.next=7;break;case 13:n.next=15;break;case 14:n.prev=14,V=n.catch(6),l.e(V);case 15:return n.prev=15,l.f(),n.finish(15);case 16:return c+="</div>",s.innerHTML=c,n.next=17,pn();case 17:n.next=19;break;case 18:n.prev=18,n.catch(0),document.getElementById("cartContent").innerHTML='\n        <div class="cart-empty">\n            <h2>Error loading cart</h2>\n            <p>Please refresh the page and try again.</p>\n        </div>\n    ',(K=document.getElementById("cartSummary"))&&(K.style.display="none");case 19:case"end":return n.stop()}},n,null,[[0,18],[6,14,15,16]])}))).apply(this,arguments)}window.SHIPPING_CONFIG={CN:{name:"China (Mainland)",carrier:"ZTO Express (ä¸­éå¿«é)",shipping:0,tax:0,currency:"CNY",estimatedDays:"2-5",trackingPrefix:"ZTO"},HK:{name:"Hong Kong",carrier:"SF Express International (é¡ºä¸°å½é)",shipping:25,tax:0,currency:"USD",estimatedDays:"3-7",trackingPrefix:"SF"},TW:{name:"Taiwan",carrier:"SF Express International (é¡ºä¸°å½é)",shipping:30,tax:5,currency:"USD",estimatedDays:"5-10",trackingPrefix:"SF"},JP:{name:"Japan",carrier:"SF Express International (é¡ºä¸°å½é)",shipping:45,tax:10,currency:"USD",estimatedDays:"7-14",trackingPrefix:"SF"},UK:{name:"United Kingdom",carrier:"SF Express International (é¡ºä¸°å½é)",shipping:65,tax:20,currency:"USD",estimatedDays:"10-15",trackingPrefix:"SF"},US:{name:"United States",carrier:"SF Express International (é¡ºä¸°å½é)",shipping:60,tax:8,currency:"USD",estimatedDays:"10-15",trackingPrefix:"SF"},OTHER:{name:"Other Countries",carrier:"SF Express International (é¡ºä¸°å½é)",shipping:75,tax:15,currency:"USD",estimatedDays:"15-30",trackingPrefix:"SF"}},void 0===window.PAYMENT_QR_CODES&&(window.PAYMENT_QR_CODES={alipay:"/images/alipay-qr.png",wechat:"/images/wechat-qr.png",paypal:"/images/paypal-qr.png"}),C()(function(){if("undefined"!=typeof supabase)sn();else var n=O()(function(){"undefined"!=typeof supabase&&(clearInterval(n),sn())},100)},100);function fn(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"white",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"front";return new(H())(function(t){var a,r=document.createElement("canvas"),i=r.getContext("2d");r.width=100,r.height=125,i.fillStyle="#ffffff",i.fillRect(0,0,r.width,r.height);var o=new Image;o.crossOrigin="anonymous",o.width=100,o.height=125,o.onload=function(){var n=Math.min(r.width/this.naturalWidth,r.height/this.naturalHeight),e=this.naturalWidth*n,a=this.naturalHeight*n,o=(r.width-e)/2,s=(r.height-a)/2;i.drawImage(this,o,s,e,a);var d=r.toDataURL("image/jpeg",.9);t(d)},o.onerror=function(){i.fillStyle="black"===n?"#333333":"#f0f0f0",i.fillRect(0,0,r.width,r.height);var e=r.toDataURL("image/jpeg",.9);t(e)};var s={front:{white:"./images/white-front.png",black:"./images/black-front.png"},back:{white:"./images/white-back.png",black:"./images/black-back.png"}};o.src=(null===(a=s[e])||void 0===a?void 0:a[n])||s.front.white})}function bn(n,e){var t;if(!e||0===F()(e).length)return"<p>No sizes selected</p>";var a="";return z()(t=B()(e)).call(t,function(e){var t,r,i,o,s,d=(0,S.A)(e,2),c=d[0],l=d[1];a+=G()(t=G()(r=G()(i=G()(o=G()(s='\n        <div class="size-quantity-group">\n            <span class="size-label">'.concat(c,':</span>\n            <div class="quantity-controls">\n                <button class="quantity-btn quantity-btn-left" \n                        data-cart-id="')).call(s,n,'" \n                        data-size="')).call(o,c,'" \n                        data-change="-1">-</button>\n                <input type="text" class="quantity-value" value="')).call(i,l,'" readonly>\n                <button class="quantity-btn quantity-btn-right" data-cart-id="')).call(r,n,'" \n                        data-size="')).call(t,c,'" \n                        data-change="1")">+</button>\n            </div>\n        </div>\n    ')}),a}function hn(n,e,t){return vn.apply(this,arguments)}function vn(){return(vn=(0,E.A)(A().mark(function n(e,t,a){var r,i,o;return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=1,supabase.from("cart_items").select("sizes").eq("id",e).single();case 1:if(r=n.sent,i=r.data){n.next=2;break}return n.abrupt("return");case 2:return(o=an({},i.sizes))[t]=Math.max(0,(o[t]||0)+a),0===o[t]&&delete o[t],n.next=3,updateCartItemQuantity(e,o);case 3:if(!n.sent){n.next=4;break}return n.next=4,gn();case 4:n.next=6;break;case 5:n.prev=5,n.catch(0);case 6:case"end":return n.stop()}},n,null,[[0,5]])}))).apply(this,arguments)}function wn(n){return xn.apply(this,arguments)}function xn(){return(xn=(0,E.A)(A().mark(function n(e){return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=1,removeFromCart(e);case 1:if(!n.sent){n.next=2;break}return n.next=2,gn();case 2:case"end":return n.stop()}},n)}))).apply(this,arguments)}function kn(){return(kn=(0,E.A)(A().mark(function n(){return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=1,clearCart();case 1:if(!n.sent){n.next=2;break}return n.next=2,gn();case 2:case"end":return n.stop()}},n)}))).apply(this,arguments)}function In(){"function"==typeof loadPage?loadPage("home"):window.location.href="/home"}function Sn(){return En.apply(this,arguments)}function En(){return(En=(0,E.A)(A().mark(function n(){var e,t,a,r,i;return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=1,supabase.auth.getUser();case 1:if(e=n.sent,t=e.data.user){n.next=2;break}return alert("Please login to continue"),n.abrupt("return");case 2:return n.next=3,supabase.from("cart_items").select("*").eq("user_id",t.id);case 3:if(a=n.sent,(r=a.data)&&0!==r.length){n.next=4;break}return alert("Your cart is empty"),n.abrupt("return");case 4:i=0,z()(r).call(r,function(n){var e=n.price||29.99,t=n.quantity||0;i+=e*t}),window.currentSubtotal=i,Pn(),n.next=6;break;case 5:n.prev=5,n.catch(0),alert("Error proceeding to checkout");case 6:case"end":return n.stop()}},n,null,[[0,5]])}))).apply(this,arguments)}function Pn(){return An.apply(this,arguments)}function An(){return(An=(0,E.A)(A().mark(function n(){var e,t,a,r,i,o,s,d,c;return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e=document.querySelector(".cart-header"),t=document.getElementById("cartContent"),e&&(e.innerHTML='\n            <h1>SHIPPING INFORMATION</h1>\n            <button class="back-button" data-action="back-to-cart" style="\n                padding: 5px;\n                border: 2px solid black;\n                background: white;\n                cursor: pointer;\n                font-size: 14px;\n            ">â BACK TO CART</button>\n        '),a=[],n.prev=1,n.next=2,supabase.auth.getUser();case 2:if(r=n.sent,!(i=r.data.user)){n.next=4;break}return n.next=3,supabase.from("profiles").select("shipping_addresses").eq("user_id",i.id).single();case 3:o=n.sent,s=o.data,a=(null==s?void 0:s.shipping_addresses)||[];case 4:n.next=6;break;case 5:n.prev=5,n.catch(1);case 6:window.currentSavedAddresses=a,d="",d=a.length>0?'\n        <div class="address-selection" style="margin-bottom: 30px;">\n        <h3 style="margin-bottom: 15px;">SELECT SHIPPING ADDRESS</h3>\n        <div class="saved-addresses">\n            '.concat(J()(a).call(a,function(n,e){var t,a,r,i,o,s,d,c,l,p,u,m,g,y;return G()(t=G()(a=G()(r=G()(i=G()(o=G()(s=G()(d=G()(c=G()(l=G()(p=G()(u=G()(m=G()(g=G()(y='\n                <div class="address-option '.concat(n.isDefault?"default-address":"",'" data-address-index="')).call(y,e,'" style="\n                    border: 2px solid #ccc;\n                    padding: 15px;\n                    margin-bottom: 10px;\n                    cursor: pointer;\n                    transition: all 0.3s;\n                    position: relative;\n                    ')).call(g,n.isDefault?" background-color: #f8f8f8;":"",'\n                ">\n                    <label style="cursor: pointer; display: block; width: 100%;">\n                        <input type="radio" name="selectedAddress" value="')).call(m,e,'" \n                               ')).call(u,n.isDefault?"checked":"",' \n                               style="margin-right: 10px;">\n                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 80px);">\n                            <div style="display: flex; align-items: center; margin-bottom: 8px;">\n                                <strong style="font-size: 16px;">')).call(p,n.fullName,"</strong>\n                                ")).call(l,n.isDefault?'<span style="background: black; color: white; padding: 2px 8px; font-size: 12px; margin-left: 15px;">DEFAULT</span>':"",'\n                            </div>\n                            <div style="color: #555; font-size: 14px; line-height: 1.4;">\n                                ')).call(c,n.phone,"<br>\n                                ")).call(d,n.address1," ")).call(s,n.address2||"","<br>\n                                ")).call(o,n.city,", ")).call(i,n.state," ")).call(r,n.zipCode,"<br>\n                                ")).call(a,n.country,'\n                            </div>\n                        </div>\n                    </label>\n                    <button class="delete-address-btn" data-address-index="')).call(t,e,'" style="\n                        position: absolute;\n                        bottom: 15px;\n                        right: 15px;\n\n                    padding:0 5px;\n                        border: 2px black solid;\n                        padding: 5px 8px;\n                        font-size: 12px;\n                        cursor: pointer;\n                    background:white;\n                     \n                    " title="Delete Address">DELETE</button>\n                </div>\n            ')}).join(""),'\n        </div>\n                <div style="text-align: center; margin: 20px 0;">\n                    <button id="useNewAddress" style="\n                        background: white;\n                        color: black;\n                        border: 2px solid black;\n                        padding: 8px 20px;\n                        cursor: pointer;\n                        font-size: 14px;\n                    ">+ ADD NEW ADDRESS</button>\n                </div>\n            </div>\n        '):'\n            <div class="address-selection" style="margin-bottom: 30px;">\n                <h3 style="margin-bottom: 15px;">NO SAVED ADDRESSES</h3>\n                <p style="color: #666; margin-bottom: 20px;">Please add a new shipping address</p>\n                <button id="useNewAddress" style="\n                    background: black;\n                    color: white;\n                    border: none;\n                    padding: 8px 20px;\n                    cursor: pointer;\n                    font-size: 14px;\n                ">+ ADD NEW ADDRESS</button>\n            </div>\n        ',c='\n        <style>\n            .checkout-form-container {\n                background: white;\n                padding: 0;\n            }\n            \n            .address-option:hover {\n                border-color: black !important;\n               \n            }\n            \n            .address-option:has(input[type="radio"]:checked) {\n                border-color: black !important;\n              \n            }\n\n            .checkout-form {\n                max-width: 100%;\n                display: none;\n            }\n            \n            .form-group {\n                margin-bottom: 20px;\n            }\n            \n            .form-group label {\n                display: block;\n                margin-bottom: 8px;\n                font-weight: bold;\n                font-size: 14px;\n            }\n            \n            .form-group input,\n            .form-group select {\n                width: 100%;\n                padding: 10px;\n                border: 2px solid black;\n                font-size: 14px;\n                background: white;\n            }\n            \n            .form-group input:focus,\n            .form-group select:focus {\n                outline: none;\n                border-color: #555;\n            }\n            \n            .form-group input[type="checkbox"] {\n                width: auto;\n                margin-right: 8px;\n                vertical-align: middle;\n                transform: scale(1.1);\n            }\n\n .checkbox-label {\n            display: flex !important;\n            align-items: center;\n            margin-bottom: 0 !important;\n            font-weight: normal !important;\n        }\n        \n\n            .form-row {\n                display: flex;\n                gap: 20px;\n            }\n            \n            .form-row .form-group {\n                flex: 1;\n            }\n            \n            .required-asterisk {\n                color: red;\n            }\n        </style>\n        \n        <div class="checkout-form-container">\n            '.concat(d,'\n            \n            <form id="checkoutForm" class="checkout-form">\n                <h3 style="margin-bottom: 20px;">ADD NEW SHIPPING ADDRESS</h3>\n                \n                <div class="form-group">\n                    <label>Full Name <span class="required-asterisk">*</span></label>\n                    <input type="text" id="fullName" name="fullName" required placeholder="Enter your full name">\n                </div>\n                \n                <div class="form-group">\n                    <label>Email Address </label>\n                    <input type="email" id="email" name="email" required placeholder="your@email.com">\n                </div>\n                \n                <div class="form-group">\n                    <label>Phone Number <span class="required-asterisk">*</span></label>\n                    <input type="tel" id="phone" name="phone" required placeholder="+86">\n                </div>\n                \n                <h4 style="margin-top: 30px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid black;">DELIVERY ADDRESS</h4>\n                \n                <div class="form-group">\n                    <label>Address Line 1 <span class="required-asterisk">*</span></label>\n                    <input type="text" id="address1" name="address1" required placeholder="Street address, P.O. box">\n                </div>\n                \n                <div class="form-group">\n                    <label>Address Line 2</label>\n                    <input type="text" id="address2" name="address2" placeholder="Apartment, suite, unit, building, floor, etc.">\n                </div>\n                \n                <div class="form-row">\n                    <div class="form-group">\n                        <label>City <span class="required-asterisk">*</span></label>\n                        <input type="text" id="city" name="city" required placeholder="City">\n                    </div>\n                    <div class="form-group">\n                        <label>State/Province <span class="required-asterisk">*</span></label>\n                        <input type="text" id="state" name="state" required placeholder="State or Province">\n                    </div>\n                </div>\n                \n                <div class="form-row">\n                    <div class="form-group">\n                        <label>ZIP/Postal Code <span class="required-asterisk">*</span></label>\n                        <input type="text" id="zipCode" name="zipCode" required placeholder="12345">\n                    </div>\n                    <div class="form-group">\n                        <label>Country <span class="required-asterisk">*</span></label>\n                        <select id="country" name="country" required>\n                            <option value="">Select Country</option>\n                            <option value="CN">ä¸­å½</option>\n                            <option value="HK">Hong Kong</option>\n                            <option value="TW">èºç£</option>\n                            <option value="JP">Japan</option>\n                            <option value="UK">United Kingdom</option>\n                            <option value="US">United States</option>\n                            <option value="OTHER">Other</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <div class="form-group">\n                    <label>\n                        <input type="checkbox" id="setAsDefault" name="setAsDefault">\n                        Set as default address\n                    </label>\n                </div>\n                \n                <div style="display: flex; gap: 10px; margin-top: 30px;">\n                    <button type="submit" style="\n                        flex: 1;\n                        background: black;\n                        color: white;\n                        border: none;\n                        padding: 12px;\n                        font-size: 16px;\n                        cursor: pointer;\n                    ">SAVE ADDRESS</button>\n                    <button type="button" id="cancelNewAddress" style="\n                        flex: 1;\n                        background: white;\n                        color: black;\n                        border: 2px solid black;\n                        padding: 12px;\n                        font-size: 16px;\n                        cursor: pointer;\n                    ">CANCEL</button>\n                </div>\n            </form>\n        </div>\n    '),t.innerHTML=c,Hn(),Tn(a),Cn(),a.length>0&&_n(X()(a).call(a,function(n){return n.isDefault})||a[0]);case 7:case"end":return n.stop()}},n,null,[[1,5]])}))).apply(this,arguments)}function Tn(n){var e,t;z()(e=document.querySelectorAll('input[name="selectedAddress"]')).call(e,function(e){e.addEventListener("change",function(e){var t;if(z()(t=document.querySelectorAll(".address-option")).call(t,function(n){n.classList.remove("selected"),n.style.borderColor="#ccc"}),e.target.checked){var a=e.target.closest(".address-option");a.classList.add("selected"),a.style.borderColor="black";var r=R()(e.target.value);_n(n[r]);var i=document.getElementById("proceedToPayment");i&&(i.disabled=!1,i.style.background="black",i.style.color="white",i.style.cursor="pointer")}})});var a=document.querySelector('input[name="selectedAddress"]:checked');if(a){var r=a.closest(".address-option");r.classList.add("selected"),r.style.borderColor="black"}z()(t=document.querySelectorAll(".delete-address-btn")).call(t,function(n){n.addEventListener("click",function(){var n=(0,E.A)(A().mark(function n(e){var t;return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e.stopPropagation(),t=R()(e.target.dataset.addressIndex),!confirm("Are you sure you want to delete this address?")){n.next=1;break}return n.next=1,Dn(t);case 1:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}())});var i=document.getElementById("useNewAddress");i&&i.addEventListener("click",function(){document.querySelector(".address-selection").style.display="none",document.querySelector(".checkout-form").style.display="block",Fn();var n=document.getElementById("proceedToPayment");n&&(n.disabled=!0,n.style.background="#ccc",n.style.color="#666",n.style.cursor="not-allowed")})}function Cn(){var n=document.getElementById("checkoutForm");n&&n.addEventListener("submit",function(){var n=(0,E.A)(A().mark(function n(e){return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.preventDefault(),n.next=1,Nn();case 1:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}());var e=document.getElementById("cancelNewAddress");e&&e.addEventListener("click",function(){document.querySelector(".checkout-form").style.display="none",document.querySelector(".address-selection").style.display="block"});var t=document.getElementById("country");t&&t.addEventListener("change",function(n){var e=n.target.value;e?qn(e):Fn()})}function Dn(n){return On.apply(this,arguments)}function On(){return(On=(0,E.A)(A().mark(function n(e){var t,a,r,i,o,s,d,c;return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=1,supabase.auth.getUser();case 1:return t=n.sent,a=t.data.user,n.next=2,supabase.from("profiles").select("shipping_addresses").eq("user_id",a.id).single();case 2:return r=n.sent,i=r.data,o=(null==i?void 0:i.shipping_addresses)||[],s=o[e],en()(o).call(o,e,1),null!=s&&s.isDefault&&o.length>0&&(o[0].isDefault=!0),n.next=3,supabase.from("profiles").update({shipping_addresses:o}).eq("user_id",a.id);case 3:if(d=n.sent,!(c=d.error)){n.next=4;break}throw c;case 4:Pn(),n.next=6;break;case 5:n.prev=5,n.catch(0),alert("Failed to delete address. Please try again.");case 6:case"end":return n.stop()}},n,null,[[0,5]])}))).apply(this,arguments)}function Nn(){return Rn.apply(this,arguments)}function Rn(){return(Rn=(0,E.A)(A().mark(function n(){var e,t,a,r,i,o,s,d,c;return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,e=new FormData(document.getElementById("checkoutForm")),n.next=1,supabase.auth.getUser();case 1:return t=n.sent,a=t.data.user,r={fullName:e.get("fullName"),email:e.get("email"),phone:e.get("phone"),address1:e.get("address1"),address2:e.get("address2")||"",city:e.get("city"),state:e.get("state"),zipCode:e.get("zipCode"),country:e.get("country"),isDefault:"on"===e.get("setAsDefault")},n.next=2,supabase.from("profiles").select("shipping_addresses").eq("user_id",a.id).single();case 2:return i=n.sent,o=i.data,s=(null==o?void 0:o.shipping_addresses)||[],r.isDefault&&(s=J()(s).call(s,function(n){return an(an({},n),{},{isDefault:!1})})),0===s.length&&(r.isDefault=!0),s.push(r),n.next=3,supabase.from("profiles").update({shipping_addresses:s}).eq("user_id",a.id);case 3:if(d=n.sent,!(c=d.error)){n.next=4;break}throw c;case 4:Pn(),n.next=6;break;case 5:n.prev=5,n.catch(0),alert("Failed to save address. Please try again.");case 6:case"end":return n.stop()}},n,null,[[0,5]])}))).apply(this,arguments)}function _n(n){if(n&&n.country){var e=window.SHIPPING_CONFIG[n.country]||window.SHIPPING_CONFIG.OTHER,t=window.currentSubtotal||0,a=e.shipping,r=t*(e.tax/100);Bn({subtotal:t,shipping:a,tax:r,total:t+a+r,config:e,address:n})}else Fn()}function Hn(){var n=document.getElementById("cartSummary");if(n){n.innerHTML='\n            <h3>ORDER SUMMARY</h3>\n            <div id="summaryDetails">\n                <div class="summary-row">\n                    <span>Subtotal:</span>\n                    <span>Â¥'.concat((window.currentSubtotal||0).toFixed(2),'</span>\n                </div>\n                <div id="addressPrompt" class="summary-row">\n                    <span style="color: #666; font-style: italic;">Select address to calculate total</span>\n                </div>\n            </div>\n            <button id="proceedToPayment" disabled style="\n                width: 100%;\n                margin-top: 15px;\n                padding: 12px;\n                background: #ccc;\n                color: #666;\n                border: none;\n                font-size: 16px;\n                cursor: not-allowed;\n            ">PROCEED TO CHECKOUT</button>\n        ');var e=document.getElementById("proceedToPayment");e&&(e.onclick=null,e.addEventListener("click",window.proceedToPayment))}}function qn(n){var e=window.SHIPPING_CONFIG[n]||window.SHIPPING_CONFIG.OTHER,t=window.currentSubtotal||0,a=e.shipping,r=t*(e.tax/100);Bn({subtotal:t,shipping:a,tax:r,total:t+a+r,config:e,address:{country:n}})}function Fn(){var n=document.getElementById("summaryDetails");if(n){var e=window.currentSubtotal||0;n.innerHTML='\n                <div class="summary-row">\n                    <span>Subtotal:</span>\n                    <span id="subtotalAmount">Â¥'.concat(e.toFixed(2),'</span>\n                </div>\n                <div id="addressPrompt" class="summary-row">\n                    <span style="color: black; font-style:italic;">Please select a country to calculate total</span>\n                </div>\n            ')}}function Ln(n){var e=n.country||"OTHER",t=window.SHIPPING_CONFIG[e]||window.SHIPPING_CONFIG.OTHER,a=window.currentSubtotal||0,r=t.shipping,i=a*(t.tax/100),o=a+r+i;window.shippingCost=r,window.taxAmount=i,window.orderTotal=o,window.shippingConfig=t,Un(n,r,i,o)}function zn(){return(zn=(0,E.A)(A().mark(function n(){var e;return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(e=document.querySelector(".cart-header"))&&(e.innerHTML="<h1>SHOPPING CART</h1>"),n.next=1,gn();case 1:case"end":return n.stop()}},n)}))).apply(this,arguments)}function Mn(n){var e=n.country||"OTHER",t=SHIPPING_CONFIG[e]||SHIPPING_CONFIG.OTHER,a=window.currentSubtotal||0,r=t.shipping,i=a*(t.tax/100),o=a+r+i;Bn({subtotal:a,shipping:r,tax:i,total:o,config:t,address:n}),window.shippingCost=r,window.taxAmount=i,window.orderTotal=o,window.shippingConfig=t,Un(n,r,i,o)}function Bn(n){var e,t=document.getElementById("summaryDetails");if(t){var a,r=G()(e='\n            <div class="summary-row">\n                <span>Subtotal:</span>\n                <span id="subtotalAmount">Â¥'.concat(n.subtotal.toFixed(2),'</span>\n            </div>\n            <div class="summary-row" id="shippingRow">\n                <span>Shipping:</span>\n                <span id="shippingAmount">')).call(e,0===n.shipping?'<span style="color: black;">FREE</span>':"Â¥"+n.shipping.toFixed(2),"</span>\n            </div>\n        ");if(n.tax>0)r+=G()(a='\n                <div class="summary-row" id="taxRow">\n                    <span>Tax ('.concat(n.config.tax,'%):</span>\n                    <span id="taxAmount">Â¥')).call(a,n.tax.toFixed(2),"</span>\n                </div>\n            ");r+='\n            <div class="summary-row summary-total" id="totalRow" style="font-weight: bold; font-size: 18px; margin-top: 10px; padding-top: 10px; border-top: 2px solid black;">\n                <span>Total:</span>\n                <span id="totalAmount">Â¥'.concat(n.total.toFixed(2),"</span>\n            </div>\n        "),t.innerHTML=r;var i=document.getElementById("proceedToPayment");i&&(i.disabled=!1,i.style.background="black",i.style.color="white",i.style.cursor="pointer")}}function Un(n,e,t,a){var r,i,o,s,d,c,l,p,u,m,g,y,f,b,h=document.querySelector(".cart-header"),v=document.getElementById("cartContent");h&&(h.innerHTML='\n                <h1>REVIEW & PAYMENT</h1>\n                <button class="back-button" data-action="back-to-shipping" style="\n                    padding: 8px 15px;\n                    border: 2px solid black;\n                    background: white;\n                    cursor: pointer;\n                    font-size: 14px;\n                ">â EDIT SHIPPING INFO</button>\n            ');var w=window.shippingConfig;var x=G()(r=G()(i=G()(o=G()(s=G()(d=G()(c=G()(l=G()(p=G()(u=G()(m=G()(g=G()(y=G()(f='\n            <style>\n                .payment-methods {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 15px;\n                    margin: 20px 0;\n                }\n                \n                .payment-option {\n                    display: flex;\n                    align-items: center;\n                    gap: 15px;\n                    padding: 15px;\n                    border: 2px solid black;\n                    cursor: pointer;\n                    transition: all 0.3s;\n                }\n                \n                .payment-option:hover {\n                    border-color: black;\n                  \n                }\n                \n                .payment-option input[type="radio"]:checked + span {\n                    font-weight: bold;\n                }\n                \n                .order-summary-final {\n             \n                    padding: 20px;\n                    margin: 20px 0;\n                    border: 2px solid black;\n                }\n                \n                .payment-qr-container {\n                    display: none;\n                    text-align: center;\n                    padding: 20px;\n                    background: white;\n                    border: 2px solid black;\n                    margin: 20px 0;\n                }\n                \n                .payment-qr-container.active {\n                    display: block;\n                }\n                \n                .order-info {\n           \n                    padding: 15px;\n                    margin-bottom: 20px;\n                    border: 2px solid black;\n                }\n                \n                .qr-code-img {\n                    width: 250px;\n                    height: 250px;\n                    border: 2px solid black;\n                    padding: 10px;\n                    background: white;\n                }\n                \n                .payment-note {\n                    color: black;\n                    margin: 10px 0;\n                    font-size: 14px;\n                }\n                \n            \n            </style>\n            \n            <div class="payment-container">\n                <div class="order-review" style=" padding: 20px; margin-bottom: 25px; border: 2px solid black;">\n                    <h3 style="margin-bottom: 10px;">DELIVERY INFORMATION</h3>\n                    <p style="line-height: 1.6;">\n                        '.concat(n.fullName,"<br>\n                        ")).call(f,n.address1,"<br>\n                        ")).call(y,n.address2?n.address2+"<br>":"","\n                        ")).call(g,n.city,", ")).call(m,n.state," ")).call(u,n.zipCode,"<br>\n                        ")).call(p,w.name,"<br>\n                        <strong>Carrier:</strong> ")).call(l,w.carrier,"<br>\n                        <strong>Estimated Delivery:</strong> ")).call(c,w.estimatedDays,' business days\n                    </p>\n                </div>\n                \n                <div class="payment-form">\n                    <h3 style="margin-bottom: 20px;">SELECT PAYMENT METHOD</h3>\n                    ')).call(d,'\n                <div class="payment-methods">\n                    <label class="payment-option">\n                        <input type="radio" name="payment" value="paypal" checked>\n                        <span>PayPal</span>\n                        </label>\n                    <label class="payment-option">\n                        <input type="radio" name="payment" value="alipay" checked>\n                        <span>Alipay(æ¯ä»å®)</span>\n                    </label>\n                    <label class="payment-option">\n                        <input type="radio" name="payment" value="wechat">\n                        <span>WeChat Pay(å¾®ä¿¡æ¯ä»)</span>\n                    </label>\n                </div>\n            ','\n                </div>\n                \n                <div class="order-summary-final">\n                    <h4 style="margin-bottom: 15px;">ORDER TOTAL</h4>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Subtotal:</span>\n                        <span>Â¥')).call(s,window.currentSubtotal.toFixed(2),'</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Shipping:</span>\n                        <span>')).call(o,0===e?'<span style="color: black;">FREE</span>':"Â¥"+e.toFixed(2),"</span>\n                    </div>\n                    ")).call(i,t>0?G()(b='\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Tax ('.concat(w.tax,"%):</span>\n                        <span>Â¥")).call(b,t.toFixed(2),"</span>\n                    </div>\n                    "):"",'\n                    <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 20px; margin-top: 10px; padding-top: 10px; border-top: 2px solid #333;">\n                        <span>Total to Pay:</span>\n                        <span>Â¥')).call(r,a.toFixed(2),"</span>\n                    </div>\n                </div>\n            </div>\n        ");v.innerHTML=x,function(n){var e=document.getElementById("cartSummary");e&&(e.innerHTML='\n                <h3>COMPLETE ORDER</h3>\n                <div>\n                    <div style="text-align: center; margin-top:15px;">\n                        <span style="font-size: 24px; font-weight: bold;">Â¥'.concat(n.toFixed(2),'</span>\n                    </div>\n                    <button id="placeOrderBtn" style="\n                        width: 100%;\n                        margin-top:15px;\n                        padding: 5px;\n                        background: black;\n                        color: white;\n                        border: none;\n                        font-size: 18px;\n                        font-weight: bold;\n                        cursor: pointer;\n                        text-transform: uppercase;\n                        transition: all 0.3s;\n                    " onmouseover="this.style.background=\'#333\'" onmouseout="this.style.background=\'black\'">\n                        PLACE ORDER\n                    </button>\n                    <p style="margin-top: 15px;margin-bottom: 0px;padding:0; font-size: 12px; color: #666; text-align: center;">\n                        Click to generate payment QR code\n                    </p>\n                </div>\n            '),document.getElementById("placeOrderBtn").addEventListener("click",Gn))}(a),window.pendingPayment={amount:a,address:n,shipping:e,tax:t},window.showPaymentView=Un}function Gn(){return Yn.apply(this,arguments)}function Yn(){return(Yn=(0,E.A)(A().mark(function n(){var e,t,a,r,i,o,s,d,c,l,p,u,m,g,y,f,b,h,v,w,x;return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(e=document.querySelector('input[name="payment"]:checked')){n.next=1;break}return alert("Please select a payment method"),n.abrupt("return");case 1:if(t=e.value,a=Wn(),r=window.pendingPayment?window.pendingPayment.amount:window.orderTotal||0,i=null,o=null,"paypal"!==t){n.next=6;break}return n.prev=2,n.next=3,fetch("https://api.exchangerate-api.com/v4/latest/USD");case 3:return s=n.sent,n.next=4,s.json();case 4:d=n.sent,i=d.rates.CNY,o=r/i,n.next=6;break;case 5:n.prev=5,n.catch(2),o=r/(i=7.2);case 6:return c="",n.prev=7,n.next=8,supabase.auth.getUser();case 8:if(l=n.sent,!(p=l.data.user)){n.next=10;break}return n.next=9,supabase.from("profiles").select("manifesto").eq("user_id",p.id).single();case 9:u=n.sent,(m=u.data)&&m.manifesto&&(c=m.manifesto);case 10:n.next=12;break;case 11:n.prev=11,n.catch(7),c="User"+Math.random().toString(36).substr(2,5).toUpperCase();case 12:if(window.currentOrder={orderId:a,paymentMethod:t,amount:r,usdAmount:o,exchangeRate:i,manifesto:c,status:"pending",createdAt:(new Date).toISOString()},g={alipay:"Alipay(æ¯ä»å®)",wechat:"WeChat Pay(å¾®ä¿¡æ¯ä»)",paypal:"PayPal"},y={alipay:"/images/alipay-qr.png",wechat:"/images/wechat-qr.png",paypal:"./images/paypal-qr.png"}[t]||"./images/default-qr.png",f=document.querySelector(".cart-container")){n.next=13;break}return(b=document.getElementById("cartContent"))&&Kn(b,a,r,t,g,y,c,o,i),n.abrupt("return");case 13:Kn(f,a,r,t,g,y,c,o,i),(h=document.getElementById("cartSummary"))&&(h.innerHTML=G()(v=G()(w='\n                <h3>PAYMENT PENDING</h3>\n                <div style="padding: 20px; text-align: center;">\n                    <p style="color: black; font-size: 20px; margin-bottom: 10px;">\n                        Waiting for payment\n                    </p>\n                    <p style="font-size: 15px; color: #666;">\n                        Order #'.concat(a,'\n                    </p>\n                    <p style="font-size: 25px; font-weight: bold; margin-top: 10px;">\n                        ')).call(w,"paypal"===t&&o?"$".concat(o.toFixed(2)," USD"):"Â¥".concat(r.toFixed(2)),"\n                    </p>\n                    ")).call(v,"paypal"===t&&i?G()(x='<p style="font-size: 12px; color: #666; margin-top: 5px;">\n                            (Â¥'.concat(r.toFixed(2)," @ 1 USD = ")).call(x,i.toFixed(4)," CNY)\n                        </p>"):"","\n                </div>\n            "));case 14:case"end":return n.stop()}},n,null,[[2,5],[7,11]])}))).apply(this,arguments)}function Kn(n,e,t,a,r,i,o){var s,d,c,l,p,u,m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,g=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,y=document.querySelector(".cart-header"),f=document.getElementById("cartContent");y&&(y.innerHTML='\n                <h1>PAYMENT</h1>\n                <button class="back-button" data-action="back-to-review" style="\n                    padding: 8px 15px;\n                    border: 2px solid black;\n                    background: white;\n                    cursor: pointer;\n                    font-size: 14px;\n                ">â BACK TO REVIEW</button>\n            ');var b,h;"paypal"===a&&m&&g?G()(b=G()(h='\n            <p><strong>Amount:</strong> \n            <span style="font-size: 20px; font-weight: bold;">$'.concat(m.toFixed(2),' USD</span><br>\n            <span style="font-size: 14px; color: #666;">(Â¥')).call(h,t.toFixed(2)," CNY @ 1 USD = ")).call(b,g.toFixed(2)," CNY)</span>\n            </p>\n        "):'<p><strong>Amount:</strong> <span style="font-size: 20px; font-weight: bold;">Â¥'.concat(t.toFixed(2),"</span></p>");var v=G()(s=G()(d=G()(c=G()(l=G()(p=G()(u='\n            <style>\n                .payment-display-container {\n                    padding: 20px;\n                    border: black 2px solid;\n                }\n                \n                .order-info {\n                    padding: 20px;\n                    margin-bottom: 20px;\n                    border: 2px solid black;\n                }\n                \n                .order-info h3 {\n                    margin-top: 0;\n                    text-transform: uppercase;\n                }\n                \n                .order-info p {\n                    margin: 10px 0;\n                    line-height: 1.6;\n                }\n                \n                .qr-section {\n                    text-align: center;\n                }\n                \n                .qr-section h4 {\n                    font-size: 20px;\n                    margin-bottom: 10px;\n                    text-transform: uppercase;\n                }\n                \n                .payment-note {\n                    margin-top: 10px;\n                    line-height: 1.8;\n                }\n            </style>\n            \n            <div class="payment-display-container">\n                <div class="order-info">\n                    <h3>ORDER INFORMATION</h3>\n                    <p><strong>Order Number:</strong> <span style="font-size: 18px; color: black;">'.concat(e,'</span></p>\n                    <p><strong>Manifesto#:</strong> <span style="font-size: 18px; color: black;">')).call(u,o||"Anonymous",'</span></p>\n                    <p><strong>Amount:</strong> <span style="font-size: 20px; font-weight: bold;">Â¥')).call(p,t.toFixed(2),"</span></p>\n                    <p><strong>Payment Method:</strong> ")).call(l,r[a]||a,'</p>\n                </div>\n                \n                <div class="qr-section">\n                    <h4>SCAN TO PAY</h4>\n                    <div style="margin-top:5px; border: 2px solid black; padding: 10px; display: inline-block; background: white;">\n                        <img src="')).call(c,i,'" \n                             alt="')).call(d,r[a]," QR Code\" \n                             class=\"qr-code-img\"\n                             style=\"width: 250px; height: 250px; display: block;\"\n                             onerror=\"this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'250\\' height=\\'250\\'%3E%3Crect fill=\\'%23f0f0f0\\' width=\\'250\\' height=\\'250\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' text-anchor=\\'middle\\' dy=\\'.3em\\' fill=\\'%23999\\'%3EQR Code%3C/text%3E%3C/svg%3E'; this.onerror=null;\">\n                    </div>\n                    <p class=\"payment-note\">\n                        <span style=\"color: black;\">Please include your manifesto in payment note(ä»æ¬¾æ¶è¯·å¤æ³¨ä½ çå®£è¨)</span><br>\n                        <span style=\"color: black; font-weight: bold; font-size: 18px;\">å®£è¨ Manifesto#: ")).call(s,o||"Anonymous",'</span>\n                    </p>\n                </div>\n                \n                <button id="confirmPaymentBtn" class="confirm-payment-btn"  style="\n                    background: black;\n                    color: white;\n                    padding: 5px;\n                    border: none;\n                    font-size: 18px;\n                    cursor: pointer;\n                    width: 100%;\n                    margin-top:5px;\n                ">\n                    I HAVE PAID(æå·²å®ææ¯ä»)\n                </button>\n            </div>\n        ');f.innerHTML=v}function Vn(){window.PAYMENT_QR_CODES||(window.PAYMENT_QR_CODES={alipay:"/images/alipay-qr.png",wechat:"/images/wechat-qr.png",paypal:"/images/paypal-qr.png"})}function Wn(){var n,e=K()().toString(36).toUpperCase(),t=Math.random().toString(36).substr(2,5).toUpperCase();return G()(n="ORD".concat(e)).call(n,t)}function jn(){var n=null;if(window.pendingPayment&&window.pendingPayment.address)n=window.pendingPayment;else if(sessionStorage.getItem("pendingPayment"))try{n=JSON.parse(sessionStorage.getItem("pendingPayment")),window.pendingPayment=n}catch(n){}else window.checkoutAddress&&window.orderTotal&&(n={address:window.checkoutAddress,shipping:window.shippingCost||0,tax:window.taxAmount||0,amount:window.orderTotal},window.pendingPayment=n);n&&n.address?"function"==typeof window.showPaymentView&&window.showPaymentView(n.address,n.shipping,n.tax,n.amount):(alert("Payment information lost. Please restart checkout."),"function"==typeof window.loadCartItems&&window.loadCartItems())}function Qn(){return Zn.apply(this,arguments)}function Zn(){return(Zn=(0,E.A)(A().mark(function n(){var e,t,a,r,i,o,s,d,c,l;return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(e=document.getElementById("confirmPaymentBtn")).disabled=!0,e.textContent="AWAITING VERIFICATION(è¯·ç­å¾å®¡æ ¸)",e.style.background="#999",window.currentOrder.status="awaiting_verification",window.currentOrder.paidAt=(new Date).toISOString(),n.prev=1,n.next=2,supabase.auth.getUser();case 2:if(t=n.sent,a=t.data.user,!t.error&&a){n.next=3;break}return alert("Please login to continue"),e.disabled=!1,e.textContent="I HAVE PAID(æå·²å®ææ¯ä»)",e.style.background="black",n.abrupt("return");case 3:return n.next=4,supabase.from("cart_items").select("*, drafts(*)").eq("user_id",a.id);case 4:return r=n.sent,i=r.data,r.error,o={order_id:window.currentOrder.orderId,user_id:a.id,manifesto:window.currentOrder.manifesto||"Anonymous",items:i||[],shipping_address:window.pendingPayment?window.pendingPayment.address:window.checkoutAddress,payment_method:window.currentOrder.paymentMethod,amount:window.currentOrder.amount,shipping_cost:window.pendingPayment?window.pendingPayment.shipping:window.shippingCost||0,tax_amount:window.pendingPayment?window.pendingPayment.tax:window.taxAmount||0,status:"awaiting_verification",payment_status:"pending_verification",created_at:window.currentOrder.createdAt,paid_at:window.currentOrder.paidAt},n.next=5,supabase.from("orders").insert([o]).select().single();case 5:if(s=n.sent,s.data,!(d=s.error)){n.next=6;break}return"42501"===d.code?alert("Database permission error. Please contact support.\n\nError: RLS policy violation\nOrder ID: "+window.currentOrder.orderId):alert("Error saving order: "+d.message+"\n\nPlease save your order number: "+window.currentOrder.orderId),e.disabled=!1,e.textContent="I HAVE PAID(æå·²å®ææ¯ä»)",e.style.background="black",n.abrupt("return");case 6:return(c=document.getElementById("cartContent"))&&(c.innerHTML='\n                <div style="text-align: center; padding: 40px;">\n                    <h2 style="color: black;">â PAYMENT SUBMITTED</h2>\n                    <p style="font-size: 18px; margin: 20px 0;">\n                        Order #'.concat(window.currentOrder.orderId,'\n                    </p>\n                    <p style="color: black;">\n                        We will verify your payment within 24 hours<br>\n                        ä»æ¬¾å°å¨24å°æ¶åå®¡æ ¸\n                    </p><br>\n                    <p style="color: black;">\n                    You can check your order progress in your profile<br>\n                    æ¨å¯ä»¥å¨æ¡£æ¡ä¸­æ¥çè®¢åè¿å±\n                </p>\n                    <button class="cart-btn" data-action="go-home" style="\n                        margin-top: 30px;\n                        padding: 15px 30px;\n                        background: black;\n                        color: white;\n                        border: none;\n                        cursor: pointer;\n                        font-size: 16px;\n                    ">CONTINUE SHOPPING</button>\n                </div>\n            ')),n.next=7,supabase.from("cart_items").delete().eq("user_id",a.id);case 7:if(l=n.sent,l.error,!window.CartManager){n.next=8;break}return n.next=8,window.CartManager.updateCartBadge();case 8:sessionStorage.removeItem("pendingPayment"),alert("Order submitted successfully!\nè®¢åæäº¤æåï¼\n\nOrder #".concat(window.currentOrder.orderId,"\n\nWe will verify your payment within 24 hours.\næä»¬å°å¨24å°æ¶åéªè¯æ¨çä»æ¬¾ã")),n.next=10;break;case 9:n.prev=9,n.catch(1),alert("Unexpected error. Please save your order number: "+window.currentOrder.orderId),e.disabled=!1,e.textContent="I HAVE PAID(æå·²å®ææ¯ä»)",e.style.background="black";case 10:case"end":return n.stop()}},n,null,[[1,9]])}))).apply(this,arguments)}window.proceedToPayment=function(){var n=document.querySelector('input[name="selectedAddress"]:checked');if(n){var e=R()(n.value),t=(window.currentSavedAddresses||[])[e];t?(window.checkoutAddress=t,Ln(t)):alert("Selected address not found")}else alert("Please select a shipping address")},document.getElementById("checkoutForm").addEventListener("submit",function(){var n=(0,E.A)(A().mark(function n(e){var t,a;return A().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:e.preventDefault(),t=new FormData(e.target),a={fullName:t.get("fullName"),email:t.get("email"),phone:t.get("phone"),address1:t.get("address1"),address2:t.get("address2"),city:t.get("city"),state:t.get("state"),zipCode:t.get("zipCode"),country:t.get("country")},window.checkoutAddress=a,Mn(a);case 1:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()),window.updateQuantity=hn,window.removeItem=wn,window.clearAllItems=function(){return kn.apply(this,arguments)},window.proceedToCheckout=Sn,window.goToHome=In,window.showPaymentView=Un,window.generatePaymentOrder=Gn,window.initializePaymentQRCodes=Vn,window.confirmPayment=Qn,window.displayPaymentInfo=Kn,window.handleBackToReview=jn,window.handleCartClick=ln}}]);