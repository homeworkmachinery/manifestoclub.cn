/*! For license information please see page-profile.6a691e8e6e88de2bfec7.js.LICENSE.txt */
(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e){throw new TypeError('"'+e+'" is read-only')}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function a(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach(function(t){r(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function r(t,n,a){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var r=a.call(t,n||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}function i(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function o(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function i(n,a,r,i){var o=a&&a.prototype instanceof c?a:c,l=Object.create(o.prototype);return d(l,"_invoke",function(n,a,r){var i,o,d,c=0,l=r||[],u=!1,p={p:0,n:0,v:e,a:f,f:f.bind(e,4),d:function(t,n){return i=t,o=0,d=e,p.n=n,s}};function f(n,a){for(o=n,d=a,t=0;!u&&c&&!r&&t<l.length;t++){var r,i=l[t],f=p.p,g=i[2];n>3?(r=g===a)&&(d=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=e):i[0]<=f&&((r=n<2&&f<i[1])?(o=0,p.v=a,p.n=i[1]):f<g&&(r=n<3||i[0]>a||a>g)&&(i[4]=n,i[5]=a,p.n=g,o=0))}if(r||n>1)return s;throw u=!0,a}return function(r,l,g){if(c>1)throw TypeError("Generator is already running");for(u&&1===l&&f(l,g),o=l,d=g;(t=o<2?e:d)||!u;){i||(o?o<3?(o>1&&(p.n=-1),f(o,d)):p.n=d:p.v=d);try{if(c=2,i){if(o||(r="next"),t=i[r]){if(!(t=t.call(i,d)))throw TypeError("iterator result is not an object");if(!t.done)return t;d=t.value,o<2&&(o=0)}else 1===o&&(t=i.return)&&t.call(i),o<2&&(d=TypeError("The iterator does not provide a '"+r+"' method"),o=1);i=e}else if((t=(u=p.n<0)?d:n.call(a,p))!==s)break}catch(t){i=e,o=1,d=t}finally{c=1}}return{value:t,done:u}}}(n,r,i),!0),l}var s={};function c(){}function l(){}function u(){}t=Object.getPrototypeOf;var p=[][a]?t(t([][a]())):(d(t={},a,function(){return this}),t),f=u.prototype=c.prototype=Object.create(p);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,d(e,r,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=u,d(f,"constructor",u),d(u,"constructor",l),l.displayName="GeneratorFunction",d(u,r,"GeneratorFunction"),d(f),d(f,r,"Generator"),d(f,a,function(){return this}),d(f,"toString",function(){return"[object Generator]"}),(o=function(){return{w:i,m:g}})()}function d(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}d=function(e,t,n,a){if(t)r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n;else{var i=function(t,n){d(e,t,function(e){return this._invoke(t,n,e)})};i("next",0),i("throw",1),i("return",2)}},d(e,t,n,a)}function c(e,t,n,a,r,i,s){try{var o=e[i](s),d=o.value}catch(e){return void n(e)}o.done?t(d):Promise.resolve(d).then(a,r)}function l(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var i=e.apply(t,n);function s(e){c(i,a,r,s,o,"next",e)}function o(e){c(i,a,r,s,o,"throw",e)}s(void 0)})}}var u=!1,p=!1;document.querySelectorAll(".menu-item"),document.querySelectorAll(".content-section");function f(){u||(u=!0,document.addEventListener("click",handleGlobalClick),document.addEventListener("keydown",function(e){"Escape"===e.key&&A()}))}function g(e){return m.apply(this,arguments)}function m(){return(m=l(o().m(function e(t){var n,a,r;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,supabase.from("note_annotations").select("*").eq("note_id",t).order("display_order",{ascending:!0});case 1:if(n=e.v,a=n.data,!(r=n.error)){e.n=2;break}throw r;case 2:return e.a(2,a||[]);case 3:return e.p=3,e.v,e.a(2,[])}},e,null,[[0,3]])}))).apply(this,arguments)}function b(e){return v.apply(this,arguments)}function v(){return(v=l(o().m(function e(t){var n;return o().w(function(e){for(;;)switch(e.n){case 0:if(t&&0!==t.length){e.n=1;break}return e.a(2,"");case 1:return n=i(t).sort(function(e,t){return e.display_order-t.display_order}),e.a(2,'\n        <div class="note-annotations" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee;">\n            <div style="font-weight: bold; margin-bottom: 8px; font-size: 13px;">注解:</div>\n            '.concat(n.map(function(e){return'\n                <div style="margin-bottom: 6px; line-height: 1.4; font-size: 12px;">\n                    <span style="color: #0066cc; font-weight: bold; margin-right: 4px;">'.concat(y(e.display_order),"</span>\n                    <span>").concat(e.annotation_text||"（无注解内容）","</span>\n                </div>\n            ")}).join(""),"\n        </div>\n    "))}},e)}))).apply(this,arguments)}function y(e){return e<=20?["⓪","①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩","⑪","⑫","⑬","⑭","⑮","⑯","⑰","⑱","⑲","⑳"][e]:"(".concat(e,")")}function h(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})}function w(){return(w=l(o().m(function e(t,n){var r,i,s,d,c,l,u,p,f,g,m,b;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,supabase.from("drafts").select("*").eq("id",t).single();case 1:if(r=e.v,i=r.data,!r.error&&i){e.n=2;break}return alert("Unable to add to cart"),e.a(2);case 2:return s=29.99,i.data&&(d=i.data,c=d.color||"white",l=d.backImages&&d.backImages.length>0,u=l?"double-sided":"single-sided",window.TSHIRT_PRICING&&window.TSHIRT_PRICING[u]&&(s="white"===c?window.TSHIRT_PRICING[u].white:"black"===c?window.TSHIRT_PRICING[u].black:window.TSHIRT_PRICING[u].colored)),e.n=3,supabase.auth.getUser();case 3:if(p=e.v,f=p.data.user){e.n=4;break}return alert("Please login first"),e.a(2);case 4:return g=a(a({},i.data),{},{sizeQuantities:n}),e.n=5,supabase.from("drafts").update({data:g,sizes:n,updated_at:(new Date).toISOString()}).eq("id",t);case 5:if(m=e.v,m.error,!window.CartManager||!window.CartManager.addOrUpdateCartItem){e.n=7;break}return e.n=6,window.CartManager.addOrUpdateCartItem({draftId:t,itemData:{type:"custom-design",designType:"custom",color:(null===(b=i.data)||void 0===b?void 0:b.color)||"white",title:i.title||"Custom T-shirt Design",unitPrice:s},sizes:n,userId:f.id});case 6:e.v;case 7:e.n=9;break;case 8:e.p=8,e.v,alert("Operation failed, please try again.");case 9:return e.a(2)}},e,null,[[0,8]])}))).apply(this,arguments)}function x(){return k.apply(this,arguments)}function k(){return(k=l(o().m(function e(){var t,n,a,r;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,supabase.auth.getUser();case 1:if(t=e.v,n=t.data.user){e.n=2;break}return e.a(2);case 2:return e.n=3,supabase.from("drafts").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});case 3:if(a=e.v,r=a.data,!a.error){e.n=4;break}return e.a(2);case 4:E(r),e.n=6;break;case 5:e.p=5,e.v;case 6:return e.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function E(e){var t=document.getElementById("draft");if(t){var n=e.map(function(e){var t="";return("svg"===e.type||"tshirt"===e.type)&&(t=e.front_preview_image),'\n        <div class="draft-item" data-id="'.concat(e.id,'">\n            <div style="display: flex; align-items: center; gap: 10px;">\n                <img src="').concat(t,'" alt="预览" \n                     style="width: 80px; height: 80px; object-fit: cover;  border: 2px solid black; aspect-ratio: 1 / 1; ">\n                <div style="flex: 1;">\n                    <p>').concat("svg"===e.type?"DOODLE":"T-SHIRT","</p>\n                    <p>CREATED: ").concat(new Date(e.created_at).toLocaleString(),'</p>\n                </div>\n                <div class="button-containe">\n                    <button class="load-draft-btn" data-draft-id="').concat(e.id,'" style="margin-right: 10px; border: 2px solid black; background:white; width:100px;font-size: 15px">LOAD</button>\n                    <button class="delete-draft-btn" data-draft-id="').concat(e.id,'" style="color: black;border: 2px solid black; background:white; width:100px; font-size: 15px">DELETE</button>\n                </div>\n            </div>\n        </div>\n\n        ')}).join("");t.innerHTML=n}}function _(){return(_=l(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:if(!p){e.n=1;break}return e.a(2);case 1:p=!0,setTimeout(l(o().m(function e(){var n,a,r,s,d,c,l,u,f,g,m,b;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(confirm("确定要删除这个草稿吗？")){e.n=1;break}return p=!1,e.a(2);case 1:return e.p=1,e.n=2,supabase.from("drafts").select("*").eq("id",t).single();case 2:if(n=e.v,a=n.data,!n.error){e.n=3;break}return alert("删除失败"),p=!1,e.a(2);case 3:if(r=[],s=function(e){if(!e||"string"!=typeof e)return null;var t=e.match(/\/storage\/v1\/object\/public\/design-files\/(.+)/);return t?t[1]:null},"svg"===a.type?(a.data&&(a.data.storageUrl&&(d=s(a.data.storageUrl))&&r.push(d),a.data.fileName&&(r.includes(a.data.fileName)||r.push(a.data.fileName))),a.front_preview_image&&(c=s(a.front_preview_image))&&!r.includes(c)&&r.push(c)):"tshirt"===a.type&&((l=a.data)&&(l.frontImages&&Array.isArray(l.frontImages)&&l.frontImages.forEach(function(e,t){if(e.storageFile)if(e.storageFile.fileName)r.push(e.storageFile.fileName);else if(e.storageFile.publicUrl){var n=s(e.storageFile.publicUrl);n&&!r.includes(n)&&r.push(n)}}),l.backImages&&Array.isArray(l.backImages)&&l.backImages.forEach(function(e,t){if(e.storageFile)if(e.storageFile.fileName)r.push(e.storageFile.fileName);else if(e.storageFile.publicUrl){var n=s(e.storageFile.publicUrl);n&&!r.includes(n)&&r.push(n)}}),l.frontPreviewFile&&l.frontPreviewFile.fileName&&r.push(l.frontPreviewFile.fileName),l.backPreviewFile&&l.backPreviewFile.fileName&&r.push(l.backPreviewFile.fileName)),a.front_preview_image&&(u=s(a.front_preview_image))&&!r.includes(u)&&r.push(u),a.back_preview_image&&(f=s(a.back_preview_image))&&!r.includes(f)&&r.push(f)),!((g=i(new Set(r))).length>0)){e.n=5;break}return e.n=4,supabase.storage.from("design-files").remove(g);case 4:m=e.v,m.data,m.error;case 5:return e.n=6,supabase.from("drafts").delete().eq("id",t);case 6:if(b=e.v,!b.error){e.n=7;break}alert("删除失败"),e.n=8;break;case 7:return alert("草稿已删除"),e.n=8,x();case 8:e.n=10;break;case 9:e.p=9,e.v,alert("删除失败");case 10:return e.p=10,setTimeout(function(){p=!1},500),e.f(10);case 11:return e.a(2)}},e,null,[[1,9,10,11]])})),0);case 2:return e.a(2)}},e)}))).apply(this,arguments)}function I(){return(I=l(o().m(function e(t){var n,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,supabase.from("drafts").select("*").eq("id",t).single();case 1:if(n=e.v,a=n.data,!n.error){e.n=2;break}return e.a(2);case 2:"svg"===a.type?S(a):"tshirt"===a.type&&P(a),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function S(e){var t='\n    \n        <div id="draftPreviewModal" class="modal-overlay-svg" style="position: fixed; top: 0; left: 5px; width: calc(100% - 10px); height: 100%; z-index: 10000;  display: flex; justify-content: center; align-items: center; ">\n            <div class="modal-content-svg" style="background: white; padding: 20px;  max-width: 100vw; max-height: 100vh;  border: 2px solid black;">\n                <div class="preview-container" style="display: flex; gap: 30px; justify-content: center; margin-bottom: 20px;">\n                    <div class="preview-item" style="text-align: center;">\n                        <span style="font-size: 18px; margin-bottom: 10px; display: block;">PREVIEW</span>\n                        <div class="preview-tshirt" style="width: 200px; height: 250px; background-image: url(\''.concat(e.front_preview_image,'\'); background-size: contain; background-repeat: no-repeat; background-position: center; margin: 0 auto; outline: none; box-shadow: none;border: 2px solid black;"></div>\n                    </div>\n                </div>\n              \n                <div class="modal-buttons" style="display: flex; gap: 20px; justify-content: space-between;">\n                    <button class="edit-draft" data-draft-id="').concat(e.id,'" style="width: 200px; font-size: 16px; border: 2px solid black; background: white; cursor: pointer; min-width: 150px;">BACK TO EDIT</button>\n                    <button class="add-in-gallery" data-draft-id="').concat(e.id,'" style="width: 200px; font-size: 16px; border: 2px solid black; background: white; cursor: pointer; min-width: 150px;">ADD TO GALLERY</button>\n                </div>\n            </div>\n        </div>\n    ');document.body.insertAdjacentHTML("beforeend",t)}function P(e){var t,n=(null===(t=e.data)||void 0===t?void 0:t.sizeQuantities)||e.sizes||{XS:0,S:0,M:0,L:0,XL:0,"2XL":0,"3XL":0},a='\n    <div id="draftPreviewModal" class="modal-overlay" style="position: fixed; top: 0; left: 5px; width: calc(100% - 10px); height: 100%; z-index: 10000; display: flex; justify-content: center; align-items: center;">\n      <div class="modal-content" style="background: white; padding: 25px; max-width: 70vh; max-height: 80vh; overflow-y: auto; border: 2px solid black; position: relative;">\n        <div class="preview-container" style="display: flex; gap: 30px; justify-content: center; margin-bottom: 20px;">\n          <div class="preview-item" style="text-align: center;">\n            <span style="font-size: 18px; margin-bottom: 10px; display: block;">FRONT</span>\n            <div style="border: 2px black solid;">\n              <div class="preview-tshirt" style="width: 200px; height: 250px; min-width: 120px; background-image: url(\''.concat(e.front_preview_image,'\'); background-size: contain; background-repeat: no-repeat; background-position: center; margin: 0 auto;"></div>\n            </div>\n          </div>\n          <div class="preview-item" style="text-align: center;">\n            <span style="font-size: 18px; margin-bottom: 10px; display: block;">BACK</span>\n            <div style="border: 2px black solid;">\n              <div class="preview-tshirt" style="width: 200px; height: 250px; min-width: 100px; background-image: url(\'').concat(e.back_preview_image,'\'); background-size: contain; background-repeat: no-repeat; background-position: center; margin: 0 auto;"></div>\n            </div>\n          </div>\n        </div>\n        \n        <div class="size-selection-horizontal" style="display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-bottom: 20px;">\n          ').concat(["XS","S","M","L","XL","2XL","3XL"].map(function(e){return'\n            <div class="size-option">\n              <label>'.concat(e,'</label>\n              <div class="quantity-control" style="display: flex; align-items: center; overflow: hidden;">\n                <input type="number" class="quantity-input" data-size="').concat(e,'" value="').concat(n[e]||0,'" min="0" max="99" style="width: 45px; height: 30px; text-align: center; border: 2px solid black;">\n              </div>\n            </div>\n          ')}).join(""),'\n        </div>\n        \n        <div class="modal-buttons" style="display: flex; gap: 20px; justify-content: space-between;">\n          <button class="edit-draft" data-draft-id="').concat(e.id,'" style="width: 200px; font-size: 16px; border: 2px solid black; background: white; cursor: pointer; min-width: 120px;">BACK TO EDIT</button>\n          <button class="add-to-cart-tshirt" data-draft-id="').concat(e.id,'" style="width: 200px; font-size: 16px; border: 2px solid black; background: white; cursor: pointer; min-width: 120px;">UPDATE CART</button>\n        </div>\n      </div>\n    </div>\n    ');document.body.insertAdjacentHTML("beforeend",a)}function A(){var e=document.getElementById("draftPreviewModal");e&&e.remove()}function T(){return(T=l(o().m(function e(t){var n,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,supabase.from("drafts").select("*").eq("id",t).single();case 1:if(n=e.v,a=n.data,!n.error&&a){e.n=2;break}return alert("无法加载草稿"),e.a(2);case 2:"svg"===a.type?window.location.href="/?loadSvgDraft=".concat(t):"tshirt"===a.type&&(window.location.href="/?loadTshirtDraft=".concat(t)),e.n=4;break;case 3:e.p=3,e.v,alert("加载失败，请重试");case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function L(){return(L=l(o().m(function e(t){var n,a,r,i,s,d,c,l,u,p,f,g,m;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,supabase.auth.getUser();case 1:if(i=e.v,s=i.data.user){e.n=2;break}return alert("请先登录"),e.a(2);case 2:return e.n=3,supabase.from("drafts").select("*").eq("id",t).single();case 3:if(d=e.v,c=d.data,!d.error&&c){e.n=4;break}return alert("无法获取草稿信息"),e.a(2);case 4:if("svg"===c.type){e.n=5;break}return alert("只能将SVG草稿添加到Gallery"),e.a(2);case 5:return e.n=6,supabase.from("gallery").select("id").eq("draft_id",t).maybeSingle();case 6:if(l=e.v,!l.data){e.n=7;break}return alert("This artwork is already in the gallery!"),e.a(2);case 7:return u=prompt("Give your artwork a title:","My Doodle")||"Untitled",p=prompt("Add a description (optional):","")||"",f={user_id:s.id,draft_id:t,title:u,description:p,preview_image:c.front_preview_image,svg_url:(null===(n=c.data)||void 0===n?void 0:n.storageUrl)||null,svg_data:(null===(a=c.data)||void 0===a?void 0:a.svgContent)||(null===(r=c.data)||void 0===r?void 0:r.svgData)||null},e.n=8,supabase.from("gallery").insert([f]).select().single();case 8:if(g=e.v,g.data,!(m=g.error)){e.n=9;break}return alert("添加失败："+m.message),e.a(2);case 9:if(!confirm("Successfully added to gallery! Do you want to delete this draft?")){e.n=11;break}return e.n=10,D(t);case 10:e.n=13;break;case 11:if(A(),!confirm("View in gallery now?")){e.n=12;break}"function"==typeof loadPage?loadPage("gallery"):window.location.href="/gallery",e.n=13;break;case 12:return e.n=13,x();case 13:e.n=15;break;case 14:e.p=14,e.v,alert("添加失败，请重试");case 15:return e.a(2)}},e,null,[[0,14]])}))).apply(this,arguments)}function D(e){return C.apply(this,arguments)}function C(){return(C=l(o().m(function e(t){var n,a,r,s,d,c,l,u,p,f;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,supabase.from("drafts").select("*").eq("id",t).single();case 1:if(n=e.v,a=n.data,!n.error){e.n=2;break}return e.a(2);case 2:if(r=[],s=function(e){if(!e||"string"!=typeof e)return null;var t=e.match(/\/storage\/v1\/object\/public\/design-files\/(.+)/);return t?t[1]:null},"svg"===a.type&&(null!==(d=a.data)&&void 0!==d&&d.storageUrl&&(l=s(a.data.storageUrl))&&r.push(l),null!==(c=a.data)&&void 0!==c&&c.fileName&&r.push(a.data.fileName)),!((u=i(new Set(r))).length>0)){e.n=4;break}return e.n=3,supabase.storage.from("design-files").remove(u);case 3:p=e.v,p.error;case 4:return e.n=5,supabase.from("drafts").delete().eq("id",t);case 5:if(f=e.v,!f.error){e.n=6;break}alert("草稿删除失败"),e.n=8;break;case 6:if(A(),!confirm("Draft deleted. View in gallery now?")){e.n=7;break}"function"==typeof loadPage?loadPage("gallery"):window.location.href="/gallery",e.n=8;break;case 7:return e.n=8,x();case 8:e.n=10;break;case 9:e.p=9,e.v;case 10:return e.a(2)}},e,null,[[0,9]])}))).apply(this,arguments)}function N(){return O.apply(this,arguments)}function O(){return(O=l(o().m(function e(){var t,n,a,r,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,supabase.auth.getUser();case 1:if(t=e.v,n=t.data.user,!t.error&&n){e.n=2;break}return(a=document.getElementById("order"))&&(a.innerHTML='<p style="text-align: center; padding: 20px;">Please login to view your orders</p>'),e.a(2);case 2:return e.n=3,supabase.from("orders").select("*").eq("user_id",n.id).order("created_at",{ascending:!1});case 3:if(r=e.v,i=r.data,!r.error){e.n=4;break}return e.a(2);case 4:z(i),e.n=6;break;case 5:e.p=5,e.v;case 6:return e.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function z(e){var t=document.getElementById("order");if(t)if(e&&0!==e.length){var n="";e.forEach(function(e){var t=new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),a=e.paid_at?new Date(e.paid_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Not paid",r="",i="#666";switch(e.status){case"awaiting_verification":r="AWAITING VERIFICATION (等待审核)",i="#FFA500";break;case"verified":r="PAYMENT VERIFIED (付款已确认)",i="#28a745";break;case"shipped":r="SHIPPED (已发货)",i="#17a2b8";break;case"delivered":r="DELIVERED (已送达)",i="#28a745";break;case"cancelled":r="CANCELLED (已取消)",i="#dc3545";break;default:r=e.status.toUpperCase()}var s=parseFloat(e.amount)||0,o=parseFloat(e.shipping_cost)||0,d=parseFloat(e.tax_amount)||0,c=s+o+d,l="";"awaiting_verification"===e.status||"verified"===e.status?l+='\n         <button class="cancel-order-btn" data-order-id="'.concat(e.order_id,'"  style="\n             padding: 5px 20px;\n             font-size:15px;\n             background: white;\n             color: black;\n             cursor: pointer;\n             border: 2px black solid;\n         ">CANCEL ORDER</button>\n     '):"shipped"!==e.status&&"delivered"!==e.status||(l+='\n         <button class="track-order-btn" data-order-id="'.concat(e.order_id,'" data-tracking-number="').concat(e.tracking_number||"",'"  style="\n         padding: 5px 20px;\n         font-size:15px;\n         background: white;\n         color: black;\n         cursor: pointer;\n         border: 2px black solid;\n         ">ORDER TRACKING</button>\n     ')),n+='\n            <div class="order-item" style="\n                background: white;\n                border: 2px solid black;\n                padding: 20px;\n                margin-bottom: 20px;\n                position: relative;\n            ">\n                <div class="order-header" style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;  ">\n                    <div >\n                        <h3 style="margin: 0; font-size: 20px;">ORDER #'.concat(e.order_id,'</h3>\n                        <p style="color: #666; margin: 5px 0; font-size: 14px;">Placed on ').concat(t,'</p>\n                    </div>\n                    <div class="status" style="text-align: right;">\n                        <span class="status-badge" style="\n                            background: ').concat(i,';\n                        ">').concat(r,'</span>\n                    </div>\n                </div>\n\n                <div style="  margin-bottom: 15px; font-size: 15px;">\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">\n                        <span>Manifesto#:</span>\n                        <span>').concat(e.manifesto||"Anonymous",'</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">\n                        <span>Payment Method:</span>\n                        <span>').concat("alipay"===e.payment_method?"Alipay (支付宝)":"wechat"===e.payment_method?"WeChat Pay (微信支付)":e.payment_method,"</span>\n                    </div>\n                    ").concat(e.paid_at?'\n                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">\n                            <span>Paid At:</span>\n                            <span>'.concat(a,"</span>\n                        </div>\n                    "):"",'\n                </div>\n\n                <div style="border-top: 2px solid black; padding-top: 15px; margin-bottom: 15px;">\n                    <h4 style="margin-bottom: 10px;">Items (').concat(e.items?e.items.length:0,")</h4>\n                    ").concat(e.items&&e.items.length>0?'\n                        <div style="max-height: 200px; overflow-y: auto;">\n                            '.concat(e.items.map(function(e){return'\n                                <div style="\n                                    display: flex;\n                                    justify-content: space-between;\n                                   \n                                    margin-bottom: 5px;\n                                ">\n                                    <div>\n                                        <strong>'.concat(function(e){var t="";if(e.type&&e.type.startsWith("console-"))if(e.item_data&&e.item_data.productName)t=e.item_data.productName.toUpperCase();else{var n=e.type.replace("console-","");t="RETRO CONSOLE #".concat(n)}else t=e.type&&e.type.includes("blank-tshirt")?"BLANK T-SHIRT":e.draft_id&&e.drafts?"CUSTOMIZED T-SHIRT":"T-SHIRT";return t}(e),"</strong>\n                                        ").concat(e.size?'<span style="color: #666; ">Size: '.concat(e.size,"</span>"):"","\n                                        ").concat(e.quantity>1?'<span style="color: #666; margin-left: 10px;">× '.concat(e.quantity,"</span>"):"","\n                                    </div>\n                                    <div>\n                                        ¥").concat((parseFloat(e.price)*(e.quantity||1)).toFixed(2),"\n                                    </div>\n                                </div>\n                            ")}).join(""),"\n                        </div>\n                    "):'<p style="color: #999;">No item details available</p>','\n                </div>\n\n                <div style="border-top: black 2px solid ; padding-top: 15px; margin-bottom: 15px;">\n                    <h4 style="margin-bottom: 10px;">Shipping Address</h4>\n                    ').concat(e.shipping_address?'\n                        <div style="  font-size: 14px;">\n                       '.concat(e.shipping_address.fullName||e.shipping_address.name||"","<br>\n                        ").concat(e.shipping_address.email?"Email: ".concat(e.shipping_address.email,"<br>"):"","\n                        ").concat(e.shipping_address.phone?"Phone: ".concat(e.shipping_address.phone,"<br>"):"","\n                        ").concat(e.shipping_address.address1||e.shipping_address.street||"","<br>\n                        ").concat(e.shipping_address.address2?"".concat(e.shipping_address.address2,"<br>"):"","\n                        ").concat(e.shipping_address.city||""," ").concat(e.shipping_address.state||""," ").concat(e.shipping_address.zipCode||"","<br>\n                        ").concat(e.shipping_address.country||"","\n                        </div>\n                    "):'<p style="color: #999;">No shipping address provided</p>','\n                </div>\n\n                <div style="border-top: 2px solid black; padding-top: 15px;">\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size:15px;">\n                        <span>Subtotal:</span>\n                        <span>¥').concat(s.toFixed(2),'</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size:15px;">\n                        <span>Shipping:</span>\n                        <span>¥').concat(o.toFixed(2),'</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size:15px;">\n                        <span>Tax:</span>\n                        <span>¥').concat(d.toFixed(2),'</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: bold;">\n                        <span>Total:</span>\n                        <span>¥').concat(c.toFixed(2),"</span>\n                    </div>\n                </div>\n\n               \n                ").concat(e.tracking_number?'\n                    <div style="margin-top: 15px; padding: 10px;  border: 2px solid black;">\n                        <strong>Tracking Number:</strong> '.concat(e.tracking_number,"<br>\n                        <strong>Courier:</strong> ").concat(e.courier,"\n                    </div>\n                "):"",'\n\n                <div style="margin-top: 20px; display: flex; flex-wrap: wrap; gap: 10px;">\n                    ').concat(l,"\n                </div>\n          \n               \n        </div>\n        ")}),t.innerHTML=n}else t.innerHTML='\n            <div style="text-align: center; padding: 40px;">\n                <h2 style="color: black; margin-bottom: 20px;">NO ORDERS YET</h2>\n                <p style="color: #999;">Your orders will appear here after purchase</p>\n            </div>\n        '}function q(){return(q=l(o().m(function e(t,n,a){var r;return o().w(function(e){for(;;)switch(e.n){case 0:if(n){e.n=1;break}return alert("Tracking number not available yet.\n追踪号码尚未生成。\n\nPlease check back later.\n请稍后再查看。"),e.a(2);case 1:r="https://www.17track.net/en#nums=".concat(n,"&auto=1"),window.open(r,"_blank");case 2:return e.a(2)}},e)}))).apply(this,arguments)}document.addEventListener("DOMContentLoaded",function(){setTimeout(l(o().m(function e(){return o().w(function(e){for(;;)switch(e.n){case 0:if("function"!=typeof window.displayUserProfile){e.n=2;break}return e.n=1,window.displayUserProfile();case 1:e.n=3;break;case 2:setTimeout(l(o().m(function e(){return o().w(function(e){for(;;)switch(e.n){case 0:if("function"!=typeof window.displayUserProfile){e.n=1;break}return e.n=1,window.displayUserProfile();case 1:return e.a(2)}},e)})),1e3);case 3:return e.a(2)}},e)})),200),f()}),window.handleGlobalClick=function(e){if(e.target.classList.contains("menu-item")){var t=e.target.getAttribute("data-target");if(!t)return;document.querySelectorAll(".menu-item").forEach(function(e){return e.classList.remove("active")}),e.target.classList.add("active"),document.querySelectorAll(".content-section").forEach(function(e){return e.classList.remove("active")});var n=document.getElementById(t);return n&&n.classList.add("active"),"library"===t&&loadLibrary(),"draft"===t&&x(),"order"===t&&N(),void("setting"===t&&j())}if(e.target.classList.contains("load-draft-btn")){e.preventDefault(),e.stopPropagation();var a=e.target.getAttribute("data-draft-id");a&&function(e){I.apply(this,arguments)}(a)}else if(e.target.classList.contains("delete-draft-btn")){e.preventDefault(),e.stopPropagation();var r=e.target.getAttribute("data-draft-id");r&&!p&&function(e){_.apply(this,arguments)}(r)}else if(e.target.classList.contains("edit-draft")){e.preventDefault(),e.stopPropagation();var i=e.target.getAttribute("data-draft-id");i&&function(e){T.apply(this,arguments)}(i)}else if(e.target.classList.contains("add-to-cart-tshirt")){e.preventDefault(),e.stopPropagation();var s=e.target.getAttribute("data-draft-id");if(s){var o=document.querySelectorAll("#draftPreviewModal .quantity-input"),d={},c=!1;if(o.forEach(function(e){var t=e.getAttribute("data-size"),n=parseInt(e.value)||0;n>0&&(d[t]=n,c=!0)}),!c)return void alert("Please select at least one size");!function(e,t){w.apply(this,arguments)}(s,d)}}else if(e.target.classList.contains("add-in-gallery")){e.preventDefault(),e.stopPropagation();var l=e.target.getAttribute("data-draft-id");l&&function(e){L.apply(this,arguments)}(l)}else if(e.target.classList.contains("modal-overlay")||e.target.classList.contains("modal-overlay-svg"))"draftPreviewModal"===e.target.id&&A();else if(e.target.classList.contains("view-order-details-btn")){e.preventDefault(),e.stopPropagation();var u=e.target.getAttribute("data-order-id");u&&viewOrderDetails(u)}else if(e.target.classList.contains("cancel-order-btn")){e.preventDefault(),e.stopPropagation();var f=e.target.getAttribute("data-order-id");f&&function(e){F.apply(this,arguments)}(f)}else if(e.target.classList.contains("track-order-btn")){e.preventDefault(),e.stopPropagation();var g=e.target.getAttribute("data-order-id"),m=e.target.getAttribute("data-tracking-number");g&&function(e,t,n){q.apply(this,arguments)}(g,m)}else if(e.target.classList.contains("reorder-items-btn")){e.preventDefault(),e.stopPropagation();var b=e.target.getAttribute("data-order-id");b&&reorderItems(b)}else{if(e.target.classList.contains("close-tracking-modal-x-btn"))return e.preventDefault(),e.stopPropagation(),void closeTrackingModal();if(e.target.classList.contains("close-tracking-modal-btn"))return e.preventDefault(),e.stopPropagation(),void closeTrackingModal();if(e.target.classList.contains("open-courier-website-btn")){e.preventDefault(),e.stopPropagation();var v=e.target.getAttribute("data-tracking-number");v&&window.open("https://www.example-courier.com/track/".concat(v),"_blank")}else e.target.classList.contains("modal-overlay")?"draftPreviewModal"===e.target.id&&A():"trackingModal"!==e.target.id||closeTrackingModal()}},"undefined"!=typeof window&&"undefined"!=typeof displayUserProfile&&(window.displayUserProfile=displayUserProfile),window.reloadProfileBarcode=l(o().m(function e(){return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,displayUserProfile();case 1:e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])})),window.addEventListener("profilePageLoaded",l(o().m(function e(){return o().w(function(e){for(;;)switch(e.n){case 0:if("function"!=typeof displayUserProfile){e.n=1;break}return e.n=1,displayUserProfile();case 1:return e.a(2)}},e)}))),function e(){try{if("undefined"!=typeof supabase&&document.getElementById("library")){var t=document.querySelector('.menu-item[data-target="library"]');t&&!t.classList.contains("active")&&(document.querySelectorAll(".menu-item").forEach(function(e){return e.classList.remove("active")}),t.classList.add("active"));var n=document.getElementById("library");n&&!n.classList.contains("active")&&(document.querySelectorAll(".content-section").forEach(function(e){return e.classList.remove("active")}),n.classList.add("active")),loadLibrary()}else setTimeout(e,200)}catch(t){setTimeout(e,200)}}(),window.loadLibrary=l(o().m(function e(){var t,n,a,r,i,s,d,c,l,u,p,f,m,v,y,w,x,k,E,_,I,S,P,A,T,L,D;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("library")){e.n=1;break}return e.a(2);case 1:return t.innerHTML='\n        <div style="padding: 20px; text-align: center;">\n            <div class="loading">Loading your library...</div>\n        </div>\n    ',e.p=2,e.n=3,supabase.auth.getUser();case 3:if(n=e.v,a=n.data.user){e.n=4;break}return t.innerHTML='\n                <div style="padding: 40px; text-align: center;">\n                    <p style="font-size: 18px; margin-bottom: 20px;">请先登录查看你的书库</p>\n                </div>\n            ',e.a(2);case 4:return e.n=5,supabase.from("book_wants").select("book_id, created_at").eq("user_id",a.id).order("created_at",{ascending:!1});case 5:if(r=e.v,i=r.data,!(s=r.error)){e.n=6;break}throw s;case 6:return e.n=7,supabase.from("book_readings").select("book_id, created_at").eq("user_id",a.id).order("created_at",{ascending:!1});case 7:if(d=e.v,c=d.data,!(l=d.error)){e.n=8;break}throw l;case 8:return e.n=9,supabase.from("book_notes").select("*").eq("user_id",a.id).order("created_at",{ascending:!1});case 9:if(u=e.v,p=u.data,!(f=u.error)){e.n=10;break}throw f;case 10:if(m={},p&&p.forEach(function(e){m[e.book_id]||(m[e.book_id]=[]),m[e.book_id].push(e)}),v=window.BOOKS_DATA||{},y="<div>",c&&c.length>0&&(y+='<div class="library-section" style="margin-bottom: 10px;">',y+='<div style="font-size: 22px;  border: 2px black solid; ">READ ('+c.length+")</div>",y+='<div style="margin-bottom: 10px;"></div>',y+='<div class="library-books-grid" style=" display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px;">',c.forEach(function(e){var t=v[e.book_id];if(t){var n=m[e.book_id]?m[e.book_id].length:0;y+='\n                        <div class="library-book-card" style="border: 2px solid black; padding: 10px; cursor: pointer;" \n                             onclick="scrollToBook(\''.concat(t.id,"', '").concat(t.category,'\')"\n                             >\n                             <div style="display: flex; justify-content: center; width: 100%; margin-bottom: 10px;">\n                            <img src="').concat(t.imgSrc,'" alt="').concat(t.title,'" style="width: 100px; height: auto; object-fit: cover;">\n                            </div>\n                            <span style="font-size: 16px;">').concat(t.title,'</span><br>\n                            <span style="font-size: 12px; color: #666;">').concat(n," NOTES</span>\n                        </div>\n                    ")}}),y+="</div></div>"),i&&i.length>0&&(y+='<div class="library-section" style="margin-bottom: 10px;">',y+='<div style="font-size: 22px; border: 2px black solid;">WANT ('+i.length+")</div>",y+='<div style="margin-bottom: 10px;"></div>',y+='<div class="library-books-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px;">',i.forEach(function(e){var t=v[e.book_id];if(t){var n=m[e.book_id]?m[e.book_id].length:0;y+='\n                        <div class="library-book-card" style="border: 2px solid black; padding: 10px; cursor: pointer; " \n                             onclick="scrollToBook(\''.concat(t.id,"', '").concat(t.category,'\')"\n                             >\n                             <div style="display: flex; justify-content: center; width: 100%; margin-bottom: 10px;">\n                            <img src="').concat(t.imgSrc,'" alt="').concat(t.title,'" style="width: 100px; height: auto; object-fit: cover; "></div>\n                            <span style="font-size: 16px; margin-bottom: 5px;">').concat(t.title,'</span><br>\n                            <span style="font-size: 12px; color: #666;">').concat(n," NOTES</span>\n                        </div>\n                    ")}}),y+="</div></div>"),!(p&&p.length>0)){e.n=19;break}y+='<div class="library-section" style="margin-bottom: 10px;">',y+='<div style="font-size: 22px; border: 2px black solid;">MY NOTES ('+p.length+")</div>",y+='<div style="margin-bottom: 10px;"></div>',w=0,x=Object.keys(m);case 11:if(!(w<x.length)){e.n=18;break}if(k=x[w],E=v[k],_=m[k],!(E&&_&&_.length>0)){e.n=17;break}y+='\n                        <div class="book-notes-section" style="margin-bottom: 10px; padding: 10px; border: 2px solid black;">\n                            <span style="font-size: 18px; cursor: pointer; font-weight: bold;" onclick="scrollToBook(\''.concat(k,"', '").concat(E.category,"')\">\n                                ").concat(E.title," (").concat(_.length,')\n                            </span>\n                            <div class="notes-list" id="library-notes-list-').concat(k,'">\n                    '),I=0;case 12:if(!(I<_.length)){e.n=16;break}return S=_[I],P=new Date(S.created_at).toLocaleDateString("zh-CN"),A="",S.page_start&&S.page_end?A="P".concat(S.page_start,"-").concat(S.page_end):S.page_start&&(A="P".concat(S.page_start)),e.n=13,g(S.id);case 13:return T=e.v,e.n=14,b(T);case 14:L=e.v,D=h(S.content),y+='\n                            <div class="library-note-item" id="library-note-'.concat(S.id,'" style="margin-bottom: 10px; padding: 10px; border: 2px solid black; background-color: white;">\n                                <div class="note-content-display" style="margin-bottom: 10px; font-size: 14px; line-height: 1.6; white-space: pre-wrap; word-break: break-word;">').concat(D,"</div>\n                                ").concat(L,'\n                                <div class="note-meta" style="display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #666; margin-top: 10px;">\n                                    <span>').concat(A?A+" · ":"").concat(P,'</span>\n                                    <div style="display: flex; gap: 10px;">\n                                        <span class="note-edit-btn" onclick="editLibraryNote(\'').concat(S.id,"', '").concat(k,"', ").concat(S.page_start||"null",", ").concat(S.page_end||"null",')" style="cursor: pointer; color: #666; ">编辑</span>\n                                        <span class="note-delete-btn" onclick="deleteLibraryNote(\'').concat(S.id,"', '").concat(k,'\')" style="cursor: pointer; color: #666; ">删除</span>\n                            \n                                    </div>\n                                </div>\n                            </div>\n                        ');case 15:I++,e.n=12;break;case 16:y+="</div></div>";case 17:w++,e.n=11;break;case 18:y+="</div>";case 19:c&&0!==c.length||i&&0!==i.length||p&&0!==p.length||(y='\n                <div style="padding: 40px; text-align: center;">\n                    <p style="font-size: 18px; margin-bottom: 20px;">Your library is still empty</p>\n                    <p style="font-size: 14px; color: #666;">Go mark some books or add notes</p>\n                </div>\n            '),y+="</div>",t.innerHTML=y,e.n=21;break;case 20:e.p=20,e.v,t.innerHTML='\n            <div style="padding: 40px; text-align: center;">\n                <p style="color: red;">加载失败，请刷新重试</p>\n            </div>\n        ';case 21:return e.a(2)}},e,null,[[2,20]])})),window.scrollToBook=function(e,t){var n={law:"/law",game:"/game",design:"/design",culture:"/culture"}[t]||"/law";sessionStorage.setItem("scrollToBookId",e),sessionStorage.setItem("openNotesArea","true"),window.location.href=n},window.editLibraryNote=function(){var e=l(o().m(function e(t,n,a,r){var i,s,d,c,l;return o().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,supabase.auth.getUser();case 1:if(i=e.v,i.data.user){e.n=2;break}return alert("请先登录"),e.a(2);case 2:return s=document.getElementById("library-note-".concat(t)),e.n=3,supabase.from("book_notes").select("*").eq("id",t).single();case 3:if(d=e.v,c=d.data){e.n=4;break}return alert("笔记未找到"),e.a(2);case 4:return l=(l=c.content.replace(/[①-⑳⓪]/g,"")).split("\n").map(function(e){var t=e.trim();return t?t.replace(/^　+/g,""):""}).join("\n"),e.n=5,g(t);case 5:e.v,s.innerHTML='\n        <div style="margin-bottom: 10px;">\n            <div style="display: flex; gap: 10px; margin-bottom: 10px;">\n                <input type="number" id="lib-edit-pageStart-'.concat(t,'" value="').concat(a||"",'" placeholder="起始页" \n                    style="width: 100px; padding: 5px; border: 2px solid black;">\n                <span style="line-height: 30px;">-</span>\n                <input type="number" id="lib-edit-pageEnd-').concat(t,'" value="').concat(r||"",'" placeholder="结束页" \n                    style="width: 100px; padding: 5px; border: 2px solid black;">\n            </div>\n            <div id="lib-edit-content-').concat(t,'" contenteditable="true" style="width: 100%; min-height: 120px; padding: 10px; border: 2px solid black; font-family: inherit; font-size: 14px; white-space: pre-wrap; line-height: 1.6;">').concat(h(l),'</div>\n        </div>\n        <div style="display: flex; gap: 10px; margin-top: 10px;">\n            <button onclick="saveLibraryNoteEdit(\'').concat(t,"', '").concat(n,'\')" style="padding: 5px 15px; border: 2px solid black; background-color: white; cursor: pointer;">保存</button>\n            <button onclick="cancelLibraryNoteEdit(\'').concat(t,"', '").concat(n,'\')" style="padding: 5px 15px; border: 2px solid black; background-color: white; cursor: pointer;">取消</button>\n        </div>\n    ');case 6:return e.a(2)}},e)}));return function(t,n,a,r){return e.apply(this,arguments)}}(),window.saveLibraryNoteEdit=function(){var e=l(o().m(function e(t,n){var a,r,i,s,d,c;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,a=document.getElementById("lib-edit-content-".concat(t)),r=document.getElementById("lib-edit-pageStart-".concat(t)).value,i=document.getElementById("lib-edit-pageEnd-".concat(t)).value,s=(s=a.textContent.trim()).split("\n").map(function(e){var t=e.trim();return t?"　　"+t:""}).join("\n")){e.n=1;break}return alert("请输入笔记内容"),e.a(2);case 1:if(r){e.n=2;break}return alert("请填写页码"),e.a(2);case 2:return e.n=3,supabase.from("book_notes").update({content:s,page_start:parseInt(r),page_end:i?parseInt(i):null,updated_at:(new Date).toISOString()}).eq("id",t);case 3:if(d=e.v,!(c=d.error)){e.n=4;break}throw c;case 4:return e.n=5,loadLibrary();case 5:e.n=7;break;case 6:e.p=6,e.v,alert("保存失败，请重试");case 7:return e.a(2)}},e,null,[[0,6]])}));return function(t,n){return e.apply(this,arguments)}}(),window.cancelLibraryNoteEdit=function(){var e=l(o().m(function e(t,n){return o().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,loadLibrary();case 1:return e.a(2)}},e)}));return function(t,n){return e.apply(this,arguments)}}(),window.deleteLibraryNote=function(){var e=l(o().m(function e(t,n){var a,r;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(confirm("确定要删除这条笔记吗？")){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,supabase.from("book_notes").delete().eq("id",t);case 2:if(a=e.v,!(r=a.error)){e.n=3;break}throw r;case 3:return e.n=4,loadLibrary();case 4:e.n=6;break;case 5:e.p=5,e.v,alert("删除失败，请重试");case 6:return e.a(2)}},e,null,[[1,5]])}));return function(t,n){return e.apply(this,arguments)}}(),document.addEventListener("DOMContentLoaded",function(){f();var e=window.handleGlobalClick;window.handleGlobalClick=function(t){if(t.target.classList.contains("menu-item")){var n=t.target.getAttribute("data-target");if("order"===n){document.querySelectorAll(".menu-item").forEach(function(e){return e.classList.remove("active")}),t.target.classList.add("active"),document.querySelectorAll(".content-section").forEach(function(e){return e.classList.remove("active")});var a=document.getElementById(n);return a&&a.classList.add("active"),void N()}}e&&e.call(this,t)}}),window.addEventListener("orderSubmitted",function(e){var t=document.getElementById("order");t&&t.classList.contains("active")&&N()});var B=window.confirmPayment;function F(){return(F=l(o().m(function e(n){var a,r,i,s,d;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(confirm("Are you sure you want to cancel order #".concat(n,"?\n您确定要取消订单 #").concat(n," 吗？\n\nThis action cannot be undone.\n此操作无法撤销。"))){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,supabase.auth.getUser();case 2:if(a=e.v,r=a.data.user,!a.error&&r){e.n=3;break}return alert("Please login to cancel order"),e.a(2);case 3:return e.n=4,supabase.from("orders").update({status:"cancelled",cancelled_at:(new Date).toISOString()}).eq("order_id",n).eq("user_id",r.id).select().single();case 4:if(i=e.v,i.data,!(s=i.error)){e.n=8;break}if("PGRST204"!==s.code&&!s.message.includes("column")){e.n=7;break}return e.n=5,supabase.from("orders").update({status:"cancelled"}).eq("order_id",n).eq("user_id",r.id).select().single();case 5:if(d=e.v,d.data,!d.error){e.n=6;break}return alert("Failed to cancel order. Please try again.\n取消订单失败，请重试。"),e.a(2);case 6:t("data"),e.n=8;break;case 7:return alert("Failed to cancel order. Please try again.\n取消订单失败，请重试。"),e.a(2);case 8:return alert("Order #".concat(n," has been cancelled successfully.\n订单 #").concat(n," 已成功取消。\n\nRefund will be processed within 3-5 business days.\n退款将在3-5个工作日内处理。")),e.n=9,N();case 9:e.n=11;break;case 10:e.p=10,e.v,alert("An unexpected error occurred. Please try again.\n发生意外错误，请重试。");case 11:return e.a(2)}},e,null,[[1,10]])}))).apply(this,arguments)}function j(){return M.apply(this,arguments)}function M(){return(M=l(o().m(function e(){var t,n,a,r,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("setting")){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,supabase.auth.getUser();case 2:if(n=e.v,a=n.data.user,!n.error&&a){e.n=3;break}return t.innerHTML='<p style="text-align: center; padding: 20px;">Please login to access settings</p>',e.a(2);case 3:return e.n=4,supabase.from("profiles").select("manifesto, shipping_addresses").eq("user_id",a.id).single();case 4:r=e.v,i=r.data,r.error,window.currentAddresses=(null==i?void 0:i.shipping_addresses)||[],t.innerHTML='\n            <style>\n                .settings-section {\n                    border: 2px solid black;\n                    padding: 20px;\n                    margin-bottom: 20px;\n                    background: white;\n                }\n                \n                .settings-section h3 {\n                    margin-top: 0;\n                    margin-bottom: 20px;\n                    font-size: 20px;\n                    border-bottom: 2px solid black;\n                    padding-bottom: 10px;\n                }\n                \n                .form-group {\n                    margin-bottom: 15px;\n                }\n                \n                .form-group label {\n                    display: block;\n                    margin-bottom: 5px;\n                    font-weight: bold;\n                    font-size: 14px;\n                }\n                \n                .form-group input, .form-group select {\n                    width: 100%;\n                    padding: 10px;\n                    border: 2px solid black;\n                    font-size: 14px;\n                    box-sizing: border-box;\n                    background: white;\n                }\n                \n                .form-group input[type="checkbox"] {\n                    width: auto;\n                    margin-right: 10px;\n                    transform: scale(1.2);\n                }\n                \n                .form-group label input[type="checkbox"] {\n                    display: inline;\n                    margin-right: 8px;\n                }\n                \n                .settings-btn {\n                    padding: 8px 20px;\n                    background: black;\n                    color: white;\n                    border: none;\n                    cursor: pointer;\n                    font-size: 16px;\n                    margin-right: 10px;\n                    margin-bottom: 5px;\n                }\n                \n                .settings-btn:hover {\n                    background: #333;\n                }\n                \n                .settings-btn:disabled {\n                    background: #999;\n                    cursor: not-allowed;\n                }\n                \n                .settings-btn.secondary {\n                    background: #666;\n                }\n                \n                .settings-btn.secondary:hover {\n                    background: #555;\n                }\n                \n                .success-message, .error-message {\n                    background: black;\n                    color: white;\n                    padding: 5px;\n                    margin-bottom: 10px;\n                    display: none;\n                    border-radius:0;\n                    position: relative;\n                    font-size:16px;\n                }\n                \n                \n                .two-columns {\n                    display: grid;\n                    grid-template-columns: 1fr 1fr;\n                    gap: 15px;\n                }\n                \n                .address-card {\n                    border: 2px solid black;\n                    padding: 15px;\n                    margin-bottom: 15px;\n                    position: relative;\n                }\n                \n                .address-card .address-header {\n                    display: flex;\n                    align-items: center;\n                    margin-bottom: 10px;\n                }\n                \n                .address-card .default-badge {\n                    background: black;\n                    color: white;\n                    padding: 2px 8px;\n                    font-size: 12px;\n                    margin-left: 15px;\n                    font-weight: bold;\n                }\n                \n                .address-card .address-info {\n                    font-size: 14px;\n                    color: #555;\n                    line-height: 1.4;\n                }\n                \n                .address-card .address-actions {\n                    margin-top: 15px;\n                    display: flex;\n                    gap: 10px;\n                    flex-wrap: wrap;\n                }\n                \n                .address-card .settings-btn {\n                    padding: 5px 12px;\n                    font-size: 12px;\n                    margin: 0;\n                }\n                \n                @media (max-width: 768px) {\n                    .two-columns {\n                        grid-template-columns: 1fr;\n                    }\n                    \n                    .address-card .address-actions {\n                        flex-direction: column;\n                    }\n                    \n                    .address-card .settings-btn {\n                        width: 100%;\n                        margin-bottom: 5px;\n                    }\n                }\n            </style>\n            \n            \x3c!-- Manifesto Section --\x3e\n            <div class="settings-section">\n                <h3>MANIFESTO USERNAME</h3>\n                <div id="manifestoMessage" class="success-message">Manifesto updated successfully!</div>\n                <div id="manifestoError" class="error-message"></div>\n                \n                <form id="manifestoForm">\n                    <div class="form-group">\n                        <label for="manifesto">Your Manifesto:</label>\n                        <input type="text" \n                               id="manifesto" \n                               name="manifesto" \n                               value="'.concat((null==i?void 0:i.manifesto)||"",'" \n                               placeholder="Enter your manifesto"\n                               maxlength="50">\n                    </div>\n                    <button type="submit" class="settings-btn save-manifesto-btn">SAVE MANIFESTO</button>\n                </form>\n            </div>\n            \n            \x3c!-- Shipping Information Section --\x3e\n            <div class="settings-section">\n                <h3>SHIPPING INFORMATION</h3>\n                <div id="shippingMessage" class="success-message">Shipping information updated successfully!</div>\n                <div id="shippingError" class="error-message"></div>\n                \n                \x3c!-- 已保存的地址列表 --\x3e\n                ').concat(null!=i&&i.shipping_addresses&&i.shipping_addresses.length>0?'\n                    <div style="margin-bottom: 25px;">\n                        <h4 style="margin-bottom: 15px; font-size: 16px;">Saved Addresses:</h4>\n                        '.concat(i.shipping_addresses.map(function(e,t){return'\n                            <div class="address-card">\n                                <div class="address-header">\n                                    <strong style="font-size: 16px;">'.concat(e.fullName,"</strong>\n                                    ").concat(e.isDefault?'<span class="default-badge">DEFAULT</span>':"",'\n                                </div>\n                                <div class="address-info">\n                                    ').concat(e.phone,"<br>\n                                    ").concat(e.address1," ").concat(e.address2||"","<br>\n                                    ").concat(e.city,", ").concat(e.state," ").concat(e.zipCode,"<br>\n                                    ").concat(e.country,'\n                                </div>\n                                <div class="address-actions">\n                                    <button class="settings-btn edit-address-btn" \n                                            data-address-index="').concat(t,'" style="background:white; border:black 2px solid;color:black; padding:0 10px; ">\n                                        EDIT\n                                    </button>\n                                    <button class="settings-btn delete-address-btn" \n                                            data-address-index="').concat(t,'"\n                                            style="background:white; border:black 2px solid; color:black; padding:0 10px;">\n                                        DELETE\n                                    </button>\n                                    ').concat(e.isDefault?"":'\n                                        <button class="settings-btn set-default-btn" \n                                                data-address-index="'.concat(t,'"\n                                                style="background:white; border:black 2px solid;color:black; padding:0 10px;">\n                                            SET AS DEFAULT\n                                        </button>\n                                    '),"\n                                </div>\n                            </div>\n                        ")}).join(""),"\n                    </div>\n                "):"",'\n                \n                \x3c!-- 添加/编辑地址表单 --\x3e\n                <div id="addressFormContainer">\n                    <h4 style="margin-bottom: 15px; font-size: 16px;">\n                        <span id="addressFormTitle">Add New Address</span>\n                    </h4>\n                    <form id="shippingForm">\n                        <input type="hidden" id="addressIndex" value="">\n                        \n                        <div class="two-columns">\n                            <div class="form-group">\n                                <label for="fullName">Full Name:</label>\n                                <input type="text" \n                                       id="fullName" \n                                       name="fullName" \n                                       value=""\n                                       required>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="phone">Phone Number:</label>\n                                <input type="tel" \n                                       id="phone" \n                                       name="phone" \n                                       value=""\n                                       required>\n                            </div>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label for="email">Email:</label>\n                            <input type="email" \n                                   id="email" \n                                   name="email" \n                                   value="').concat(a.email||"",'"\n                                   required>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label for="address1">Address Line 1:</label>\n                            <input type="text" \n                                   id="address1" \n                                   name="address1" \n                                   value=""\n                                   required>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label for="address2">Address Line 2 (Optional):</label>\n                            <input type="text" \n                                   id="address2" \n                                   name="address2" \n                                   value="">\n                        </div>\n                        \n                        <div class="two-columns">\n                            <div class="form-group">\n                                <label for="city">City:</label>\n                                <input type="text" \n                                       id="city" \n                                       name="city" \n                                       value=""\n                                       required>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="state">State/Province:</label>\n                                <input type="text" \n                                       id="state" \n                                       name="state" \n                                       value=""\n                                       required>\n                            </div>\n                        </div>\n                        \n                        <div class="two-columns">\n                            <div class="form-group">\n                                <label for="zipCode">ZIP/Postal Code:</label>\n                                <input type="text" \n                                       id="zipCode" \n                                       name="zipCode" \n                                       value=""\n                                       required>\n                            </div>\n                            \n                            <div class="form-group">\n                                <label for="country">Country:</label>\n                                <select id="country" name="country" required>\n                                    <option value="">Select Country</option>\n                                    <option value="CN">中国</option>\n                                    <option value="HK">Hong Kong</option>\n                                    <option value="TW">臺灣</option>\n                                    <option value="JP">Japan</option>\n                                    <option value="UK">United Kingdom</option>\n                                <option value="US">United States</option>\n                                <option value="OTHER">Other</option>\n                                </select>\n                            </div>\n                        </div>\n                        \n                        <div class="form-group">\n                            <label>\n                                <input type="checkbox" id="setAsDefault" name="setAsDefault">\n                                Set as default address\n                            </label>\n                        </div>\n                        \n                        <button type="submit" class="settings-btn save-shipping-btn">SAVE ADDRESS</button>\n                        <button type="button" class="settings-btn secondary cancel-edit-btn" style="display: none;">CANCEL</button>\n                    </form>\n                </div>\n            </div>\n            \n            \x3c!-- Change Password Section --\x3e\n            <div class="settings-section">\n                <h3>CHANGE PASSWORD</h3>\n                <div id="passwordMessage" class="success-message">Password updated successfully!</div>\n                <div id="passwordError" class="error-message"></div>\n                \n                <form id="passwordForm">\n                    <div class="form-group">\n                        <label for="currentPassword">Current Password:</label>\n                        <input type="password" \n                               id="currentPassword" \n                               name="currentPassword" \n                               placeholder="Enter current password"\n                               required>\n                    </div>\n                    \n                    <div class="form-group">\n                        <label for="newPassword">New Password:</label>\n                        <input type="password" \n                               id="newPassword" \n                               name="newPassword" \n                               placeholder="Enter new password"\n                               minlength="6"\n                               required>\n                    </div>\n                    \n                    <div class="form-group">\n                        <label for="confirmPassword">Confirm New Password:</label>\n                        <input type="password" \n                               id="confirmPassword" \n                               name="confirmPassword" \n                               placeholder="Confirm new password"\n                               minlength="6"\n                               required>\n                    </div>\n                    \n                    <button type="submit" class="settings-btn change-password-btn">CHANGE PASSWORD</button>\n                </form>\n            </div>\n            \n            \x3c!-- Account Info Section --\x3e\n            <div class="settings-section">\n                <h3>ACCOUNT INFORMATION</h3>\n                <div style="line-height: 1.6;">\n                    <p><strong>Email:</strong> ').concat(a.email,"</p>\n                    <p><strong>User ID:</strong> ").concat(a.id,"</p>\n                    <p><strong>Account Created:</strong> ").concat(new Date(a.created_at).toLocaleDateString(),"</p>\n                </div>\n            </div>\n        "),U(),e.n=6;break;case 5:e.p=5,e.v,t.innerHTML='<p style="text-align: center; padding: 20px; color: red;">Error loading settings. Please try again.</p>';case 6:return e.a(2)}},e,null,[[1,5]])}))).apply(this,arguments)}function U(){var e=document.getElementById("manifestoForm");e&&e.addEventListener("submit",function(){var e=l(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:return t.preventDefault(),e.n=1,R();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());var t=document.getElementById("shippingForm");t&&t.addEventListener("submit",function(){var e=l(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:return t.preventDefault(),e.n=1,G();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}());var n=document.getElementById("passwordForm");n&&n.addEventListener("submit",function(){var e=l(o().m(function e(t){return o().w(function(e){for(;;)switch(e.n){case 0:return t.preventDefault(),e.n=1,X();case 1:return e.a(2)}},e)}));return function(t){return e.apply(this,arguments)}}()),document.querySelectorAll(".edit-address-btn").forEach(function(e){e.addEventListener("click",function(e){!function(e){var t=(window.currentAddresses||[])[e];if(!t)return;document.getElementById("addressIndex").value=e,document.getElementById("fullName").value=t.fullName||"",document.getElementById("phone").value=t.phone||"",document.getElementById("email").value=t.email||"",document.getElementById("address1").value=t.address1||"",document.getElementById("address2").value=t.address2||"",document.getElementById("city").value=t.city||"",document.getElementById("state").value=t.state||"",document.getElementById("zipCode").value=t.zipCode||"",document.getElementById("country").value=t.country||"",document.getElementById("setAsDefault").checked=t.isDefault||!1,document.getElementById("addressFormTitle").textContent="Edit Address",document.querySelector(".save-shipping-btn").textContent="UPDATE ADDRESS",document.querySelector(".cancel-edit-btn").style.display="inline-block",document.getElementById("addressFormContainer").scrollIntoView({behavior:"smooth",block:"start"})}(parseInt(e.target.dataset.addressIndex))})}),document.querySelectorAll(".delete-address-btn").forEach(function(e){e.addEventListener("click",function(e){!function(e){K.apply(this,arguments)}(parseInt(e.target.dataset.addressIndex))})}),document.querySelectorAll(".set-default-btn").forEach(function(e){e.addEventListener("click",function(e){!function(e){W.apply(this,arguments)}(parseInt(e.target.dataset.addressIndex))})});var a=document.querySelector(".cancel-edit-btn");a&&a.addEventListener("click",function(){!function(){document.getElementById("shippingForm").reset(),document.getElementById("addressIndex").value="",document.getElementById("addressFormTitle").textContent="Add New Address",document.querySelector(".cancel-edit-btn").style.display="none";var e=supabase.auth.getUser().data.user;e&&(document.getElementById("email").value=e.email||"")}()})}function R(){return H.apply(this,arguments)}function H(){return(H=l(o().m(function e(){var t,n,a,r,i,s,d,c;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("manifesto").value.trim(),n=document.getElementById("manifestoMessage"),a=document.getElementById("manifestoError"),r=document.querySelector(".save-manifesto-btn"),n.style.display="none",a.style.display="none",t){e.n=1;break}return a.textContent="Manifesto name cannot be empty",a.style.display="block",e.a(2);case 1:return r.disabled=!0,r.textContent="SAVING...",e.p=2,e.n=3,supabase.auth.getUser();case 3:return i=e.v,s=i.data.user,e.n=4,supabase.from("profiles").update({manifesto:t}).eq("user_id",s.id);case 4:if(d=e.v,!(c=d.error)){e.n=5;break}throw c;case 5:if(n.style.display="block","function"!=typeof displayUserProfile){e.n=6;break}return e.n=6,displayUserProfile();case 6:setTimeout(function(){n.style.display="none"},3e3),e.n=8;break;case 7:e.p=7,e.v,a.textContent="Failed to update manifesto. Please try again.",a.style.display="block";case 8:return e.p=8,r.disabled=!1,r.textContent="SAVE MANIFESTO",e.f(8);case 9:return e.a(2)}},e,null,[[2,7,8,9]])}))).apply(this,arguments)}function G(){return V.apply(this,arguments)}function V(){return(V=l(o().m(function e(){var t,n,r,i,s,d,c,l,u,p,f,g,m,b;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=document.getElementById("shippingForm"),n=new FormData(t),r=document.getElementById("shippingMessage"),i=document.getElementById("shippingError"),s=document.querySelector(".save-shipping-btn"),d=document.getElementById("addressIndex").value,r.style.display="none",i.style.display="none",c={fullName:n.get("fullName"),phone:n.get("phone"),email:n.get("email"),address1:n.get("address1"),address2:n.get("address2")||"",city:n.get("city"),state:n.get("state"),zipCode:n.get("zipCode"),country:n.get("country"),isDefault:"on"===n.get("setAsDefault")},s.disabled=!0,s.textContent="SAVING...",e.p=1,e.n=2,supabase.auth.getUser();case 2:return l=e.v,u=l.data.user,e.n=3,supabase.from("profiles").select("shipping_addresses").eq("user_id",u.id).single();case 3:return p=e.v,f=p.data,g=(null==f?void 0:f.shipping_addresses)||[],c.isDefault&&(g=g.map(function(e){return a(a({},e),{},{isDefault:!1})})),""!==d?g[parseInt(d)]=c:(0===g.length&&(c.isDefault=!0),g.push(c)),e.n=4,supabase.from("profiles").update({shipping_addresses:g}).eq("user_id",u.id);case 4:if(m=e.v,!(b=m.error)){e.n=5;break}throw b;case 5:r.style.display="block",setTimeout(function(){r.style.display="none",j()},2e3),e.n=7;break;case 6:e.p=6,e.v,i.textContent="Failed to update shipping information. Please try again.",i.style.display="block";case 7:return e.p=7,s.disabled=!1,s.textContent="SAVE ADDRESS",e.f(7);case 8:return e.a(2)}},e,null,[[1,6,7,8]])}))).apply(this,arguments)}function K(){return(K=l(o().m(function e(t){var n,a,r,i,s,d,c,l,u,p;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(confirm("Are you sure you want to delete this address?")){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,supabase.auth.getUser();case 2:return n=e.v,a=n.data.user,e.n=3,supabase.from("profiles").select("shipping_addresses").eq("user_id",a.id).single();case 3:return r=e.v,i=r.data,s=(null==i?void 0:i.shipping_addresses)||[],d=s[t],s.splice(t,1),null!=d&&d.isDefault&&s.length>0&&(s[0].isDefault=!0),e.n=4,supabase.from("profiles").update({shipping_addresses:s}).eq("user_id",a.id);case 4:if(c=e.v,!(l=c.error)){e.n=5;break}throw l;case 5:(u=document.getElementById("shippingMessage")).textContent="Address deleted successfully!",u.style.display="block",setTimeout(function(){u.style.display="none",j()},2e3),e.n=7;break;case 6:e.p=6,e.v,(p=document.getElementById("shippingError")).textContent="Failed to delete address. Please try again.",p.style.display="block",setTimeout(function(){p.style.display="none"},5e3);case 7:return e.a(2)}},e,null,[[1,6]])}))).apply(this,arguments)}function W(){return(W=l(o().m(function e(t){var n,r,i,s,d,c,l,u,p;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,supabase.auth.getUser();case 1:return n=e.v,r=n.data.user,e.n=2,supabase.from("profiles").select("shipping_addresses").eq("user_id",r.id).single();case 2:if(i=e.v,s=i.data,(d=(null==s?void 0:s.shipping_addresses)||[])[t]){e.n=3;break}throw new Error("Address not found");case 3:return d=d.map(function(e,n){return a(a({},e),{},{isDefault:n===t})}),e.n=4,supabase.from("profiles").update({shipping_addresses:d}).eq("user_id",r.id);case 4:if(c=e.v,!(l=c.error)){e.n=5;break}throw l;case 5:(u=document.getElementById("shippingMessage")).textContent="Default address updated successfully!",u.style.display="block",setTimeout(function(){u.style.display="none",j()},2e3),e.n=7;break;case 6:e.p=6,e.v,(p=document.getElementById("shippingError")).textContent="Failed to set default address. Please try again.",p.style.display="block",setTimeout(function(){p.style.display="none"},5e3);case 7:return e.a(2)}},e,null,[[0,6]])}))).apply(this,arguments)}function X(){return Y.apply(this,arguments)}function Y(){return(Y=l(o().m(function e(){var t,n,a,r,i,s,d,c,l,u,p;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("currentPassword").value,n=document.getElementById("newPassword").value,a=document.getElementById("confirmPassword").value,r=document.getElementById("passwordMessage"),i=document.getElementById("passwordError"),s=document.querySelector(".change-password-btn"),r.style.display="none",i.style.display="none",n===a){e.n=1;break}return i.textContent="New passwords do not match",i.style.display="block",e.a(2);case 1:if(!(n.length<6)){e.n=2;break}return i.textContent="Password must be at least 6 characters",i.style.display="block",e.a(2);case 2:if(t!==n){e.n=3;break}return i.textContent="New password must be different from current password",i.style.display="block",e.a(2);case 3:return s.disabled=!0,s.textContent="UPDATING...",e.p=4,d=supabase.auth.updateUser({password:n}),c=new Promise(function(e,t){return setTimeout(function(){return t(new Error("Request timeout"))},1e4)}),e.n=5,Promise.race([d,c]);case 5:if(l=e.v,!(u=l.error)){e.n=6;break}throw u;case 6:r.style.display="block",document.getElementById("currentPassword").value="",document.getElementById("newPassword").value="",document.getElementById("confirmPassword").value="",setTimeout(function(){r.style.display="none"},5e3),e.n=8;break;case 7:e.p=7,p=e.v,i.textContent="Request timeout"===p.message?"Request timed out. Please check your connection and try again.":p.message||"Failed to update password. Please try again.",i.style.display="block";case 8:return e.p=8,s.disabled=!1,s.textContent="CHANGE PASSWORD",e.f(8);case 9:return e.a(2)}},e,null,[[4,7,8,9]])}))).apply(this,arguments)}window.confirmPayment=l(o().m(function e(){var t,n,a,r,i,s,d,c,l,u,p,f,g,m;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,B.call(this);case 1:return window.dispatchEvent(new CustomEvent("orderSubmitted",{detail:{orderId:null===(t=window.currentOrder)||void 0===t?void 0:t.orderId}})),e.p=2,e.n=3,supabase.auth.getUser();case 3:if(n=e.v,a=n.data.user,!n.error&&a){e.n=4;break}return alert("Please login to complete payment"),e.a(2);case 4:return e.n=5,getCartItems();case 5:return r=e.v,i=generateOrderId(),s=calculateSubtotal(r),d=calculateShipping(),c=calculateTax(s),l=r.map(function(e){return{draft_id:e.draft_id,size:e.size,quantity:e.quantity,price:e.price,title:e.title||"Custom Design"}}),u={order_id:i,user_id:a.id,items:l,status:"awaiting_verification",amount:s,shipping_cost:d,tax_amount:c,payment_method:window.selectedPaymentMethod||"pending",shipping_address:window.shippingAddress||{},manifesto:window.currentManifesto||null,created_at:(new Date).toISOString(),paid_at:(new Date).toISOString()},e.n=6,supabase.from("orders").insert([u]).select().single();case 6:if(p=e.v,f=p.data,!p.error){e.n=7;break}return alert("Failed to create order"),e.a(2);case 7:return e.n=8,saveDraftImagesToOrderStorage(f.order_id,l);case 8:if(!((g=e.v)&&g.length>0)){e.n=10;break}return e.n=9,supabase.from("orders").update({saved_images:g}).eq("order_id",f.order_id);case 9:m=e.v,m.error;case 10:return e.n=11,clearCart();case 11:return showPaymentSuccessModal(f.order_id),window.dispatchEvent(new CustomEvent("orderSubmitted",{detail:{orderId:f.order_id}})),window.currentOrder={orderId:f.order_id},e.a(2,f);case 12:return e.p=12,e.v,alert("Payment processing failed. Please try again."),e.a(2,null)}},e,this,[[2,12]])}))})();