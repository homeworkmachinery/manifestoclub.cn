/*! For license information please see global.674b31da26dd4b84759a.js.LICENSE.txt */
(()=>{var e,t,n,a={2238:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t,n,a){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var r=a.call(t,n||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}!function(e){"use strict";window.BOOKS_DATA||(window.BOOKS_DATA=(t(t(t(t(t(t(t(t(t(t(e={9787565728778:{id:"9787565728778",title:"版权战争",imgSrc:"/images/books/9787565728778.jpg",author:"[美] 彼得·鲍德温",translator:"王志刚",publisher:"中国传媒大学出版社",publishDate:"2022-3",pages:435,category:"law"},9787544485418:{id:"9787544485418",title:"印刷中的革命",imgSrc:"/images/books/9787544485418.jpg",author:"[美]罗伯特·达恩顿 / [法]丹尼尔·罗什",publisher:"上海教育出版社",publishDate:"2022-11",pages:424,category:"law"},9787503655784:{id:"9787503655784",title:"知识产权法关键词",imgSrc:"/images/books/9787503655784.jpg",author:"李琛",publisher:"法律出版社",publishDate:"2006-6",pages:271,category:"law"},9787301143926:{id:"9787301143926",title:"著作权之道——从印刷机到数字云",imgSrc:"/images/books/9787301143926.jpg",author:"Paul Goldstein",publisher:"北京大学出版社",publishDate:"2008-11-01",pages:252,category:"law"},9787800119231:{id:"9787800119231",title:"信息封建主义",imgSrc:"/images/books/9787800119231.jpg",author:"Peter Drahos / John Braithwaite",publisher:"知识产权出版社",publishDate:"2005-9",pages:282,category:"law"},9787513096225:{id:"9787513096225",title:"知识共享许可协议适用指南",imgSrc:"/images/books/9787513096225.jpg",author:"中国科协学会服务中心",publisher:" 知识产权出版社",publishDate:"2008-11-01",pages:220,category:"law"},9787508601250:{id:"9787508601250",title:"思想的未来:网络时代公共知识领域的警世喻言",imgSrc:"/images/books/9787508601250.jpg",author:"[美] 劳伦斯·莱斯格",publisher:"中信出版社",publishDate:"2004-9",pages:277,category:"law"},9787508615882:{id:"9787508615882",title:"免费文化:创意产业的未来",imgSrc:"/images/books/9787508615882.jpg",author:"[美] 劳伦斯·莱斯格",publisher:"中信出版社",publishDate:"2009-10",pages:252,category:"law"},9787508600529:{id:"9787508600529",title:"代码:塑造网络空间的法律",imgSrc:"/images/books/9787508600529.jpg",author:"[美] 劳伦斯·莱斯格",publisher:"中信出版社",publishDate:"2004-10-1",pages:297,category:"law"},9787300264684:{id:"9787300264684",title:"知识产权法教程（第六版）",imgSrc:"/images/books/9787300264684.jpg",author:"王迁",publisher:"中国人民大学出版社",publishDate:"2019-1-1",pages:567,category:"law"},9787301328569:{id:"9787301328569",title:"知识产权法学（第八版）",imgSrc:"/images/books/9787301328569.jpg",author:"吴汉东 / 等",publisher:"北京大学出版社",publishDate:"2022-3",pages:548,category:"law"},9787513079990:{id:"9787513079990",title:"商标审查审理指南",imgSrc:"/images/books/9787513079990.jpg",author:"国家知识产权局",publisher:"知识产权出版社",publishDate:"2021",pages:428,category:"law"},9787802475465:{id:"9787802475465",title:"专利审查指南",imgSrc:"/images/books/9787802475465.jpg",author:"国家知识产权局",publisher:"知识产权出版社",publishDate:"2010-1",pages:578,category:"law"},9787519758868:{id:"9787519758868",title:"商标法：原理与判例",imgSrc:"/images/books/9787519758868.jpg",author:"孔祥俊",publisher:"法律出版社",publishDate:"2021-12-1",pages:155100,category:"law"},9787301248355:{id:"9787301248355",title:"著作权法",imgSrc:"/images/books/9787301248355.jpg",author:"崔国斌",publisher:"北京大学出版社",publishDate:"2014-9-1",pages:914,category:"law"},9787301241172:{id:"9787301241172",title:"侵犯著作权犯罪典型案例评析",imgSrc:"/images/books/9787301241172.jpg",author:"张远煌 、 左坚卫 、王志祥 编",publisher:"北京大学出版社",publishDate:"2014-05",pages:343,category:"law"},9787301087220:{id:"9787301087220",title:"论知识产权法的体系化",imgSrc:"/images/books/9787301087220.jpg",author:"李琛",publisher:"北京大学出版社",publishDate:"2005-3",pages:191,category:"law"},9787503671678:{id:"9787503671678",title:"作品精神权利论",imgSrc:"/images/books/9787503671678.jpg",author:"杨延超",publisher:"法律出版社",publishDate:"2007-4",pages:403,category:"law"},9787503686764:{id:"9787503686764",title:"知识产权资本化",imgSrc:"/images/books/9787503686764.jpg",author:"杨延超",publisher:"法律出版社",publishDate:"2008",pages:419,category:"law"},9787519727772:{id:"9787519727772",title:"机器人法",imgSrc:"/images/books/9787519727772.jpg",author:"杨延超",publisher:"法律出版社",publishDate:"2019-3-1",pages:419,category:"law"},9787513051934:{id:"9787513051934",title:"版权战争",imgSrc:"/images/books/9787513051934.jpg",author:"杨延超",publisher:"知识产权出版社",publishDate:"2017-10-30",pages:300,category:"law"},9787511814999:{id:"9787511814999",title:"网络环境中的著作权保护研究",imgSrc:"/images/books/9787511814999.jpg",author:"王迁",publisher:"法律出版社",publishDate:"2011-3",pages:462,category:"law"},9787519759858:{id:"9787519759858",title:"音乐版权",imgSrc:"/images/books/9787519759858.jpg",author:"吴登华",publisher:"法律出版社",publishDate:"2022-1",pages:98,category:"law"},9787511835802:{id:"9787511835802",title:"美国版权法与音乐产业",imgSrc:"/images/books/9787511835802.jpg",author:"黄虚峰",publisher:"法律出版社",publishDate:"2012-7",pages:240,category:"law"},9787511860965:{id:"9787511860965",title:"美国知识产权法(第2版)",imgSrc:"/images/books/9787511860965.jpg",author:"李明德",publisher:"法律出版社",publishDate:"2014-4-1",pages:1003,category:"law"},9787530633991:{id:"9787530633991",title:"中国商标史话",imgSrc:"/images/books/9787530633991.jpg",author:"左旭初",publisher:"百花文艺出版社",publishDate:"2002-05-01",pages:444,category:"law"},9787562028666:{id:"9787562028666",title:"互联网上的不正当竞争和商标",imgSrc:"/images/books/9787562028666.jpg",author:"马特斯尔斯·W·斯达切尔",publisher:"中国政法大学出版社",publishDate:"2004-12",pages:324,category:"law"},9787565304101:{id:"9787565304101",title:"互联网域名与商标冲突研究",imgSrc:"/images/books/9787565304101.jpg",author:"蒋剑鸣",publisher:"中国人民公安大学出版社",publishDate:"2011-4",pages:256,category:"law"},9787100107129:{id:"9787100107129",title:"软件与互联网法（上册）",imgSrc:"/images/books/9787100107129.jpg",author:"[美]马克·A.莱姆利",translator:"张韬略",publisher:"商务印书馆",publishDate:"2014-10-1",pages:510,category:"law"},9787100129275:{id:"9787100129275",title:"软件与互联网法(下共2册)",imgSrc:"/images/books/9787100129275.jpg",author:"[美]马克·A.莱姆利",translator:"张韬略",publisher:"商务印书馆",publishDate:"2017-4",pages:1473,category:"law"},9787509387610:{id:"9787509387610",title:"网络游戏知识产权司法保护",imgSrc:"/images/books/9787509387610.jpg",author:"孙磊 / 曹丽萍",publisher:"中国法制出版社",publishDate:"2017-9",pages:354,category:"law"},9787511817396:{id:"9787511817396",title:"对撼法律",imgSrc:"/images/books/9787511817396.jpg",author:"斯坦·苏克",publisher:"法律出版社",publishDate:"2011-4",pages:223,category:"law"},9787100106382:{id:"9787100106382",title:"娱乐法",imgSrc:"/images/books/9787100106382.jpg",author:"宋海燕",publisher:"商务印书馆",publishDate:"2014-9",pages:321,category:"law"},9787519749491:{id:"9787519749491",title:"中国娱乐法案例评注",imgSrc:"/images/books/9787519749491.jpg",author:"孔祥俊 / 谢兰芳",publisher:"法律出版社",publishDate:"2020-11",pages:414,category:"law"},9787514617283:{id:"9787514617283",title:"科幻编年史",imgSrc:"/images/books/9787514617283.jpg",author:"[英]盖伊·哈雷（Guy Haley） / 盖伊·哈雷",publisher:"中信出版社",publishDate:"2019-6",pages:560,category:"culture"},9787508657196:{id:"9787508657196",title:"摇滚编年史",imgSrc:"/images/books/9787508657196.jpg",author:"[英] 戴维·罗伯茨 / David Roberts",publisher:"中信出版社",publishDate:"2016-4",pages:576,category:"culture"},9780525573883:{id:"9780525573883",title:"Contact High",imgSrc:"/images/books/9780525573883.jpg",author:"Vikki Tobak",publisher:"Crown Publishing Group",publishDate:"2018-10-16",pages:288,category:"culture"},9787100185684:{id:"9787100185684",title:"爵士乐史",imgSrc:"/images/books/9787100185684.png",author:"[美]泰德·乔亚（Ted Gioia）",publisher:"雅众文化",publishDate:"2020-9",pages:680,category:"culture"},9787565842733:{id:"9787565842733",title:"摇滚乐风格",imgSrc:"/images/books/9787565842733.jpg",author:"[美] 凯瑟琳·查尔顿",publisher:"鹭江出版社",publishDate:"2021-8",pages:513,category:"culture"},9787511720474:{id:"9787511720474",title:"流行音乐史上最著名的120次死亡",imgSrc:"/images/books/9787511720474.jpg",author:"[英] 罗伯特·迪默里 / [英] 布鲁诺·麦克唐纳",publisher:"中央编译出版社",publishDate:"2014-3-1",pages:256,category:"culture"},9787552030624:{id:"9787552030624",title:"别再问我什么是嘻哈①",imgSrc:"/images/books/9787552030624.jpg",author:"长谷川町藏 / 大和田俊之",publisher:"上海社会科学院出版社",publishDate:"2020-6",pages:316,category:"culture"},9787545914801:{id:"9787545914801",title:"ROCK CONNEXTIONS",imgSrc:"/images/books/9787545914801.jpg",author:"[英] 布鲁诺·麦克唐纳",publisher:"鹭江出版社",publishDate:"2018-7",pages:288,category:"culture"},"1001-563":{id:"1001-563",title:"共产党宣言",imgSrc:"/images/books/1001-563.png",author:"[德国] 卡尔·马克思",publisher:"人民出版社",publishDate:"1963-4",pages:86,category:"culture"},"3056-26":{id:"3056-26",title:"祸国殃民的“四人帮”",imgSrc:"/images/books/3056-26.jpg",author:"北京有线电厂工人理论组",publisher:"中国少年儿童出版社",publishDate:"1977-5",pages:136,category:"culture"},9787513931854:{id:"9787513931854",title:"法国大革命思想史",imgSrc:"/images/books/9787513931854.jpg",author:"[英] 乔纳森·伊斯雷尔",publisher:"民主与建设出版社",publishDate:"2020-11",pages:816,category:"culture"},9787111452478:{id:"9787111452478",title:"大教堂与集市",imgSrc:"/images/books/9787111452478.jpg",author:"[美] Eric S. Raymond",translator:"卫剑钒",publisher:"机械工业出版社",publishDate:"2014-5",pages:194,category:"culture"},9787115349002:{id:"9787115349002",title:"算法帝国",imgSrc:"/images/books/9787115349002.jpg",author:"人民邮电出版社",publishDate:"2014-6",pages:232,category:"culture"},9787508652085:{id:"9787508652085",title:"免费:商业的未来",imgSrc:"/images/books/9787508652085.png",author:"[美] Chris Anderson",publisher:"中信出版社",publishDate:"2015-10-1",pages:352,category:"culture"},9787532132454:{id:"9787532132454",title:"做",imgSrc:"/images/books/9787532132454.jpg",author:"汉斯·乌尔里希·奥布里斯特（编） / 胡昉（编）",publisher:"上海文艺出版社",publishDate:"2007-11",pages:361,category:"culture"},9787513319133:{id:"9787513319133",title:"各种“主义”",imgSrc:"/images/books/9787513319133.jpg",author:"约翰·安德鲁斯",publisher:"新星出版社",publishDate:"2015-10",pages:235,category:"culture"},9787551421874:{id:"9787551421874",title:"行为表演艺术：从未来主义至当下",imgSrc:"/images/books/9787551421874.jpg",author:"[美]罗斯莉·格特伯格",publisher:"浙江摄影出版社",publishDate:"2018-6-1",pages:320,category:"culture"},9787544527682:{id:"9787544527682",title:"荣格文集",imgSrc:"/images/books/9787544527682.jpg",author:"[瑞士] 卡尔·荣格",publisher:"长春出版社",publishDate:"2014-1-1",pages:2532,category:"culture"},9787544779852:{id:"9787544779852",title:"炼金术之梦",imgSrc:"/images/books/9787544779852.jpg",author:"[瑞士] 卡尔·荣格",publisher:"译林出版社",publishDate:"2019-11",pages:278,category:"culture"},9787544761987:{id:"9787544761987",title:"哲学树",imgSrc:"/images/books/9787544761987.jpg",author:"[瑞士] 卡尔·荣格",publisher:"译林出版社",publishDate:"2019-4",pages:145,category:"culture"},9787544773355:{id:"9787544773355",title:"伊雍：自性现象学研究",imgSrc:"/images/books/9787544773355.jpg",author:"[瑞士] 卡尔·荣格",publisher:"译林出版社",publishDate:"2018-04",pages:378,category:"culture"},9787544781824:{id:"9787544781824",title:"心理学与炼金术",imgSrc:"/images/books/9787544781824.jpg",author:"[瑞士] 卡尔·荣格",publisher:"译林出版社",publishDate:"2020-07",pages:385,category:"culture"}},"9787544779852",{id:"9787544779852",title:"炼金术之梦",imgSrc:"/images/books/9787544779852.jpg",author:"[瑞士] 卡尔·荣格",publisher:"译林出版社",publishDate:"2019-11",pages:278,category:"culture"}),"9787544779845",{id:"9787544779845",title:"移情心理学",imgSrc:"/images/books/9787544779845.jpg",author:"[瑞士] 卡尔·荣格",publisher:"译林出版社",publishDate:"2019-11",pages:219,category:"culture"}),"9787511738776",{id:"9787511738776",title:"金花的秘密",imgSrc:"/images/books/9787511738776.jpg",author:"[德] 卫礼贤 / [瑞士] 荣格",publisher:"中央编译出版社",publishDate:"2020-11",pages:163,category:"culture"}),"9787544779333",{id:"9787544779333",title:"东方的智慧",imgSrc:"/images/books/9787544779333.jpg",author:"[瑞士] 卡尔·荣格",publisher:"译林出版社",publishDate:"2019-08",pages:183,category:"culture"}),"9787100214070",{id:"9787100214070",title:"化学婚仪",imgSrc:"/images/books/9787100214070.jpg",author:"[德]安德里亚",publisher:"商务印书馆",publishDate:"2022-12",pages:236,category:"culture"}),"9787108063632",{id:"9787108063632",title:"纽伦堡审判与罗夏墨迹测验",imgSrc:"/images/books/9787108063632.jpg",author:"[美] 乔尔·迪姆斯代尔",publisher:"生活·读书·新知三联书店",publishDate:"2019-4",pages:291,category:"culture"}),"9787115534897",{id:"9787115534897",title:"从巴甫洛夫的狗到罗夏墨迹测验",imgSrc:"/images/books/9787115534897.jpg",author:"[美] 迈克尔·A.布里特（Michael A. Britt）",publisher:"人民邮电出版社",publishDate:"2020-4",pages:243,category:"culture"}),"9787513352109",{id:"9787513352109",title:"早期中国的鬼",imgSrc:"/images/books/9787513352109.jpg",author:"蒲慕州",publisher:"新星出版社",publishDate:"2023-5",pages:252,category:"culture"}),"9787520125154",{id:"9787520125154",title:"左道",imgSrc:"/images/books/9787520125154.jpg",author:"[美]万志英（Richard von Glahn）",publisher:"社会科学文献出版社",publishDate:"2018-8",pages:440,category:"culture"}),"9787805631295",{id:"9787805631295",title:"寺院 宫观 神佛",imgSrc:"/images/books/9787805631295.jpg",author:"张映勤",publisher:"天津社会科学院出版社",publishDate:"1991-11",pages:225,category:"culture"}),t(t(t(t(t(t(t(t(t(t(e,"9787208005310",{id:"9787208005310",title:"中国古代算命术",imgSrc:"/images/books/9787208005310.jpg",author:"姜玉珍 / 洪丕谟",publisher:"上海人民出版社",publishDate:"1990-12",pages:327,category:"culture"}),"9787801232885",{id:"9787801232885",title:"天主教知识读本",imgSrc:"/images/books/9787801232885.jpg",author:"任延黎",publisher:"宗教文化出版社",publishDate:"2000-1",pages:133,category:"culture"}),"9787108038265",{id:"9787108038265",title:"神话与传说",imgSrc:"/images/books/9787108038265.jpg",author:"[英] 菲利普·威尔金森",publisher:"生活·读书·新知三联书店",publishDate:"2012-5",pages:348,category:"culture"}),"9787513937931",{id:"9787513937931",title:"魔法四万年",imgSrc:"/images/books/9787513937931.jpg",author:"[英] 克里斯·戈斯登",publisher:"民主与建设出版社",publishDate:"2022-9",pages:424,category:"culture"}),"9787505752900",{id:"9787505752900",title:"恶魔幻影志",imgSrc:"/images/books/9787505752900.jpg",author:"[日]涩泽龙彦",publisher:"中国友谊出版公司",publishDate:"2021-10",pages:184,category:"culture"}),"9787559828934",{id:"9787559828934",title:"黑魔法手帖",imgSrc:"/images/books/9787559828934.jpg",author:"[日]涩泽龙彦",publisher:"广西师范大学出版社",publishDate:"2020-7",pages:240,category:"culture"}),"9787561360064",{id:"9787561360064",title:"超古代文明",imgSrc:"/images/books/9787561360064.jpg",author:"古代文明研究会",publisher:"陕西师范大学出版社",publishDate:"2012-5",pages:372,category:"culture"}),"9787561363959",{id:"9787561363959",title:"超宇宙文明",imgSrc:"/images/books/9787561363959.jpg",author:"深泽久夫",publisher:"陕西师范大学出版社",publishDate:"2012-8",pages:269,category:"culture"}),"9787561363966",{id:"9787561363966",title:"超古代文物",imgSrc:"/images/books/9787561363966.jpg",author:"并木伸一郎",publisher:"陕西师范大学出版社",publishDate:"2012-8",pages:264,category:"culture"}),"9787561369203",{id:"9787561369203",title:"不可思议的世界之谜TOP100",imgSrc:"/images/books/9787561369203.jpg",author:"日本探索历史之谜会",publisher:"陕西师范大学出版社",publishDate:"2013-4",pages:243,category:"culture"}),t(t(t(t(t(t(t(t(t(t(e,"13214-55",{id:"13214-55",title:"西方伪科学种种",imgSrc:"/images/books/13214-55.jpg",author:"[美] 马丁·加德纳",publisher:"知识出版社",publishDate:"1984",pages:359,category:"culture"}),"9787213027321",{id:"9787213027321",title:"魔法时刻",imgSrc:"/images/books/9787213027321.jpg",author:"乔治·夏尔帕克 / 亨利·布洛什",publisher:"浙江人民出版社",publishDate:"2004-1-1",pages:200,category:"culture"}),"9787542407177",{id:"9787542407177",title:"科学与超自然现象",imgSrc:"/images/books/9787542407177.jpg",author:"[法] 布雷",publisher:"甘肃科学技术出版社",publishDate:"2000-8",pages:319,category:"culture"}),"9787550212893",{id:"9787550212893",title:"超自然现象全揭秘",imgSrc:"/images/books/9787550212893.jpg",author:"柳青",publisher:"北京联合出版公司",publishDate:"2013-3",pages:287,category:"culture"}),"9787544302845",{id:"9787544302845",title:"高人兰迪",imgSrc:"/images/books/9787544302845.jpg",author:"兰迪",publisher:"海南出版社",publishDate:"2001-12-1",pages:286,category:"culture"}),"9787802288935",{id:"9787802288935",title:"全球100超自然之谜",imgSrc:"/images/books/9787802288935.jpg",author:"[美] 史蒂芬·J·斯皮格纳斯",publisher:"新世界出版社",publishDate:"2008-09",pages:362,category:"culture"}),"9787805928180",{id:"9787805928180",title:"在对错之外思考",imgSrc:"/images/books/9787805928180.jpg",author:"[英] 爱德华·德·波诺",publisher:"广州出版社",publishDate:"1998",pages:152,category:"culture"}),"9787535777485",{id:"9787535777485",title:"浩瀚的宇宙",imgSrc:"/images/books/9787535777485.jpg",author:"马特·特维德",publisher:"湖南科学技术出版社",publishDate:"2013-8-1",pages:72,category:"culture"}),"9787535789808",{id:"9787535789808",title:"纺织",imgSrc:"/images/books/9787535789808.jpg",author:"克里斯蒂安•马汀",publisher:"湖南科学技术出版社",publishDate:"2016-11-1",pages:57,category:"culture"}),"9787535789792",{id:"9787535789792",title:"神奇的树",imgSrc:"/images/books/9787535789792.jpg",author:"奥拉维•胡达瑞",publisher:"湖南科学技术出版社",publishDate:"2016-11-1",pages:61,category:"culture"}),t(t(t(t(t(t(t(t(t(t(e,"9787535739643",{id:"9787535739643",title:"一生受用的公式",imgSrc:"/images/books/9787535739643.jpg",author:"M·沃特金斯 / M·特威德",publisher:"湖南科学技术出版社",publishDate:"2004-5-1",pages:61,category:"culture"}),"9787535769244",{id:"9787535769244",title:"数学证明之美",imgSrc:"/images/books/9787535769244.jpg",author:"博卡德·波斯特",publisher:"湖南科学技术出版社",publishDate:"2012-1",pages:61,category:"culture"}),"9787535769213",{id:"9787535769213",title:"几何天才的杰作",imgSrc:"/images/books/9787535769213.jpg",author:"[英] 道尔德·萨顿",publisher:"湖南科学技术出版社",publishDate:"2012-1",pages:58,category:"culture"}),"9787535769251",{id:"9787535769251",title:"透视与错觉",imgSrc:"/images/books/9787535769251.jpg",author:"佛比·麦克劳顿",publisher:"湖南科学技术出版社",publishDate:"2012-1-1",pages:58,category:"culture"}),"9787535769237",{id:"9787535769237",title:"神圣的数",imgSrc:"/images/books/9787535769237.jpg",author:"米兰达·伦迪",publisher:"湖南科学技术出版社",publishDate:"2012-1-1",pages:58,category:"culture"}),"9787535792914",{id:"9787535792914",title:"创世神话",imgSrc:"/images/books/9787535792914.jpg",author:"[英]格拉德·切谢尔",publisher:"湖南科学技术出版社",publishDate:"2017-8",pages:61,category:"culture"}),"9787535792921",{id:"9787535792921",title:"龙图腾",imgSrc:"/images/books/9787535792921.jpg",author:"[美] 乔伊斯·哈格里弗",publisher:"湖南科学技术出版社",publishDate:"2017-8",pages:65,category:"culture"}),"9787535789815",{id:"9787535789815",title:"我是谁",imgSrc:"/images/books/9787535789815.jpg",author:"奥拉维·胡达瑞",publisher:"湖南科学技术出版社",publishDate:"2016-11",pages:61,category:"culture"}),"9787535769268",{id:"9787535769268",title:"谐振仪",imgSrc:"/images/books/9787535769268.jpg",author:"安东尼·艾希顿",publisher:"湖南科学技术出版社",publishDate:"2012-1",pages:58,category:"culture"}),"9787535777478",{id:"9787535777478",title:"超越感官的探测术",imgSrc:"/images/books/9787535777478.jpg",author:"哈米斯·米勒",publisher:"湖南科学技术出版社",publishDate:"2013-9-5",pages:72,category:"culture"}),t(t(t(t(t(t(t(t(t(t(e,"9787535777461",{id:"9787535777461",title:"巨石阵",imgSrc:"/images/books/9787535777461.jpg",author:"罗宾·希思",publisher:"湖南科学技术出版社",publishDate:"2013-9-9",pages:60,category:"culture"}),"9787535789785",{id:"9787535789785",title:"UFO寻踪",imgSrc:"/images/books/9787535789785.jpg",author:"保罗•怀特海德乔治•温菲尔德",publisher:"湖南科学技术出版社",publishDate:"2016-11-1",pages:65,category:"culture"}),"9787535792907",{id:"9787535792907",title:"极简 极美",imgSrc:"/images/books/9787535792907.jpg",author:"乔纳森·霍宁",publisher:"湖南科学技术出版社",publishDate:"2017-8-1",pages:58,category:"culture"}),"9787535739636",{id:"9787535739636",title:"典雅的几何",imgSrc:"/images/books/9787535739636.jpg",author:"M·伦迪",publisher:"湖南科学技术出版社",publishDate:"2004-5-1",pages:75,category:"culture"}),"9787535769220",{id:"9787535769220",title:"玛雅历法及其它古代历法",imgSrc:"/images/books/9787535769220.jpg",author:"杰弗·斯垂伊",publisher:"湖南科学技术出版社",publishDate:"2012-1",pages:58,category:"culture"}),"9787535769206",{id:"9787535769206",title:"基本元素",imgSrc:"/images/books/9787535769206.jpg",author:"迈特·迈维德",publisher:"湖南科学技术出版社",publishDate:"2012-1-1",pages:58,category:"culture"}),"9787535739650",{id:"9787535739650",title:"太阳、月亮和地球",imgSrc:"/images/books/9787535739650.jpg",author:"R·希思",publisher:"湖南科学技术出版社",publishDate:"2004-5-1",pages:92,category:"culture"}),"9787535775894",{id:"9787535775894",title:"炼金师的厨房",imgSrc:"/images/books/9787535775894.jpg",author:"盖伊·欧吉维",publisher:"湖南科学技术出版社",publishDate:"2013-4",pages:58,category:"culture"}),"9787562492368",{id:"9787562492368",title:"天文之书",imgSrc:"/images/books/9787562492368.jpg",author:"[美] Jim Bell",publisher:"重庆大学出版社",publishDate:"2015-9",pages:304,category:"culture"}),"9787562493266",{id:"9787562493266",title:"数学之书",imgSrc:"/images/books/9787562493266.jpg",author:"克利福德·皮寇弗",publisher:"重庆大学出版社",publishDate:"2015-10-19",pages:280,category:"culture"}),t(t(t(t(t(t(t(t(t(t(e,"9787568900478",{id:"9787568900478",title:"生物学之书",imgSrc:"/images/books/9787568900478.jpg",author:"[美] 迈克尔• C. 杰拉尔德",publisher:"重庆大学出版社",publishDate:"2016-12-2",pages:288,category:"culture"}),"9787568903523",{id:"9787568903523",title:"工程学之书",imgSrc:"/images/books/9787568903523.jpg",author:"[美] 马歇尔·布莱恩",publisher:"重庆大学出版社",publishDate:"2016-12-2",pages:288,category:"culture"}),"9787568918039",{id:"9787568918039",title:"医学之书",imgSrc:"/images/books/9787568918039.jpg",author:"[美] 克利福德·皮寇弗",publisher:"重庆大学出版社",publishDate:"2020-5-20",pages:388,category:"culture"}),"9787568910576",{id:"9787568910576",title:"化学之书",imgSrc:"/images/books/9787568910576.jpg",author:"[美]德里克·B.罗威",publisher:"重庆大学出版社有限公司",publishDate:"2018-12-31",pages:288,category:"culture"}),"9787513334068",{id:"9787513334068",title:"大自然有条隐形线",imgSrc:"/images/books/9787513334068.jpg",author:"[意] 詹翁贝托·阿奇内利 著 / [意] 塞雷娜·维奥拉 绘",publisher:"新星出版社",publishDate:"2020-1",pages:123,category:"culture"}),"9787800096389",{id:"9787800096389",title:"PC游戏",imgSrc:"/images/books/9787800096389.png",author:"李洪",publisher:"时事出版社",publishDate:"2001-5-1",pages:401,category:"game"}),"9787806768679",{id:"9787806768679",title:"上帝掷骰子: 欧美角色扮演游戏史",imgSrc:"/images/books/9787806768679.jpg",author:"陈灼",publisher:"文汇出版社",publishDate:"2005-12",pages:272,category:"game"}),"9787516105740",{id:"9787516105740",title:"游戏的哲学",imgSrc:"/images/books/9787516105740.jpg",author:"付立峰",publisher:"中国社会科学出版社",publishDate:"2012-3",pages:293,category:"game"}),"9787513332750",{id:"9787513332750",title:"红白机视觉史",imgSrc:"/images/books/9787513332750.jpg",author:"Bitmap Books Ltd",translator:"林延平",publisher:"新星出版社",publishDate:"2019-2-28",pages:536,category:"game"}),"9787513338752",{id:"9787513338752",title:"超级任天堂视觉史",imgSrc:"/images/books/9787513338752.jpg",author:"Bitmap Books Ltd",translator:"林延平",publisher:"新星出版社",publishDate:"2021-7",pages:536,category:"game"}),t(t(t(t(t(t(t(t(t(t(e,"9780993012921",{id:"9780993012921",title:"Sinclair ZX Spectrum",imgSrc:"/images/books/9780993012921.jpg",author:"Clive Sinclair",publisher:"Bitmap Books Ltd",publishDate:"2015-9-17",pages:304,category:"game"}),"9780993012983",{id:"9780993012983",title:"Commodore 64",imgSrc:"/images/books/9780993012983.jpg",author:"Steve Jarratt / Sam Dyer",publisher:"Bitmap Books Ltd",publishDate:"2016-1-9",pages:476,category:"game"}),"9787573101242",{id:"9787573101242",title:"电子游戏微历史",imgSrc:"/images/books/9787573101242.jpg",author:"[英]伊恩·西蒙斯 / [英]詹姆斯·纽曼",translator:"陈厚力 / 王栋",publisher:"吉林出版集团股份有限公司",publishDate:"2021-9",pages:224,category:"game"}),"9787513933407",{id:"9787513933407",title:"电子游戏机完全指南",imgSrc:"/images/books/9787513933407.jpg",author:"[英]Future出版公司 编著",translator:"李龙",publisher:"民主与建设出版社",publishDate:"2021-3",pages:208,category:"game"}),"9787115327772",{id:"9787115327772",title:"通关! 游戏设计之道",imgSrc:"/images/books/9787115327772.jpg",author:"[美] Scott Rogers",translator:"孙懿",publisher:"人民邮电出版社",publishDate:"2016-3",pages:368,category:"game"}),"9787201094601",{id:"9787201094601",title:"故事",imgSrc:"/images/books/9787201094601.jpg",author:"罗伯特・麦基",publisher:"天津人民出版社",publishDate:"2016-1",pages:508,category:"game"}),"9787805646954",{id:"9787805646954",title:"大型电子游戏必胜玩法",imgSrc:"/images/books/9787805646954.jpg",author:"夏凉",publisher:"三环出版社(北京)",publishDate:"1991-09-01",pages:189,category:"game"}),"9787533504830",{id:"9787533504830",title:"电视游戏一点通",imgSrc:"/images/books/9787533504830.jpg",author:"傅瓒 编著",publisher:"福建科学技术出版社",publishDate:"1991-8",pages:205,category:"game"}),"9787110018095",{id:"9787110018095",title:"任天堂－游戏攻关秘诀",imgSrc:"/images/books/9787110018095.jpg",author:"傅瓒 / 献辉 / 王皓 / 赵晓叶 / 孙百英",publisher:"科学普及出版社",publishDate:"1990-10",pages:88,category:"game"}),"9787805067650",{id:"9787805067650",title:"MAGIC地带",imgSrc:"/images/books/9787805067650.jpg",author:"电子游戏软件杂志社",publisher:"内蒙古文化出版社",publishDate:"1999-3",pages:204,category:"game"}),t(t(t(t(t(t(t(t(t(t(e,"9787514352689",{id:"9787514352689",title:"第九区·社交理毛",imgSrc:"/images/books/9787514352689.jpg",author:"腾云智库 / 译言",publisher:"现代出版社",publishDate:"2016-10",pages:171,category:"game"}),"9787560896014",{id:"9787560896014",title:"街机游戏字体",imgSrc:"/images/books/9787560896014.jpg",author:"[日] 大曲都市",translator:"严安若",publisher:"同济大学出版社",publishDate:"2021-2",pages:280,category:"game"}),"9787121342660",{id:"9787121342660",title:"树莓派开始，玩转Linux",imgSrc:"/images/books/9787121342660.jpg",author:"Vamei / 周昕梓",publisher:"电子工业出版社",publishDate:"2018-6-27",pages:356,category:"game"}),"9787568517577",{id:"9787568517577",title:"平面国",imgSrc:"/images/books/9787568517577.jpg",author:"[英] 埃德温·A·艾勃特",translator:"陈凤洁",publisher:"大连理工大学出版社",publishDate:"2018-11",pages:144,category:"design"}),"9787102028835",{id:"9787102028835",title:"平面构成",imgSrc:"/images/books/9787102028835.jpg",author:"满懿",publisher:"人民美术出版社",publishDate:"2016-3",pages:368,category:"design"}),"9787559619433",{id:"9787559619433",title:"非平面",imgSrc:"/images/books/9787559619433.jpg",author:"[美] 尼克·索萨尼斯",translator:"严安若",publisher:"北京联合出版公司",publishDate:"2018-11",pages:208,category:"design"}),"9783836560931",{id:"9783836560931",title:"Jamie Hewlett",imgSrc:"/images/books/9783836560931.jpg",author:"Jamie Hewlett",publisher:"TASCHEN",publishDate:"2017-12-29",pages:424,category:"design"}),"9781940878423",{id:"9781940878423",title:"Gorillaz Almanac",imgSrc:"/images/books/9781940878423.jpg",author:"Gorillaz",publisher:"Z2 Comics",publishDate:"2020-12-22",pages:288,category:"design"}),"9783836548403",{id:"9783836548403",title:"Fritz Kahn",imgSrc:"/images/books/9783836548403.jpg",author:"Uta and Thilo von Debschitz",publisher:"TASCHEN",publishDate:"2013-11-15",pages:360,category:"design"}),"9780500021880",{id:"9780500021880",title:"Stanley Donwood: There Will Be No Quiet",imgSrc:"/images/books/9780500021880.jpg",author:"Thom Yorke / Stanley Donwood",publisher:"Harry N. Abrams",publishDate:"2019-10-22",pages:368,category:"design"}),t(t(t(t(t(t(t(t(t(t(e,"9783836561853",{id:"9783836561853",title:"Horror Cinema",imgSrc:"/images/books/9783836561853.jpg",author:"Penner, Jonathan",publisher:"Taschen",publishDate:"2017-5-25",pages:640,category:"design"}),"9780062380746",{id:"9780062380746",title:"Gilliamesque",imgSrc:"/images/books/9780062380746.jpg",author:"Terry Gilliam",publisher:"Harper Design",publishDate:"2015-10-20",pages:352,category:"design"}),"9780648227311",{id:"9780648227311",title:"SNAPSCRACKPOP!",imgSrc:"/images/books/9780648227311.jpeg",author:"JOHN FOY",publisher:"RED EYE RECORDS",publishDate:"2018",pages:295,category:"design"}),"9780998140742",{id:"9780998140742",title:"Color X Color the Sperry poster archive",imgSrc:"/images/books/9780998140742.jpg",author:"Chuck Sperry",publisher:"Paragon Press",publishDate:"2021",pages:751,category:"design"}),"9780826367358",{id:"9780826367358",title:"Dreams Unreal",imgSrc:"/images/books/9780826367358.jpg",author:"Titus O'Brien",publisher:"UNM Press",publishDate:"2024-11-5",pages:392,category:"design"}),"9781780672984",{id:"9781780672984",title:"The Modern Magazine",imgSrc:"/images/books/9781780672984.jpg",author:"Jeremy Leslie",publisher:"Laurence King Publishers",publishDate:"2013-10-8",pages:240,category:"design"}),"9781856697668",{id:"9781856697668",title:"Protest Stencil Toolkit",imgSrc:"/images/books/9781856697668.jpg",author:"Patrick Thomas",publisher:"Laurence King Publishing",publishDate:"2011-5-25",pages:144,category:"design"}),"9780789324634",{id:"9780789324634",title:"Ripped",imgSrc:"/images/books/9780789324634.jpg",author:"Cesar Padilla / Lydia Lunch / Betsey Johnson",publisher:"UNIVERSE PUBLISHING",publishDate:"2012-9",pages:208,category:"design"}),"9781454921387",{id:"9781454921387",title:"Punk Tees",imgSrc:"/images/books/9781454921387.jpg",author:"Martin Popoff",publisher:"Union Square & Co.",publishDate:"2016-10-18",pages:192,category:"design"}),"9780500023792",{id:"9780500023792",title:"Vivienne Westwood",imgSrc:"/images/books/9780500023792.jpg",author:"Alexander Fury",publisher:"Thames & Hudson Ltd",publishDate:"2021-5",pages:632,category:"design"}),t(t(t(t(t(t(t(t(t(t(e,"9780500515006",{id:"9780500515006",title:"The Worldwide History of Beads",imgSrc:"/images/books/9780500515006.png",author:"Kiyoshi Togashi / Lois Sherr Dubin",publisher:"Thames & Hudson Ltd",publishDate:"2010-2",pages:396,category:"design"}),"9787514619232",{id:"9787514619232",title:"世界花纹与图案大典",imgSrc:"/images/books/9787514619232.jpg",author:"Elizabeth Wilhide",publisher:"中国画报出版社",publishDate:"2020-8",pages:660,category:"design"}),"9784766132595",{id:"9784766132595",title:"マッチ・ラベル",imgSrc:"/images/books/9784766132595.jpg",author:"たるみ燐寸博物館 小野 隆弘",publisher:"グラフィック社",publishDate:"2019-4",pages:144,category:"design"}),"9789887711094",{id:"9789887711094",title:"Textilepedia",imgSrc:"/images/books/9789887711094.jpg",author:"",publisher:"Fashionary International Limited",publishDate:"2018-6",pages:220,category:"design"}),"9789887710974",{id:"9789887710974",title:"fashion business manual",imgSrc:"/images/books/9789887710974.jpg",author:"",publisher:"Fashionary International Limited",publishDate:"2018-6",pages:220,category:"design"}),"9787108021144",{id:"9787108021144",title:"角色符号",imgSrc:"/images/books/9787108021144.jpg",author:"栾冠桦",publisher:"生活·读书·新知三联书店",publishDate:"2005-01",pages:227,category:"design"}),"9787505407909",{id:"9787505407909",title:"中国京剧脸谱",imgSrc:"/images/books/9787505407909.jpg",author:"赵梦林",publisher:"朝华出版社",publishDate:"2003-1",pages:168,category:"design"}),"9787539400440",{id:"9787539400440",title:"二十世纪视觉传达设计史",imgSrc:"/images/books/9787539400440.jpg",author:"(美)梅格斯",publisher:"湖北美术出版社",publishDate:"1989-09",pages:262,category:"design"}),"8114-6",{id:"8114-6",title:"刊头题花图案",imgSrc:"/images/books/8114-6.jpg",author:"江胜全",publisher:"重庆出版社",publishDate:"1982-01",pages:96,category:"design"}),"9787539410050",{id:"9787539410050",title:"平面设计八人",imgSrc:"/images/books/9787539410050.jpg",author:"泛克",publisher:"湖北美术出版社",publishDate:"2000-06",pages:158,category:"design"}),t(t(t(t(t(t(t(t(t(t(e,"9787500673651",{id:"9787500673651",title:"今日文字设计",imgSrc:"/images/books/9787500673651.jpg",author:"赫尔穆特·施密德",publisher:"中国青年出版社",publishDate:"2007-6",pages:186,category:"design"}),"9787202007877",{id:"9787202007877",title:"丑语大观",imgSrc:"/images/books/9787202007877.jpg",author:"余云华",publisher:"河北人民出版社",publishDate:"1990-10",pages:261,category:"design"}),"10071-260",{id:"10071-260",title:"大跃进之歌",imgSrc:"/images/books/10071-260.jpg",author:"北京出版社",publisher:"北京出版社",publishDate:"1958-07",pages:203,category:"design"}),"7538714421",{id:"7538714421",title:"民谣下的中国",imgSrc:"/images/books/7538714421.jpg",author:"武阿蒙",publisher:"时代文艺出版社",publishDate:"2000",pages:301,category:"design"}),"9787800818004",{id:"9787800818004",title:"古今中外兵器大观",imgSrc:"/images/books/9787800818004.jpg",author:"陈学建 / 金永吉",publisher:"蓝天出版社",publishDate:"1998",pages:288,category:"design"}),"9789863444336",{id:"9789863444336",title:"法醫科學研究室",imgSrc:"/images/books/9789863444336.jpg",author:"道格拉斯·萊爾",publisher:"麥田",publishDate:"2017-3-18",pages:512,category:"design"}),"9789863444091",{id:"9789863444091",title:"毒物研究室",imgSrc:"/images/books/9789863444091.jpg",author:"席瑞塔·史蒂文斯 / 安妮·班農",publisher:"麥田",publishDate:"2018-2-3",pages:446,category:"design"}),"9787100196192",{id:"9787100196192",title:"众神的植物",imgSrc:"/images/books/9787100196192.jpg",author:"[美]理查德·伊文斯·舒尔兹 / [瑞士]艾伯特·霍夫曼 / [德]克里斯汀·拉奇",publisher:"商务印书馆",publishDate:"2021-9",pages:209,category:"design"}),"9787513330848",{id:"9787513330848",title:"魔药课",imgSrc:"/images/books/9787513330848.jpg",author:"(法) 蒂博·维拉诺瓦",publisher:"新星出版社",publishDate:"2018-8",pages:184,category:"design"}),"9789863443513",{id:"9789863443513",title:"餐桌上的語言學家",imgSrc:"/images/books/9789863443513.jpg",author:"任韶堂(Dan Jurafsky)",publisher:"麥田",publishDate:"2016-6-2",pages:301,category:"design"}),t(t(t(t(t(t(t(t(t(t(e,"9783836520294",{id:"9783836520294",title:"Menu Design in America",imgSrc:"/images/books/9783836520294.jpg",author:"Steven Heller / John Mariani",publisher:"Taschen GmbH",publishDate:"2018-10-23",pages:592,category:"design"}),"9780714873985",{id:"9780714873985",title:"THE WORLD IS YOUR BURGER",imgSrc:"/images/books/9780714873985.jpeg",author:"David Michaels",publisher:"Phaidon",publishDate:"2013-10-8",pages:432,category:"design"}),"9787805016993",{id:"9787805016993",title:"茶饮笔记",imgSrc:"/images/books/9787805016993.jpg",author:"作山若子",publisher:"北京美术摄影出版社",publishDate:"2015-5",pages:208,category:"design"}),"9787806073278",{id:"9787806073278",title:"箱男",imgSrc:"/images/books/9787806073278.jpg",author:"[日本] 安部公房",publisher:"珠海出版社",publishDate:"1997-7",pages:347,category:"design"}),"15747-110",{id:"15747-110",title:"他人的脸",imgSrc:"/images/books/15747-110.jpg",author:"[日本] 安部公房",publisher:"珠海出版社",publishDate:"1997-7",pages:446,category:"design"}),"9787308225236",{id:"9787308225236",title:"私密感的诞生",imgSrc:"/images/books/9787308225236.jpg",author:"[法] 安尼克·帕尔代赫－加拉布隆",publisher:"浙江大学出版社",publishDate:"2022-7-1",pages:404,category:"design"}),"9780810997417",{id:"9780810997417",title:"The Wes Anderson Collection",imgSrc:"/images/books/9780810997417.jpg",author:"Matt Zoller Seitz",publisher:"Harry N. Abrams",publishDate:"2013-10-8",pages:336,category:"design"}),"9787805212043",{id:"9787805212043",title:"白天鹅宾馆管理实务",imgSrc:"/images/books/9787805212043.jpg",author:"杨小鹏",publisher:"广东旅游出版社",publishDate:"2002-12",pages:942,category:"design"}),"9781911026600",{id:"9781911026600",title:"Around the World in 80 Record Stores",imgSrc:"/images/books/9781911026600.jpg",author:"Marcus Barnes",publisher:"Art & Photography",publishDate:"2018",pages:144,category:"design"}),"9789881470331",{id:"9789881470331",title:"Cartographics",imgSrc:"/images/books/9789881470331.jpg",author:"SendPoints",publisher:"SendPoints",publishDate:"2017-1-16",pages:256,category:"design"}),t(t(t(t(t(t(t(t(t(e,"9789869406932",{id:"9789869406932",title:"偏見地圖１",imgSrc:"/images/books/9789869406932.jpg",author:"[保加利亞]楊科·茨維可夫（Yanko Tsvetkov）",publisher:"行路出版",publishDate:"2017-3",pages:84,category:"design"}),"9789869406949",{id:"9789869406949",title:"偏見地圖2",imgSrc:"/images/books/9789869406949.jpg",author:"[保加利亞]楊科·茨維可夫（Yanko Tsvetkov）",publisher:"行路出版",publishDate:"2017-3",pages:84,category:"design"}),"9787521720402",{id:"9787521720402",title:"地图3000年：从神秘符号到谷歌地图",imgSrc:"/images/books/9787521720402.jpg",author:"[挪威] Thomas Reinertsen Berg",publisher:"中信出版社",publishDate:"2021-1-31",pages:356,category:"design"}),"9789869577533",{id:"9789869577533",title:"妖怪地圖",imgSrc:"/images/books/9789869577533.jpg",author:"Sandra Lawrence",publisher:"大家出版",publishDate:"2018-6-6",pages:64,category:"design"}),"9780500519509",{id:"9780500519509",title:"The Writer's Map",imgSrc:"/images/books/9780500519509.jpg",author:"LEWIS-JONES HUW",publisher:"Thames & Hudson",publishDate:"2018-10-3",pages:256,category:"design"}),"9787559201737",{id:"9787559201737",title:"哥特艺术",imgSrc:"/images/books/9787559201737.jpg",author:"[英]克里斯·布鲁克斯",publisher:"华南理工大学出版社",publishDate:"2018-10",pages:448,category:"design"}),"9787562330578",{id:"9787562330578",title:"何镜堂建筑创作",imgSrc:"/images/books/9787562330578.jpg",author:"何镜堂",publisher:"华南理工大学出版社",publishDate:"2010-4",pages:276,category:"design"}),"9787518067459",{id:"9787518067459",title:"松田纱和的绳结服饰包袋",imgSrc:"/images/books/9787518067459.jpg",author:" [日] 松田纱和",publisher:"中国纺织出版社",publishDate:"2019",pages:96,category:"design"}),"9787543066762",{id:"9787543066762",title:"终极结绳技巧全图解",imgSrc:"/images/books/9787543066762.jpg",author:"[澳] 内维尔·奥利菲",publisher:"武汉出版社",publishDate:"2013-09-01",pages:144,category:"design"})),window.getBooksDataByCategory=function(e){return Object.values(window.BOOKS_DATA).filter(function(t){return t.category===e})},window.getBookById=function(e){return window.BOOKS_DATA[e]||null})}()},4843:()=>{},5230:(e,t,n)=>{"use strict";var a=n(6129),r=n.n(a);function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,i,o,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=i.call(n)).done)&&(s.push(a.value),s.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw r}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach(function(t){l(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e,t,n){return(t=g(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,g(a.key),a)}}function g(e){var t=function(e,t){if("object"!=i(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=i(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==i(t)?t:t+""}function p(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function i(n,a,r,i){var c=a&&a.prototype instanceof s?a:s,u=Object.create(c.prototype);return h(u,"_invoke",function(n,a,r){var i,s,c,u=0,l=r||[],d=!1,g={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,s=0,c=e,g.n=n,o}};function p(n,a){for(s=n,c=a,t=0;!d&&u&&!r&&t<l.length;t++){var r,i=l[t],p=g.p,h=i[2];n>3?(r=h===a)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=p&&((r=n<2&&p<i[1])?(s=0,g.v=a,g.n=i[1]):p<h&&(r=n<3||i[0]>a||a>h)&&(i[4]=n,i[5]=a,g.n=h,s=0))}if(r||n>1)return o;throw d=!0,a}return function(r,l,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!d;){i||(s?s<3?(s>1&&(g.n=-1),p(s,c)):g.n=c:g.v=c);try{if(u=2,i){if(s||(r="next"),t=i[r]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),s=1);i=e}else if((t=(d=g.n<0)?c:n.call(a,g))!==o)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,r,i),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][a]?t(t([][a]())):(h(t={},a,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,h(e,r,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,h(d,"constructor",u),h(u,"constructor",c),c.displayName="GeneratorFunction",h(u,r,"GeneratorFunction"),h(d),h(d,r,"Generator"),h(d,a,function(){return this}),h(d,"toString",function(){return"[object Generator]"}),(p=function(){return{w:i,m:g}})()}function h(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}h=function(e,t,n,a){if(t)r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n;else{var i=function(t,n){h(e,t,function(e){return this._invoke(t,n,e)})};i("next",0),i("throw",1),i("return",2)}},h(e,t,n,a)}function m(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}function f(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var i=e.apply(t,n);function o(e){m(i,a,r,o,s,"next",e)}function s(e){m(i,a,r,o,s,"throw",e)}o(void 0)})}}var v,b="undefined"!=typeof window&&"localhost"===window.location.hostname?"http://localhost:3001":"";function y(){var e,t,n,a=document.getElementById("manifesto"),r=(e=f(p().m(function e(){var t;return p().w(function(e){for(;;)switch(e.n){case 0:if(!(t=this.value.trim())){e.n=2;break}return e.n=1,w(t);case 1:e.n=3;break;case 2:return e.n=3,w("MANIFESTOCLUB");case 3:return e.a(2)}},e,this)})),t=300,function(){var a=this,r=arguments;clearTimeout(n),n=setTimeout(function(){e.apply(a,r)},t)});a.addEventListener("input",r)}function w(e){return k.apply(this,arguments)}function k(){return k=f(p().m(function e(t){var n,a,i,o,s,c=arguments;return p().w(function(e){for(;;)switch(e.n){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:"barcode",a="ManifestoClub",i="MANIFESTOCLUB",!t||"MANIFESTOCLUB"===t){e.n=2;break}return e.n=1,S(t);case 1:o=e.v,a=o.slice(0,15),i=o,e.n=4;break;case 2:return e.n=3,S("MANIFESTOCLUB");case 3:i=e.v;case 4:try{(s=document.getElementById(n)).innerHTML="",r(),r()(s,i,{format:"CODE128",displayValue:!0,text:a,font:'"Lucida Console"',width:2,height:80,margin:0}),s.setAttribute("data-barcode",i)}catch(e){}return e.a(2,i)}},e)})),k.apply(this,arguments)}function S(e){return P.apply(this,arguments)}function P(){return(P=f(p().m(function e(t){var n,a,r,i,o;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if("undefined"==typeof crypto||!crypto.subtle){e.n=4;break}return e.p=1,n=new TextEncoder,a=n.encode(t),e.n=2,crypto.subtle.digest("SHA-256",a);case 2:return r=e.v,i=Array.from(new Uint8Array(r)),o=i.map(function(e){return e.toString(16).padStart(2,"0")}).join(""),e.a(2,o.slice(0,15));case 3:return e.p=3,e.v,e.a(2,E(t));case 4:return e.a(2,E(t));case 5:return e.a(2)}},e,null,[[1,3]])}))).apply(this,arguments)}function E(e){for(var t=0,n=e+"MANIFESTOCLUB_SALT",a=0;a<n.length;a++){t=(t<<5)-t+n.charCodeAt(a),t&=t}for(var r=Math.abs(t),i=r.toString(16).padStart(8,"0");i.length<15;)i+=r.toString(16);return i.slice(0,15)}function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3,n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).silent,a=void 0!==n&&n;return new Promise(function(n,r){var i=document.getElementById(e);if(i)n(i);else{var o=Date.now(),s=function(){var i=document.getElementById(e);if(i)n(i);else{if(Date.now()-o>t){var c=new Error("Element ".concat(e," not found within ").concat(t,"ms"));return c.notFound=!0,void(a?n(null):r(c))}setTimeout(s,50)}};s()}})}function C(){return D.apply(this,arguments)}function D(){return(D=f(p().m(function e(){var t,n,a,r;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,document.getElementById("member-barcode-complete")){e.n=1;break}return e.a(2);case 1:if(t=null,n=null,void 0!==window.authManager&&(t=window.authManager.getCurrentUser(),n=window.authManager.getToken()),t){e.n=2;break}return e.a(2);case 2:return e.n=3,fetch("https://diydajlvfdvujiogryte.supabase.co/rest/v1/profiles?user_id=eq.".concat(t.id,"&select=manifesto,barcode"),{headers:u({apikey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRpeWRhamx2ZmR2dWppb2dyeXRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNjc0MDMsImV4cCI6MjA4MDg0MzQwM30.dqqhQ2QT5aUnweLAEQrfilsrkqdCj096oDUeg92TqNs"},n?{Authorization:"Bearer ".concat(n)}:{})});case 3:return a=e.v,e.n=4,a.json();case 4:if(!((r=e.v)&&r.length>0&&r[0].barcode)){e.n=6;break}return e.n=5,B.generateBarcodeImage(r[0].manifesto||"No manifesto",r[0].barcode,"member-barcode-complete");case 5:case 6:e.n=8;break;case 7:e.p=7,e.v;case 8:return e.a(2)}},e,null,[[0,7]])}))).apply(this,arguments)}v=0,document.addEventListener("visibilitychange",function(){if(!document.hidden){var e=Date.now();if(e-v<2e3)return;v=e,setTimeout(f(p().m(function e(){var t,n;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,"undefined"==typeof supabase){e.n=3;break}return e.n=1,supabase.auth.getSession();case 1:if(t=e.v,!(n=t.data.session)){e.n=3;break}return e.n=2,supabase.auth.setSession({access_token:n.access_token,refresh_token:n.refresh_token});case 2:setTimeout(function(){return L()},300);case 3:e.n=5;break;case 4:e.p=4,e.v;case 5:return e.a(2)}},e,null,[[0,4]])})),300)}}),window.addEventListener("load",function(){setTimeout(f(p().m(function e(){var t,n;return p().w(function(e){for(;;)switch(e.n){case 0:if("undefined"==typeof supabase){e.n=2;break}return e.n=1,supabase.auth.getSession();case 1:if(t=e.v,!(n=t.data.session)){e.n=2;break}return e.n=2,supabase.auth.setSession({access_token:n.access_token,refresh_token:n.refresh_token});case 2:return e.a(2)}},e)})),1e3)}),window.addEventListener("load",function(){w("MANIFESTOCLUB"),y()});var B=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cache=new Map,this.isReady=!0},t=[{key:"generateBarcodeImage",value:(o=f(p().m(function e(t,n){var a,r,i,o=arguments;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:return a=o.length>2&&void 0!==o[2]?o[2]:"member-barcode-complete",e.p=1,e.n=2,I(a,5e3,{silent:!0});case 2:if(r=e.v){e.n=3;break}return e.a(2,null);case 3:return e.n=4,this.createBarcodeCanvas(t,n,r);case 4:return i=e.v,r&&i&&(r.style.width="100%",r.style.height="auto",r.style.objectFit="contain",r.style.display="block"),e.a(2,i);case 5:return e.p=5,e.v,e.a(2,null)}},e,this,[[1,5]])})),function(e,t){return o.apply(this,arguments)})},{key:"createBarcodeCanvas",value:(i=f(p().m(function e(t,n,a){var i,o,s,c,u,l,d,g,h,m,f,v,b,y,w,k,S,P,E;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(i="barcode_".concat(t,"_").concat(n),!this.cache.has(i)){e.n=1;break}return o=this.cache.get(i),a.src=o,a.style.display="block",e.a(2,o);case 1:if(e.p=1,s=function(e,t,n,a,r,i){for(var o=t.split(" "),s="",u=[],l=0;l<o.length;l++){var d=s+o[l]+" ";e.measureText(d).width>r&&l>0?(u.push(s.trim()),s=o[l]+" "):s=d}u.push(s.trim());var g=[];u.forEach(function(t){if(e.measureText(t).width>r){for(var n="",a=0;a<t.length;a++){var i=n+t[a];e.measureText(i).width>r&&n.length>0?(g.push(n),n=t[a]):n=i}n&&g.push(n)}else g.push(t)});var p=g.length*i,h=a-p/2+i/2,m=c.width,f=0;return g.forEach(function(t,a){var r=h+a*i;e.fillText(t,n,r);var o=e.measureText(t).width,s=n-o/2,c=n+o/2;m=Math.min(m,s),f=Math.max(f,c)}),{endY:h+p,minX:m,maxX:f,startY:h,height:p}},c=document.createElement("canvas"),u=c.getContext("2d"),c.width=1500,c.height=800,u.fillStyle="#000000",u.font="".concat(90,"px Arial, sans-serif"),u.textAlign="center",l=c.width,d=s(u,t,c.width/2,200,l,108),g=Math.max(d.endY-65,-200),(h=document.createElement("canvas")).width=1500,h.height=500,h.getContext("2d").clearRect(0,0,h.width,h.height),r()(h,n,{format:"CODE128",displayValue:!0,width:10,height:300,margin:0,background:"transparent",font:'"Lucida Console"',fontSize:100}),m=(c.width-h.width)/2,u.drawImage(h,m,g),!(f=this.getContentBounds(u,c.width,c.height))){e.n=2;break}return v=Math.max(0,f.minX-20),b=Math.max(0,f.minY-20),y=Math.min(c.width,f.maxX+20)-v,w=Math.min(c.height,f.maxY+20)-b,(k=document.createElement("canvas")).width=y,k.height=w,k.getContext("2d").drawImage(c,v,b,y,w,0,0,y,w),S=k.toDataURL("image/png"),this.cache.size>50&&(P=this.cache.keys().next().value,this.cache.delete(P)),this.cache.set(i,S),a.src=S,a.style.display="block",e.a(2,S);case 2:return E=c.toDataURL("image/png"),this.cache.set(i,E),a.src=E,a.style.display="block",e.a(2,E);case 3:return e.p=3,e.v,e.a(2,null)}},e,this,[[1,3]])})),function(e,t,n){return i.apply(this,arguments)})},{key:"getContentBounds",value:function(e,t,n){try{for(var a=e.getImageData(0,0,t,n).data,r=t,i=0,o=n,s=0,c=!1,u=0;u<n;u++)for(var l=0;l<t;l++){var d=4*(u*t+l),g=a[d],p=a[d+1],h=a[d+2];a[d+3]>0&&(g<250||p<250||h<250)&&(c=!0,r=Math.min(r,l),i=Math.max(i,l),o=Math.min(o,u),s=Math.max(s,u))}return c?{minX:r,maxX:i,minY:o,maxY:s}:null}catch(e){return null}}},{key:"preloadBarcode",value:(a=f(p().m(function e(t,n){var a,r;return p().w(function(e){for(;;)switch(e.n){case 0:if(a="barcode_".concat(t,"_").concat(n),this.cache.has(a)){e.n=1;break}return r=document.createElement("img"),e.n=1,this.createBarcodeCanvas(t,n,r);case 1:return e.a(2)}},e,this)})),function(e,t){return a.apply(this,arguments)})}],t&&d(e.prototype,t),n&&d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n,a,i,o}());function T(){return j.apply(this,arguments)}function j(){return(j=f(p().m(function e(){var t,n,a;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,x();case 1:return"undefined"!=typeof supabase&&supabase.auth&&setTimeout(f(p().m(function e(){var t;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,supabase.auth.getSession();case 1:if(t=e.v,!t.data.session){e.n=2;break}if("function"!=typeof forceRefreshSession){e.n=2;break}return e.n=2,forceRefreshSession();case 2:e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},e,null,[[0,3]])})),1500),e.n=2,w("MANIFESTOCLUB");case 2:return y(),e.n=3,L();case 3:t=new URLSearchParams(window.location.search),n="password_update"===t.get("type"),a=t.get("email"),n&&a&&(sessionStorage.setItem("resetEmail",decodeURIComponent(a)),document.getElementById("auth-modal").style.display="block",ue(decodeURIComponent(a)),window.history.replaceState({},"",window.location.pathname)),oe(),he(),e.n=5;break;case 4:e.p=4,e.v;case 5:return e.a(2)}},e,null,[[0,4]])}))).apply(this,arguments)}function L(){return M.apply(this,arguments)}function M(){return(M=f(p().m(function e(){var t,n,a,r;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(document.documentElement.classList.remove("lock"),e.p=1,void 0!==window.supabase&&window.supabase.auth){e.n=2;break}return e.n=2,x();case 2:if(t=null,n=!1,void 0===window.authManager||!window.authManager){e.n=3;break}t=window.authManager.getCurrentUser(),n=window.authManager.isAuthenticated(),e.n=6;break;case 3:if(!window.supabase||!window.supabase.auth){e.n=5;break}return e.n=4,window.supabase.auth.getUser();case 4:a=e.v,r=a.data.user,n=!!(t=r),e.n=6;break;case 5:n=!1;case 6:n&&t?A(t):O(),e.n=8;break;case 7:e.p=7,e.v,O();case 8:return e.a(2)}},e,null,[[1,7]])}))).apply(this,arguments)}function x(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;return new Promise(function(t,n){var a=Date.now(),r=function(){void 0!==window.supabase&&window.supabase.auth?t():Date.now()-a>e?n(new Error("Supabase initialization timeout")):setTimeout(r,100)};r()})}function A(e){var t=document.querySelector(".header__nav li:last-child"),n=document.querySelector(".header__nav--mobile ul");if(t&&(t.innerHTML='\n      <div class="user-menu">\n        <span class="user-menu-trigger">ME(0)</span>\n        <div class="user-dropdown" id="user-dropdown" style="display: none;">\n        \n          <div class="user-info">\n            <a class="profile" href="profile" data-page="profile">Profile</a>\n          </div>\n          <div class="user-info">\n            <a class="profile" href="friend" data-page="friend">Friend(0)</a>\n          </div>\n          <div class="user-actions">\n            <span class="logout-btn">LOGOUT</span>\n          </div>\n        </div>\n      </div>\n    '),n){var a=n.querySelector("li .profile"),r=n.querySelector("li .logout-btn"),i=n.querySelector("li .cart-link");if(!a||!i||!r){var o=Array.from(n.querySelectorAll("li")).find(function(e){var t=e.querySelector("span");return t&&"LOGIN"===t.textContent.trim()});if(!i){var s=document.createElement("li");s.innerHTML='<div class="cart-link" data-page="cart">CART(<span id="cartBadgeMobile">0</span>)</div>',o.insertAdjacentElement("afterend",s)}if(o&&(o.innerHTML='<a class="profile" href="profile" data-page="profile">PROFILE</a>',"profile"===window.currentPage&&setTimeout(f(p().m(function e(){return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,"function"!=typeof window.displayUserProfile){e.n=1;break}return e.n=1,window.displayUserProfile();case 1:e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])})),100),!r)){var c=document.createElement("li");c.innerHTML='<span class="logout-btn">LOGOUT</span>',n.appendChild(c)}}}setTimeout(f(p().m(function e(){return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,"function"!=typeof window.displayUserProfile){e.n=1;break}return e.n=1,window.displayUserProfile();case 1:e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},e,null,[[0,2]])})),100)}function O(){var e=document.querySelector(".header__nav li:last-child"),t=document.querySelector(".header__nav--mobile ul");if(e&&(e.innerHTML='<span id="login-trigger">Login</span>'),t){var n,a,r,i=null===(n=t.querySelector("li .profile"))||void 0===n?void 0:n.parentElement,o=null===(a=t.querySelector("li .cart-link"))||void 0===a?void 0:a.parentElement,s=null===(r=t.querySelector("li .logout-btn"))||void 0===r?void 0:r.parentElement;if(i&&i.remove(),o&&o.remove(),s&&s.remove(),!Array.from(t.querySelectorAll("li")).some(function(e){var t=e.querySelector("span");return t&&"LOGIN"===t.textContent.trim()})){var c=document.createElement("li");c.innerHTML="<span>LOGIN</span>",t.appendChild(c)}}var u=document.getElementById("member-barcode-complete");u&&(u.style.display="none",u.src="")}function N(){document.addEventListener("loginSuccess",function(e){setTimeout(function(){return L()},100)}),document.addEventListener("logout",function(e){setTimeout(function(){return L()},100)}),document.addEventListener("authStateChanged",function(e){e.detail.isAuthenticated;setTimeout(function(){return L()},100)}),document.addEventListener("visibilitychange",f(p().m(function e(){return p().w(function(e){for(;;)switch(e.n){case 0:if(document.hidden){e.n=2;break}return e.n=1,new Promise(function(e){return setTimeout(e,500)});case 1:return e.n=2,L();case 2:return e.a(2)}},e)})))}function _(){return R.apply(this,arguments)}function R(){return(R=f(p().m(function e(){return p().w(function(e){for(;;)switch(e.n){case 0:if(void 0===window.authManager){e.n=2;break}return e.n=1,window.authManager.init();case 1:e.n=3;break;case 2:if(void 0===window.supabase){e.n=3;break}return e.n=3,new Promise(function(e){if(void 0!==window.supabase)e();else var t=setInterval(function(){void 0!==window.supabase&&(clearInterval(t),e())},100)});case 3:return e.n=4,L();case 4:N();case 5:return e.a(2)}},e)}))).apply(this,arguments)}function U(){return q.apply(this,arguments)}function q(){return(q=f(p().m(function e(){var t,n,a,r,i;return p().w(function(e){for(;;)switch(e.n){case 0:if(t=document.getElementById("manifesto"),n=document.querySelector(".check-manifesto"),(a=document.getElementById("manifesto-error")).style.display="none",n.innerHTML="",t.value.trim()){e.n=1;break}return a.textContent="Please enter your manifesto",a.style.display="block",e.a(2,!1);case 1:return e.n=2,F(t.value);case 2:return r=e.v,(i=n.querySelector("img"))||((i=document.createElement("img")).alt=r?"Valid":"Invalid",n.appendChild(i)),r?(i.src="/images/yes.png",a.style.display="none"):(i.src="/images/no.png",a.textContent="This manifesto already exists",a.style.display="block"),e.a(2,r)}},e)}))).apply(this,arguments)}function F(e){return H.apply(this,arguments)}function H(){return(H=f(p().m(function e(t){var n,a;return p().w(function(e){for(;;)switch(e.n){case 0:if(t.trim()){e.n=1;break}return e.a(2,!1);case 1:return e.n=2,supabase.from("profiles").select("manifesto").eq("manifesto",t);case 2:if(n=e.v,a=n.data,!n.error){e.n=3;break}return e.a(2,!1);case 3:return e.a(2,0===a.length)}},e)}))).apply(this,arguments)}function z(){return G.apply(this,arguments)}function G(){return(G=f(p().m(function e(){var t,n,a,r,i;return p().w(function(e){for(;;)switch(e.n){case 0:return t=document.getElementById("signup-email"),n=document.querySelector(".check-email"),a=document.getElementById("email-error"),n.innerHTML="",a.style.display="none",e.n=1,W(t.value);case 1:if((r=e.v).valid){e.n=7;break}i=r.reason,e.n="empty"===i?2:"invalid_format"===i?3:"registered"===i?4:5;break;case 2:return e.a(2,!1);case 3:return a.textContent="Please enter a valid email address",e.a(3,6);case 4:return a.textContent="This email is already registered",e.a(3,6);case 5:a.textContent="Validation error";case 6:return a.style.display="block",n.innerHTML='<img src="/images/no.png" alt="Invalid">',e.a(2,!1);case 7:return n.innerHTML='<img src="/images/yes.png" alt="Valid">',e.a(2,!0)}},e)}))).apply(this,arguments)}function W(e){return V.apply(this,arguments)}function V(){return(V=f(p().m(function e(t){var n,a;return p().w(function(e){for(;;)switch(e.n){case 0:if(t.trim()){e.n=1;break}return e.a(2,{valid:!1,reason:"empty"});case 1:if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){e.n=2;break}return e.a(2,{valid:!1,reason:"invalid_format"});case 2:return e.n=3,supabase.from("profiles").select("email").eq("email",t);case 3:if(n=e.v,a=n.data,!n.error){e.n=4;break}return e.a(2,{valid:!1,reason:"error"});case 4:return e.a(2,{valid:0===a.length,reason:0===a.length?"available":"registered"})}},e)}))).apply(this,arguments)}function Y(){return J.apply(this,arguments)}function J(){return(J=f(p().m(function e(){var t,n,a,r,i;return p().w(function(e){for(;;)switch(e.n){case 0:if(t=document.getElementById("signup-password"),n=document.querySelector(".check-password"),a=document.getElementById("password-error"),n.innerHTML="",a.style.display="none",0!==(r=t.value.trim()).length){e.n=1;break}return e.a(2,!1);case 1:return(i=r.length>=8)?n.innerHTML='<img src="/images/yes.png" alt="Valid">':(n.innerHTML='<img src="/images/no.png" alt="Invalid">',a.textContent="Password must be longer than 8 characters",a.style.display="block"),e.a(2,i)}},e)}))).apply(this,arguments)}function X(){return K.apply(this,arguments)}function K(){return(K=f(p().m(function e(){var t,n,a,r,i,s,c,u,l,d,g,h,m,f,v;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,Promise.all([U(),z(),Y()]);case 1:if(t=e.v,n=o(t,3),a=n[0],r=n[1],i=n[2],a&&r&&i){e.n=2;break}return s=function(e){e.style.display="none",setTimeout(function(){return e.style.display="block"},10)},a||s(document.getElementById("manifesto-error")),r||s(document.getElementById("email-error")),i||s(document.getElementById("password-error")),e.a(2);case 2:return c=document.getElementById("signup-email").value,u=document.getElementById("signup-password").value,l=document.getElementById("manifesto").value,e.p=3,(d=document.getElementById("signup-button"))&&(d.disabled=!0,d.textContent="Signing up..."),e.n=4,w(l);case 4:return g=e.v,e.n=5,fetch("".concat(b,"/api/auth/signup"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c,password:u,manifesto:l,barcode:g})});case 5:return h=e.v,e.n=6,h.json();case 6:if(m=e.v,h.ok){e.n=7;break}return alert("注册失败: "+(m.error||"Unknown error")),d&&(d.disabled=!1,d.textContent="Sign Up"),e.a(2);case 7:Q({email:c,manifesto:l}),d&&(d.textContent="Sign Up",d.disabled=!1),e.n=9;break;case 8:e.p=8,v=e.v,alert("注册失败: "+v.message),(f=document.getElementById("signup-button"))&&(f.disabled=!1,f.textContent="Sign Up");case 9:return e.a(2)}},e,null,[[3,8]])}))).apply(this,arguments)}function Q(e){document.querySelector(".auth-modal-header").style.display="none",document.getElementById("login-form").style.display="none",document.getElementById("signup-form").style.display="none",document.getElementById("password-reset-form").style.display="none",document.getElementById("signup-success-form").style.display="block",document.getElementById("manifesto-code").textContent=e.manifesto,document.getElementById("success-email").textContent=e.email,w(e.manifesto,"barcode-success")}function Z(){return $.apply(this,arguments)}function $(){return($=f(p().m(function e(){var t,n,a,r;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=document.getElementById("success-email").textContent,n=document.getElementById("resend-button"),e.p=1,n.disabled=!0,n.textContent="Sending...",e.n=2,new Promise(function(e){return setTimeout(e,50)});case 2:return e.n=3,supabase.auth.resend({type:"signup",email:t});case 3:if(a=e.v,!(r=a.error)){e.n=4;break}throw r;case 4:n.textContent="✓ Email Resent",e.n=6;break;case 5:e.p=5,e.v,n.textContent="Resend Verification Email",n.disabled=!1;case 6:return e.a(2)}},e,null,[[1,5]])}))).apply(this,arguments)}function ee(){document.getElementById("auth-modal").style.display="none",te()}function te(){document.querySelector(".auth-modal-header").style.display="block",document.getElementById("login-form").style.display="block",document.getElementById("signup-form").style.display="none",document.getElementById("signup-success-form").style.display="none",document.getElementById("password-reset-form").style.display="none",document.getElementById("signup-email").value="",document.getElementById("signup-password").value="",document.getElementById("manifesto").value="",document.getElementById("login-email").value="",document.getElementById("login-password").value="",document.querySelectorAll(".check-icon").forEach(function(e){e.innerHTML=""}),document.querySelectorAll(".error-message").forEach(function(e){e.style.display="none"}),w("MANIFESTOCLUB")}function ne(){document.getElementById("login-form").style.display="none",document.getElementById("password-reset-form").style.display="block"}function ae(){document.getElementById("login-form").style.display="block",document.getElementById("signup-form").style.display="none",document.getElementById("password-reset-form").style.display="none",document.getElementById("update-password-form").style.display="none"}function re(){document.getElementById("login-form").style.display="none",document.getElementById("signup-form").style.display="block"}document.addEventListener("visibilitychange",function(){document.hidden||"profile"!==window.currentPage||setTimeout(f(p().m(function e(){return p().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,C();case 1:return e.a(2)}},e)})),100)}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".member-code-container");e&&(e.style.width="100%",e.style.boxSizing="border-box");var t=document.querySelector(".barcode-wrapper");t&&(t.style.width="100%")}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",_):_(),document.addEventListener("DOMContentLoaded",T),"undefined"!=typeof window&&(window.barcodeGenerator=B,window.generateBarcode=w),window.openAuthModal=function(){var e=document.getElementById("auth-modal");if(e){e.style.display="block";var t=sessionStorage.getItem("resetEmail"),n=new URLSearchParams(window.location.search),a="password_update"===n.get("type"),r=n.get("email");a&&r?(ue(decodeURIComponent(r)),window.history.replaceState({},document.title,window.location.pathname)):t?ue(t):n.has("login")&&ae()}},window.handleModalClick=function(e){e.target===document.getElementById("auth-modal")&&(document.getElementById("auth-modal").style.display="none",te())};var ie;sessionStorage.getItem("resetEmail");function oe(){var e=new URLSearchParams(window.location.search),t=e.get("email"),n="password_update"===e.get("type");t&&n&&sessionStorage.setItem("resetEmail",decodeURIComponent(t))}function se(){return ce.apply(this,arguments)}function ce(){return(ce=f(p().m(function e(){var t,n,a,r,i;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("reset-email").value.trim(),n=document.getElementById("reset-link"),(a=document.getElementById("reset-error")).style.display="none",a.textContent="",t){e.n=1;break}return a.textContent="Please enter your email address",a.style.display="block",e.a(2);case 1:if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){e.n=2;break}return a.textContent="Please enter a valid email address",a.style.display="block",e.a(2);case 2:return e.p=2,n.disabled=!0,n.textContent="Sending...",e.n=3,fetch("".concat(b,"/api/auth/password-reset"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});case 3:return r=e.v,e.n=4,r.json();case 4:if(i=e.v,r.ok){e.n=5;break}throw a.textContent=i.error||"Failed to send reset link",a.style.display="block",new Error(i.error);case 5:n.textContent="✓ Email Sent",sessionStorage.setItem("resetEmail",t),setTimeout(function(){n.textContent="SEND RESET LINK",n.disabled=!1},3e3),e.n=7;break;case 6:e.p=6,e.v,a.textContent="Failed to send reset link. Please try again.",a.style.display="block",n.textContent="SEND RESET LINK",n.disabled=!1;case 7:return e.a(2)}},e,null,[[2,6]])}))).apply(this,arguments)}function ue(e){document.getElementById("login-form").style.display="none",document.getElementById("signup-form").style.display="none",document.getElementById("password-reset-form").style.display="none",document.getElementById("update-password-form").style.display="block",document.getElementById("reset-email-display").value=e,document.getElementById("new-password").value="",document.getElementById("confirm-password").value="",document.getElementById("update-password-error").style.display="none",document.getElementById("confirm-password-error").style.display="none",le()}function le(){var e=document.getElementById("new-password").value,t=document.getElementById("confirm-password").value,n=document.querySelector(".check-new-password"),a=document.querySelector(".check-confirm-password"),r=document.getElementById("update-password-error"),i=document.getElementById("confirm-password-error"),o=document.getElementById("update-password");r.style.display="none",i.style.display="none",n.innerHTML="",a.innerHTML="";var s=!0;return e.length>0&&e.length<8?(de(n,!1),r.textContent="Password must be at least 8 characters",r.style.display="block",s=!1):e.length>=8&&de(n,!0),e&&t&&e!==t?(de(a,!1),i.textContent="Passwords do not match",i.style.display="block",s=!1):t&&e===t&&de(a,!0),o.disabled=!s,s}function de(e,t){e.innerHTML="";var n=document.createElement("img");n.src=t?".../images/yes.png":".../images/no.png",n.alt=t?"Valid":"Invalid",e.appendChild(n)}function ge(){return pe.apply(this,arguments)}function pe(){return(pe=f(p().m(function e(){var t,n,a,r,i,o,s;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(le()){e.n=1;break}return e.a(2);case 1:if(t=document.getElementById("new-password").value,n=document.getElementById("update-password"),a=document.getElementById("update-password-error"),e.p=2,n.disabled=!0,n.textContent="Updating...",r=localStorage.getItem("authToken")){e.n=3;break}throw new Error("No authentication token found");case 3:return e.n=4,fetch("".concat(b,"/api/auth/update-password"),{method:"POST",headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"},body:JSON.stringify({password:t})});case 4:return i=e.v,e.n=5,i.json();case 5:if(o=e.v,i.ok){e.n=6;break}throw new Error(o.error||"Failed to update password");case 6:n.textContent="✓ Password Updated",sessionStorage.removeItem("resetEmail"),setTimeout(function(){ae(),document.getElementById("new-password").value="",document.getElementById("confirm-password").value="",ee(),alert("Password updated successfully! Please log in with your new password.")},1500),e.n=8;break;case 7:e.p=7,s=e.v,a.textContent=s.message,a.style.display="block",n.textContent="UPDATE PASSWORD",n.disabled=!1;case 8:return e.a(2)}},e,null,[[2,7]])}))).apply(this,arguments)}function he(){document.getElementById("new-password").addEventListener("input",function(){clearTimeout(ie),ie=setTimeout(le,300)}),document.getElementById("confirm-password").addEventListener("input",function(){clearTimeout(ie),ie=setTimeout(le,300)})}function me(){return fe.apply(this,arguments)}function fe(){return(fe=f(p().m(function e(){var t,n,a,r,i,o;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("login-email").value.trim(),n=document.getElementById("login-password").value,document.getElementById("login-error"),be(),t&&n){e.n=1;break}return ve("Please enter both email/manifesto and password"),e.a(2);case 1:return e.p=1,(a=document.getElementById("login-button"))&&(a.disabled=!0,a.textContent="Logging in..."),e.n=2,fetch("".concat(b,"/api/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emailOrManifesto:t,password:n})});case 2:return r=e.v,e.n=3,r.json();case 3:if(i=e.v,r.ok){e.n=4;break}return ve(i.error||"Login failed"),a&&(a.disabled=!1,a.textContent="Login"),e.a(2);case 4:return i.token&&localStorage.setItem("authToken",i.token),i.user&&localStorage.setItem("currentUser",JSON.stringify(i.user)),void 0!==window.authManager&&window.authManager&&(window.authManager.user=i.user,window.authManager.token=i.token,window.authManager.refreshToken=i.refreshToken||null,window.authManager.expiresAt=Math.floor(Date.now()/1e3)+3600,window.authManager.saveToStorage()),be(),ee(),e.n=5,L();case 5:a&&(a.textContent="Login",a.disabled=!1),e.n=7;break;case 6:e.p=6,e.v,ve("An error occurred during login. Please try again."),(o=document.getElementById("login-button"))&&(o.disabled=!1,o.textContent="Login");case 7:return e.a(2)}},e,null,[[1,6]])}))).apply(this,arguments)}function ve(e){var t=document.getElementById("login-error");t&&(t.textContent=e,t.style.display="block",t.style.opacity="0",setTimeout(function(){t.style.opacity="1"},10))}function be(){var e=document.getElementById("login-error");e&&(e.style.display="none",e.textContent="")}function ye(){var e=document.getElementById("login-email"),t=document.getElementById("login-password");e&&(e.addEventListener("blur",function(){var e=function(e){if(!e.trim())return{valid:!1,message:"Please enter your email or manifesto"};if(e.includes("@")&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))return{valid:!1,message:"Please enter a valid email address"};return{valid:!0}}(this.value);!e.valid&&this.value.trim()&&ve(e.message)}),e.addEventListener("input",function(){be()})),t&&t.addEventListener("input",function(){be()})}function we(){var e=document.getElementById("user-dropdown");"none"===e.style.display||""===e.style.display?e.style.display="block":e.style.display="none"}function ke(){return Se.apply(this,arguments)}function Se(){return(Se=f(p().m(function e(){var t;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!(t=localStorage.getItem("authToken"))){e.n=1;break}return e.n=1,fetch("".concat(b,"/api/auth/logout"),{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"}});case 1:return localStorage.removeItem("authToken"),localStorage.removeItem("currentUser"),void 0!==window.authManager&&window.authManager&&(window.authManager.user=null,window.authManager.token=null,window.authManager.refreshToken=null,window.authManager.expiresAt=null,window.authManager.saveToStorage()),e.n=2,L();case 2:e.n=4;break;case 3:return e.p=3,e.v,localStorage.removeItem("authToken"),localStorage.removeItem("currentUser"),void 0!==window.authManager&&window.authManager&&(window.authManager.user=null,window.authManager.token=null,window.authManager.refreshToken=null,window.authManager.expiresAt=null,window.authManager.saveToStorage()),e.n=4,L();case 4:return e.a(2)}},e,null,[[0,3]])}))).apply(this,arguments)}function Pe(){document.addEventListener("keydown",function(e){if("Enter"===e.code||"Enter"===e.key){var t=document.getElementById("auth-modal"),n=document.getElementById("login-form"),a=t&&"block"===t.style.display,r=n&&"none"!==n.style.display,i=document.activeElement,o=i&&("login-email"===i.id||"login-password"===i.id);a&&r&&o&&(e.preventDefault(),me())}})}function Ee(){return(Ee=f(p().m(function e(){var t,n;return p().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,supabase.auth.getUser();case 1:if(t=e.v,n=t.data.user,!t.error&&n){e.n=2;break}return"function"==typeof openAuthModal&&openAuthModal(),ae(),e.a(2,null);case 2:return e.a(2,n)}},e)}))).apply(this,arguments)}document.addEventListener("DOMContentLoaded",f(p().m(function e(){var t,n,a,r,i,o;return p().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.n=1,L();case 1:if(!(t=window.location.hash).includes("access_token")&&!t.includes("refresh_token")){e.n=6;break}return e.p=2,e.n=3,supabase.auth.getSession();case 3:n=e.v,a=n.data,n.error||a.session&&(r=new URLSearchParams(window.location.search),i="password_update"===r.get("type"),o=r.get("email"),i&&o&&ue(decodeURIComponent(o))),e.n=5;break;case 4:e.p=4,e.v;case 5:window.history.replaceState({},"",window.location.pathname);case 6:oe(),he();case 7:return e.a(2)}},e,null,[[2,4]])}))),document.addEventListener("DOMContentLoaded",f(p().m(function e(){return p().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,new Promise(function(e){if("undefined"!=typeof supabase)e();else var t=setInterval(function(){"undefined"!=typeof supabase&&(clearInterval(t),e())},100)});case 1:return e.n=2,T();case 2:ye(),Pe();case 3:return e.a(2)}},e)}))),document.addEventListener("click",function(e){var t=document.querySelector(".user-menu"),n=document.getElementById("user-dropdown");t&&!t.contains(e.target)&&n&&(n.style.display="none")}),document.addEventListener("DOMContentLoaded",function(){ye(),Pe();var e=document.getElementById("auth-modal"),t=document.querySelector(".auth-modal-container");function n(){var e=document.getElementById("auth-modal");e&&(e.style.display="none"),te(),document.documentElement.classList.remove("lock")}e&&t&&(e.addEventListener("click",function(t){t.target===e&&n()}),t.addEventListener("click",function(e){e.stopPropagation()})),document.addEventListener("click",function(t){var n=t.target.closest("#login-trigger"),a=t.target.closest(".header__nav--mobile span");if(n||a&&a.textContent.includes("LOGIN"))return t.preventDefault(),e&&(e.style.display="block",document.documentElement.classList.add("lock")),void closeMobileMenu();if(t.target.closest(".user-menu-trigger"))return t.preventDefault(),void we();if(t.target.closest(".logout-btn"))return t.preventDefault(),ke(),void closeMobileMenu();if(t.target.closest(".header__nav--mobile .profile"))closeMobileMenu();else if(t.target.closest(".header__mob-toggle")){var r=document.getElementById("mobileNav");r&&(r.style.display="block"===r.style.display?"none":"block")}});var a=document.getElementById("login-button");a&&a.addEventListener("click",me);var r=document.querySelector(".auth-form-toggle.signup");r&&r.addEventListener("click",re);var i=document.getElementById("signup-button");i&&i.addEventListener("click",X);var o=document.querySelector("#signup-form .auth-form-toggle");o&&o.addEventListener("click",ae);var s=document.querySelector(".forgot-password-link");s&&s.addEventListener("click",ne);var c=document.getElementById("reset-link");c&&c.addEventListener("click",se);var u=document.querySelector("#password-reset-form .auth-form-toggle");u&&u.addEventListener("click",ae);var l=document.getElementById("update-password");l&&l.addEventListener("click",ge);var d=document.getElementById("resend-button");d&&d.addEventListener("click",Z);var g=document.getElementById("verify-button");g&&g.addEventListener("click",n);var p=document.getElementById("manifesto");p&&p.addEventListener("input",U);var h=document.getElementById("signup-email");h&&h.addEventListener("input",z);var m=document.getElementById("signup-password");m&&m.addEventListener("input",Y)}),"undefined"!=typeof window&&(window.displayUserProfile=C,window.generateBarcode=w,window.barcodeGenerator=B),"undefined"!=typeof window&&(window.login=me,window.signup=X,window.logout=ke,window.openAuthModal=openAuthModal,window.closeAuthModal=ee,window.handleModalClick=handleModalClick,window.showLoginForm=ae,window.showSignupForm=re,window.showPasswordReset=ne,window.showUpdatePasswordForm=ue,window.checkManifesto=U,window.checkEmail=z,window.checkPassword=Y,window.validateManifesto=F,window.validateEmail=W,window.sendResetLink=se,window.updatePassword=ge,window.resendVerificationEmail=Z,window.toggleUserMenu=we,window.showSuccessForm=Q,window.resetAuthForms=te,window.showLoginError=ve,window.hideLoginError=be,window.setupLoginValidation=ye,window.setupEnterKeyLogin=Pe,window.checkUserLogin=function(){return Ee.apply(this,arguments)})},7283:(e,t,n)=>{"use strict";var a=n(2578);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function s(e,t,n){return(t=d(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,d(a.key),a)}}function l(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=r(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:t+""}function g(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function i(n,a,r,i){var c=a&&a.prototype instanceof s?a:s,u=Object.create(c.prototype);return p(u,"_invoke",function(n,a,r){var i,s,c,u=0,l=r||[],d=!1,g={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,s=0,c=e,g.n=n,o}};function p(n,a){for(s=n,c=a,t=0;!d&&u&&!r&&t<l.length;t++){var r,i=l[t],p=g.p,h=i[2];n>3?(r=h===a)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=p&&((r=n<2&&p<i[1])?(s=0,g.v=a,g.n=i[1]):p<h&&(r=n<3||i[0]>a||a>h)&&(i[4]=n,i[5]=a,g.n=h,s=0))}if(r||n>1)return o;throw d=!0,a}return function(r,l,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,h),s=l,c=h;(t=s<2?e:c)||!d;){i||(s?s<3?(s>1&&(g.n=-1),p(s,c)):g.n=c:g.v=c);try{if(u=2,i){if(s||(r="next"),t=i[r]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),s=1);i=e}else if((t=(d=g.n<0)?c:n.call(a,g))!==o)break}catch(t){i=e,s=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,r,i),!0),u}var o={};function s(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][a]?t(t([][a]())):(p(t={},a,function(){return this}),t),d=u.prototype=s.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,p(e,r,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=u,p(d,"constructor",u),p(u,"constructor",c),c.displayName="GeneratorFunction",p(u,r,"GeneratorFunction"),p(d),p(d,r,"Generator"),p(d,a,function(){return this}),p(d,"toString",function(){return"[object Generator]"}),(g=function(){return{w:i,m:h}})()}function p(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}p=function(e,t,n,a){if(t)r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n;else{var i=function(t,n){p(e,t,function(e){return this._invoke(t,n,e)})};i("next",0),i("throw",1),i("return",2)}},p(e,t,n,a)}function h(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}function m(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var i=e.apply(t,n);function o(e){h(i,a,r,o,s,"next",e)}function s(e){h(i,a,r,o,s,"throw",e)}o(void 0)})}}var f={url:"undefined"!=typeof process&&process.env.NEXT_PUBLIC_SUPABASE_URL?process.env.NEXT_PUBLIC_SUPABASE_URL:"https://diydajlvfdvujiogryte.supabase.co",anonKey:"undefined"!=typeof process&&process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY?process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRpeWRhamx2ZmR2dWppb2dyeXRlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUyNjc0MDMsImV4cCI6MjA4MDg0MzQwM30.dqqhQ2QT5aUnweLAEQrfilsrkqdCj096oDUeg92TqNs",storageKey:"manifesto-auth-data"},v=null,b=0,y=null,w=(0,a.UU)(f.url,f.anonKey,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1,flowType:"pkce",storage:{getItem:function(){return null},setItem:function(){},removeItem:function(){}}},global:{headers:{}}});function k(){return S.apply(this,arguments)}function S(){return S=m(g().m(function e(){var t,n,a,r,i,o=arguments;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=o.length>0&&void 0!==o[0]&&o[0],n=Date.now(),!(!t&&v&&n-b<3e4)){e.n=1;break}return e.a(2,!0);case 1:if(window.authManager){e.n=2;break}return e.a(2,!1);case 2:if(window.authManager.isAuthenticated()){e.n=3;break}return e.a(2,!1);case 3:if(a=window.authManager.getToken(),r=window.authManager.getCurrentUser(),a&&r){e.n=4;break}return e.a(2,!1);case 4:return e.p=4,e.n=5,w.auth.setSession({access_token:a,refresh_token:window.authManager.refreshToken||"",expires_at:window.authManager.expiresAt||0,token_type:"bearer",user:r});case 5:if(i=e.v,!i.error){e.n=6;break}return e.a(2,!1);case 6:return v={user:r,token:a,timestamp:n},b=n,P(),e.a(2,!0);case 7:return e.p=7,e.v,e.a(2,!1)}},e,null,[[4,7]])})),S.apply(this,arguments)}function P(){y&&clearInterval(y),y=setInterval(m(g().m(function e(){var t,n;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!document.hidden){e.n=1;break}return e.a(2);case 1:return e.p=1,e.n=2,w.auth.getSession();case 2:if(n=e.v,!n.error||null===(t=window.authManager)||void 0===t||!t.isAuthenticated()){e.n=3;break}return e.n=3,k(!0);case 3:e.n=5;break;case 4:e.p=4,e.v;case 5:return e.a(2)}},e,null,[[1,4]])})),3e5)}var E=function(){return l(function e(){c(this,e),this.user=null,this.token=null,this.refreshToken=null,this.expiresAt=null,this.storageKey=f.storageKey,this.isInitialized=!1,this.initPromise=null},[{key:"init",value:(s=m(g().m(function e(){var t=this;return g().w(function(e){for(;;)switch(e.n){case 0:if(!this.initPromise){e.n=1;break}return e.a(2,this.initPromise);case 1:return this.initPromise=m(g().m(function e(){return g().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t.loadFromStorage(),!t.token||!t.isTokenExpired()){e.n=4;break}return e.p=1,e.n=2,t.refreshAccessToken();case 2:e.n=4;break;case 3:e.p=3,e.v,t.logout();case 4:return setTimeout(function(){t.user&&document.dispatchEvent(new CustomEvent("authStateChanged",{detail:{user:t.user,isAuthenticated:t.isAuthenticated()}})),document.dispatchEvent(new CustomEvent("authReady",{detail:{authManager:t,isReady:!0}}))},100),t.isInitialized=!0,e.a(2,t)}},e,null,[[1,3]])}))(),e.a(2,this.initPromise)}},e,this)})),function(){return s.apply(this,arguments)})},{key:"loadFromStorage",value:function(){try{var e=localStorage.getItem(this.storageKey);if(!e)return!1;var t=JSON.parse(e);return(Date.now()-(t.savedAt||0))/864e5>7?(localStorage.removeItem(this.storageKey),!1):(this.user=t.user,this.token=t.token,this.refreshToken=t.refreshToken,this.expiresAt=t.expiresAt,!0)}catch(e){try{localStorage.removeItem(this.storageKey)}catch(e){}return!1}}},{key:"saveToStorage",value:function(){try{return localStorage.setItem(this.storageKey,JSON.stringify({user:this.user,token:this.token,refreshToken:this.refreshToken,expiresAt:this.expiresAt,savedAt:Date.now()})),!0}catch(e){return!1}}},{key:"isTokenExpired",value:function(){if(!this.expiresAt)return!0;var e=Math.floor(Date.now()/1e3);return this.expiresAt-60<e}},{key:"isAuthenticated",value:function(){return this.token&&!this.isTokenExpired()}},{key:"onLoginSuccess",value:(i=m(g().m(function e(t){var n,a,r,i;return g().w(function(e){for(;;)switch(e.n){case 0:if(null===(n=t.data)||void 0===n||!n.session){e.n=1;break}return a=t.data,r=a.session,i=a.user,this.user=i,this.token=r.access_token,this.refreshToken=r.refresh_token,this.expiresAt=r.expires_at,this.saveToStorage(),Promise.all([k(!0),new Promise(function(e){document.dispatchEvent(new CustomEvent("authStateChanged",{detail:{user:i,isAuthenticated:!0,source:"login"}})),document.dispatchEvent(new CustomEvent("loginSuccess",{detail:{user:i}})),e()})]),e.a(2,!0);case 1:return e.a(2,!1)}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"onSignupSuccess",value:(r=m(g().m(function e(t){var n,a,r;return g().w(function(e){for(;;)switch(e.n){case 0:if(null===(n=t.data)||void 0===n||!n.user){e.n=2;break}if(a=t.data,r=a.user,!a.session){e.n=1;break}return e.a(2,this.onLoginSuccess(t));case 1:return this.user=r,this.token=null,this.refreshToken=null,this.expiresAt=null,document.dispatchEvent(new CustomEvent("signupSuccess",{detail:{user:r}})),e.a(2,!0);case 2:return e.a(2,!1)}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"logout",value:function(){var e=this.user;this.user=null,this.token=null,this.refreshToken=null,this.expiresAt=null,v=null;try{localStorage.removeItem(this.storageKey),localStorage.removeItem("supabase.auth.token")}catch(e){}document.dispatchEvent(new CustomEvent("authStateChanged",{detail:{user:null,isAuthenticated:!1,source:"logout",oldUser:e}})),document.dispatchEvent(new CustomEvent("logout",{detail:{oldUser:e}}))}},{key:"getCurrentUser",value:function(){return this.user}},{key:"getToken",value:function(){return this.token}},{key:"getAuthHeaders",value:function(){var e={apikey:f.anonKey,"Content-Type":"application/json"};return this.token&&(e.Authorization="Bearer ".concat(this.token)),e}},{key:"refreshAccessToken",value:(a=m(g().m(function e(){var t,n;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.refreshToken){e.n=1;break}return e.a(2,!1);case 1:return e.p=1,e.n=2,fetch("https://diydajlvfdvujiogryte.supabase.co/auth/v1/token?grant_type=refresh_token",{method:"POST",headers:{"Content-Type":"application/json",apikey:f.anonKey},body:JSON.stringify({refresh_token:this.refreshToken})});case 2:if((t=e.v).ok){e.n=3;break}return 400===t.status&&this.logout(),e.a(2,!1);case 3:return e.n=4,t.json();case 4:return n=e.v,this.token=n.access_token,this.refreshToken=n.refresh_token,this.expiresAt=Math.floor(Date.now()/1e3)+n.expires_in,this.saveToStorage(),document.dispatchEvent(new CustomEvent("tokenRefreshed",{detail:{user:this.user,expiresAt:this.expiresAt}})),e.a(2,!0);case 5:return e.p=5,e.v,e.a(2,!1)}},e,this,[[1,5]])})),function(){return a.apply(this,arguments)})},{key:"supabaseRequest",value:(n=m(g().m(function e(t){var n,a,r,i,s=arguments;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},e.p=1,a=this.getAuthHeaders(),n.method&&["POST","PATCH","PUT"].includes(n.method)&&(a["Content-Type"]="application/json"),Object.assign(a,n.headers||{}),r="https://diydajlvfdvujiogryte.supabase.co/rest/v1/".concat(t),e.n=2,fetch(r,o(o({},n),{},{headers:a}));case 2:if(401!==(i=e.v).status||!this.refreshToken){e.n=5;break}return e.n=3,this.refreshAccessToken();case 3:if(!e.v){e.n=5;break}return a.Authorization="Bearer ".concat(this.token),e.n=4,fetch(r,o(o({},n),{},{headers:a}));case 4:i=e.v;case 5:return e.a(2,i);case 6:throw e.p=6,e.v;case 7:return e.a(2)}},e,this,[[1,6]])})),function(e){return n.apply(this,arguments)})},{key:"getUserProfile",value:(t=m(g().m(function e(){var t,n;return g().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.user){e.n=1;break}return e.a(2,null);case 1:return e.p=1,e.n=2,this.supabaseRequest("profiles?user_id=eq.".concat(this.user.id,"&select=*"),{method:"GET"});case 2:if(!(t=e.v).ok){e.n=4;break}return e.n=3,t.json();case 3:return n=e.v,e.a(2,n[0]||null);case 4:e.n=6;break;case 5:e.p=5,e.v;case 6:return e.a(2,null)}},e,this,[[1,5]])})),function(){return t.apply(this,arguments)})},{key:"updateUserProfile",value:(e=m(g().m(function e(t){return g().w(function(e){for(;;)switch(e.n){case 0:if(this.user){e.n=1;break}return e.a(2,null);case 1:return e.a(2,this.supabaseRequest("profiles?user_id=eq.".concat(this.user.id),{method:"PATCH",body:JSON.stringify(t)}))}},e,this)})),function(t){return e.apply(this,arguments)})}]);var e,t,n,a,r,i,s}(),I=function(){return l(function e(){c(this,e),this.isConnected=!1},[{key:"ensureConnection",value:(e=m(g().m(function e(){var t,n;return g().w(function(e){for(;;)switch(e.n){case 0:if(!this.isConnected){e.n=1;break}return e.a(2,!0);case 1:if(null===(t=window.authManager)||void 0===t||!t.isAuthenticated()){e.n=3;break}return e.n=2,k();case 2:n=e.v,this.isConnected=n,e.n=4;break;case 3:this.isConnected=!0;case 4:return e.a(2,this.isConnected)}},e,this)})),function(){return e.apply(this,arguments)})},{key:"disconnect",value:function(){this.isConnected=!1,v=null}},{key:"handleVisibilityChange",value:function(){var e=this;document.addEventListener("visibilitychange",function(){document.hidden||e.ensureConnection().catch(console.error)})}}]);var e}(),C=function(){return l(function e(){c(this,e),this.loadedScripts=new Set},[{key:"loadScript",value:(e=m(g().m(function e(t){var n=this;return g().w(function(e){for(;;)switch(e.n){case 0:if(!this.loadedScripts.has(t)){e.n=1;break}return e.a(2);case 1:return e.a(2,new Promise(function(e){var a=document.createElement("script");a.src="/js/".concat(t),a.async=!1,a.onload=function(){n.loadedScripts.add(t),e()},a.onerror=function(){e()},document.body.appendChild(a)}))}},e,this)})),function(t){return e.apply(this,arguments)})}]);var e}(),D=null,B=null,T=null;function j(){return D||(D=new E,"undefined"!=typeof window&&(window.authManager=D),D.init()),D}function L(){return B||(B=new I,"undefined"!=typeof window&&(window.supabaseManager=B,B.handleVisibilityChange())),B}function M(){return T||(T=new C,"undefined"!=typeof window&&(window.pageScriptManager=T)),T}function x(){return A.apply(this,arguments)}function A(){return(A=m(g().m(function e(){return g().w(function(e){for(;;)switch(e.n){case 0:j(),L(),M(),"undefined"!=typeof window&&(window.supabase=w,window.restoreSupabaseSession=k,window.updateSupabaseAuth=function(){var e;if(null!==(e=window.authManager)&&void 0!==e&&e.isAuthenticated()){var t=window.authManager.getToken();w.auth.setSession({access_token:t,refresh_token:window.authManager.refreshToken||"",expires_at:window.authManager.expiresAt||0,token_type:"bearer",user:window.authManager.getCurrentUser()}).catch(function(e){}),v={token:t,user:window.authManager.getCurrentUser(),timestamp:Date.now()}}else w.auth.setSession(null),v=null}),document.addEventListener("authStateChanged",function(){window.updateSupabaseAuth&&window.updateSupabaseAuth()}),document.addEventListener("visibilitychange",function(){var e;!document.hidden&&null!==(e=window.authManager)&&void 0!==e&&e.isAuthenticated()&&k().catch(console.error)});case 1:return e.a(2)}},e)}))).apply(this,arguments)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",x):x()},7421:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(t){if(null!=t){var n=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],a=0;if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&a>=t.length&&(t=void 0),{value:t&&t[a++],done:!t}}}}throw new TypeError(e(t)+" is not iterable")}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,i,o,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=i.call(n)).done)&&(s.push(a.value),s.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw r}}return s}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw o}}}}function r(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function o(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function i(n,a,r,i){var o=a&&a.prototype instanceof u?a:u,l=Object.create(o.prototype);return s(l,"_invoke",function(n,a,r){var i,o,s,u=0,l=r||[],d=!1,g={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,o=0,s=e,g.n=n,c}};function p(n,a){for(o=n,s=a,t=0;!d&&u&&!r&&t<l.length;t++){var r,i=l[t],p=g.p,h=i[2];n>3?(r=h===a)&&(s=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=e):i[0]<=p&&((r=n<2&&p<i[1])?(o=0,g.v=a,g.n=i[1]):p<h&&(r=n<3||i[0]>a||a>h)&&(i[4]=n,i[5]=a,g.n=h,o=0))}if(r||n>1)return c;throw d=!0,a}return function(r,l,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,h),o=l,s=h;(t=o<2?e:s)||!d;){i||(o?o<3?(o>1&&(g.n=-1),p(o,s)):g.n=s:g.v=s);try{if(u=2,i){if(o||(r="next"),t=i[r]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,o<2&&(o=0)}else 1===o&&(t=i.return)&&t.call(i),o<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),o=1);i=e}else if((t=(d=g.n<0)?s:n.call(a,g))!==c)break}catch(t){i=e,o=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,r,i),!0),l}var c={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var g=[][a]?t(t([][a]())):(s(t={},a,function(){return this}),t),p=d.prototype=u.prototype=Object.create(g);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,r,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,s(p,"constructor",d),s(d,"constructor",l),l.displayName="GeneratorFunction",s(d,r,"GeneratorFunction"),s(p),s(p,r,"Generator"),s(p,a,function(){return this}),s(p,"toString",function(){return"[object Generator]"}),(o=function(){return{w:i,m:h}})()}function s(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}s=function(e,t,n,a){if(t)r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n;else{var i=function(t,n){s(e,t,function(e){return this._invoke(t,n,e)})};i("next",0),i("throw",1),i("return",2)}},s(e,t,n,a)}function c(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var i=e.apply(t,n);function o(e){c(i,a,r,o,s,"next",e)}function s(e){c(i,a,r,o,s,"throw",e)}o(void 0)})}}function l(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,d(a.key),a)}}function d(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var r=a.call(t,n||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}!function(e){"use strict";"undefined"!=typeof pdfjsLib&&(pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js");var r=0,i=0,s=function(){return s=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pdfDoc=null,this.currentPage=1,this.totalPages=0,this.scale=1,this.baseScale=1,this.isLoading=!1,this.canvases=new Map,this.thumbnails=new Map,this.renderQueue=[],this.isRendering=!1,this.isFullscreen=!1,this.isDragging=!1,this.startX=0,this.startY=0,this.scrollLeft=0,this.scrollTop=0,this.viewMode="single",this.currentSpread=1,this.pageGap=20,this.saddleHelpShown=!1,this.thumbnailsLoaded=!1,this.preventUrlChange=!1,this.printModalBound=!1,this.cleanupDragEvents=null,this.cleanupLinkHandler=null,this.isPrinting=!1,this.dragThreshold=5,this.hasDragged=!1,this.isDraggingActive=!1,this.dragProtectionTimer=null,this.lastDragEndTime=0,this.navigationLocked=!1,this.originalNavigate=null,this.originalPushState=null,this.originalReplaceState=null,this.contentType=null,this.images=[],this.imageObjects=new Map,this.methodsBound=!1,this.readerHelpShown=!1,this.readerHelpTimer=null,this.initialized=!1},c=[{key:"destroy",value:function(){this.unlockNavigation(),this.cleanupDragEvents&&this.cleanupDragEvents(),this.cleanupLinkHandler&&this.cleanupLinkHandler(),document.querySelectorAll('iframe[id^="print-iframe-"]').forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),this.isPrinting=!1,this.resizeHandler&&(e.removeEventListener("resize",this.resizeHandler),this.resizeHandler=null),this.resizeTimeout&&clearTimeout(this.resizeTimeout)}},{key:"preloadImage",value:(A=u(o().m(function e(t){return o().w(function(e){for(;;)if(0===e.n)return e.a(2,new Promise(function(e,n){var a=new Image;a.onload=function(){i++;var t=30+Math.round(i/r*70),n=document.getElementById("progressFill"),o=document.getElementById("progressText");n&&o&&r>0&&(n.style.width="".concat(t,"%"),o.textContent="".concat(t,"%")),e(a)},a.onerror=function(){i++;var e=30+Math.round(i/r*70),a=document.getElementById("progressFill"),o=document.getElementById("progressText");a&&o&&r>0&&(a.style.width="".concat(e,"%"),o.textContent="".concat(e,"%")),n(new Error("Failed to load: ".concat(t)))},a.src=t}))},e)})),function(e){return A.apply(this,arguments)})},{key:"preloadImages",value:(x=u(o().m(function e(t){var n,a=this;return o().w(function(e){for(;;)switch(e.n){case 0:return n=t.map(function(){var e=u(o().m(function e(t){var n;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!(t<1||t>a.totalPages)){e.n=1;break}return e.a(2);case 1:if(!a.imageObjects.has(t)){e.n=2;break}return e.a(2);case 2:return e.p=2,(n=new Image).crossOrigin="anonymous",e.n=3,new Promise(function(e,r){n.onload=function(){a.imageObjects.set(t,n),e()},n.onerror=r,n.src=a.images[t-1]});case 3:e.n=5;break;case 4:e.p=4,e.v;case 5:return e.a(2)}},e,null,[[2,4]])}));return function(t){return e.apply(this,arguments)}}()),e.n=1,Promise.all(n);case 1:return e.a(2)}},e)})),function(e){return x.apply(this,arguments)})},{key:"updateProgress",value:function(e,t){var n=document.getElementById("progressFill"),a=document.getElementById("progressText");if(n&&a&&t>0){var r=Math.round(e/t*100);n.style.width=r+"%",a.textContent=r+"%"}}},{key:"init",value:(M=u(o().m(function t(n){var a,r=this;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,!this.initialized){t.n=1;break}return t.a(2);case 1:if(this.createUI(),this.initDragScroll(),!n.pdfUrl){t.n=3;break}return this.contentType="pdf",t.n=2,this.loadPDF(n.pdfUrl);case 2:setTimeout(function(){r.showReaderHelp()},800),t.n=6;break;case 3:if(!n.imagesFolder&&!n.images){t.n=5;break}return this.contentType="images",t.n=4,this.loadImages(n);case 4:setTimeout(function(){r.showReaderHelp()},800),t.n=6;break;case 5:throw new Error("未提供有效的内容源（pdfUrl 或 imagesFolder/images）");case 6:this.resizeHandler=function(){clearTimeout(r.resizeTimeout),r.resizeTimeout=setTimeout(function(){"single"===r.viewMode&&(r.canvases.delete(r.currentPage),r.displaySinglePage(r.currentPage))},300)},e.addEventListener("resize",this.resizeHandler),this.ensureA4ButtonHandler(),this.initialized=!0,t.n=8;break;case 7:t.p=7,a=t.v,this.showError("Failed to load content: "+a.message);case 8:return t.a(2)}},t,this,[[0,7]])})),function(e){return M.apply(this,arguments)})},{key:"loadPDF",value:(L=u(o().m(function e(t){var n,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,this.showLoading(!0),n=pdfjsLib.getDocument(t),e.n=1,n.promise;case 1:return this.pdfDoc=e.v,this.totalPages=this.pdfDoc.numPages,this.updatePageInfo(),e.n=2,this.loadPage(this.currentPage);case 2:this.showLoading(!1),this.showReaderHelp(),e.n=4;break;case 3:e.p=3,a=e.v,this.showError("PDF加载失败: "+a.message);case 4:return e.a(2)}},e,this,[[0,3]])})),function(e){return L.apply(this,arguments)})},{key:"ensureA4ButtonHandler",value:function(){var e=this,t=document.getElementById("a4ModeBtn");if(t){var n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),n.onclick=function(t){t.preventDefault(),t.stopPropagation();var n="single"===e.viewMode?"saddle":"single";e.setViewMode(n),"saddle"===n&&e.showSaddleHelp()}}}},{key:"showReaderHelp",value:function(){if(!this.readerHelpShown&&"single"===this.viewMode){var e=document.getElementById("readerHelp");e&&(this.readerHelpTimer&&clearTimeout(this.readerHelpTimer),e.style.display="none",e.style.animation="none",e.offsetHeight,e.style.display="block",e.style.animation="slideIn 0.3s ease",this.readerHelpShown=!0,this.readerHelpTimer=setTimeout(function(){e.style.animation="slideOut 0.3s ease",setTimeout(function(){e.style.display="none"},280)},6e3))}}},{key:"showSaddleHelp",value:function(){var e=document.getElementById("saddleHelp");e&&(e.style.display="none",e.offsetHeight,e.style.display="block",setTimeout(function(){e.style.display="none"},6e3))}},{key:"loadImages",value:(j=u(o().m(function e(t){var n,a=this;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,this.showLoading(!0),!t.imagesFolder){e.n=2;break}return e.n=1,this.loadImagesFromFolder(t.imagesFolder,t.totalPages);case 1:this.images=e.v;case 2:if(0!==this.images.length){e.n=3;break}throw new Error("未找到任何图片");case 3:return this.images.sort(function(e,t){var n=a.extractImageName(e)||"",r=a.extractImageName(t)||"",i=String(n),o=String(r);return i.localeCompare(o,void 0,{numeric:!0})}),this.totalPages=this.images.length,this.updatePageInfo(),e.n=4,this.preloadImages([1,2,3]);case 4:return e.n=5,this.loadPage(this.currentPage);case 5:this.showLoading(!1),this.showReaderHelp(),e.n=7;break;case 6:e.p=6,n=e.v,this.showError("图片文件夹加载失败: "+n.message);case 7:return e.a(2)}},e,this,[[0,6]])})),function(e){return j.apply(this,arguments)})},{key:"extractImageName",value:function(e){if(!e||"string"!=typeof e)return"";var t=e.split("/");return t[t.length-1].replace(/\.[^/.]+$/,"")||""}},{key:"loadImagesFromFolder",value:(T=u(o().m(function e(t){var n,s,c,l,d,g,p,h,m,f,v,b,y,w,k,S,P,E,I,C,D,B,T,j,L,M,x,A,O,N,_,R=this,U=arguments;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:n=U.length>1&&void 0!==U[1]?U[1]:null,t.endsWith("/")||(t+="/"),s=["jpg","jpeg","png","webp","gif"],c=[function(e){return String(e).padStart(3,"0")},function(e){return String(e).padStart(4,"0")},function(e){return String(e).padStart(2,"0")},function(e){return String(e)}],l=null,d=null,g=0,(p=document.getElementById("loadingText"))&&(p.textContent="Verifying format..."),h=function(){var e=u(o().m(function e(t){var n;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch(t,{method:"HEAD"});case 1:return n=e.v,e.a(2,n.ok);case 2:return e.p=2,e.v,e.a(2,!1)}},e,null,[[0,2]])}));return function(t){return e.apply(this,arguments)}}(),m=0,f=[0,1];case 1:if(!(m<f.length)){e.n=16;break}v=f[m],b=a(c),e.p=2,b.s();case 3:if((y=b.n()).done){e.n=12;break}w=y.value,k=a(s),e.p=4,k.s();case 5:if((S=k.n()).done){e.n=8;break}return P=S.value,E=w(v),I="".concat(t).concat(E,".").concat(P),e.n=6,h(I);case 6:if(!e.v){e.n=7;break}return l=P,d=w,g=v,e.a(3,16);case 7:e.n=5;break;case 8:e.n=10;break;case 9:e.p=9,N=e.v,k.e(N);case 10:return e.p=10,k.f(),e.f(10);case 11:e.n=3;break;case 12:e.n=14;break;case 13:e.p=13,_=e.v,b.e(_);case 14:return e.p=14,b.f(),e.f(14);case 15:m++,e.n=1;break;case 16:if(l){e.n=23;break}return e.p=17,e.n=18,fetch(t+"index.json");case 18:if(!(C=e.v).ok){e.n=20;break}return e.n=19,C.json();case 19:if(!(D=e.v).images){e.n=20;break}return e.a(2,D.images.map(function(e){return e.startsWith("http")?e:t+e}));case 20:e.n=22;break;case 21:e.p=21,e.v;case 22:throw new Error("无法检测到起始图片 (000.jpg 或 001.jpg)");case 23:if(B=[],!(n&&n>0)){e.n=24;break}for(T=g+n-1,j=g;j<=T;j++)B.push("".concat(t).concat(d(j),".").concat(l));e.n=33;break;case 24:p&&(p.textContent="Scanning pages..."),L=g,M=2e3,x=g;case 25:return e.n=26,h("".concat(t).concat(d(M),".").concat(l));case 26:if(!e.v){e.n=28;break}if(L=M,!((M*=2)>1e4)){e.n=27;break}return e.a(3,28);case 27:e.n=25;break;case 28:if(!(L<=M)){e.n=32;break}return A=Math.floor((L+M)/2),e.n=29,h("".concat(t).concat(d(A),".").concat(l));case 29:if(!e.v){e.n=30;break}x=A,L=A+1,e.n=31;break;case 30:M=A-1;case 31:e.n=28;break;case 32:for(O=g;O<=x;O++)B.push("".concat(t).concat(d(O),".").concat(l));case 33:return r=B.length,i=0,p&&(p.textContent="Loading ".concat(r," images...")),Promise.allSettled(B.map(function(e){return R.preloadImage(e)})),e.a(2,B)}},e,null,[[17,21],[4,9,10,11],[2,13,14,15]])})),function(e){return T.apply(this,arguments)})},{key:"createUI",value:function(){var e=this,t=document.getElementById("productDetails");t&&(t.innerHTML='\n    <div class="pdf-reader-container" id="pdfReader">\n        \x3c!-- 工具栏 --\x3e\n        <div class="pdf-toolbar">\n            <div class="toolbar-left">                   \n                <button class="toolbar-btn" id="zoomOutBtn" title="缩小">\n                    <span>−</span>\n                </button>\n                <div class="zoom-controls">\n                    <span class="zoom-percent" id="zoomPercent">100%</span>\n                </div>\n                <button class="toolbar-btn" id="zoomInBtn" title="放大">\n                    <span>+</span>\n                </button>\n                 <button class="toolbar-btn" id="resetZoomBtn" title="重置到适应窗口">\n                    ↺\n                </button>        \n                <button class="toolbar-btn" id="fullscreenBtn" title="全屏">\n                    ⛶\n                </button>\n            </div>\n            \n     \n<div class="toolbar-center">\n    <div class="pdf-navigator">\n        <button class="nav-btn" id="prevPageBtn" disabled>Prev</button>\n        \n        <div class="page-navigation-container" style="display: flex; align-items: center; gap: 10px;">\n            \x3c!-- 包裹在一个div中而不是form --\x3e\n            <div class="page-input-wrapper view-mode-single" onclick="event.stopPropagation()">\n                <input type="number" class="page-input" id="pageInput" min="1" value="1" \n                       onkeypress="if(event.key===\'Enter\'){event.preventDefault();return false;}">\n                <span>/ <span id="totalPages">?</span></span>\n            </div>\n            \n            <span class="spread-info" id="spreadInfo" style="display:none;"></span>\n        </div>\n        \n        <button class="nav-btn" id="nextPageBtn">Next</button>\n    </div>\n</div>\n            \n            <div class="toolbar-right">\n                \x3c!-- A4按钮 - 双态切换 --\x3e\n                <button class="a4-mode-btn" id="a4ModeBtn" title="切换到骑马订模式">A4</button>\n               <button class="toolbar-btn" id="printModalBtn" title="打印选择页面">\n    PRINT\n</button>\n            </div>\n        </div>\n\n        \x3c!-- 页面显示区域 --\x3e\n        <div class="pdf-pages-container" id="pdfPagesContainer">\n            <div class="pdf-viewport" id="pdfViewport">\n                \x3c!-- 页面会动态插入到这里 --\x3e\n            </div>\n            \n            \x3c!-- 加载状态 --\x3e\n   <div class="pdf-loading" id="pdfLoading">\n        <div class="loading-game-container">\n            <div class="loading-title"></div>\n            <div class="progress-bar-container">\n                <div class="progress-bar">\n                    \x3c!-- ⚠️ 确保这个ID存在 --\x3e\n                    <div class="progress-fill" id="progressFill"></div>\n                </div>\n                \x3c!-- ⚠️ 确保这个ID存在 --\x3e\n                <div class="progress-text" id="progressText">0%</div>\n            </div>\n          \n        </div>\n    </div>\n            \n\n       \x3c!-- 单页模式提示 --\x3e\n            <div class="reader-help" id="readerHelp" style="display:none;">\n                <div class="reader-help-content">\n                    <h4>Page Navigation</h4>\n                    <p>Desktop: Use ← → keys or click the left/right buttons to flip pages.</p>\n                    <p>Mobile: Tap the left half (previous page) or right half (next page) of the screen.</p>                  \n                </div>\n            </div>\n      \n  \n\n\n            \x3c!-- 骑马订模式提示 --\x3e\n            <div class="saddle-help" id="saddleHelp" style="display:none;">\n                <div class="help-content">\n                    <h4>Saddle-Stitch Mode (for A4 Home Printing)</h4>\n                    <p>Pages are automatically arranged as consecutive spreads on A4 sheets.</p>\n                    <p>Use this mode to preview the correct page order before printing booklets or manuals on your home printer.</p>                  \n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class="mobile-page-nav"> \n        <div class="pdf-navigator">\n            <button class="nav-btn" id="mobilePrevPageBtn" disabled>Prev</button>\n            \n            <div class="page-navigation-container" style="display: flex; align-items: center; gap: 10px;">\n                <div class="page-input-wrapper view-mode-single" onclick="event.stopPropagation()">\n                    <input type="number" class="page-input" id="mobilePageInput" min="1" value="1" \n                           onkeypress="if(event.key===\'Enter\'){event.preventDefault();return false;}">\n                    <span>/ <span id="mobileTotalPages">?</span></span>\n                </div>\n                \n                <span class="spread-info" id="mobileSpreadInfo" style="display:none;"></span>\n            </div>\n            \n            <button class="nav-btn" id="mobileNextPageBtn">Next</button>\n        </div>\n    </div>\n    ',setTimeout(function(){e.addFullscreenEventListeners()},100),this.bindEvents(),this.bindMobileEvents())}},{key:"bindMobileEvents",value:function(){var e=this,t=document.getElementById("mobilePrevPageBtn");t&&t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.prevPage()});var n=document.getElementById("mobileNextPageBtn");n&&n.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.nextPage()});var a=document.getElementById("mobilePageInput");a&&(a.addEventListener("change",function(t){t.preventDefault(),t.stopPropagation(),e.goToPage(parseInt(t.target.value))}),a.addEventListener("keydown",function(t){"Enter"===t.key&&(t.preventDefault(),t.stopPropagation(),e.goToPage(parseInt(t.target.value)),t.target.blur())}))}},{key:"generateA4PrintOptions",value:function(){var e=document.getElementById("printModalContent");e&&(e.innerHTML='\n        <div class="print-options-container" onclick="event.stopPropagation()">\n            \x3c!-- 对开页选择在最上方 --\x3e\n            <div class="spread-selection-section">\n                \n                <div class="selection-controls">\n                    <button class="a4-selection-btn" id="selectAllBtn">Select All Pages\n</button>\n                    <button class="a4-selection-btn" id="selectNoneBtn">Deselect All\n</button>\n                    <button class="a4-selection-btn" id="selectOddBtn">Select Odd Pages</button>\n                    <button class="a4-selection-btn" id="selectEvenBtn">Select Even Pages</button>\n                </div>\n                \n              \n                \n                <div class="a4-page-selection-grid" id="pageSelectionGrid">\n                    \x3c!-- 对开页选择项会动态插入 --\x3e\n                </div>\n            </div>\n            \n            <div class="print-settings-grid">\n                \x3c!-- 左下：打印设置 --\x3e\n                <div class="print-basic-settings">\n                    <h4>Print Settings</h4>\n                    \n                    <div class="orientation-selector">\n                        <label class="bold">Paper Orientation</label>\n                        <div class="orientation-buttons">\n                           \n                            <button class="orientation-btn active" id="orientationLandscape">Landscape</button>\n                             <button class="orientation-btn " id="orientationPortrait">Portrait</button>\n                        </div>\n                       \n                    </div>\n                    \n                    <div class="margin-controls">\n                        <label class="bold">Margin Settings (mm)</label>\n                        \n                        <div class="margin-inputs-grid">\n                            \x3c!-- 订口 (装订边) --\x3e\n                            <div class="margin-input">\n                                <label>Gutter</label>\n                                <input type="number" id="marginGutter" min="0" max="50" value="0">\n                               \n                            </div>\n                            \n                         \n                            \n                            \x3c!-- 天头 --\x3e\n                            <div class="margin-input">\n        <label>Top & Bottom</label>\n        <input type="number" id="marginVertical" min="0" max="50" value="20">\n   \n    </div>\n                        </div>\n                    </div>\n                </div>\n                \n                \x3c!-- 右下：A4对开打印设置 --\x3e\n                <div class="print-advanced-settings">\n                    <h4>A4 Spread Print Preview</h4>\n                    \n                    <div class="preview-canvas-container">\n                        <canvas id="printPreviewCanvas"></canvas>\n                        <div id="printPreviewInfo"></div>\n                    </div>\n                    \n                \n                    \n                  \n                </div>\n            </div>\n        </div>\n    ',this.generateA4PageSelectionList(),this.initializeA4PrintPreview())}},{key:"setPrintMode",value:function(e){var t=document.getElementById("printModeSpread"),n=document.getElementById("printModeSingle");t&&n&&("spread"===e?(t.classList.add("active"),n.classList.remove("active")):(t.classList.remove("active"),n.classList.add("active")),this.generatePageSelectionList(),this.updatePrintPreview())}},{key:"initializeA4PrintPreview",value:function(){var e=this,t=document.getElementById("printPreviewCanvas"),n=document.getElementById("printPreviewInfo");if(t&&n){t.width=500,t.height=700,this.updateA4PrintPreview(),["orientationPortrait","orientationLandscape","marginGutter","marginTop","marginBottom","printCropMarks","printPageNumbers","printBleedMarks"].forEach(function(t){var n=document.getElementById(t);n&&("button"===n.type?n.addEventListener("click",function(){setTimeout(function(){return e.updateA4PrintPreview()},100)}):"checkbox"!==n.type&&"number"!==n.type&&"text"!==n.type||(n.addEventListener("input",function(){setTimeout(function(){return e.updateA4PrintPreview()},100)}),n.addEventListener("change",function(){setTimeout(function(){return e.updateA4PrintPreview()},100)})))});var a=document.getElementById("pageSelectionGrid");a&&a.addEventListener("change",function(){setTimeout(function(){return e.updateA4PrintPreview()},100)})}}},{key:"updateA4PrintPreview",value:function(){var e,t,n,a=document.getElementById("printPreviewCanvas");if(a){var r=a.getContext("2d");if(r){r.clearRect(0,0,a.width,a.height);var i=null===(e=document.getElementById("orientationLandscape"))||void 0===e?void 0:e.classList.contains("active"),o=3.78*parseInt((null===(t=document.getElementById("marginGutter"))||void 0===t?void 0:t.value)||20),s=3.78*parseInt((null===(n=document.getElementById("marginVertical"))||void 0===n?void 0:n.value)||20),c=s,u=s,l=794,d=1123;if(this.canvases.size>0){var g=this.canvases.values().next().value;g&&(l=g.width,d=g.height)}var p,h,m=i?1123:794,f=i?794:1123,v=1*Math.min(a.width/m,a.height/f);i?(p=(a.width-m*v)/2,h=0):(p=(a.width-m*v)/2,h=(a.height-f*v)/2),r.save(),r.translate(p,h),r.scale(v,v),r.fillStyle="white",r.fillRect(0,0,m,f),r.strokeStyle="#333",r.lineWidth=2,r.strokeRect(0,0,m,f),r.strokeStyle="#4CAF50",r.lineWidth=1,r.setLineDash([5,3]);var b=m/2,y=10;r.beginPath(),r.moveTo(b-5-o,c),r.lineTo(b-5-o,f-u),r.stroke(),r.beginPath(),r.moveTo(b+5+o,c),r.lineTo(b+5+o,f-u),r.stroke(),r.beginPath(),r.moveTo(0,c),r.lineTo(m,c),r.stroke(),r.beginPath(),r.moveTo(0,f-u),r.lineTo(m,f-u),r.stroke(),r.setLineDash([]);var w,k,S,P,E=b-5-o,I=c,C=f-c-u,D=l/d,B=E/C;D>B?(w=E,S=0,P=I+(C-(k=E/D))/2):(k=C,S=0+(E-(w=C*D))/2,P=I),r.fillStyle="#e8f4f8",r.fillRect(S,P,w,k),r.strokeStyle="#999",r.lineWidth=1,r.strokeRect(S,P,w,k),r.fillStyle="#f0f0f0",r.fillRect(b-5,I,y,C),r.strokeStyle="#666",r.strokeRect(b-5,I,y,C);var T=b+5+o,j=m-T;D>B?(w=j,S=T,P=I+(C-(k=j/D))/2):(k=C,S=T+(j-(w=C*D))/2,P=I),r.fillStyle="#f8e8f8",r.fillRect(S,P,w,k),r.strokeStyle="#999",r.strokeRect(S,P,w,k),r.restore()}}}},{key:"showPrintModal",value:function(){var e=this,t=document.getElementById("printModalOverlay"),n=document.getElementById("printModalContent");if(t&&n){if("block"===t.style.display)return this.hidePrintModal(),void setTimeout(function(){e.showPrintModal()},100);"saddle"===this.viewMode?this.showA4PrintModal():this.showSimplePrintModal()}}},{key:"showSimplePrintModal",value:function(){var t=this,n=document.getElementById("printModalOverlay"),a=document.getElementById("printModalContent");this.thumbnailsLoaded=!1,a.innerHTML='\n        <div style="text-align: center; padding: 40px;">\n            <div class="loading-spinner" style="margin: 0 auto 20px;"></div>\n            <div>Loading page thumbnails...</div>\n        </div>\n    ',n.style.display="block",document.body.style.overflow="hidden",this.savedRouter=e.router,e.router&&e.router.navigate&&(this.originalNavigate=e.router.navigate,e.router.navigate=function(){}),this.loadAllThumbnails().then(function(){t.generateSimplePageSelectionList(),t.bindSimplePrintModalEvents(),setTimeout(function(){t.updatePrintButtonState()},100)}).catch(function(e){t.generateSimplePageSelectionList(),t.bindSimplePrintModalEvents(),setTimeout(function(){t.updatePrintButtonState()},100)})}},{key:"showA4PrintModal",value:(B=u(o().m(function t(){var n,a,r,i;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n=document.getElementById("printModalOverlay"),(a=document.getElementById("printModalContent")).innerHTML='\n        <div style="text-align: center; padding: 40px;">\n            <div class="loading-spinner" style="margin: 0 auto 20px;"></div>\n            <div id="printLoadingText">Loading Thumbnails & Generating Preview...</div>\n        </div>\n    ',n.style.display="block",document.body.style.overflow="hidden",this.savedRouter=e.router,e.router&&e.router.navigate&&(this.originalNavigate=e.router.navigate,e.router.navigate=function(){}),t.p=1,r=document.getElementById("printLoadingText"),this.thumbnailsLoaded){t.n=2;break}return r&&(r.textContent="Processing Thumbnails (0%)..."),t.n=2,new Promise(function(e){return setTimeout(e,50)});case 2:return t.n=3,this.loadAllThumbnails();case 3:this.generateA4PrintOptions(),this.bindA4PrintModalEvents(),this.updatePrintButtonState(),t.n=5;break;case 4:t.p=4,i=t.v,a.innerHTML='\n                <div style="text-align: center; padding: 40px; color: red;">\n                    <h3>Error</h3>\n                    <p>'.concat(i.message,"</p>\n                    <button onclick=\"document.getElementById('printModalOverlay').style.display='none'\" \n                            style=\"margin-top:20px; padding:5px 10px;\">Close</button>\n                </div>\n            ");case 5:return t.a(2)}},t,this,[[1,4]])})),function(){return B.apply(this,arguments)})},{key:"ensureThumbnails",value:(D=u(o().m(function e(){return o().w(function(e){for(;;)switch(e.n){case 0:if(this.thumbnailsLoaded){e.n=1;break}return e.n=1,this.loadAllThumbnails();case 1:return e.a(2)}},e,this)})),function(){return D.apply(this,arguments)})},{key:"hidePrintModal",value:function(){var t=document.getElementById("printModalOverlay");t&&(t.style.display="none",document.body.style.overflow=""),this.savedRouter&&this.originalNavigate&&(e.router.navigate=this.originalNavigate,delete this.savedRouter,delete this.originalNavigate),this.printModalBound=!1}},{key:"generateSimplePageSelectionList",value:function(){var e=this,t=document.getElementById("printModalContent");if(t){for(var n='\n        <div class="page-selection-section" onclick="event.stopPropagation()">\n            <div class="selection-controls">\n                <button class="selection-btn" id="selectAllBtn">Select All Pages</button>\n                <button class="selection-btn" id="selectNoneBtn">Deselect All</button>\n                <button class="selection-btn" id="selectOddBtn">Select Odd Pages</button>\n                <button class="selection-btn" id="selectEvenBtn">Select Even Pages</button>\n            </div>\n            \n            <div class="page-selection-grid" id="pageSelectionGrid" onclick="event.stopPropagation()">\n    ',a=1;a<=this.totalPages;a++){var r="Page ".concat(a),i=this.getThumbnailDataUrl(a);n+='\n            <div class="page-preview-item '.concat("selected",'" \n                 data-page="').concat(a,'" \n                 ').concat('data-selected="true"','>\n                <div class="page-preview-content">\n                    <input type="checkbox" class="page-checkbox" id="page-').concat(a,'" \n                           data-page="').concat(a,'" ').concat("checked",'>\n                    <div class="page-info">\n                        <div class="page-number">').concat(r,"</div>\n                        ").concat(i?'\n                            <div class="page-thumbnail">\n                                <img src="'.concat(i,'" alt="第').concat(a,'页缩略图" \n                                     style="width: 120px; height: auto; margin-top: 8px; \n                                            border: 1px solid #ddd; ">\n                            </div>\n                        '):'\n                            <div class="page-dimension">单页</div>\n                        ',"\n                    </div>\n                </div>\n            </div>\n        ")}n+="\n            </div>\n        </div>\n    ",t.innerHTML=n,setTimeout(function(){e.updatePrintButtonState()},0),this.bindPageSelectionEvents()}}},{key:"getSpreadThumbnailDataUrl",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e?this.thumbnails.get(e):null,r=t?this.thumbnails.get(t):null;if(!a&&!r)return"";var i=document.createElement("canvas"),o=i.getContext("2d");if(n){var s=a?a.width:0,c=r?r.width:0,u=Math.max(a?a.height:0,r?r.height:0);if(i.width=s+c+5,i.height=u,o.fillStyle="#f0f0f0",o.fillRect(0,0,i.width,i.height),a){var l=(u-a.height)/2;o.drawImage(a,0,l)}if(r){var d=s+5,g=(u-r.height)/2;o.drawImage(r,d,g)}}else{var p=210,h=297;i.width=p,i.height=h,o.fillStyle="#f0f0f0",o.fillRect(0,0,i.width,i.height);var m=0,f=0;a&&(m+=a.width,f=Math.max(f,a.height)),r&&(m+=r.width,f=Math.max(f,r.height));var v=p/m,b=h/f,y=.98*Math.min(v,b);if(a){var w=a.width*y,k=a.height*y,S=(105-w)/2,P=(h-k)/2;o.drawImage(a,S,P,w,k)}if(r){var E=r.width*y,I=r.height*y,C=105+(105-E)/2,D=(h-I)/2;o.drawImage(r,C,D,E,I)}}var B=document.createElement("canvas"),T=B.getContext("2d"),j=Math.min(180/i.width,250/i.height,1);return B.width=i.width*j,B.height=i.height*j,T.drawImage(i,0,0,B.width,B.height),B.toDataURL("image/png")}},{key:"generateA4PageSelectionList",value:function(){var e,t=this,n=document.getElementById("pageSelectionGrid");if(n){var a=null===(e=document.getElementById("orientationLandscape"))||void 0===e?void 0:e.classList.contains("active"),r="";this.calculateSaddlePairs().forEach(function(e,n){var i=n+1,o=e.leftPage,s=e.rightPage,c=t.getPageRangeText(o,s),u=t.getSpreadThumbnailDataUrl(o,s,a);r+='\n            <div class="page-preview-item selected" \n                 data-spread="'.concat(i,'" \n                 data-selected="true">\n                <div class="page-preview-content">\n                    <input type="checkbox" \n                           class="page-checkbox" \n                           id="spread-').concat(i,'" \n                           data-spread="').concat(i,'" \n                           checked>\n                    <div class="page-info">\n                        <div class="page-number">Spread ').concat(i,'</div>\n                        <div class="page-dimension">Page: ').concat(c,"</div>\n                        ").concat(u?'\n                            <div class="page-thumbnail">\n                                <img src="'.concat(u,'" \n                                     alt="对开页 ').concat(i,'"\n                                     style="width: 100%; height: auto; margin-top: 10px; \n                                            border: 1px solid #ddd;\n                                            object-fit: contain;">\n                            </div>\n                        '):'\n                            <div class="page-thumbnail-placeholder">\n                                Generating thumbnail...\n                            </div>\n                        ',"\n                    </div>\n                </div>\n            </div>\n        ")}),n.innerHTML=r,setTimeout(function(){t.updatePrintButtonState()},100),this.bindA4PageSelectionEvents()}}},{key:"bindA4PageSelectionEvents",value:function(){var e=this,t=document.getElementById("pageSelectionGrid");if(t){var n=t.querySelectorAll(".page-preview-item"),a=t.querySelectorAll(".page-checkbox");n.forEach(function(t){t.addEventListener("click",function(n){if("checkbox"!==n.target.type){var a=t.querySelector(".page-checkbox");if(a){a.checked=!a.checked,a.checked?(t.classList.add("selected"),t.setAttribute("data-selected","true")):(t.classList.remove("selected"),t.removeAttribute("data-selected"));var r=new Event("change",{bubbles:!1});a.dispatchEvent(r),e.updatePrintButtonState(),e.updateA4PrintPreview(),n.preventDefault(),n.stopPropagation()}}})}),a.forEach(function(t){t.addEventListener("change",function(n){var a=n.target.closest(".page-preview-item");a&&(t.checked?(a.classList.add("selected"),a.setAttribute("data-selected","true")):(a.classList.remove("selected"),a.removeAttribute("data-selected")),e.updatePrintButtonState(),e.updateA4PrintPreview())}),t.addEventListener("click",function(e){e.stopPropagation()})})}}},{key:"getThumbnailDataUrl",value:function(e){if(!this.thumbnails.has(e))return"";var t=this.thumbnails.get(e);if(!t)return"";var n=document.createElement("canvas"),a=n.getContext("2d"),r=t.height/t.width*120;return n.width=120,n.height=r,a.drawImage(t,0,0,t.width,t.height,0,0,120,r),n.toDataURL("image/png")}},{key:"getSaddlePageLabel",value:function(e,t){if(!t.length)return"第 ".concat(e," 页");var n,r=a(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.leftPage===e)return"第 ".concat(e," 页 (对开左)");if(i.rightPage===e)return"第 ".concat(e," 页 (对开右)")}}catch(e){r.e(e)}finally{r.f()}return"第 ".concat(e," 页")}},{key:"bindPageSelectionEvents",value:function(){var e=this,t=document.getElementById("pageSelectionGrid"),n=t.querySelectorAll(".page-preview-item"),a=t.querySelectorAll(".page-checkbox");n.forEach(function(t){t.addEventListener("click",function(n){if("checkbox"!==n.target.type){var a=t.querySelector(".page-checkbox");if(a){a.checked=!a.checked,a.checked?(t.classList.add("selected"),t.setAttribute("data-selected","true")):(t.classList.remove("selected"),t.removeAttribute("data-selected"));var r=new Event("change",{bubbles:!1});a.dispatchEvent(r),e.updatePrintButtonState(),n.preventDefault(),n.stopPropagation()}}})}),a.forEach(function(t){t.addEventListener("change",function(n){var a=n.target.closest(".page-preview-item");a&&(t.checked?(a.classList.add("selected"),a.setAttribute("data-selected","true")):(a.classList.remove("selected"),a.removeAttribute("data-selected")),e.updatePrintButtonState())}),t.addEventListener("click",function(e){e.stopPropagation()})})}},{key:"bindSimplePrintModalEvents",value:function(){var e=this;this.printModalBound=!0;var t=document.getElementById("closePrintModalBtn"),n=document.getElementById("cancelPrintBtn"),a=document.getElementById("confirmPrintBtn"),r=document.getElementById("printModalOverlay");if(a){var i=a.cloneNode(!0);a.parentNode.replaceChild(i,a),a=i}if(n){var o=n.cloneNode(!0);n.parentNode.replaceChild(o,n),n=o}var s=function(t){t.preventDefault(),t.stopPropagation(),e.hidePrintModal()};if(t){var c=t.cloneNode(!0);t.parentNode.replaceChild(c,t),c.addEventListener("click",s)}n&&n.addEventListener("click",s),a&&a.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.isPrinting||e.performSimplePrint()}),r&&(r.onclick=function(t){"printModalOverlay"===t.target.id&&(t.preventDefault(),t.stopPropagation(),e.hidePrintModal())});var u=document.getElementById("selectAllBtn"),l=document.getElementById("selectNoneBtn"),d=document.getElementById("selectOddBtn"),g=document.getElementById("selectEvenBtn");u&&u.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.selectAllPages(!0)}),l&&l.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.selectAllPages(!1)}),d&&d.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.selectOddEvenPages(!0)}),g&&g.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.selectOddEvenPages(!1)})}},{key:"bindA4PrintModalEvents",value:function(){var e=this;this.printModalBound=!0;var t=document.getElementById("closePrintModalBtn"),n=document.getElementById("cancelPrintBtn"),a=document.getElementById("confirmPrintBtn"),r=document.getElementById("printModalOverlay");if(a){var i=a.cloneNode(!0);a.parentNode.replaceChild(i,a),a=i}if(n){var o=n.cloneNode(!0);n.parentNode.replaceChild(o,n),n=o}var s=function(t){t.preventDefault(),t.stopPropagation(),e.hidePrintModal()};if(t){var c=t.cloneNode(!0);t.parentNode.replaceChild(c,t),c.addEventListener("click",s)}n&&n.addEventListener("click",s),a&&a.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.isPrinting||e.performA4Print()}),r&&(r.onclick=function(t){"printModalOverlay"===t.target.id&&(t.preventDefault(),t.stopPropagation(),e.hidePrintModal())});var u=document.getElementById("orientationPortrait"),l=document.getElementById("orientationLandscape");if(u&&l){var d=function(t){t?(l.classList.add("active"),u.classList.remove("active")):(u.classList.add("active"),l.classList.remove("active")),e.generateA4PageSelectionList(),e.updateA4PrintPreview()};u.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),d(!1)}),l.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),d(!0)})}["marginGutter","marginVertical"].forEach(function(t){var n=document.getElementById(t);n&&n.addEventListener("input",function(){e.updateA4PrintPreview()})});var g=document.getElementById("selectAllBtn"),p=document.getElementById("selectNoneBtn"),h=document.getElementById("selectOddBtn"),m=document.getElementById("selectEvenBtn"),f=document.getElementById("applyRangeBtn"),v=document.getElementById("pageRangeInput");g&&g.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.selectAllPages(!0)}),p&&p.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.selectAllPages(!1)}),h&&h.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.selectOddEvenSpreads(!0)}),m&&m.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.selectOddEvenSpreads(!1)}),f&&v&&(f.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.parseSpreadRange(v.value)}),v.addEventListener("keypress",function(t){"Enter"===t.key&&(t.preventDefault(),t.stopPropagation(),e.parseSpreadRange(v.value))}))}},{key:"parseSpreadRange",value:function(e){if(e.trim()){var t,r=new Set,i=e.split(","),o=this.calculateSaddlePairs().length,s=a(i);try{for(s.s();!(t=s.n()).done;){var c=t.value.trim();if(c.includes("-")){var u=n(c.split("-").map(function(e){return e.trim()}),2),l=u[0],d=u[1],g=Number(l),p=Number(d);if(!isNaN(g)&&!isNaN(p)&&g<=p)for(var h=g;h<=p;h++)h>=1&&h<=o&&r.add(h)}else{var m=Number(c);!isNaN(m)&&m>=1&&m<=o&&r.add(m)}}}catch(e){s.e(e)}finally{s.f()}var f=document.querySelectorAll(".page-checkbox"),v=document.querySelectorAll(".page-preview-item");f.forEach(function(e,t){var n=Number(e.dataset.spread),a=r.has(n);e.checked=a;var i=v[t];a?i.classList.add("selected"):i.classList.remove("selected")}),this.updatePrintButtonState()}}},{key:"performSimplePrint",value:(C=u(o().m(function e(){var n,a,r,i,s,c,u,l,d=this;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.isPrinting){e.n=1;break}return e.a(2);case 1:if(n=[],document.querySelectorAll(".page-checkbox:checked").forEach(function(e){var t=Number(e.dataset.page);isNaN(t)||n.push(t)}),0!==n.length){e.n=2;break}return alert("请至少选择一个页面进行打印"),e.a(2);case 2:this.isPrinting=!0,this.hidePrintModal(),e.p=3,(a=document.createElement("iframe")).id="print-iframe-"+Date.now(),a.style.position="absolute",a.style.width="0",a.style.height="0",a.style.border="none",a.style.visibility="hidden",document.body.appendChild(a),(r=a.contentDocument||a.contentWindow.document).open(),r.write("\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <title>打印 - ".concat(n.length," 页</title>\n                <style>\n                    @media print {\n                        @page {\n                            margin: 0.5in;\n                            size: auto;\n                        }\n                        body { \n                            margin: 0; \n                            padding: 0;\n                            background: white;\n                        }\n                        .print-page { \n                            page-break-after: always; \n                            page-break-inside: avoid;\n                            text-align: center;\n                            margin: 0 auto;\n                        }\n                        .print-page img {\n                            max-width: 100%;\n                            height: auto;\n                            display: block;\n                            margin: 0 auto;\n                            /* 保持原始质量，不进行任何缩放或优化 */\n                            image-rendering: auto;\n                        }\n                        .print-page:last-child { \n                            page-break-after: auto; \n                        }\n                    }\n                    body {\n                        font-family: Arial, sans-serif;\n                        margin: 0;\n                        padding: 20px;\n                    }\n                </style>\n            </head>\n            <body>\n            </body>\n            </html>\n        ")),r.close(),i=r.body,s=o().m(function e(){var t,n,a,s,l,g,p;return o().w(function(e){for(;;)switch(e.n){case 0:if(t=u[c],"pdf"!==d.contentType){e.n=2;break}return e.n=1,d.loadPage(t);case 1:(n=d.canvases.get(t))&&(a=n.toDataURL("image/png"),(s=r.createElement("div")).className="print-page",(l=r.createElement("img")).src=a,l.style.width="100%",l.style.maxWidth="100%",l.style.height="auto",s.appendChild(l),i.appendChild(s)),e.n=4;break;case 2:return(g=r.createElement("img")).src=d.images[t-1],g.style.width="100%",g.style.maxWidth="100%",g.style.height="auto",e.n=3,new Promise(function(e,t){g.onload=e,g.onerror=t});case 3:(p=r.createElement("div")).className="print-page",p.appendChild(g),i.appendChild(p);case 4:return e.a(2)}},e)}),c=0,u=n;case 4:if(!(c<u.length)){e.n=6;break}return e.d(t(s()),5);case 5:c++,e.n=4;break;case 6:setTimeout(function(){try{a.contentWindow.focus(),a.contentWindow.print()}catch(e){alert("打印失败: "+e.message)}setTimeout(function(){a&&a.parentNode&&document.body.removeChild(a),d.isPrinting=!1},2e3)},500),e.n=8;break;case 7:e.p=7,l=e.v,alert("打印过程中发生错误: "+l.message),this.isPrinting=!1;case 8:return e.a(2)}},e,this,[[3,7]])})),function(){return C.apply(this,arguments)})},{key:"selectAllPages",value:function(e){var t=document.querySelectorAll(".page-checkbox"),n=document.querySelectorAll(".page-preview-item");t.forEach(function(t,a){t.checked=e;var r=n[a];e?r.classList.add("selected"):r.classList.remove("selected")}),this.updatePrintButtonState()}},{key:"selectOddEvenPages",value:function(e){var t=document.querySelectorAll(".page-checkbox"),n=document.querySelectorAll(".page-preview-item");t.forEach(function(t,a){var r=parseInt(t.dataset.page)%2==1;e&&r||!e&&!r?(t.checked=!0,n[a].classList.add("selected")):(t.checked=!1,n[a].classList.remove("selected"))}),this.updatePrintButtonState()}},{key:"selectOddEvenSpreads",value:function(e){var t=document.querySelectorAll(".page-checkbox"),n=document.querySelectorAll(".page-preview-item");t.forEach(function(t,a){var r=parseInt(t.dataset.spread)%2==1;e&&r||!e&&!r?(t.checked=!0,n[a].classList.add("selected")):(t.checked=!1,n[a].classList.remove("selected"))}),this.updatePrintButtonState()}},{key:"parsePageRange",value:function(e){if(e.trim()){var t,r=new Set,i=a(e.split(","));try{for(i.s();!(t=i.n()).done;){var o=t.value.trim();if(o.includes("-")){var s=n(o.split("-").map(function(e){return e.trim()}),2),c=s[0],u=s[1],l=Number(c),d=Number(u);if(!isNaN(l)&&!isNaN(d)&&l<=d)for(var g=l;g<=d;g++)g>=1&&g<=this.totalPages&&r.add(g)}else{var p=Number(o);!isNaN(p)&&p>=1&&p<=this.totalPages&&r.add(p)}}}catch(e){i.e(e)}finally{i.f()}var h=document.querySelectorAll(".page-checkbox"),m=document.querySelectorAll(".page-preview-item");h.forEach(function(e,t){var n=Number(e.dataset.page),a=r.has(n);e.checked=a;var i=m[t];a?i.classList.add("selected"):i.classList.remove("selected")}),this.updatePrintButtonState()}}},{key:"generateA4PageNumbers",value:function(e,t,n){var a=(n.isLandscape?210:297)-n.marginBottom+5,r="";return e&&(r+='\n            <div class="page-number" style="left: '.concat(n.marginGutter+20,"mm; top: ").concat(a,'mm;">\n                ').concat(e,"\n            </div>\n        ")),t&&(n.isLandscape,r+='\n            <div class="page-number" style="right: '.concat(n.marginForeEdge+20,"mm; top: ").concat(a,'mm;">\n                ').concat(t,"\n            </div>\n        ")),r}},{key:"generateA4CropMarks",value:function(e){var t=e?297:210,n=e?210:297;return'\n        \x3c!-- 左上角裁切线 --\x3e\n        <div class="crop-mark" style="left: 0mm; top: 0mm;"></div>\n        <div class="crop-mark-vertical" style="left: 0mm; top: 0mm;"></div>\n        \n        \x3c!-- 右上角裁切线 --\x3e\n        <div class="crop-mark" style="left: '.concat(t-5,'mm; top: 0mm;"></div>\n        <div class="crop-mark-vertical" style="left: ').concat(t-.2,'mm; top: 0mm;"></div>\n        \n        \x3c!-- 左下角裁切线 --\x3e\n        <div class="crop-mark" style="left: 0mm; top: ').concat(n,'mm;"></div>\n        <div class="crop-mark-vertical" style="left: 0mm; top: ').concat(n-5,'mm;"></div>\n        \n        \x3c!-- 右下角裁切线 --\x3e\n        <div class="crop-mark" style="left: ').concat(t-5,"mm; top: ").concat(n,'mm;"></div>\n        <div class="crop-mark-vertical" style="left: ').concat(t-.2,"mm; top: ").concat(n-5,'mm;"></div>\n    ')}},{key:"generateA4PageImage",value:(I=u(o().m(function e(t,n,a){var r,i,s,c,u,l,d,g,p;return o().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.loadPage(t);case 1:if(r=this.canvases.get(t)){e.n=2;break}return e.a(2,"");case 2:return i=r.toDataURL("image/png"),s=a.isLandscape?297:210,c=a.isLandscape?210:297,u=s/2,"left"===n?(l=0,g=u-5-a.marginGutter,d=a.marginTop,p=c-a.marginTop-a.marginBottom):"right"===n?(l=u+5+a.marginGutter,g=s-l,d=a.marginTop,p=c-a.marginTop-a.marginBottom):(l=a.marginGutter,g=s-2*a.marginGutter,d=a.marginTop,p=c-a.marginTop-a.marginBottom),e.a(2,'\n        <img src="'.concat(i,'" class="page-image" \n             style="left: ').concat(l,"mm; top: ").concat(d,"mm; width: ").concat(g,"mm; height: ").concat(p,'mm;">\n    '))}},e,this)})),function(e,t,n){return I.apply(this,arguments)})},{key:"performA4Print",value:(E=u(o().m(function e(){var t,n,a,r,i,s,c,u,l,d,g,p,h,m,f,v,b,y,w,k,S=this;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.isPrinting){e.n=1;break}return e.a(2);case 1:if(r=null===(t=document.getElementById("orientationLandscape"))||void 0===t?void 0:t.classList.contains("active"),i=parseInt((null===(n=document.getElementById("marginGutter"))||void 0===n?void 0:n.value)||20),s=parseInt((null===(a=document.getElementById("marginVertical"))||void 0===a?void 0:a.value)||20),c=s,u=s,l=[],document.querySelectorAll(".page-checkbox:checked").forEach(function(e){e.dataset.spread&&l.push(Number(e.dataset.spread))}),0!==l.length){e.n=2;break}return alert("请至少选择一个对开页进行打印"),e.a(2);case 2:this.isPrinting=!0,this.hidePrintModal(),e.p=3,(d=document.createElement("iframe")).id="print-iframe-"+Date.now(),d.style.position="absolute",d.style.width="0",d.style.height="0",d.style.border="none",d.style.visibility="hidden",document.body.appendChild(d),g="\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <title>A4对开打印 - ".concat(l.length," 对开页</title>\n                <style>\n                    @media print {\n                        @page {\n                            size: A4 ").concat(r?"landscape":"portrait",";\n                            margin: 0;\n                        }\n                        \n                        body { \n                            margin: 0; \n                            padding: 0; \n                        }\n                        \n                        .print-sheet {\n                            width: ").concat(r?"297mm":"210mm",";\n                            height: ").concat(r?"210mm":"297mm",";\n                            position: relative;\n                            page-break-after: always;\n                            background: white;\n                        }\n                        \n                        .print-sheet:last-child {\n                            page-break-after: auto;\n                        }\n                        \n                        .page-image {\n                            position: absolute;\n                            object-fit: contain;\n                        }\n                    }\n                </style>\n            </head>\n            <body>\n        "),p=this.calculateSaddlePairs(),h=0,m=l;case 4:if(!(h<m.length)){e.n=11;break}if(f=m[h],v=p[f-1]){e.n=5;break}return e.a(3,10);case 5:if(g+='<div class="print-sheet">',!v.leftPage){e.n=7;break}return y=g,e.n=6,this.generateA4PageImage(v.leftPage,"left",{isLandscape:r,marginGutter:i,marginTop:c,marginBottom:u});case 6:g=y+=e.v;case 7:if(!v.rightPage){e.n=9;break}return w=g,e.n=8,this.generateA4PageImage(v.rightPage,"right",{isLandscape:r,marginGutter:i,marginTop:c,marginBottom:u});case 8:g=w+=e.v;case 9:g+="</div>";case 10:h++,e.n=4;break;case 11:g+="</body></html>",(b=d.contentDocument||d.contentWindow.document).open(),b.write(g),b.close(),d.onload=function(){setTimeout(function(){try{d.contentWindow.focus(),d.contentWindow.print()}catch(e){alert("打印失败: "+e.message)}setTimeout(function(){d&&d.parentNode&&document.body.removeChild(d),S.isPrinting=!1},2e3)},500)},e.n=13;break;case 12:e.p=12,k=e.v,alert("打印过程中发生错误: "+k.message),this.isPrinting=!1;case 13:return e.a(2)}},e,this,[[3,12]])})),function(){return E.apply(this,arguments)})},{key:"bindEvents",value:function(){var t=this;document.getElementById("zoomInBtn").addEventListener("click",function(){return t.zoomIn()}),document.getElementById("zoomOutBtn").addEventListener("click",function(){return t.zoomOut()}),document.getElementById("resetZoomBtn").addEventListener("click",function(){return t.resetZoom()}),document.getElementById("prevPageBtn").addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),t.prevPage()}),document.getElementById("nextPageBtn").addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),t.nextPage()});var n=document.getElementById("pageInput");n.addEventListener("change",function(e){e.preventDefault(),e.stopPropagation(),t.goToPage(parseInt(e.target.value))}),n.addEventListener("keydown",function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),t.goToPage(parseInt(e.target.value)),e.target.blur())});var a=document.getElementById("a4ModeBtn");a&&(a.onclick=function(){var e="single"===t.viewMode?"saddle":"single";t.setViewMode(e)}),document.getElementById("fullscreenBtn").addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),t.requestFullscreen()}),document.getElementById("printModalBtn").addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),t.showPrintModal()}),document.addEventListener("keydown",function(e){return t.handleKeydown(e)}),e.addEventListener("resize",function(){t.updateCursorState()}),this.preventPdfLinksNavigation()}},{key:"preventPdfLinksNavigation",value:function(){var t=this,n=document.getElementById("pdfReader");if(n){var a=function(n){var a=n.target.closest("a");if(a){var r=Date.now()-t.lastDragEndTime;if(t.isDragging||t.isDraggingActive||t.hasDragged||t.preventUrlChange||r<800)return n.preventDefault(),n.stopPropagation(),n.stopImmediatePropagation(),!1;var i=a.getAttribute("data-page");return i?(n.preventDefault(),n.stopPropagation(),e.router&&e.router.navigate&&e.router.navigate(i),!1):void 0}};n.addEventListener("click",a,!0),n.addEventListener("mousedown",a,!0),n.addEventListener("mouseup",a,!0),this.cleanupLinkHandler=function(){n.removeEventListener("click",a,!0),n.removeEventListener("mousedown",a,!0),n.removeEventListener("mouseup",a,!0)}}}},{key:"updatePrintButtonState",value:function(){var e=document.querySelectorAll(".page-checkbox:checked").length,t=document.getElementById("confirmPrintBtn");e>0?(t.disabled=!1,t.textContent="Print (".concat(e," pages)")):(t.disabled=!0,t.textContent="Print Selected Pages")}},{key:"calculateSaddlePairs",value:function(){var e=[],t=this.totalPages;this.totalPages%4!=0&&(t=4*Math.ceil(this.totalPages/4));for(var n=Math.ceil(t/2),a=0;a<n;a++){var r=void 0,i=void 0;a%2==0?(r=t-2*a/2,i=a+1):(r=a+1,i=t-2*(a-1)/2-1),e.push({spreadIndex:a,spreadNumber:a+1,leftPage:r<=this.totalPages?r:null,rightPage:i<=this.totalPages?i:null,isBlank:r>this.totalPages||i>this.totalPages,pageRange:this.getPageRangeText(r,i)})}return e}},{key:"getPageRangeText",value:function(e,t){if(e&&t){var n=Math.min(e,t),a=Math.max(e,t);return"".concat(n,"-").concat(a)}return e?"".concat(e):t?"".concat(t):""}},{key:"getCurrentSaddleSpread",value:function(){if(0===this.totalPages)return null;for(var e=this.calculateSaddlePairs(),t=null,n=0;n<e.length;n++){var a=e[n];if(a.leftPage===this.currentPage||a.rightPage===this.currentPage){t=a;break}}return!t&&e.length>0&&(t=e[0]),t}},{key:"goToSaddleSpread",value:function(e){var t=this.calculateSaddlePairs(),n=e-1;if(n>=0&&n<t.length){var a=t[n];this.currentSpread=e;var r=a.leftPage||a.rightPage;r&&(this.currentPage=r,this.updatePageInput(),this.refreshCurrentView(),this.updateNavigationButtons())}}},{key:"updatePageInput",value:function(){var e=document.getElementById("pageInput"),t=document.getElementById("mobilePageInput"),n=document.getElementById("totalPages"),a=document.getElementById("mobileTotalPages");if("saddle"===this.viewMode){var r=this.calculateSaddlePairs();e&&(e.value=this.currentSpread),n&&(n.textContent=r.length),t&&(t.value=this.currentSpread),a&&(a.textContent=r.length)}else e&&(e.value=this.currentPage),n&&(n.textContent=this.totalPages),t&&(t.value=this.currentPage),a&&(a.textContent=this.totalPages)}},{key:"setViewMode",value:function(e){if(e!==this.viewMode){this.viewMode=e,"saddle"===e?this.lockNavigation():this.unlockNavigation();var t=document.getElementById("a4ModeBtn");t&&("saddle"===e?(t.classList.add("active"),t.title="切换到单页模式"):(t.classList.remove("active"),t.title="切换到骑马订模式"));var n=document.getElementById("pdfReader");if(n&&(n.classList.remove("view-mode-single","view-mode-saddle"),n.classList.add("view-mode-".concat(e))),"saddle"===e){var a=this.getCurrentSaddleSpread();this.currentSpread=a?a.spreadNumber:1}this.updatePageInput(),this.refreshCurrentView(),this.updateSpreadInfo(),this.updateNavigationButtons()}}},{key:"lockNavigation",value:function(){var e=this;this.navigationLocked=!0,this.popstateBlocker||(this.popstateBlocker=function(t){e.navigationLocked}),this.lockAllLinks()}},{key:"unlockNavigation",value:function(){this.navigationLocked=!1,this.popstateBlocker&&e.removeEventListener("popstate",this.popstateBlocker,!0),this.unlockAllLinks()}},{key:"lockAllLinks",value:function(){var e=document.getElementById("pdfPagesContainer");e&&e.querySelectorAll("a").forEach(function(e){"true"!==e.dataset.hrefLocked&&(e.getAttribute("href")&&(e.dataset.originalHref=e.getAttribute("href"),e.removeAttribute("href"),e.style.cursor="grab"),e.dataset.hrefLocked="true",e.onclick=function(e){return e.preventDefault(),e.stopPropagation(),!1})})}},{key:"unlockAllLinks",value:function(){var e=document.getElementById("pdfReader");e&&(e.querySelectorAll('a[data-locked="true"]').forEach(function(e){e.dataset.originalHref&&(e.href=e.dataset.originalHref),e.removeAttribute("data-locked"),e.removeAttribute("data-original-href"),e.style.pointerEvents="",e.style.cursor="",e.style.textDecoration=""}),this.linkObserver&&(this.linkObserver.disconnect(),this.linkObserver=null))}},{key:"refreshAllVisiblePages",value:function(){var e=this,t=new Set;if("single"===this.viewMode)t.add(this.currentPage);else if("saddle"===this.viewMode){var n=this.getCurrentSaddleSpread();n&&(n.leftPage&&t.add(n.leftPage),n.rightPage&&t.add(n.rightPage))}t.forEach(function(t){e.canvases.delete(t)}),this.refreshCurrentView()}},{key:"refreshCurrentView",value:function(){"single"===this.viewMode?this.displaySinglePage(this.currentPage):this.displaySaddleSpread(this.currentSpread)}},{key:"displaySinglePage",value:(P=u(o().m(function e(t){var n,a,r,i,s,c=this;return o().w(function(e){for(;;)switch(e.n){case 0:if(n=document.getElementById("pdfViewport"),a=document.getElementById("pdfPagesContainer"),n.innerHTML="",!(t<1||t>this.totalPages)){e.n=1;break}return e.a(2);case 1:if(a.scrollLeft=0,a.scrollTop=0,r=this.canvases.get(t)){e.n=3;break}return e.n=2,this.renderPage(t);case 2:r=this.canvases.get(t);case 3:if(r){e.n=4;break}return e.a(2);case 4:(i=document.createElement("div")).className="pdf-page-wrapper single-page",i.style.position="static",(s=document.createElement("div")).className="pdf-canvas-container",s.appendChild(r),i.appendChild(s),n.appendChild(i),requestAnimationFrame(function(){requestAnimationFrame(function(){c.adjustViewportSize(r.width,r.height)})});case 5:return e.a(2)}},e,this)})),function(e){return P.apply(this,arguments)})},{key:"displaySaddleSpread",value:(S=u(o().m(function e(t){var n,a,r,i,s,c,u,l,d,g,p=this;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=document.getElementById("pdfViewport")){e.n=1;break}return e.a(2);case 1:if(n.innerHTML="",a=this.calculateSaddlePairs(),r=Math.max(0,Math.min(t-1,a.length-1)),i=a[r]){e.n=2;break}return e.a(2);case 2:if(e.p=2,(s=document.createElement("div")).className="pdf-page-wrapper double-page saddle-spread",s.dataset.spread=t,!i.leftPage){e.n=4;break}return e.n=3,this.getPageCanvas(i.leftPage);case 3:(c=e.v)&&((u=document.createElement("div")).className="pdf-canvas-container saddle-left",u.style.width="".concat(c.width,"px"),u.style.height="".concat(c.height,"px"),u.dataset.page=i.leftPage,u.appendChild(c),s.appendChild(u));case 4:if((l=document.createElement("div")).className="saddle-gap",l.style.width="".concat(this.pageGap,"px"),s.appendChild(l),!i.rightPage){e.n=6;break}return e.n=5,this.getPageCanvas(i.rightPage);case 5:(d=e.v)&&((g=document.createElement("div")).className="pdf-canvas-container saddle-right",g.style.width="".concat(d.width,"px"),g.style.height="".concat(d.height,"px"),g.dataset.page=i.rightPage,g.appendChild(d),s.appendChild(g));case 6:n.appendChild(s),this.currentSpread=t,this.adjustSaddleViewport(s),setTimeout(function(){return p.centerPage(s)},100),this.updateSpreadInfo(),setTimeout(function(){p.navigationLocked&&p.lockAllLinks()},200),e.n=8;break;case 7:e.p=7,e.v,this.viewMode="single",this.displaySinglePage(this.currentPage);case 8:return e.a(2)}},e,this,[[2,7]])})),function(e){return S.apply(this,arguments)})},{key:"centerPage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=document.getElementById("pdfViewport"),n=document.getElementById("pdfPagesContainer");if(e||(e=t.querySelector(".pdf-page-wrapper")),e&&t&&n){var a=e.getBoundingClientRect(),r=n.getBoundingClientRect(),i=(a.width-r.width)/2,o=(a.height-r.height)/2;n.scrollLeft=i,n.scrollTop=o}}},{key:"updateSpreadInfo",value:function(){var e=document.getElementById("spreadInfo"),t=document.getElementById("mobileSpreadInfo");if("saddle"===this.viewMode){var n=this.calculateSaddlePairs(),a=n[this.currentSpread-1],r=a?this.getPageRangeText(a.leftPage,a.rightPage):"";e&&(e.style.display="inline",e.textContent=a?"COPY ".concat(this.currentSpread,"/").concat(n.length," (").concat(r,")"):"COPY ".concat(this.currentSpread,"/").concat(n.length)),t&&(t.style.display="inline",t.textContent=a?"COPY ".concat(this.currentSpread,"/").concat(n.length," (").concat(r,")"):"COPY ".concat(this.currentSpread,"/").concat(n.length))}else e&&(e.style.display="none"),t&&(t.style.display="none")}},{key:"getPageCanvas",value:(k=u(o().m(function e(t){var n,a;return o().w(function(e){for(;;)switch(e.n){case 0:if(!(t<1||t>this.totalPages)){e.n=1;break}return e.a(2,null);case 1:if(n=this.canvases.get(t)){e.n=3;break}return e.n=2,this.renderPage(t);case 2:n=this.canvases.get(t);case 3:if(n){e.n=4;break}return e.a(2,null);case 4:return(a=document.createElement("canvas")).width=n.width,a.height=n.height,a.getContext("2d").drawImage(n,0,0),e.a(2,a)}},e,this)})),function(e){return k.apply(this,arguments)})},{key:"createSaddlePageWrapper",value:function(e,t,n){var a=document.createElement("div");a.className="pdf-canvas-container saddle-page saddle-".concat(n),a.style.width="".concat(e.width,"px"),a.style.height="".concat(e.height,"px"),a.dataset.page=t;var r=document.createElement("div");return r.className="page-number",r.textContent=t,a.appendChild(r),a.appendChild(e),a}},{key:"adjustSaddleViewport",value:function(e){var t=this,n=document.getElementById("pdfViewport"),a=document.getElementById("pdfPagesContainer");if(n&&a){var r=e.getBoundingClientRect();n.style.width="".concat(Math.max(r.width,a.clientWidth),"px"),n.style.height="".concat(Math.max(r.height,a.clientHeight),"px"),n.style.display="block",n.style.alignItems="",n.style.justifyContent="",setTimeout(function(){t.updateCursorState&&t.updateCursorState()},50)}}},{key:"adjustViewportSize",value:function(e,t){var n=this,a=document.getElementById("pdfViewport"),r=document.getElementById("pdfPagesContainer");a&&r&&("single"===this.viewMode?(a.style.width="".concat(Math.max(e,r.clientWidth),"px"),a.style.height="".concat(Math.max(t,r.clientHeight),"px"),a.style.display="flex",a.style.alignItems="center",a.style.justifyContent="center"):(a.style.width="".concat(Math.max(e,r.clientWidth),"px"),a.style.height="".concat(Math.max(t,r.clientHeight),"px"),a.style.display="block",a.style.alignItems="",a.style.justifyContent=""),setTimeout(function(){n.updateCursorState&&n.updateCursorState()},50))}},{key:"initDragScroll",value:function(){var t=this,n=document.getElementById("pdfPagesContainer");if(n){var a=0,r=0,i=0,o=function(e){if(!e.target.closest(".back-btn")){if(t.navigationLocked&&n.contains(e.target))return e.preventDefault(),e.stopPropagation(),!1;if(!e.target.closest(".back-btn")&&!e.target.closest(".nav-header")){var a=Date.now()-t.lastDragEndTime;if(t.isDragging||t.isDraggingActive||t.hasDragged||t.preventUrlChange||a<800||t.navigationLocked){var r=e.target.closest("a");if(r&&n.contains(r))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1}}}};document.addEventListener("click",o,!0),e.addEventListener("click",o,!0);var s=new MutationObserver(function(){n.querySelectorAll("a").forEach(function(e){e._clickBound||(e.addEventListener("click",function(e){if(t.isDragging||t.isDraggingActive||t.hasDragged||t.preventUrlChange||t.navigationLocked)return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1},!0),e._clickBound=!0)})});s.observe(n,{childList:!0,subtree:!0}),n.addEventListener("mousedown",function(e){var o=e.target;if(!o.closest("input")&&!o.closest("button")){a=Date.now(),r=e.clientX,i=e.clientY,n.offsetHeight;var s=n.scrollHeight>n.clientHeight+3,c=n.scrollWidth>n.clientWidth+3;if(s||c){var u=o.closest("a");n.classList.add("dragging"),n.querySelectorAll("a").forEach(function(e){return e.style.pointerEvents="none"}),u&&e.preventDefault(),Date.now(),e.clientX,e.clientY,t.hasDragged=!1,t.isDragging=!0,t.isDraggingActive=!0,t.preventUrlChange=!0,t.startX=e.clientX,t.startY=e.clientY,t.scrollLeft=n.scrollLeft,t.scrollTop=n.scrollTop,t.dragProtectionTimer&&clearTimeout(t.dragProtectionTimer),u||(e.preventDefault(),e.stopPropagation())}}}),n.addEventListener("mousemove",function(e){if(t.isDragging){e.preventDefault(),e.stopPropagation();var a=e.clientX-t.startX,r=e.clientY-t.startY;Math.sqrt(a*a+r*r)>t.dragThreshold&&(t.hasDragged=!0,t.isDraggingActive=!0),n.scrollLeft=t.scrollLeft-a,n.scrollTop=t.scrollTop-r,t.preventUrlChange=!0}});var c=function(e){if(t.isDragging){n.classList.remove("dragging"),n.querySelectorAll("a").forEach(function(e){return e.style.pointerEvents="auto"});var o=Date.now();t.isDragging=!1;var s=o-a,c=Math.sqrt(Math.pow(e.clientX-r,2)+Math.pow(e.clientY-i,2));if(s<300&&c<5&&!t.hasDragged){var u=n.getBoundingClientRect();(e.clientX-u.left)/u.width<.5?t.prevPage():t.nextPage()}t.lastDragEndTime=o;var l=t.hasDragged?1e3:300;t.dragProtectionTimer=setTimeout(function(){t.preventUrlChange=!1,t.hasDragged=!1,t.isDraggingActive=!1},l)}};n.addEventListener("mouseup",c),n.addEventListener("mouseleave",c);var u=0,l=0,d=0;n.addEventListener("touchstart",function(e){e.target.closest("button")||e.target.closest("input")||(d=Date.now(),u=e.touches[0].clientX,l=e.touches[0].clientY,t.isDragging=!0,t.isDraggingActive=!0,n.classList.add("dragging"),t.startX=e.touches[0].clientX,t.startY=e.touches[0].clientY,t.scrollLeft=n.scrollLeft,t.scrollTop=n.scrollTop)}),n.addEventListener("touchmove",function(e){if(t.isDragging){e.preventDefault();var a=e.touches[0].clientX-t.startX,r=e.touches[0].clientY-t.startY;n.scrollLeft=t.scrollLeft-a,n.scrollTop=t.scrollTop-r,t.hasDragged=!0}});var g=function(e){if(t.isDragging){t.isDragging=!1,n.classList.remove("dragging");var a=Date.now()-d,r=e.changedTouches?e.changedTouches[0].clientX:u,i=e.changedTouches?e.changedTouches[0].clientY:l,o=Math.sqrt(Math.pow(r-u,2)+Math.pow(i-l,2));if(a<300&&o<10&&!t.hasDragged&&e.changedTouches){var s=n.getBoundingClientRect();(r-s.left)/s.width<.5?t.prevPage():t.nextPage()}t.lastDragEndTime=Date.now(),setTimeout(function(){t.hasDragged=!1,t.isDraggingActive=!1},500)}};n.addEventListener("touchend",g),n.addEventListener("touchcancel",g),this.cleanupDragEvents=function(){document.removeEventListener("click",o,!0),e.removeEventListener("click",o,!0),s.disconnect(),t.dragProtectionTimer&&clearTimeout(t.dragProtectionTimer)}}}},{key:"generateImageThumbnail",value:(w=u(o().m(function e(t){var n,a,r,i,s,c,u=this;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.thumbnails.has(t)){e.n=1;break}return e.a(2);case 1:if(e.p=1,n=this.imageObjects.get(t)){e.n=3;break}return(n=new Image).crossOrigin="anonymous",e.n=2,new Promise(function(e,a){n.onload=e,n.onerror=a,n.src=u.images[t-1]});case 2:this.imageObjects.set(t,n);case 3:a=document.createElement("canvas"),r=a.getContext("2d"),i=n.width,s=n.height,(i>200||s>300)&&(c=Math.min(200/i,300/s),i*=c,s*=c),a.width=i,a.height=s,r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(n,0,0,i,s),this.addWatermark(a,r),this.thumbnails.set(t,a),e.n=5;break;case 4:e.p=4,e.v;case 5:return e.a(2)}},e,this,[[1,4]])})),function(e){return w.apply(this,arguments)})},{key:"loadThumbnail",value:(y=u(o().m(function e(t){var n,a,r,i,s,c,u,l;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.thumbnails.has(t)){e.n=1;break}return e.a(2,this.thumbnails.get(t));case 1:return e.p=1,e.n=2,this.pdfDoc.getPage(t);case 2:return n=e.v,a=n.getViewport({scale:1}),r=200/a.width,i=300/a.height,s=Math.min(r,i,.5),c=n.getViewport({scale:s}),u=document.createElement("canvas"),l=u.getContext("2d"),u.width=c.width,u.height=c.height,e.n=3,n.render({canvasContext:l,viewport:c}).promise;case 3:return this.addWatermark(u,l),this.thumbnails.set(t,u),e.a(2,u);case 4:return e.p=4,e.v,e.a(2,null)}},e,this,[[1,4]])})),function(e){return y.apply(this,arguments)})},{key:"loadPage",value:(b=u(o().m(function e(t){var n,a,r,i,s,c,u,l=this;return o().w(function(e){for(;;)switch(e.n){case 0:if(!(t<1||t>this.totalPages)){e.n=1;break}return e.a(2);case 1:this.currentPage=t,this.updatePageInfo(),this.updatePageInput(),"saddle"===this.viewMode&&(n=this.getCurrentSaddleSpread(),this.currentSpread=n?n.spreadNumber:1),this.updateNavigationButtons(),a=[],this.canvases.has(t)||a.push(t),"saddle"===this.viewMode&&(r=this.getCurrentSaddleSpread())&&(r.leftPage&&!this.canvases.has(r.leftPage)&&a.push(r.leftPage),r.rightPage&&!this.canvases.has(r.rightPage)&&a.push(r.rightPage)),i=0,s=a;case 2:if(!(i<s.length)){e.n=4;break}return c=s[i],e.n=3,this.renderPage(c);case 3:i++,e.n=2;break;case 4:"images"===this.contentType&&(u=[t-1,t+1,t+2].filter(function(e){return e>=1&&e<=l.totalPages&&!l.imageObjects.has(e)})).length>0&&this.preloadImages(u).catch(function(e){}),this.refreshCurrentView();case 5:return e.a(2)}},e,this)})),function(e){return b.apply(this,arguments)})},{key:"generateSpreadThumbnail",value:(v=u(o().m(function e(t,n){var a,r,i,s,c,u,l,d,g,p,h,m,f,v,b,y,w,k,S=arguments;return o().w(function(e){for(;;)switch(e.n){case 0:if(a=S.length>2&&void 0!==S[2]&&S[2],t||n){e.n=1;break}return e.a(2,null);case 1:if(r=t?this.thumbnails.get(t):null,i=n?this.thumbnails.get(n):null,r||i){e.n=2;break}return e.a(2,null);case 2:return s=document.createElement("canvas"),c=s.getContext("2d"),a?(u=Math.max(r?r.width:0,i?i.width:0),l=(r?r.height:0)+(i?i.height:0)+10,s.width=u,s.height=l,c.fillStyle="#f8f8f8",c.fillRect(0,0,s.width,s.height),r&&(d=(u-r.width)/2,c.drawImage(r,d,0)),i&&(g=(u-i.width)/2,p=(r?r.height:0)+10,c.drawImage(i,g,p))):(h=(r?r.width:0)+(i?i.width:0)+10,m=Math.max(r?r.height:0,i?i.height:0),s.width=h,s.height=m,c.fillStyle="#f8f8f8",c.fillRect(0,0,s.width,s.height),r&&(f=(m-r.height)/2,c.drawImage(r,0,f)),i&&(v=(r?r.width:0)+10,b=(m-i.height)/2,c.drawImage(i,v,b))),y=document.createElement("canvas"),w=y.getContext("2d"),k=Math.min(180/s.width,250/s.height,1),y.width=s.width*k,y.height=s.height*k,w.drawImage(s,0,0,y.width,y.height),e.a(2,y.toDataURL("image/png"))}},e,this)})),function(e,t){return v.apply(this,arguments)})},{key:"updateNavigationButtons",value:function(){var e=document.getElementById("prevPageBtn"),t=document.getElementById("nextPageBtn"),n=document.getElementById("mobilePrevPageBtn"),a=document.getElementById("mobileNextPageBtn");if("single"===this.viewMode)e&&(e.disabled=this.currentPage<=1),t&&(t.disabled=this.currentPage>=this.totalPages),n&&(n.disabled=this.currentPage<=1),a&&(a.disabled=this.currentPage>=this.totalPages);else{var r=this.calculateSaddlePairs();e&&(e.disabled=this.currentSpread<=1),t&&(t.disabled=this.currentSpread>=r.length),n&&(n.disabled=this.currentSpread<=1),a&&(a.disabled=this.currentSpread>=r.length)}}},{key:"renderPage",value:(f=u(o().m(function e(t){var n,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.isRendering){e.n=1;break}return this.renderQueue.push(t),e.a(2);case 1:if(this.isRendering=!0,e.p=2,"pdf"!==this.contentType){e.n=4;break}return e.n=3,this.renderPDFPage(t);case 3:n=e.v,e.n=6;break;case 4:if("images"!==this.contentType){e.n=6;break}return e.n=5,this.renderImagePage(t);case 5:n=e.v;case 6:n&&this.canvases.set(t,n),e.n=8;break;case 7:e.p=7,e.v;case 8:return e.p=8,this.isRendering=!1,this.renderQueue.length>0&&(a=this.renderQueue.shift(),this.renderPage(a)),e.f(8);case 9:return e.a(2)}},e,this,[[2,7,8,9]])})),function(e){return f.apply(this,arguments)})},{key:"renderImagePage",value:(m=u(o().m(function e(t){var n,a,r,i,s,c,u,l,d,g,p,h,m,f,v,b,y=this;return o().w(function(e){for(;;)switch(e.n){case 0:if(n=document.getElementById("pdfPagesContainer"),a=this.imageObjects.get(t)){e.n=2;break}return(a=new Image).crossOrigin="anonymous",e.n=1,new Promise(function(e,n){a.onload=e,a.onerror=n,a.src=y.images[t-1]});case 1:this.imageObjects.set(t,a);case 2:return"single"===this.viewMode?(i=n.clientWidth-40,s=n.clientHeight-40,c=i/a.width,u=s/a.height,this.baseScale=Math.min(c,u),r=this.baseScale*this.scale):(l=n.clientWidth-40,d=n.clientHeight-40,g=l/a.width,p=d/a.height,h=Math.min(g,p,2)*this.scale,r=h),m=document.createElement("canvas"),f=m.getContext("2d"),m.className="pdf-canvas",v=a.width*r,b=a.height*r,m.width=v,m.height=b,f.drawImage(a,0,0,v,b),this.addWatermark(m,f),e.a(2,m)}},e,this)})),function(e){return m.apply(this,arguments)})},{key:"renderPDFPage",value:(h=u(o().m(function e(t){var n,a,r,i,s,c,u,l,d,g,p,h,m,f,v,b,y,w;return o().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.pdfDoc.getPage(t);case 1:return n=e.v,a=document.getElementById("pdfPagesContainer"),r=n.getViewport({scale:1}),i=r.width,s=r.height,"single"===this.viewMode?(u=a.clientWidth-40,l=a.clientHeight-40,d=u/i,g=l/s,this.baseScale=Math.min(d,g),c=this.baseScale*this.scale):(p=a.clientWidth-40,h=a.clientHeight-40,m=p/i,f=h/s,v=Math.min(m,f,2)*this.scale,c=v),b=document.createElement("canvas"),y=b.getContext("2d"),b.className="pdf-canvas",w=n.getViewport({scale:c}),b.width=w.width,b.height=w.height,e.n=2,n.render({canvasContext:y,viewport:w}).promise;case 2:return this.addWatermark(b,y),e.a(2,b)}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"updateCursorState",value:function(){var e=document.getElementById("pdfPagesContainer");if(e){var t=e.scrollWidth>e.clientWidth+3,n=e.scrollHeight>e.clientHeight+3,a=t||n;e.style.cursor=a?"grab":"default"}}},{key:"addWatermark",value:function(e,t){t.save(),t.globalAlpha=.1,t.fillStyle="#000000";var n=Math.min(30,e.width/10);t.font="bold ".concat(n,"px Arial"),t.textAlign="center",t.textBaseline="middle",t.translate(e.width/2,e.height/2),t.rotate(-Math.PI/4),t.fillText("PREVIEW",0,0),t.fillText("MANIFESTOCLUB.CN",0,1.3*n),t.restore()}},{key:"zoomIn",value:function(){this.scale=Math.min(this.scale+.1,3),this.updateZoom(),"single"===this.viewMode?(this.canvases.delete(this.currentPage),this.displaySinglePage(this.currentPage)):this.refreshAllVisiblePages(),this.thumbnailsLoaded=!1}},{key:"zoomOut",value:function(){this.scale=Math.max(this.scale-.1,.5),this.updateZoom(),"single"===this.viewMode?(this.canvases.delete(this.currentPage),this.displaySinglePage(this.currentPage)):this.refreshAllVisiblePages(),this.thumbnailsLoaded=!1}},{key:"resetZoom",value:function(){this.scale=1,this.updateZoom(),"single"===this.viewMode?(this.canvases.delete(this.currentPage),this.displaySinglePage(this.currentPage)):this.refreshAllVisiblePages(),this.thumbnailsLoaded=!1}},{key:"updateZoom",value:function(){var e=Math.round(100*this.scale);document.getElementById("zoomPercent").textContent="".concat(e,"%"),this.updateCursorState()}},{key:"refreshPage",value:function(){var e=this,t=[this.currentPage];"double"===this.viewMode&&this.currentPage+1<=this.totalPages&&t.push(this.currentPage+1),t.forEach(function(t){return e.canvases.delete(t)}),this.loadPage(this.currentPage)}},{key:"prevPage",value:function(){"single"===this.viewMode?this.currentPage>1&&this.loadPage(this.currentPage-1):this.currentSpread>1&&this.goToSaddleSpread(this.currentSpread-1)}},{key:"nextPage",value:function(){if("single"===this.viewMode)this.currentPage<this.totalPages&&this.loadPage(this.currentPage+1);else{var e=this.calculateSaddlePairs();this.currentSpread<e.length&&this.goToSaddleSpread(this.currentSpread+1)}}},{key:"goToPage",value:function(e){var t=Math.max(1,Math.min(e,this.totalPages));if("saddle"===this.viewMode){var n=this.calculateSaddlePairs(),a=Math.max(1,Math.min(e,n.length));this.goToSaddleSpread(a)}else this.loadPage(t)}},{key:"updatePageInfo",value:function(){var e=document.getElementById("totalPages"),t=document.getElementById("mobileTotalPages");if(e||t)if("saddle"===this.viewMode){var n=this.calculateSaddlePairs();e&&(e.textContent=n.length),t&&(t.textContent=n.length)}else e&&(e.textContent=this.totalPages),t&&(t.textContent=this.totalPages)}},{key:"handleKeydown",value:function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName){switch(e.key){case"Escape":this.isFullscreen&&(e.preventDefault(),this.exitFullscreen());break;case"ArrowLeft":case"ArrowUp":case"PageUp":e.preventDefault(),this.prevPage();break;case"ArrowRight":case"ArrowDown":case"PageDown":e.preventDefault(),this.nextPage();break;case"+":case"=":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.zoomIn());break;case"-":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),this.zoomOut())}var t=document.getElementById("printModalOverlay");return t&&"block"===t.style.display&&"Escape"===e.key?(e.preventDefault(),void this.hidePrintModal()):void 0}}},{key:"showLoading",value:function(e){var t=document.getElementById("pdfLoading");t&&(t.style.display=e?"block":"none")}},{key:"showError",value:function(e){var t=document.getElementById("pdfReader");t&&(t.innerHTML='\n                        <div class="pdf-error">\n                            <h3>PDF Preview</h3>\n                            <p>'.concat(e,"</p>\n                        </div>\n                    "))}},{key:"requestFullscreen",value:(p=u(o().m(function e(){var t;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=document.getElementById("pdfReader")){e.n=1;break}return e.a(2);case 1:if(e.p=1,!t.requestFullscreen){e.n=3;break}return e.n=2,t.requestFullscreen();case 2:e.n=6;break;case 3:if(!t.webkitRequestFullscreen){e.n=5;break}return e.n=4,t.webkitRequestFullscreen();case 4:e.n=6;break;case 5:if(!t.msRequestFullscreen){e.n=6;break}return e.n=6,t.msRequestFullscreen();case 6:this.isFullscreen=!0,e.n=8;break;case 7:e.p=7,e.v;case 8:return e.a(2)}},e,this,[[1,7]])})),function(){return p.apply(this,arguments)})},{key:"exitFullscreen",value:(g=u(o().m(function e(){return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!document.exitFullscreen){e.n=2;break}return e.n=1,document.exitFullscreen();case 1:e.n=3;break;case 2:if(!document.webkitExitFullscreen){e.n=3;break}return e.n=3,document.webkitExitFullscreen();case 3:this.isFullscreen=!1,e.n=5;break;case 4:e.p=4,e.v;case 5:return e.a(2)}},e,this,[[0,4]])})),function(){return g.apply(this,arguments)})},{key:"addFullscreenEventListeners",value:function(){var e=this,t=function(){var t=!(!document.fullscreenElement&&!document.webkitFullscreenElement);e.isFullscreen=t};document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t)}}],c&&l(s.prototype,c),d&&l(s,d),Object.defineProperty(s,"prototype",{writable:!1}),s;var s,c,d,g,p,h,m,f,v,b,y,w,k,S,P,E,I,C,D,B,T,j,L,M,x,A}();e.PDFReader=s,e.createPDFReader=function(){return new s},e.renderPDFPreview=function(){var t=u(o().m(function t(n){var a,r,i;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(a=document.getElementById("productDetails")){t.n=1;break}return t.a(2);case 1:if(t.p=1,e.pdfReader&&("function"==typeof e.pdfReader.destroy&&e.pdfReader.destroy(),e.pdfReader=null),n&&(n.pdfUrl||n.imagesFolder||n.images)){t.n=2;break}return t.a(2);case 2:return r=new s,t.n=3,r.init(n);case 3:e.pdfReader=r,t.n=5;break;case 4:t.p=4,i=t.v,a&&(a.innerHTML='\n                    <div style="padding: 40px; text-align: center;">\n                        <h3>无法加载内容</h3>\n                        <p style="color: #666;">'.concat(i.message,"</p>\n                    </div>\n                "));case 5:return t.a(2)}},t,null,[[1,4]])}));return function(e){return t.apply(this,arguments)}}()}(window)},8399:()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,i,o,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=i.call(n)).done)&&(s.push(a.value),s.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw r}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=Array(t);n<t;n++)a[n]=e[n];return a}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function i(t,n,a){return(n=function(t){var n=function(t,n){if("object"!=e(t)||!t)return t;var a=t[Symbol.toPrimitive];if(void 0!==a){var r=a.call(t,n||"default");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"==e(n)?n:n+""}(n))in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t}function o(){var e,t,n="function"==typeof Symbol?Symbol:{},a=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function i(n,a,r,i){var o=a&&a.prototype instanceof u?a:u,l=Object.create(o.prototype);return s(l,"_invoke",function(n,a,r){var i,o,s,u=0,l=r||[],d=!1,g={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,o=0,s=e,g.n=n,c}};function p(n,a){for(o=n,s=a,t=0;!d&&u&&!r&&t<l.length;t++){var r,i=l[t],p=g.p,h=i[2];n>3?(r=h===a)&&(s=i[(o=i[4])?5:(o=3,3)],i[4]=i[5]=e):i[0]<=p&&((r=n<2&&p<i[1])?(o=0,g.v=a,g.n=i[1]):p<h&&(r=n<3||i[0]>a||a>h)&&(i[4]=n,i[5]=a,g.n=h,o=0))}if(r||n>1)return c;throw d=!0,a}return function(r,l,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,h),o=l,s=h;(t=o<2?e:s)||!d;){i||(o?o<3?(o>1&&(g.n=-1),p(o,s)):g.n=s:g.v=s);try{if(u=2,i){if(o||(r="next"),t=i[r]){if(!(t=t.call(i,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,o<2&&(o=0)}else 1===o&&(t=i.return)&&t.call(i),o<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),o=1);i=e}else if((t=(d=g.n<0)?s:n.call(a,g))!==c)break}catch(t){i=e,o=1,s=t}finally{u=1}}return{value:t,done:d}}}(n,r,i),!0),l}var c={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var g=[][a]?t(t([][a]())):(s(t={},a,function(){return this}),t),p=d.prototype=u.prototype=Object.create(g);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,r,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,s(p,"constructor",d),s(d,"constructor",l),l.displayName="GeneratorFunction",s(d,r,"GeneratorFunction"),s(p),s(p,r,"Generator"),s(p,a,function(){return this}),s(p,"toString",function(){return"[object Generator]"}),(o=function(){return{w:i,m:h}})()}function s(e,t,n,a){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}s=function(e,t,n,a){if(t)r?r(e,t,{value:n,enumerable:!a,configurable:!a,writable:!a}):e[t]=n;else{var i=function(t,n){s(e,t,function(e){return this._invoke(t,n,e)})};i("next",0),i("throw",1),i("return",2)}},s(e,t,n,a)}function c(e,t,n,a,r,i,o){try{var s=e[i](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(a,r)}function u(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var i=e.apply(t,n);function o(e){c(i,a,r,o,s,"next",e)}function s(e){c(i,a,r,o,s,"throw",e)}o(void 0)})}}!function(){"use strict";if(!window.CartManager){var e="undefined"!=typeof window&&"localhost"===window.location.hostname?"http://localhost:3001":"";window.TSHIRT_PRICING={blank:{white:69,black:69,colored:69},"single-sided":{white:79,black:89,colored:89},"double-sided":{white:89,black:99,colored:99}},window.CartManager={initialized:!1,getCart:function(e){return u(o().m(function e(){var t,a,r,i;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,n();case 1:if(t=e.v){e.n=2;break}return e.a(2,[]);case 2:if(a=t.id,window.supabase){e.n=3;break}return e.a(2,[]);case 3:return e.n=4,supabase.from("cart_items").select("*").eq("user_id",a);case 4:if(r=e.v,i=r.data,!r.error){e.n=5;break}return e.a(2,[]);case 5:return e.a(2,i||[]);case 6:return e.p=6,e.v,e.a(2,[])}},e,null,[[0,6]])}))()},generateMergeKey:function(e,t,n){return"blank-tshirt"===e?"blank-tshirt-".concat(t):n?"custom-design":"tshirt"},addOrUpdateCartItem:function(e){var a=this;return u(o().m(function i(){var s,c,u,l,d,g,p,h,m,f,v,b,y,w,k,S,P,E,I,C,D,B,T,j,L,M,x,A,O;return o().w(function(i){for(;;)switch(i.p=i.n){case 0:if(s=e.draftId,c=e.itemData,u=e.sizes,l=e.userId,i.p=1,l){i.n=4;break}return i.n=2,n();case 2:if(d=i.v){i.n=3;break}return i.a(2,{success:!1,error:"请先登录"});case 3:l=d.id;case 4:if(g=null,!s){i.n=6;break}return i.n=5,supabase.from("cart_items").select("*").eq("user_id",l).eq("draft_id",s);case 5:p=i.v,(h=p.data)&&h.length>0&&(g=h[0]),i.n=8;break;case 6:if("blank-tshirt"!==c.type){i.n=8;break}return m="blank-tshirt-".concat(c.color),i.n=7,supabase.from("cart_items").select("*").eq("user_id",l).eq("type",m);case 7:f=i.v,(v=f.data)&&v.length>0&&(g=v[0]);case 8:if(b=c.unitPrice||29.99,y=Object.values(u).reduce(function(e,t){return e+t},0),!g){i.n=16;break}if(0!==y){i.n=12;break}return i.n=9,supabase.from("cart_items").delete().eq("id",g.id).eq("user_id",l);case 9:if(w=i.v,!(k=w.error)){i.n=10;break}return i.a(2,{success:!1,error:k.message});case 10:return i.n=11,a.updateCartBadge();case 11:return i.a(2,{success:!0,action:"removed",itemId:g.id});case 12:for(S=r({},g.sizes),P=0,E=Object.entries(u);P<E.length;P++)I=t(E[P],2),C=I[0],D=I[1],S[C]=(S[C]||0)+D;return B=b*y,i.n=13,supabase.from("cart_items").update({sizes:S,quantity:y,total_price:B,price:b,updated_at:(new Date).toISOString()}).eq("id",g.id).eq("user_id",l).select().single();case 13:if(T=i.v,T.data,!(j=T.error)){i.n=14;break}return i.a(2,{success:!1,error:j.message});case 14:return i.n=15,a.updateCartBadge();case 15:return a.showCartAddedEffect(),i.a(2,{success:!0,action:"updated",itemId:g.id,totalQuantity:y});case 16:if(0!==y){i.n=17;break}return i.a(2,{success:!1,error:"Please select at least one size"});case 17:return L={user_id:l,sizes:u,quantity:y,price:b,total_price:b*y,type:"blank-tshirt"===c.type?"blank-tshirt-".concat(c.color):c.type,draft_id:s||null,added_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},i.n=18,supabase.from("cart_items").insert([L]).select().single();case 18:if(M=i.v,x=M.data,!(A=M.error)){i.n=19;break}return i.a(2,{success:!1,error:A.message});case 19:return i.n=20,a.updateCartBadge();case 20:return a.showCartAddedEffect(),i.a(2,{success:!0,action:"added",itemId:x.id,totalQuantity:y});case 21:i.n=23;break;case 22:return i.p=22,O=i.v,i.a(2,{success:!1,error:O.message});case 23:return i.a(2)}},i,null,[[1,22]])}))()},syncDraftFromCart:function(e,t){return u(o().m(function n(){var a,i,s,c,u,l;return o().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,supabase.from("cart_items").select("*").eq("id",e).single();case 1:if(a=n.v,i=a.data,!a.error&&i){n.n=2;break}return n.a(2,!1);case 2:if(!i.draft_id){n.n=7;break}return n.n=3,supabase.from("drafts").select("*").eq("id",i.draft_id).single();case 3:if(s=n.v,c=s.data,!s.error&&c){n.n=4;break}return n.a(2,!1);case 4:return u=r(r({},c.data),{},{sizeQuantities:t}),n.n=5,supabase.from("drafts").update({data:u,sizes:t,updated_at:(new Date).toISOString()}).eq("id",i.draft_id);case 5:if(l=n.v,!l.error){n.n=6;break}return n.a(2,!1);case 6:case 7:return n.a(2,!0);case 8:return n.p=8,n.v,n.a(2,!1)}},n,null,[[0,8]])}))()},updateCartItemQuantity:function(t,a){var r=this;return u(o().m(function i(){var s,c,u;return o().w(function(i){for(;;)switch(i.p=i.n){case 0:return i.p=0,i.n=1,n();case 1:if(i.v){i.n=2;break}return alert("请先登录"),i.a(2,!1);case 2:return i.n=3,r.getAuthToken();case 3:if(s=i.v){i.n=5;break}return i.n=4,r.updateCartItemQuantityFallback(t,a);case 4:return i.a(2,i.v);case 5:return i.n=6,fetch("".concat(e,"/api/cart/items/").concat(t),{method:"PATCH",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"},body:JSON.stringify({newSizes:a})});case 6:if((c=i.v).ok){i.n=10;break}if(404!==c.status){i.n=8;break}return i.n=7,r.updateCartItemQuantityFallback(t,a);case 7:return i.a(2,i.v);case 8:return i.n=9,c.text();case 9:throw i.v,new Error("更新失败: ".concat(c.status," ").concat(c.statusText));case 10:return i.n=11,c.json();case 11:return i.v,i.n=12,r.updateCartBadge();case 12:return i.a(2,!0);case 13:return i.p=13,u=i.v,i.p=14,i.n=15,r.updateCartItemQuantityFallback(t,a);case 15:if(!i.v){i.n=16;break}return i.a(2,!0);case 16:i.n=18;break;case 17:i.p=17,i.v;case 18:return alert("更新失败: "+u.message),i.a(2,!1)}},i,null,[[14,17],[0,13]])}))()},updateCartItemQuantityFallback:function(e,t){var a=this;return u(o().m(function r(){var i,s,c,u,l,d;return o().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,r.n=1,n();case 1:if(i=r.v){r.n=2;break}return r.a(2,!1);case 2:if(s=0,Object.values(t).forEach(function(e){s+=e}),0!==s){r.n=4;break}return r.n=3,a.removeFromCartFallback(e);case 3:return r.a(2,r.v);case 4:return r.n=5,supabase.from("cart_items").select("price").eq("id",e).single();case 5:return c=r.v,u=c.data,l=((null==u?void 0:u.price)||29.99)*s,r.n=6,supabase.from("cart_items").update({quantity:s,sizes:t,total_price:l,updated_at:(new Date).toISOString()}).eq("id",e).eq("user_id",i.id);case 6:if(d=r.v,!d.error){r.n=7;break}return r.a(2,!1);case 7:return r.n=8,a.updateCartBadge();case 8:return r.a(2,!0);case 9:return r.p=9,r.v,r.a(2,!1)}},r,null,[[0,9]])}))()},getAuthToken:function(){return u(o().m(function e(){var t,n,a;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!window.authManager){e.n=1;break}if(!(t=window.authManager.getToken())){e.n=1;break}return e.a(2,t);case 1:if(!window.supabase){e.n=5;break}return e.p=2,e.n=3,supabase.auth.getSession();case 3:return n=e.v,a=n.data.session,e.a(2,null==a?void 0:a.access_token);case 4:e.p=4,e.v;case 5:return e.a(2,null)}},e,null,[[2,4]])}))()},addToCartWithBackend:function(t,a){var r=this;return u(o().m(function i(){var s,c,u,l,d;return o().w(function(i){for(;;)switch(i.p=i.n){case 0:return i.p=0,window.CartLoadingState&&window.CartLoadingState.show(),i.n=1,n();case 1:if(i.v){i.n=2;break}return window.CartLoadingState&&window.CartLoadingState.hide(),alert("请先登录"),i.a(2,{success:!1,error:"未登录"});case 2:return i.n=3,r.getAuthToken();case 3:if(s=i.v){i.n=4;break}return window.CartLoadingState&&window.CartLoadingState.hide(),alert("认证失败，请重新登录"),i.a(2,{success:!1,error:"无效的token"});case 4:return i.n=5,fetch("".concat(e,"/api/cart/add"),{method:"POST",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"},body:JSON.stringify({draftId:t,sizeQuantities:a})});case 5:if((c=i.v).ok){i.n=7;break}return i.n=6,c.json();case 6:return u=i.v,window.CartLoadingState&&window.CartLoadingState.hide(),i.a(2,{success:!1,error:u.error||"添加购物车失败"});case 7:return i.n=8,c.json();case 8:return l=i.v,window.CartLoadingState&&window.CartLoadingState.hide(),i.n=9,r.updateCartBadge();case 9:return r.showCartAddedEffect(),i.a(2,l);case 10:return i.p=10,d=i.v,window.CartLoadingState&&window.CartLoadingState.hide(),i.a(2,{success:!1,error:d.message})}},i,null,[[0,10]])}))()},getCartItems:function(){return u(o().m(function t(){var a,r,i,s;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,n();case 1:if(t.v){t.n=2;break}return t.a(2,[]);case 2:if(r=null===(a=window.authManager)||void 0===a?void 0:a.getToken()){t.n=3;break}return t.a(2,[]);case 3:return t.n=4,fetch("".concat(e,"/api/cart/items"),{headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});case 4:if((i=t.v).ok){t.n=5;break}throw new Error("获取购物车失败");case 5:return t.n=6,i.json();case 6:return s=t.v,t.a(2,s);case 7:return t.p=7,t.v,t.a(2,[])}},t,null,[[0,7]])}))()},getCartCount:function(){return u(o().m(function t(){var a,r,i,s,c,u,l,d,g,p,h,m;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,n();case 1:if(r=t.v){t.n=2;break}return t.a(2,0);case 2:if(i=null===(a=window.authManager)||void 0===a?void 0:a.getToken()){t.n=6;break}if(window.supabase){t.n=3;break}return t.a(2,0);case 3:return t.n=4,supabase.from("cart_items").select("quantity").eq("user_id",r.id);case 4:if(s=t.v,c=s.data,!s.error){t.n=5;break}return t.a(2,0);case 5:return u=c.reduce(function(e,t){return e+(t.quantity||0)},0),t.a(2,u);case 6:return t.n=7,fetch("".concat(e,"/api/cart/count"),{headers:{Authorization:"Bearer ".concat(i),"Content-Type":"application/json"}});case 7:if((l=t.v).ok){t.n=12;break}if(404!==l.status){t.n=11;break}if(window.supabase){t.n=8;break}return t.a(2,0);case 8:return t.n=9,supabase.from("cart_items").select("quantity").eq("user_id",r.id);case 9:if(d=t.v,g=d.data,!d.error){t.n=10;break}return t.a(2,0);case 10:return p=g.reduce(function(e,t){return e+(t.quantity||0)},0),t.a(2,p);case 11:throw new Error("获取失败: ".concat(l.status));case 12:return t.n=13,l.json();case 13:return h=t.v,m=h.count,t.a(2,m);case 14:return t.p=14,t.v,t.a(2,0)}},t,null,[[0,14]])}))()},removeFromCart:function(t){var a=this;return u(o().m(function r(){var i,s,c;return o().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,r.n=1,n();case 1:if(r.v){r.n=2;break}return alert("请先登录"),r.a(2,!1);case 2:if(confirm("确定要从购物车中移除这个商品吗？")){r.n=3;break}return r.a(2,!1);case 3:return r.n=4,a.getAuthToken();case 4:if(i=r.v){r.n=6;break}return r.n=5,a.removeFromCartFallback(t);case 5:return r.a(2,r.v);case 6:return r.n=7,fetch("".concat(e,"/api/cart/items/").concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(i),"Content-Type":"application/json"}});case 7:if((s=r.v).ok){r.n=11;break}if(404!==s.status){r.n=9;break}return r.n=8,a.removeFromCartFallback(t);case 8:return r.a(2,r.v);case 9:return r.n=10,s.text();case 10:throw r.v,new Error("删除失败: ".concat(s.status," ").concat(s.statusText));case 11:return r.n=12,s.json();case 12:return r.v,r.n=13,a.updateCartBadge();case 13:return r.a(2,!0);case 14:return r.p=14,c=r.v,r.p=15,r.n=16,a.removeFromCartFallback(t);case 16:if(!r.v){r.n=17;break}return r.a(2,!0);case 17:r.n=19;break;case 18:r.p=18,r.v;case 19:return alert("删除失败: "+c.message),r.a(2,!1)}},r,null,[[15,18],[0,14]])}))()},removeFromCartFallback:function(e){var t=this;return u(o().m(function a(){var r,i;return o().w(function(a){for(;;)switch(a.p=a.n){case 0:return a.p=0,a.n=1,n();case 1:if(r=a.v){a.n=2;break}return a.a(2,!1);case 2:return a.n=3,supabase.from("cart_items").delete().eq("id",e).eq("user_id",r.id);case 3:if(i=a.v,!i.error){a.n=4;break}return a.a(2,!1);case 4:return a.n=5,t.updateCartBadge();case 5:return a.a(2,!0);case 6:return a.p=6,a.v,a.a(2,!1)}},a,null,[[0,6]])}))()},getCartTotal:function(){return u(o().m(function t(){var a,r,i,s,c;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,n();case 1:if(t.v){t.n=2;break}return t.a(2,0);case 2:if(r=null===(a=window.authManager)||void 0===a?void 0:a.getToken()){t.n=3;break}return t.a(2,0);case 3:return t.n=4,fetch("".concat(e,"/api/cart/total"),{headers:{Authorization:"Bearer ".concat(r),"Content-Type":"application/json"}});case 4:if((i=t.v).ok){t.n=5;break}throw new Error("计算总价失败");case 5:return t.n=6,i.json();case 6:return s=t.v,c=s.total,t.a(2,c);case 7:return t.p=7,t.v,t.a(2,0)}},t,null,[[0,7]])}))()},checkout:function(){var e=this;return u(o().m(function t(){var n,a,r,i,s,c,u;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,supabase.auth.getUser();case 1:if(n=t.v,a=n.data.user){t.n=2;break}return alert("请先登录"),t.a(2,null);case 2:return t.n=3,e.getCartItems();case 3:if(0!==(r=t.v).length){t.n=4;break}return alert("购物车是空的"),t.a(2,null);case 4:return t.n=5,e.getCartTotal();case 5:return i=t.v,s="ORD-"+Date.now()+"-"+Math.random().toString(36).substr(2,9).toUpperCase(),t.n=6,supabase.from("orders").insert([{user_id:a.id,order_number:s,items:r,total_amount:i,status:"pending"}]).select().single();case 6:if(c=t.v,u=c.data,!c.error){t.n=7;break}return alert("创建订单失败"),t.a(2,null);case 7:return t.n=8,supabase.from("cart_items").delete().eq("user_id",a.id);case 8:return t.n=9,e.updateCartBadge();case 9:return alert("订单创建成功！\n订单号: ".concat(s,"\n总金额: ¥").concat(i.toFixed(2))),t.a(2,u);case 10:return t.p=10,t.v,alert("结账失败，请重试"),t.a(2,null)}},t,null,[[0,10]])}))()},testApiConnection:function(){return u(o().m(function t(){var n,a;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("".concat(e,"/api/health"),{method:"GET",headers:{"Content-Type":"application/json"}});case 1:if(n=t.v,!(a=n.ok)){t.n=3;break}return t.n=2,n.json();case 2:t.v;case 3:return t.a(2,a);case 4:return t.p=4,t.v,t.a(2,!1)}},t,null,[[0,4]])}))()},initCartIcon:function(){var e=this;return u(o().m(function t(){return o().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!e.initialized){t.n=1;break}return t.a(2);case 1:return t.p=2,t.n=3,e.testApiConnection();case 3:setTimeout(u(o().m(function t(){return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,n();case 1:if(!t.v){t.n=3;break}return t.n=2,e.updateCartBadge();case 2:e.showCartIcon(),t.n=4;break;case 3:e.hideCartIcon();case 4:t.n=6;break;case 5:t.p=5,t.v,e.hideCartIcon();case 6:e.initialized=!0;case 7:return t.a(2)}},t,null,[[0,5]])})),1e3),t.n=5;break;case 4:t.p=4,t.v,e.initialized=!0;case 5:return t.a(2)}},t,null,[[2,4]])}))()},updateCartBadge:function(){var e=this;return u(o().m(function t(){var n,a,r,i;return o().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,e.getCartCount();case 1:n=t.v,a=document.getElementById("cartIcon"),r=document.getElementById("cartBadge"),i=document.getElementById("cartBadgeMobile"),r&&(r.textContent=n,r.classList.add("updated"),setTimeout(function(){r.classList.remove("updated")},200)),a&&(n>0?e.showCartIcon():e.hideCartIcon()),i&&(i.textContent=n,i.classList.add("updated"),setTimeout(function(){return i.classList.remove("updated")},200)),t.n=3;break;case 2:t.p=2,t.v,e.hideCartIcon();case 3:return t.a(2)}},t,null,[[0,2]])}))()},showCartIcon:function(){var e=document.getElementById("cartIcon");window.innerWidth<=899?e&&(e.style.display="none"):e&&(e.style.display="block",e.classList.add("show"),e.classList.add("bounce"),setTimeout(function(){e.classList.remove("bounce")},300))},hideCartIcon:function(){var e=document.getElementById("cartIcon");window.innerWidth<=899?e&&(e.style.display="none"):e&&(e.style.display="none",e.classList.remove("show"))},showCartAddedEffect:function(){var e=document.createElement("div");e.className="cart-notification",e.textContent="Added to cart!",e.style.cssText="\n            position: fixed;\n            top: 0px;\n            right: 0px;\n            background: black;\n            color: white;\n            z-index: 9999;\n            font-size: 20px;\n            animation: slideIn 0.3s ease-out;\n            ",document.body.appendChild(e),setTimeout(function(){e.style.animation="slideOut 0.3s ease",setTimeout(function(){document.body.contains(e)&&document.body.removeChild(e)},300)},2e3)}},window.addToCartWithBackend=CartManager.addToCartWithBackend.bind(CartManager),window.getCartItems=CartManager.getCartItems.bind(CartManager),window.getCartCount=CartManager.getCartCount.bind(CartManager),window.updateCartItemQuantity=CartManager.updateCartItemQuantity.bind(CartManager),window.removeFromCart=CartManager.removeFromCart.bind(CartManager),window.getCartTotal=CartManager.getCartTotal.bind(CartManager),window.checkout=CartManager.checkout.bind(CartManager),window.updateCartBadge=CartManager.updateCartBadge.bind(CartManager)}function n(){return a.apply(this,arguments)}function a(){return(a=u(o().m(function e(){var t,n;return o().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!window.authManager||!window.authManager.isAuthenticated()){e.n=1;break}return e.a(2,window.authManager.getCurrentUser());case 1:return e.p=1,e.n=2,supabase.auth.getUser();case 2:return t=e.v,n=t.data.user,e.a(2,n);case 3:return e.p=3,e.v,e.a(2,null)}},e,null,[[1,3]])}))).apply(this,arguments)}}(),document.addEventListener("DOMContentLoaded",function(){setTimeout(u(o().m(function e(){return o().w(function(e){for(;;)switch(e.n){case 0:if(!window.CartManager||"function"!=typeof window.CartManager.initCartIcon){e.n=2;break}return e.n=1,window.CartManager.initCartIcon();case 1:e.n=3;break;case 2:case 3:return e.a(2)}},e)})),500)}),"loading"!==document.readyState&&setTimeout(u(o().m(function e(){return o().w(function(e){for(;;)switch(e.n){case 0:if(!window.CartManager||"function"!=typeof window.CartManager.initCartIcon){e.n=1;break}return e.n=1,window.CartManager.initCartIcon();case 1:return e.a(2)}},e)})),100)}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}};return a[e].call(n.exports,n,n.exports,i),n.exports}i.m=a,e=[],i.O=(t,n,a,r)=>{if(!n){var o=1/0;for(l=0;l<e.length;l++){for(var[n,a,r]=e[l],s=!0,c=0;c<n.length;c++)(!1&r||o>=r)&&Object.keys(i.O).every(e=>i.O[e](n[c]))?n.splice(c--,1):(s=!1,r<o&&(o=r));if(s){e.splice(l--,1);var u=a();void 0!==u&&(t=u)}}return t}r=r||0;for(var l=e.length;l>0&&e[l-1][2]>r;l--)e[l]=e[l-1];e[l]=[n,a,r]},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var r=Object.create(null);i.r(r);var o={};t=t||[null,n({}),n([]),n(n)];for(var s=2&a&&e;("object"==typeof s||"function"==typeof s)&&!~t.indexOf(s);s=n(s))Object.getOwnPropertyNames(s).forEach(t=>o[t]=()=>e[t]);return o.default=()=>e,i.d(r,o),r},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.j=682,(()=>{var e={682:0};i.O.j=t=>0===e[t];var t=(t,n)=>{var a,r,[o,s,c]=n,u=0;if(o.some(t=>0!==e[t])){for(a in s)i.o(s,a)&&(i.m[a]=s[a]);if(c)var l=c(i)}for(t&&t(n);u<o.length;u++)r=o[u],i.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return i.O(l)},n=self.webpackChunk=self.webpackChunk||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),i.O(void 0,[96,869],()=>i(6443)),i.O(void 0,[96,869],()=>i(1)),i.O(void 0,[96,869],()=>i(5392)),i.O(void 0,[96,869],()=>i(2238)),i.O(void 0,[96,869],()=>i(5230)),i.O(void 0,[96,869],()=>i(8399)),i.O(void 0,[96,869],()=>i(7421)),i.O(void 0,[96,869],()=>i(4843));var o=i.O(void 0,[96,869],()=>i(7283));o=i.O(o)})();