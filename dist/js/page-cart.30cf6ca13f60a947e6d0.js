/*! For license information please see page-cart.30cf6ca13f60a947e6d0.js.LICENSE.txt */
(()=>{function n(n){return function(n){if(Array.isArray(n))return l(n)}(n)||function(n){if("undefined"!=typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||d(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(n){throw new TypeError('"'+n+'" is read-only')}function t(n){if(null!=n){var e=n["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],t=0;if(e)return e.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length))return{next:function(){return n&&t>=n.length&&(n=void 0),{value:n&&n[t++],done:!n}}}}throw new TypeError(a(n)+" is not iterable")}function a(n){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},a(n)}function r(n,e){var t="undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(!t){if(Array.isArray(n)||(t=d(n))||e&&n&&"number"==typeof n.length){t&&(n=t);var a=0,r=function(){};return{s:r,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(n){throw n},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){t=t.call(n)},n:function(){var n=t.next();return o=n.done,n},e:function(n){s=!0,i=n},f:function(){try{o||null==t.return||t.return()}finally{if(s)throw i}}}}function i(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t.push.apply(t,a)}return t}function o(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?i(Object(t),!0).forEach(function(e){s(n,e,t[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})}return n}function s(n,e,t){return(e=function(n){var e=function(n,e){if("object"!=a(n)||!n)return n;var t=n[Symbol.toPrimitive];if(void 0!==t){var r=t.call(n,e||"default");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(n)}(n,"string");return"symbol"==a(e)?e:e+""}(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function c(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=null==n?null:"undefined"!=typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=t){var a,r,i,o,s=[],c=!0,d=!1;try{if(i=(t=t.call(n)).next,0===e){if(Object(t)!==t)return;c=!1}else for(;!(c=(a=i.call(t)).done)&&(s.push(a.value),s.length!==e);c=!0);}catch(n){d=!0,r=n}finally{try{if(!c&&null!=t.return&&(o=t.return(),Object(o)!==o))return}finally{if(d)throw r}}return s}}(n,e)||d(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(n,e){if(n){if("string"==typeof n)return l(n,e);var t={}.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(n):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?l(n,e):void 0}}function l(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,a=Array(e);t<e;t++)a[t]=n[t];return a}function u(){var n,e,t="function"==typeof Symbol?Symbol:{},a=t.iterator||"@@iterator",r=t.toStringTag||"@@toStringTag";function i(t,a,r,i){var c=a&&a.prototype instanceof s?a:s,d=Object.create(c.prototype);return p(d,"_invoke",function(t,a,r){var i,s,c,d=0,l=r||[],u=!1,p={p:0,n:0,v:n,a:f,f:f.bind(n,4),d:function(e,t){return i=e,s=0,c=n,p.n=t,o}};function f(t,a){for(s=t,c=a,e=0;!u&&d&&!r&&e<l.length;e++){var r,i=l[e],f=p.p,m=i[2];t>3?(r=m===a)&&(c=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=n):i[0]<=f&&((r=t<2&&f<i[1])?(s=0,p.v=a,p.n=i[1]):f<m&&(r=t<3||i[0]>a||a>m)&&(i[4]=t,i[5]=a,p.n=m,s=0))}if(r||t>1)return o;throw u=!0,a}return function(r,l,m){if(d>1)throw TypeError("Generator is already running");for(u&&1===l&&f(l,m),s=l,c=m;(e=s<2?n:c)||!u;){i||(s?s<3?(s>1&&(p.n=-1),f(s,c)):p.n=c:p.v=c);try{if(d=2,i){if(s||(r="next"),e=i[r]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,s<2&&(s=0)}else 1===s&&(e=i.return)&&e.call(i),s<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),s=1);i=n}else if((e=(u=p.n<0)?c:t.call(a,p))!==o)break}catch(e){i=n,s=1,c=e}finally{d=1}}return{value:e,done:u}}}(t,r,i),!0),d}var o={};function s(){}function c(){}function d(){}e=Object.getPrototypeOf;var l=[][a]?e(e([][a]())):(p(e={},a,function(){return this}),e),f=d.prototype=s.prototype=Object.create(l);function m(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,d):(n.__proto__=d,p(n,r,"GeneratorFunction")),n.prototype=Object.create(f),n}return c.prototype=d,p(f,"constructor",d),p(d,"constructor",c),c.displayName="GeneratorFunction",p(d,r,"GeneratorFunction"),p(f),p(f,r,"Generator"),p(f,a,function(){return this}),p(f,"toString",function(){return"[object Generator]"}),(u=function(){return{w:i,m}})()}function p(n,e,t,a){var r=Object.defineProperty;try{r({},"",{})}catch(n){r=0}p=function(n,e,t,a){if(e)r?r(n,e,{value:t,enumerable:!a,configurable:!a,writable:!a}):n[e]=t;else{var i=function(e,t){p(n,e,function(n){return this._invoke(e,t,n)})};i("next",0),i("throw",1),i("return",2)}},p(n,e,t,a)}function f(n,e,t,a,r,i,o){try{var s=n[i](o),c=s.value}catch(n){return void t(n)}s.done?e(c):Promise.resolve(c).then(a,r)}function m(n){return function(){var e=this,t=arguments;return new Promise(function(a,r){var i=n.apply(e,t);function o(n){f(i,a,r,o,s,"next",n)}function s(n){f(i,a,r,o,s,"throw",n)}o(void 0)})}}var y="undefined"!=typeof window&&"localhost"===window.location.hostname?"http://localhost:3001":"";function g(){return b.apply(this,arguments)}function b(){return(b=m(u().m(function n(){var e,t;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:if(!window.authManager||!window.authManager.isAuthenticated()){n.n=1;break}return n.a(2,window.authManager.getToken());case 1:if(n.p=1,!(e=localStorage.getItem("supabase.auth.token"))){n.n=2;break}return t=JSON.parse(e),n.a(2,t.access_token);case 2:n.n=4;break;case 3:n.p=3,n.v;case 4:return n.a(2,null)}},n,null,[[1,3]])}))).apply(this,arguments)}function v(n){return h.apply(this,arguments)}function h(){return h=m(u().m(function n(e){var t,a,r,i,s,c=arguments;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:return t=c.length>1&&void 0!==c[1]?c[1]:{},n.p=1,n.n=2,g();case 2:return a=n.v,r=o({"Content-Type":"application/json"},t.headers),a&&(r.Authorization="Bearer ".concat(a)),n.n=3,fetch("".concat(y).concat(e),o(o({},t),{},{headers:r}));case 3:if((i=n.v).ok){n.n=5;break}return n.n=4,i.json();case 4:throw s=n.v,new Error(s.error||"请求失败: ".concat(i.status));case 5:return n.n=6,i.json();case 6:return n.a(2,n.v);case 7:throw n.p=7,n.v;case 8:return n.a(2)}},n,null,[[1,7]])})),h.apply(this,arguments)}function w(){return k.apply(this,arguments)}function k(){return(k=m(u().m(function n(){var e,t;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:if(!window.authManager||!window.authManager.isAuthenticated()){n.n=1;break}return n.a(2,window.authManager.getCurrentUser());case 1:return n.p=1,n.n=2,supabase.auth.getUser();case 2:return e=n.v,t=e.data.user,n.a(2,t);case 3:return n.p=3,n.v,n.a(2,null)}},n,null,[[1,3]])}))).apply(this,arguments)}function x(){return S.apply(this,arguments)}function S(){return(S=m(u().m(function n(){var e,t;return u().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,w();case 1:if(e=n.v){n.n=2;break}return alert("请先登录"),t=new CustomEvent("showAuthModal",{detail:{message:"请登录后操作",redirect:window.location.href}}),window.dispatchEvent(t),n.a(2,null);case 2:return n.a(2,e)}},n)}))).apply(this,arguments)}function E(){return I.apply(this,arguments)}function I(){return(I=m(u().m(function n(){return u().w(function(n){for(;;)switch(n.n){case 0:if(document.getElementById("cartContent")||document.getElementById("cartSummary")){n.n=1;break}return n.a(2);case 1:if(!window.authManager||"function"!=typeof window.authManager.init){n.n=2;break}return n.n=2,window.authManager.init();case 2:return n.n=3,w();case 3:if(n.v){n.n=4;break}return n.a(2);case 4:return cn(),T(),n.n=5,O();case 5:return n.a(2)}},n)}))).apply(this,arguments)}function T(){document.getElementById("cartContent")&&(window.cartEventListenersInitialized||(window.cartEventListenersInitialized=!0,document.addEventListener("click",function(n){var e=n.target;if(e.classList.contains("back-button")||e.closest(".back-button")){n.preventDefault();var t=e.closest(".back-button");if(t){var a=t.getAttribute("data-action");"back-to-cart"===a?nn():"back-to-shipping"===a?B():"back-to-review"===a&&ln()}}else if(e.classList.contains("quantity-btn")){n.preventDefault();var r=e.getAttribute("data-cart-id"),i=e.getAttribute("data-size"),o=parseInt(e.getAttribute("data-change"));r&&i&&o&&q(r,i,o)}else if(e.classList.contains("cart-item-remove")){n.preventDefault(),n.stopPropagation();var s=e.getAttribute("data-cart-id");s&&F(s)}else if("proceedCheckoutBtn"===e.id)return n.preventDefault(),void L()}),document.addEventListener("authStateChanged",m(u().m(function n(){return u().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,O();case 1:return n.a(2)}},n)}))),document.addEventListener("authReady",function(){setTimeout(E,300)})))}function P(){return C.apply(this,arguments)}function C(){return(C=m(u().m(function n(){var e,t,i,o,s,d,l,p,f,m,y,g,b,h,k,x,S,E,I,T,P,C,O,_,D,N,q,R;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:if(e=document.getElementById("cartSummary")){n.n=1;break}return n.a(2);case 1:return n.p=1,n.n=2,w();case 2:if(t=n.v){n.n=3;break}return n.a(2);case 3:return i=[],n.p=4,n.n=5,v("/api/cart/items");case 5:i=n.v,n.n=8;break;case 6:return n.p=6,n.v,n.n=7,supabase.from("cart_items").select("*").eq("user_id",t.id);case 7:o=n.v,s=o.data,i=s||[];case 8:if(i&&0!==i.length){n.n=9;break}return e.style.display="none",e.innerHTML="",n.a(2);case 9:if(e.style.display="block",d={},l=i.filter(function(n){return n.draft_id}).map(function(n){return n.draft_id}),!(l.length>0)){n.n=13;break}return n.p=10,n.n=11,supabase.from("drafts").select("*").in("id",l);case 11:p=n.v,(f=p.data)&&Array.isArray(f)&&(d=f.reduce(function(n,e){return n[e.id]=e,n},{})),n.n=13;break;case 12:n.p=12,n.v,d={};case 13:m=0,y={},g=r(i);try{for(g.s();!(b=g.n()).done;)h=b.value,k=h.price||29.99,x=0,x=h.type&&h.type.startsWith("console-")?h.quantity||0:h.sizes&&"object"===a(h.sizes)?Object.values(h.sizes).reduce(function(n,e){return n+e},0):h.quantity||0,m+=k*x,S="",h.type&&h.type.startsWith("console-")?h.item_data&&h.item_data.productName?S=h.item_data.productName.toUpperCase():(E=h.type.replace("console-",""),S="RETRO CONSOLE #".concat(E)):S=h.type&&h.type.includes("blank-tshirt")?"BLANK T-SHIRT":h.draft_id&&d[h.draft_id]?"CUSTOMIZED T-SHIRT":"T-SHIRT",y[S]||(y[S]=0),y[S]+=x}catch(n){g.e(n)}finally{g.f()}for(I="",T=0,P=Object.entries(y);T<P.length;T++)C=c(P[T],2),O=C[0],_=C[1],I+='\n                <div class="summary-item-line">\n                    <span>'.concat(_,'x</span>\n                    <span style="font-weight: bold;">').concat(O,"</span>\n                </div>\n            ");D=null!==document.getElementById("checkoutForm"),N='\n            <h3>ORDER SUMMARY</h3>\n            <br>\n            <div class="summary-items" style="border-bottom: black 2px solid; padding: 10px 0; margin-bottom: 15px;">\n                '.concat(I,'\n            </div>\n            <div id="summaryDetails">\n                <div class="summary-row">\n                    <span>Subtotal:</span>\n                    <span id="subtotalAmount">¥').concat(m.toFixed(2),"</span>\n                </div>\n                ").concat(D?"":'\n                    <div id="addressPrompt" class="summary-row">\n                        <span style="color: black; font-style:italic;">Please enter a valid address to calculate total</span>\n                    </div>\n                ','\n            </div>\n            <div class="cart-actions" id="checkoutButtonContainer">\n                ').concat(D?'<button class="cart-btn primary" id="validateCheckoutBtn" style="background: black; color: white; padding: 5px; border: 2px solid black; cursor: pointer; width: 100%; text-transform: uppercase;">PROCEED TO CHECKOUT</button>':'<button class="cart-btn primary" id="proceedCheckoutBtn">PROCEED TO CHECKOUT</button>',"\n            </div>\n        "),e.innerHTML=N,window.currentSubtotal=m,D&&setTimeout(A,100),n.n=15;break;case 14:n.p=14,R=n.v,(q=document.getElementById("cartSummary"))&&(q.innerHTML='\n                <div class="summary-error">\n                    <h3>ERROR</h3>\n                    <p>Unable to load summary: '.concat(R.message,"</p>\n                </div>\n            "));case 15:return n.a(2)}},n,null,[[10,12],[4,6],[1,14]])}))).apply(this,arguments)}function A(){var n=document.getElementById("validateCheckoutBtn");n&&(n.onclick=null,n.onclick=function(n){n.preventDefault(),n.stopPropagation();var e=document.getElementById("checkoutForm");if(e)if(e.checkValidity()){var t=new FormData(e),a={fullName:t.get("fullName"),email:t.get("email"),phone:t.get("phone"),address1:t.get("address1"),address2:t.get("address2"),city:t.get("city"),state:t.get("state"),zipCode:t.get("zipCode"),country:t.get("country")};window.calculateAndShowPayment?window.calculateAndShowPayment(a):alert("Payment function not available")}else e.reportValidity();else alert("Please fill in address information first")})}function O(){return _.apply(this,arguments)}function _(){return(_=m(u().m(function n(){var e,t,i,s,c,d,l,p,f,m,y,g,b,h,k,x,S,E,I,T,C,A,O,_,q,R,F,M,H,L,z,B,U,j,G,W,Y,K,V,Q,Z,J,$,X;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:if(e=document.getElementById("cartContent")){n.n=1;break}return n.a(2);case 1:return n.p=1,e.innerHTML='\n            <div class="loading-cart" style="\n                text-align: center;\n                padding: 50px 20px;\n                color: black;\n            ">\n                <div style="\n                    width: 40px;\n                    height: 40px;\n                    border: 3px solid black;\n                 \n         \n                    animation: spin 2s linear infinite;\n                    margin: 0 auto 20px auto;\n                "></div>\n                <h3 style="margin-bottom: 10px;">LOADING CART...</h3>\n                <p>Fetching your cart items...</p>\n                <style>\n                    @keyframes spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                </style>\n            </div>\n        ',(t=document.getElementById("cartSummary"))&&(t.innerHTML='\n                <div style="text-align: center; padding: 20px; color: black;">\n                    <div style="\n                        width: 20px;\n                        height: 20px;\n                       border: 2px solid black;\n                      \n                        animation: spin 2s linear infinite;\n                        margin: 0 auto 10px auto;\n                    "></div>\n                    <p>Loading...</p>\n                </div>\n            '),n.n=2,w();case 2:if(i=n.v,e){n.n=3;break}return n.a(2);case 3:if(i){n.n=4;break}return e.innerHTML='\n                <div class="cart-empty">\n                    <h2>Please login first</h2>\n                    <button class="cart-btn" data-action="go-home">GO TO LOGIN</button>\n                </div>\n            ',t&&(t.style.display="none"),n.a(2);case 4:return n.n=5,v("/api/cart/items");case 5:if(s=n.v,c=s,!(d=null)){n.n=6;break}throw d;case 6:if(!d){n.n=7;break}throw d;case 7:if(c&&0!==c.length){n.n=8;break}return e.innerHTML='\n                <div class="cart-empty">\n                    <h2>Your cart is empty</h2>\n                    <p>Add some awesome designs to your cart!</p>\n                    <button class="cart-btn" data-action="continue-shopping">CONTINUE SHOPPING</button>\n                </div>\n            ',t&&(t.style.display="none"),n.a(2);case 8:if(l=c.filter(function(n){return n.draft_id}).map(function(n){return n.draft_id}),p={},!(l.length>0)){n.n=12;break}return n.p=9,n.n=10,supabase.from("drafts").select("*").in("id",l);case 10:f=n.v,(m=f.data)&&Array.isArray(m)&&(p=m.reduce(function(n,e){return n[e.id]=e,n},{})),n.n=12;break;case 11:n.p=11,n.v,p={};case 12:y=c.map(function(n){return n.draft_id&&p[n.draft_id]?o(o({},n),{},{drafts:p[n.draft_id]}):n}),g='<div class="cart-items">',b=r(y),n.p=13,b.s();case 14:if((h=b.n()).done){n.n=22;break}if(k=h.value,x="",S="",E="",I=0,T="white",C="./images/default-tshirt.png",A="./images/default-tshirt.png",O=!1,_="GAME CONSOLE",q="console",R=null,!k.type||!k.type.startsWith("console-")){n.n=15;break}O=!0,F=k.type.replace("console-","").split("-")[0],k.item_data?(R=k.item_data,E=R.productName||"Retro Product #".concat(F),I=k.price||1450,R.productCategory&&((M=R.productCategory.toLowerCase()).includes("cartridge")||M.includes("software")||M.includes("game")&&!M.includes("console")||M.includes("disc")||M.includes("cassette"))&&(_="SOFTWARE",q="software"),R.productType&&((H=R.productType.toLowerCase()).includes("software")||H.includes("game")&&!H.includes("console"))&&(_="SOFTWARE",q="software"),C=R.productImage||"images/merch/".concat(F,".jpg"),A=C):((L=window.getConsoleProductInfo&&window.getConsoleProductInfo(k.type))?(E=L.name||"Retro Product #".concat(F),C=L.image||"images/merch/".concat(F,".jpg"),A=C,L.category&&((z=L.category.toLowerCase()).includes("cartridge")||z.includes("software")||z.includes("game")&&!z.includes("console"))&&(_="SOFTWARE",q="software")):(E="Retro Product #".concat(F),C="images/merch/".concat(F,".jpg"),A=C),I=k.price||1450),x=q,n.n=20;break;case 15:if(k.type&&(k.type.includes("blank-tshirt")?(E="BLANK T-SHIRT",x="blank",T=k.type.replace("blank-tshirt-","")||"white"):k.type.includes("single-sided")?(E="CUSTOMIZED T-SHIRT",x="single-sided",T=k.type.replace("single-sided-","")||"white"):k.type.includes("double-sided")?(E="CUSTOMIZED T-SHIRT",x="double-sided",T=k.type.replace("double-sided-","")||"white"):"custom-design"===k.type&&(E="CUSTOMIZED T-SHIRT",x="custom")),k.draft_id&&k.drafts&&((B=k.drafts).data&&B.data.color&&(T=B.data.color),B.front_preview_image&&(C=B.front_preview_image),B.back_preview_image&&(A=B.back_preview_image),!x&&B.data&&(U=B.data.frontImages&&B.data.frontImages.length>0,j=B.data.backImages&&B.data.backImages.length>0,U||j?U&&j?(E="CUSTOMIZED T-SHIRT",x="double-sided"):(E="CUSTOMIZED T-SHIRT",x="single-sided"):(E="BLANK T-SHIRT",x="blank"))),x||(E="BLANK T-SHIRT",x="blank"),"blank"!==x){n.n=19;break}if(C&&"./images/default-tshirt.png"!==C){n.n=17;break}return n.n=16,D(T,"front");case 16:C=n.v;case 17:if(A&&"./images/default-tshirt.png"!==A){n.n=19;break}return n.n=18,D(T,"back");case 18:A=n.v;case 19:S="white"===T?"white":"colored",window.TSHIRT_PRICING&&window.TSHIRT_PRICING[x]&&(I=window.TSHIRT_PRICING[x][T]||window.TSHIRT_PRICING[x][S]),I||(I=k.price||29.99);case 20:G=0,G=O?k.quantity||0:k.sizes&&"object"===a(k.sizes)?Object.values(k.sizes).reduce(function(n,e){return n+e},0):k.quantity||0,W=I*G,O?(K=(null===(Y=R)||void 0===Y?void 0:Y.productName)||E,V=_,g+='\n                    <div class="cart-item" data-cart-id="'.concat(k.id,'" data-product-type="single">\n                        <div class="cart-item-previews">\n                            <div class="preview-container">\n                                <div class="preview-image">\n                                    <img src="').concat(C,'" alt="').concat(E,'" onerror="this.src=\'./images/default-product.png\'">\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class="cart-item-details">\n                            <div class="cart-item-title">').concat(K,'</div>\n                            <div class="cart-item-type">\n                                <span class="type-badge">').concat(V,"</span>\n                                ").concat(R&&R.productYear?'<span class="product-year">'.concat(R.productYear,"</span>"):"","\n                                ").concat(R&&R.variantName?'<span class="variant-name" style="margin-left: 10px; color: #666;">- '.concat(R.variantName,"</span>"):"",'\n                            </div>\n                            \n                            <div class="cart-item-quantity">\n                                <div class="quantity-controls">\n                                    <button class="quantity-btn quantity-btn-left" \n                                            data-cart-id="').concat(k.id,'" \n                                            data-size="default" \n                                            data-change="-1">−</button>\n                                    <input type="text" class="quantity-value" value="').concat(G,'" readonly>\n                                    <button class="quantity-btn quantity-btn-right" \n                                            data-cart-id="').concat(k.id,'" \n                                            data-size="default" \n                                            data-change="1">+</button>\n                                </div>\n                            </div>\n                            \n                            <div class="cart-item-pricing">\n                                <div class="price-row">\n                                    <span>Unit Price:</span>\n                                    <span>¥').concat(I.toFixed(2),'</span>\n                                </div>\n                                <div class="price-row">\n                                    <span>Quantity:</span>\n                                    <span>').concat(G,'</span>\n                                </div>\n                                <div class="price-row total">\n                                    <span>Subtotal:</span>\n                                    <span>¥').concat(W.toFixed(2),'</span>\n                                </div>\n                            </div>\n                            \n                            <button class="cart-item-remove" data-cart-id="').concat(k.id,'">Remove</button>\n                        </div>\n                    </div>\n                ')):(Q="",Q="blank"===x?"Blank Design":"double-sided"===x?"Double-Sided Design":"Single-Sided Design",Z="white"===T?"White T-Shirt":"".concat(T.charAt(0).toUpperCase()+T.slice(1)," T-Shirt"),g+='\n                    <div class="cart-item" data-cart-id="'.concat(k.id,'">\n                        <div class="cart-item-previews">\n                            <div class="preview-container">\n                                <div class="preview-image">\n                                    <img src="').concat(C,'" alt="').concat(E,' - Front" onerror="this.src=\'./images/default-tshirt.png\'">\n                                </div>\n                            </div>\n                            <div class="preview-container">\n                                <div class="preview-image">\n                                    <img src="').concat(A,'" alt="').concat(E,' - Back" onerror="this.src=\'./images/default-tshirt.png\'">\n                                </div>\n                            </div>\n                        </div>\n                        \n                        <div class="cart-item-details">\n                            <div class="cart-item-title">').concat(E,'</div>\n                            <div class="cart-item-type">\n                                <div>\n                                    <span class="type-badge">').concat(Q,'</span>\n                                    <span class="color-indicator">\n                                        <span class="color-dot" style="background-color: ').concat("white"===T?"#ffffff":T,'; "></span>\n                                        ').concat(Z,'\n                                    </span>\n                                </div>\n                            </div>\n                            \n                            <div class="cart-item-sizes">\n                                ').concat(N(k.id,k.sizes),'\n                            </div>\n                            \n                            <div class="cart-item-pricing">\n                                <div class="price-row">\n                                    <span>Unit Price:</span>\n                                    <span>¥').concat(I.toFixed(2),'</span>\n                                </div>\n                                <div class="price-row">\n                                    <span>Quantity:</span>\n                                    <span>').concat(G,'</span>\n                                </div>\n                                <div class="price-row total">\n                                    <span>Subtotal:</span>\n                                    <span>¥').concat(W.toFixed(2),'</span>\n                                </div>\n                            </div>\n                            \n                            <button class="cart-item-remove" data-cart-id="').concat(k.id,'">Remove</button>\n                        </div>\n                    </div>\n                '));case 21:n.n=14;break;case 22:n.n=24;break;case 23:n.p=23,X=n.v,b.e(X);case 24:return n.p=24,b.f(),n.f(24);case 25:return g+="</div>",e.innerHTML=g,n.p=26,n.n=27,P();case 27:n.n=29;break;case 28:n.p=28,n.v;case 29:n.n=31;break;case 30:n.p=30,n.v,(J=document.getElementById("cartContent"))&&(J.innerHTML='\n                <div class="cart-error">\n                    <h2>Error loading cart</h2>\n                    <p>Please refresh the page and try again.</p>\n                    <button class="cart-btn" onclick="location.reload()">REFRESH PAGE</button>\n                </div>\n            '),($=document.getElementById("cartSummary"))&&($.style.display="none");case 31:return n.a(2)}},n,null,[[26,28],[13,23,24,25],[9,11],[1,30]])}))).apply(this,arguments)}function D(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"white",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"front";return new Promise(function(t){var a,r=document.createElement("canvas"),i=r.getContext("2d");r.width=100,r.height=125,i.fillStyle="#ffffff",i.fillRect(0,0,r.width,r.height);var o=new Image;o.crossOrigin="anonymous",o.width=100,o.height=125,o.onload=function(){var n=Math.min(r.width/this.naturalWidth,r.height/this.naturalHeight),e=this.naturalWidth*n,a=this.naturalHeight*n,o=(r.width-e)/2,s=(r.height-a)/2;i.drawImage(this,o,s,e,a);var c=r.toDataURL("image/jpeg",.9);t(c)},o.onerror=function(){i.fillStyle="black"===n?"#333333":"#f0f0f0",i.fillRect(0,0,r.width,r.height);var e=r.toDataURL("image/jpeg",.9);t(e)};var s={front:{white:"./images/white-front.png",black:"./images/black-front.png"},back:{white:"./images/white-back.png",black:"./images/black-back.png"}};o.src=(null===(a=s[e])||void 0===a?void 0:a[n])||s.front.white})}function N(n,e){if(!e||0===Object.keys(e).length)return"<p>No sizes selected</p>";var t="";return Object.entries(e).forEach(function(e){var a=c(e,2),r=a[0],i=a[1];t+='\n        <div class="size-quantity-group">\n            <span class="size-label">'.concat(r,':</span>\n            <div class="quantity-controls">\n                <button class="quantity-btn quantity-btn-left" \n                        data-cart-id="').concat(n,'" \n                        data-size="').concat(r,'" \n                        data-change="-1">-</button>\n                <input type="text" class="quantity-value" value="').concat(i,'" readonly>\n                <button class="quantity-btn quantity-btn-right" data-cart-id="').concat(n,'" \n                        data-size="').concat(r,'" \n                        data-change="1")">+</button>\n            </div>\n        </div>\n    ')}),t}function q(n,e,t){return R.apply(this,arguments)}function R(){return(R=m(u().m(function n(e,t,a){var i,o,s,c,d,l,p,f,y,g,b,h,w,k,x,S,E,I,T,C,A,O,_,D,N,q,R,M,H,L,z,B;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:if(n.p=0,i=document.getElementById("cartContent"),o=i.querySelector('[data-cart-id="'.concat(e,'"]'))){n.n=1;break}return n.a(2);case 1:if(!("single"===o.getAttribute("data-product-type"))){n.n=5;break}if(c=o.querySelector(".quantity-value")){n.n=2;break}return n.a(2);case 2:if(d=parseInt(c.value||0),0!==(l=Math.max(0,d+a))){n.n=4;break}return n.n=3,F(e);case 3:return n.a(2);case 4:c.value=l,p=parseFloat((null===(s=o.querySelector(".price-row:nth-child(1) span:last-child"))||void 0===s?void 0:s.textContent.replace("¥",""))||0),f=p*l,o.querySelector(".price-row.total span:last-child").textContent="¥".concat(f.toFixed(2)),setTimeout(m(u().m(function n(){var t,a;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,v("/api/cart/items/".concat(e),{method:"PATCH",body:JSON.stringify({newSizes:{default:l}})});case 1:if(!n.v.success){n.n=3;break}return n.n=2,P();case 2:n.n=4;break;case 3:c.value=d,t=p*d,o.querySelector(".price-row.total span:last-child").textContent="¥".concat(t.toFixed(2));case 4:n.n=6;break;case 5:n.p=5,n.v,c.value=d,a=p*d,o.querySelector(".price-row.total span:last-child").textContent="¥".concat(a.toFixed(2));case 6:return n.a(2)}},n,null,[[0,5]])})),0),n.n=17;break;case 5:g=o.querySelectorAll(".size-quantity-group"),b=null,h=r(g),n.p=6,h.s();case 7:if((w=h.n()).done){n.n=9;break}if(k=w.value,!(x=k.querySelector(".size-label"))||x.textContent.trim()!==t+":"){n.n=8;break}return b=k,n.a(3,9);case 8:n.n=7;break;case 9:n.n=11;break;case 10:n.p=10,B=n.v,h.e(B);case 11:return n.p=11,h.f(),n.f(11);case 12:if(b){n.n=13;break}return n.a(2);case 13:if(S=b.querySelector(".quantity-value")){n.n=14;break}return n.a(2);case 14:E=parseInt(S.value||0),I=Math.max(0,E+a),S.value=I,T={},C=o.querySelectorAll(".size-quantity-group"),A=r(C);try{for(A.s();!(O=A.n()).done;)_=O.value,D=_.querySelector(".size-label"),N=_.querySelector(".quantity-value"),D&&N&&(q=D.textContent.trim().replace(":",""),R=parseInt(N.value||0),T[q]=R)}catch(n){A.e(n)}finally{A.f()}for(M in T)0===T[M]&&delete T[M];if(0!==Object.keys(T).length){n.n=16;break}return n.n=15,F(e);case 15:return n.a(2);case 16:H=parseFloat((null===(y=o.querySelector(".price-row:nth-child(1) span:last-child"))||void 0===y?void 0:y.textContent.replace("¥",""))||0),L=Object.values(T).reduce(function(n,e){return n+e},0),z=H*L,o.querySelector(".price-row:nth-child(2) span:last-child").textContent=L,o.querySelector(".price-row.total span:last-child").textContent="¥".concat(z.toFixed(2)),setTimeout(m(u().m(function n(){var t,a,i,o,s;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,v("/api/cart/items/".concat(e),{method:"PATCH",body:JSON.stringify({newSizes:T})});case 1:if(!n.v.success){n.n=3;break}return n.n=2,P();case 2:n.n=4;break;case 3:S.value=E,t=r(C);try{for(t.s();!(a=t.n()).done;)i=a.value,o=i.querySelector(".size-label"),s=i.querySelector(".quantity-value"),o&&s&&o.textContent.trim().replace(":","")}catch(n){t.e(n)}finally{t.f()}case 4:n.n=6;break;case 5:n.p=5,n.v,S.value=E;case 6:return n.a(2)}},n,null,[[0,5]])})),0);case 17:n.n=19;break;case 18:n.p=18,n.v;case 19:return n.a(2)}},n,null,[[6,10,11,12],[0,18]])}))).apply(this,arguments)}function F(n){return M.apply(this,arguments)}function M(){return(M=m(u().m(function n(e){return u().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,removeFromCart(e);case 1:if(!n.v){n.n=2;break}return n.n=2,O();case 2:return n.a(2)}},n)}))).apply(this,arguments)}function H(){"function"==typeof loadPage?loadPage("home"):window.location.href="/home"}function L(){return z.apply(this,arguments)}function z(){return(z=m(u().m(function n(){var e,t,a,r;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,x();case 1:if(e=n.v){n.n=2;break}return n.a(2);case 2:return n.n=3,supabase.from("cart_items").select("*").eq("user_id",e.id);case 3:if(t=n.v,(a=t.data)&&0!==a.length){n.n=4;break}return alert("Your cart is empty"),n.a(2);case 4:r=0,a.forEach(function(n){var e=n.price||29.99,t=n.quantity||0;r+=e*t}),window.currentSubtotal=r,B(),n.n=6;break;case 5:n.p=5,n.v,alert("Error proceeding to checkout");case 6:return n.a(2)}},n,null,[[0,5]])}))).apply(this,arguments)}function B(){return U.apply(this,arguments)}function U(){return(U=m(u().m(function n(){var e,t,a,r,i,o,s,c,d;return u().w(function(n){for(;;)switch(n.n){case 0:return e=document.querySelector(".cart-header"),(t=document.getElementById("cartContent")).innerHTML="",e&&(e.innerHTML='\n            <h1>SHIPPING INFORMATION</h1>\n            <button class="back-button" data-action="back-to-cart" style="\n                padding: 5px;\n                border: 2px solid black;\n                background: white;\n                cursor: pointer;\n                font-size: 14px;\n            ">← BACK TO CART</button>\n        '),a=[],n.n=1,supabase.auth.getUser();case 1:if(r=n.v,!(i=r.data.user)){n.n=3;break}return n.n=2,supabase.from("profiles").select("shipping_addresses").eq("user_id",i.id).single();case 2:o=n.v,s=o.data,a=(null==s?void 0:s.shipping_addresses)||[];case 3:window.currentSavedAddresses=a,c="",c=a.length>0?'\n        <div class="address-selection" style="margin-bottom: 30px;">\n        <h3 style="margin-bottom: 15px;">SELECT SHIPPING ADDRESS</h3>\n        <div class="saved-addresses">\n            '.concat(a.map(function(n,e){return'\n                <div class="address-option '.concat(n.isDefault?"default-address":"",'" data-address-index="').concat(e,'" style="\n                    border: 2px solid #ccc;\n                    padding: 15px;\n                    margin-bottom: 10px;\n                    cursor: pointer;\n                   \n                    position: relative;\n                    ').concat(n.isDefault,'\n                ">\n                    <label style="cursor: pointer; display: block; width: 100%;">\n                        <input type="radio" name="selectedAddress" value="').concat(e,'" \n                               ').concat(n.isDefault?"checked":"",' \n                               style="margin-right: 10px;">\n                        <div style="display: inline-block; vertical-align: top; width: calc(100% - 80px);">\n                            <div style="display: flex; align-items: center; margin-bottom: 8px;">\n                                <strong style="font-size: 16px;">').concat(n.fullName,"</strong>\n                                ").concat(n.isDefault?'<span style="background: black; color: white; padding: 2px 8px; font-size: 12px; margin-left: 15px;">DEFAULT</span>':"",'\n                            </div>\n                            <div style="color: #555; font-size: 14px; line-height: 1.4;">\n                                ').concat(n.phone,"<br>\n                                ").concat(n.address1," ").concat(n.address2||"","<br>\n                                ").concat(n.city,", ").concat(n.state," ").concat(n.zipCode,"<br>\n                                ").concat(n.country,'\n                            </div>\n                        </div>\n                    </label>\n                    <button class="delete-address-btn" data-address-index="').concat(e,'" style="\n                        position: absolute;\n                        bottom: 15px;\n                        right: 15px;\n\n                    padding:0 5px;\n                        border: 2px black solid;\n                        padding: 5px 8px;\n                        font-size: 12px;\n                        cursor: pointer;\n                    background:white;\n                     \n                    " title="Delete Address">DELETE</button>\n                </div>\n            ')}).join(""),'\n        </div>\n                <div style="text-align: center; margin: 20px 0;">\n                    <button id="useNewAddress" style="\n                        background: white;\n                        color: black;\n                        border: 2px solid black;\n                        padding: 8px 20px;\n                        cursor: pointer;\n                        font-size: 14px;\n                    ">+ ADD NEW ADDRESS</button>\n                </div>\n            </div>\n        '):'\n            <div class="address-selection" style="margin-bottom: 30px;">\n                <h3 style="margin-bottom: 15px;">NO SAVED ADDRESSES</h3>\n                <p style="color: #666; margin-bottom: 20px;">Please add a new shipping address</p>\n                <button id="useNewAddress" style="\n                    background: black;\n                    color: white;\n                    border: none;\n                    padding: 8px 20px;\n                    cursor: pointer;\n                    font-size: 14px;\n                ">+ ADD NEW ADDRESS</button>\n            </div>\n        ',d='\n        <style>\n            .checkout-form-container {\n                background: white;\n                padding: 0;\n            }\n            \n            .address-option:hover {\n                border-color: black !important;\n               \n            }\n            \n            .address-option:has(input[type="radio"]:checked) {\n                border-color: black !important;\n              \n            }\n\n            .checkout-form {\n                max-width: 100%;\n                display: none;\n            }\n            \n            .form-group {\n                margin-bottom: 20px;\n            }\n            \n            .form-group label {\n                display: block;\n                margin-bottom: 8px;\n                font-weight: bold;\n                font-size: 14px;\n            }\n            \n            .form-group input,\n            .form-group select {\n                width: 100%;\n                padding: 10px;\n                border: 2px solid black;\n                font-size: 14px;\n                background: white;\n            }\n            \n            .form-group input:focus,\n            .form-group select:focus {\n                outline: none;\n                border-color: #555;\n            }\n            \n            .form-group input[type="checkbox"] {\n                width: auto;\n                margin-right: 8px;\n                vertical-align: middle;\n                transform: scale(1.1);\n            }\n\n .checkbox-label {\n            display: flex !important;\n            align-items: center;\n            margin-bottom: 0 !important;\n            font-weight: normal !important;\n        }\n        \n\n            .form-row {\n                display: flex;\n                gap: 20px;\n            }\n            \n            .form-row .form-group {\n                flex: 1;\n            }\n            \n            .required-asterisk {\n                color: red;\n            }\n        </style>\n        \n        <div class="checkout-form-container">\n            '.concat(c,'\n            \n            <form id="checkoutForm" class="checkout-form">\n                <h3 style="margin-bottom: 20px;">ADD NEW SHIPPING ADDRESS</h3>\n                \n                <div class="form-group">\n                    <label>Full Name <span class="required-asterisk">*</span></label>\n                    <input type="text" id="fullName" name="fullName" required placeholder="Enter your full name">\n                </div>\n                \n                <div class="form-group">\n                    <label>Email Address </label>\n                    <input type="email" id="email" name="email" required placeholder="your@email.com">\n                </div>\n                \n                <div class="form-group">\n                    <label>Phone Number <span class="required-asterisk">*</span></label>\n                    <input type="tel" id="phone" name="phone" required placeholder="+86">\n                </div>\n                \n                <h4 style="margin-top: 30px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid black;">DELIVERY ADDRESS</h4>\n                \n                <div class="form-group">\n                    <label>Address Line 1 <span class="required-asterisk">*</span></label>\n                    <input type="text" id="address1" name="address1" required placeholder="Street address, P.O. box">\n                </div>\n                \n                <div class="form-group">\n                    <label>Address Line 2</label>\n                    <input type="text" id="address2" name="address2" placeholder="Apartment, suite, unit, building, floor, etc.">\n                </div>\n                \n                <div class="form-row">\n                    <div class="form-group">\n                        <label>City <span class="required-asterisk">*</span></label>\n                        <input type="text" id="city" name="city" required placeholder="City">\n                    </div>\n                    <div class="form-group">\n                        <label>State/Province <span class="required-asterisk">*</span></label>\n                        <input type="text" id="state" name="state" required placeholder="State or Province">\n                    </div>\n                </div>\n                \n                <div class="form-row">\n                    <div class="form-group">\n                        <label>ZIP/Postal Code <span class="required-asterisk">*</span></label>\n                        <input type="text" id="zipCode" name="zipCode" required placeholder="12345">\n                    </div>\n                    <div class="form-group">\n                        <label>Country <span class="required-asterisk">*</span></label>\n                        <select id="country" name="country" required>\n                            <option value="">Select Country</option>\n                            <option value="CN">中国</option>\n                            <option value="HK">Hong Kong</option>\n                            <option value="TW">臺灣</option>\n                            <option value="JP">Japan</option>\n                            <option value="UK">United Kingdom</option>\n                            <option value="US">United States</option>\n                            <option value="OTHER">Other</option>\n                        </select>\n                    </div>\n                </div>\n                \n                <div class="form-group">\n                    <label>\n                        <input type="checkbox" id="setAsDefault" name="setAsDefault">\n                        Set as default address\n                    </label>\n                </div>\n                \n                <div style="display: flex; gap: 10px; margin-top: 30px;">\n                    <button type="submit" style="\n                        flex: 1;\n                        background: black;\n                        color: white;\n                        border: none;\n                        padding: 12px;\n                        font-size: 16px;\n                        cursor: pointer;\n                    ">SAVE ADDRESS</button>\n                    <button type="button" id="cancelNewAddress" style="\n                        flex: 1;\n                        background: white;\n                        color: black;\n                        border: 2px solid black;\n                        padding: 12px;\n                        font-size: 16px;\n                        cursor: pointer;\n                    ">CANCEL</button>\n                </div>\n            </form>\n        </div>\n    '),t.innerHTML=d,Z(),j(a),G(),a.length>0&&Q(a.find(function(n){return n.isDefault})||a[0]);case 4:return n.a(2)}},n)}))).apply(this,arguments)}function j(n){document.querySelectorAll('input[name="selectedAddress"]').forEach(function(e){e.addEventListener("change",function(e){if(document.querySelectorAll(".address-option").forEach(function(n){n.classList.remove("selected"),n.style.borderColor="#ccc"}),e.target.checked){var t=e.target.closest(".address-option");t.classList.add("selected"),t.style.borderColor="black";var a=parseInt(e.target.value);Q(n[a]);var r=document.getElementById("proceedToPayment");r&&(r.disabled=!1,r.style.background="black",r.style.color="white",r.style.cursor="pointer")}})});var e=document.querySelector('input[name="selectedAddress"]:checked');if(e){var t=e.closest(".address-option");t.classList.add("selected"),t.style.borderColor="black"}document.querySelectorAll(".delete-address-btn").forEach(function(n){n.addEventListener("click",function(){var n=m(u().m(function n(e){var t;return u().w(function(n){for(;;)switch(n.n){case 0:if(e.stopPropagation(),t=parseInt(e.target.dataset.addressIndex),!confirm("Are you sure you want to delete this address?")){n.n=1;break}return n.n=1,W(t);case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}())});var a=document.getElementById("useNewAddress");a&&a.addEventListener("click",function(){document.querySelector(".address-selection").style.display="none",document.querySelector(".checkout-form").style.display="block",$();var n=document.getElementById("proceedToPayment");n&&(n.disabled=!0,n.style.background="#ccc",n.style.color="#666",n.style.cursor="not-allowed")})}function G(){var n=document.getElementById("checkoutForm");n&&n.addEventListener("submit",function(){var n=m(u().m(function n(e){return u().w(function(n){for(;;)switch(n.n){case 0:return e.preventDefault(),n.n=1,K();case 1:return n.a(2)}},n)}));return function(e){return n.apply(this,arguments)}}());var e=document.getElementById("cancelNewAddress");e&&e.addEventListener("click",function(){document.querySelector(".checkout-form").style.display="none",document.querySelector(".address-selection").style.display="block"});var t=document.getElementById("country");t&&t.addEventListener("change",function(n){var e=n.target.value;e?J(e):$()})}function W(n){return Y.apply(this,arguments)}function Y(){return(Y=m(u().m(function n(e){var t,a,r,i,o,s,c;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,x();case 1:if(t=n.v){n.n=2;break}return n.a(2);case 2:return n.n=3,supabase.from("profiles").select("shipping_addresses").eq("user_id",t.id).single();case 3:return a=n.v,r=a.data,i=(null==r?void 0:r.shipping_addresses)||[],o=i[e],i.splice(e,1),null!=o&&o.isDefault&&i.length>0&&(i[0].isDefault=!0),n.n=4,supabase.from("profiles").update({shipping_addresses:i}).eq("user_id",t.id);case 4:if(s=n.v,!(c=s.error)){n.n=5;break}throw c;case 5:B(),n.n=7;break;case 6:n.p=6,n.v,alert("Failed to delete address. Please try again.");case 7:return n.a(2)}},n,null,[[0,6]])}))).apply(this,arguments)}function K(){return V.apply(this,arguments)}function V(){return(V=m(u().m(function n(){var e,t,a,r,i,s,c,d;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,e=new FormData(document.getElementById("checkoutForm")),n.n=1,x();case 1:if(t=n.v){n.n=2;break}return n.a(2);case 2:return a={fullName:e.get("fullName"),email:e.get("email"),phone:e.get("phone"),address1:e.get("address1"),address2:e.get("address2")||"",city:e.get("city"),state:e.get("state"),zipCode:e.get("zipCode"),country:e.get("country"),isDefault:"on"===e.get("setAsDefault")},n.n=3,supabase.from("profiles").select("shipping_addresses").eq("user_id",t.id).single();case 3:return r=n.v,i=r.data,s=(null==i?void 0:i.shipping_addresses)||[],a.isDefault&&(s=s.map(function(n){return o(o({},n),{},{isDefault:!1})})),0===s.length&&(a.isDefault=!0),s.push(a),n.n=4,supabase.from("profiles").update({shipping_addresses:s}).eq("user_id",t.id);case 4:if(c=n.v,!(d=c.error)){n.n=5;break}throw d;case 5:B(),n.n=7;break;case 6:n.p=6,n.v,alert("Failed to save address. Please try again.");case 7:return n.a(2)}},n,null,[[0,6]])}))).apply(this,arguments)}function Q(n){if(n&&n.country){var e=window.SHIPPING_CONFIG[n.country]||window.SHIPPING_CONFIG.OTHER,t=window.currentSubtotal||0,a=e.shipping,r=t*(e.tax/100);tn({subtotal:t,shipping:a,tax:r,total:t+a+r,config:e,address:n})}else $()}function Z(){var n=document.getElementById("cartSummary");if(n){n.innerHTML='\n            <h3>ORDER SUMMARY</h3>\n            <div id="summaryDetails">\n                <div class="summary-row">\n                    <span>Subtotal:</span>\n                    <span>¥'.concat((window.currentSubtotal||0).toFixed(2),'</span>\n                </div>\n                <div id="addressPrompt" class="summary-row">\n                    <span style="color: #666; font-style: italic;">Select address to calculate total</span>\n                </div>\n            </div>\n            <button id="proceedToPayment" disabled style="\n                width: 100%;\n                margin-top: 15px;\n                padding: 12px;\n                background: #ccc;\n                color: #666;\n                border: none;\n                font-size: 16px;\n                cursor: not-allowed;\n            ">PROCEED TO CHECKOUT</button>\n        ');var e=document.getElementById("proceedToPayment");e&&(e.onclick=null,e.addEventListener("click",window.proceedToPayment))}}function J(n){var e=window.SHIPPING_CONFIG[n]||window.SHIPPING_CONFIG.OTHER,t=window.currentSubtotal||0,a=e.shipping,r=t*(e.tax/100);tn({subtotal:t,shipping:a,tax:r,total:t+a+r,config:e,address:{country:n}})}function $(){var n=document.getElementById("summaryDetails");if(n){var e=window.currentSubtotal||0;n.innerHTML='\n                <div class="summary-row">\n                    <span>Subtotal:</span>\n                    <span id="subtotalAmount">¥'.concat(e.toFixed(2),'</span>\n                </div>\n                <div id="addressPrompt" class="summary-row">\n                    <span style="color: black; font-style:italic;">Please select a country to calculate total</span>\n                </div>\n            ')}}function X(n){var e=n.country||"OTHER",t=window.SHIPPING_CONFIG[e]||window.SHIPPING_CONFIG.OTHER,a=window.currentSubtotal||0,r=t.shipping,i=a*(t.tax/100),o=a+r+i;window.shippingCost=r,window.taxAmount=i,window.orderTotal=o,window.shippingConfig=t,an(n,r,i,o)}function nn(){return en.apply(this,arguments)}function en(){return(en=m(u().m(function n(){var e;return u().w(function(n){for(;;)switch(n.n){case 0:return(e=document.querySelector(".cart-header"))&&(e.innerHTML="<h1>SHOPPING CART</h1>"),n.n=1,O();case 1:return n.a(2)}},n)}))).apply(this,arguments)}function tn(n){var e=document.getElementById("summaryDetails");if(e){var t='\n            <div class="summary-row">\n                <span>Subtotal:</span>\n                <span id="subtotalAmount">¥'.concat(n.subtotal.toFixed(2),'</span>\n            </div>\n            <div class="summary-row" id="shippingRow">\n                <span>Shipping:</span>\n                <span id="shippingAmount">').concat(0===n.shipping?'<span style="color: black;">FREE</span>':"¥"+n.shipping.toFixed(2),"</span>\n            </div>\n        ");n.tax>0&&(t+='\n                <div class="summary-row" id="taxRow">\n                    <span>Tax ('.concat(n.config.tax,'%):</span>\n                    <span id="taxAmount">¥').concat(n.tax.toFixed(2),"</span>\n                </div>\n            ")),t+='\n            <div class="summary-row summary-total" id="totalRow" style="font-weight: bold; font-size: 18px; margin-top: 10px; padding-top: 10px; border-top: 2px solid black;">\n                <span>Total:</span>\n                <span id="totalAmount">¥'.concat(n.total.toFixed(2),"</span>\n            </div>\n        "),e.innerHTML=t;var a=document.getElementById("proceedToPayment");a&&(a.disabled=!1,a.style.background="black",a.style.color="white",a.style.cursor="pointer")}}function an(n,e,t,a){var r=document.querySelector(".cart-header"),i=document.getElementById("cartContent");r&&(r.innerHTML='\n                <h1>REVIEW & PAYMENT</h1>\n                <button class="back-button" data-action="back-to-shipping" style="\n                    padding: 8px 15px;\n                    border: 2px solid black;\n                    background: white;\n                    cursor: pointer;\n                    font-size: 14px;\n                ">← EDIT SHIPPING INFO</button>\n            ');var o=window.shippingConfig;var s='\n            <style>\n                .payment-methods {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 15px;\n                    margin: 20px 0;\n                }\n                \n                .payment-option {\n                    display: flex;\n                    align-items: center;\n                    gap: 15px;\n                    padding: 15px;\n                    border: 2px solid black;\n                    cursor: pointer;\n                    transition: all 0.3s;\n                }\n                \n                .payment-option:hover {\n                    border-color: black;\n                  \n                }\n                \n                .payment-option input[type="radio"]:checked + span {\n                    font-weight: bold;\n                }\n                \n                .order-summary-final {\n             \n                    padding: 20px;\n                    margin: 20px 0;\n                    border: 2px solid black;\n                }\n                \n                .payment-qr-container {\n                    display: none;\n                    text-align: center;\n                    padding: 20px;\n                    background: white;\n                    border: 2px solid black;\n                    margin: 20px 0;\n                }\n                \n                .payment-qr-container.active {\n                    display: block;\n                }\n                \n                .order-info {\n           \n                    padding: 15px;\n                    margin-bottom: 20px;\n                    border: 2px solid black;\n                }\n                \n                .qr-code-img {\n                    width: 250px;\n                    height: 250px;\n                    border: 2px solid black;\n                    padding: 10px;\n                    background: white;\n                }\n                \n                .payment-note {\n                    color: black;\n                    margin: 10px 0;\n                    font-size: 14px;\n                }\n                \n            \n            </style>\n            \n            <div class="payment-container">\n                <div class="order-review" style=" padding: 20px; margin-bottom: 25px; border: 2px solid black;">\n                    <h3 style="margin-bottom: 10px;">DELIVERY INFORMATION</h3>\n                    <p style="line-height: 1.6;">\n                        '.concat(n.fullName,"<br>\n                        ").concat(n.address1,"<br>\n                        ").concat(n.address2?n.address2+"<br>":"","\n                        ").concat(n.city,", ").concat(n.state," ").concat(n.zipCode,"<br>\n                        ").concat(o.name,"<br>\n                        <strong>Carrier:</strong> ").concat(o.carrier,"<br>\n                        <strong>Estimated Delivery:</strong> ").concat(o.estimatedDays,' business days\n                    </p>\n                </div>\n                \n                <div class="payment-form">\n                    <h3 style="margin-bottom: 20px;">SELECT PAYMENT METHOD</h3>\n                    ').concat('\n                <div class="payment-methods">\n                    <label class="payment-option">\n                        <input type="radio" name="payment" value="paypal" checked>\n                        <span>PayPal</span>\n                        </label>\n                    <label class="payment-option">\n                        <input type="radio" name="payment" value="alipay" checked>\n                        <span>Alipay(支付宝)</span>\n                    </label>\n                    <label class="payment-option">\n                        <input type="radio" name="payment" value="wechat">\n                        <span>WeChat Pay(微信支付)</span>\n                    </label>\n                </div>\n            ','\n                </div>\n                \n                <div class="order-summary-final">\n                    <h4 style="margin-bottom: 15px;">ORDER TOTAL</h4>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Subtotal:</span>\n                        <span>¥').concat(window.currentSubtotal.toFixed(2),'</span>\n                    </div>\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Shipping:</span>\n                        <span>').concat(0===e?'<span style="color: black;">FREE</span>':"¥"+e.toFixed(2),"</span>\n                    </div>\n                    ").concat(t>0?'\n                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">\n                        <span>Tax ('.concat(o.tax,"%):</span>\n                        <span>¥").concat(t.toFixed(2),"</span>\n                    </div>\n                    "):"",'\n                    <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 20px; margin-top: 10px; padding-top: 10px; border-top: 2px solid #333;">\n                        <span>Total to Pay:</span>\n                        <span>¥').concat(a.toFixed(2),"</span>\n                    </div>\n                </div>\n            </div>\n        ");i.innerHTML=s,function(n){var e=document.getElementById("cartSummary");if(e){e.innerHTML='\n                <h3>COMPLETE ORDER</h3>\n                <div>\n                    <div style="text-align: center; margin-top:15px;">\n                        <span style="font-size: 24px; font-weight: bold;">¥'.concat(n.toFixed(2),'</span>\n                    </div>\n                    <button id="placeOrderBtn" style="\n                        width: 100%;\n                        margin-top:15px;\n                        padding: 5px;\n                        background: black;\n                        color: white;\n                        border: none;\n                        font-size: 18px;\n                        font-weight: bold;\n                        cursor: pointer;\n                        text-transform: uppercase;\n                        transition: all 0.3s;\n                    " onmouseover="this.style.background=\'#333\'" onmouseout="this.style.background=\'black\'">\n                        PLACE ORDER\n                    </button>\n                    <p style="margin-top: 15px;margin-bottom: 0px;padding:0; font-size: 12px; color: #666; text-align: center;">\n                        Click to generate payment QR code\n                    </p>\n                </div>\n            ');var t=document.getElementById("placeOrderBtn");t&&(t.onclick=null,t.onclick=rn)}}(a),window.pendingPayment={amount:a,address:n,shipping:e,tax:t},window.showPaymentView=an}function rn(){return on.apply(this,arguments)}function on(){return(on=m(u().m(function n(){var e,t,a,r,i,o,s,c,d,l,p,f,m,y,g,b,v,h;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:if(e=document.querySelector('input[name="payment"]:checked')){n.n=1;break}return alert("Please select a payment method"),n.a(2);case 1:if(t=e.value,a=dn(),r=window.pendingPayment?window.pendingPayment.amount:window.orderTotal||0,i=null,o=null,"paypal"!==t){n.n=6;break}return n.p=2,n.n=3,fetch("https://api.exchangerate-api.com/v4/latest/USD");case 3:return s=n.v,n.n=4,s.json();case 4:c=n.v,i=c.rates.CNY,o=r/i,n.n=6;break;case 5:n.p=5,n.v,o=r/(i=7.2);case 6:return d="",n.p=7,n.n=8,supabase.auth.getUser();case 8:if(l=n.v,!(p=l.data.user)){n.n=10;break}return n.n=9,supabase.from("profiles").select("manifesto").eq("user_id",p.id).single();case 9:f=n.v,(m=f.data)&&m.manifesto&&(d=m.manifesto);case 10:n.n=12;break;case 11:n.p=11,n.v,d="User"+Math.random().toString(36).substr(2,5).toUpperCase();case 12:if(window.currentOrder={orderId:a,paymentMethod:t,amount:r,usdAmount:o,exchangeRate:i,manifesto:d,status:"pending",createdAt:(new Date).toISOString()},y={alipay:"Alipay(支付宝)",wechat:"WeChat Pay(微信支付)",paypal:"PayPal"},g={alipay:"/images/alipay-qr.png",wechat:"/images/wechat-qr.png",paypal:"./images/paypal-qr.png"}[t]||"./images/default-qr.png",b=document.querySelector(".cart-container")){n.n=13;break}return(v=document.getElementById("cartContent"))&&sn(v,a,r,t,y,g,d,o,i),n.a(2);case 13:sn(b,a,r,t,y,g,d,o,i),(h=document.getElementById("cartSummary"))&&(h.innerHTML='\n                <h3>PAYMENT PENDING</h3>\n                <div style="padding: 20px; text-align: center;">\n                    <p style="color: black; font-size: 20px; margin-bottom: 10px;">\n                        Waiting for payment\n                    </p>\n                    <p style="font-size: 15px; color: #666;">\n                        Order #'.concat(a,'\n                    </p>\n                    <p style="font-size: 25px; font-weight: bold; margin-top: 10px;">\n                        ').concat("paypal"===t&&o?"$".concat(o.toFixed(2)," USD"):"¥".concat(r.toFixed(2)),"\n                    </p>\n                    ").concat("paypal"===t&&i?'<p style="font-size: 12px; color: #666; margin-top: 5px;">\n                            (¥'.concat(r.toFixed(2)," @ 1 USD = ").concat(i.toFixed(4)," CNY)\n                        </p>"):"","\n                </div>\n            "));case 14:return n.a(2)}},n,null,[[7,11],[2,5]])}))).apply(this,arguments)}function sn(n,e,t,a,r,i,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,d=document.querySelector(".cart-header"),l=document.getElementById("cartContent");d&&(d.innerHTML='\n                <h1>PAYMENT</h1>\n                <button class="back-button" data-action="back-to-review" style="\n                    padding: 8px 15px;\n                    border: 2px solid black;\n                    background: white;\n                    cursor: pointer;\n                    font-size: 14px;\n                ">← BACK TO REVIEW</button>\n            ');"paypal"===a&&s&&c?'\n            <p><strong>Amount:</strong> \n            <span style="font-size: 20px; font-weight: bold;">$'.concat(s.toFixed(2),' USD</span><br>\n            <span style="font-size: 14px; color: #666;">(¥').concat(t.toFixed(2)," CNY @ 1 USD = ").concat(c.toFixed(2)," CNY)</span>\n            </p>\n        "):'<p><strong>Amount:</strong> <span style="font-size: 20px; font-weight: bold;">¥'.concat(t.toFixed(2),"</span></p>");var u='\n            <style>\n                .payment-display-container {\n                    padding: 20px;\n                    border: black 2px solid;\n                }\n                \n                .order-info {\n                    padding: 20px;\n                    margin-bottom: 20px;\n                    border: 2px solid black;\n                }\n                \n                .order-info h3 {\n                    margin-top: 0;\n                    text-transform: uppercase;\n                }\n                \n                .order-info p {\n                    margin: 10px 0;\n                    line-height: 1.6;\n                }\n                \n                .qr-section {\n                    text-align: center;\n                }\n                \n                .qr-section h4 {\n                    font-size: 20px;\n                    margin-bottom: 10px;\n                    text-transform: uppercase;\n                }\n                \n                .payment-note {\n                    margin-top: 10px;\n                    line-height: 1.8;\n                }\n            </style>\n            \n            <div class="payment-display-container">\n                <div class="order-info">\n                    <h3>ORDER INFORMATION</h3>\n                    <p><strong>Order Number:</strong> <span style="font-size: 18px; color: black;">'.concat(e,'</span></p>\n                    <p><strong>Manifesto#:</strong> <span style="font-size: 18px; color: black;">').concat(o||"Anonymous",'</span></p>\n                    <p><strong>Amount:</strong> <span style="font-size: 20px; font-weight: bold;">¥').concat(t.toFixed(2),"</span></p>\n                    <p><strong>Payment Method:</strong> ").concat(r[a]||a,'</p>\n                </div>\n                \n                <div class="qr-section">\n                    <h4>SCAN TO PAY</h4>\n                    <div style="margin-top:5px; border: 2px solid black; padding: 10px; display: inline-block; background: white;">\n                        <img src="').concat(i,'" \n                             alt="').concat(r[a]," QR Code\" \n                             class=\"qr-code-img\"\n                             style=\"width: 250px; height: 250px; display: block;\"\n                             onerror=\"this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'250\\' height=\\'250\\'%3E%3Crect fill=\\'%23f0f0f0\\' width=\\'250\\' height=\\'250\\'/%3E%3Ctext x=\\'50%25\\' y=\\'50%25\\' text-anchor=\\'middle\\' dy=\\'.3em\\' fill=\\'%23999\\'%3EQR Code%3C/text%3E%3C/svg%3E'; this.onerror=null;\">\n                    </div>\n                    <p class=\"payment-note\">\n                        <span style=\"color: black;\">Please include your manifesto in payment note(付款时请备注你的宣言)</span><br>\n                        <span style=\"color: black; font-weight: bold; font-size: 18px;\">宣言 Manifesto#: ").concat(o||"Anonymous",'</span>\n                    </p>\n                </div>\n                \n                <button id="confirmPaymentBtn" class="confirm-payment-btn"  style="\n                    background: black;\n                    color: white;\n                    padding: 5px;\n                    border: none;\n                    font-size: 18px;\n                    cursor: pointer;\n                    width: 100%;\n                    margin-top:5px;\n                ">\n                    I HAVE PAID(我已完成支付)\n                </button>\n            </div>\n        ');l.innerHTML=u,setTimeout(function(){var n=document.getElementById("confirmPaymentBtn");n&&(n.onclick=null,n.removeEventListener("click",fn),n.onclick=fn)},100)}function cn(){window.PAYMENT_QR_CODES||(window.PAYMENT_QR_CODES={alipay:"/images/alipay-qr.png",wechat:"/images/wechat-qr.png",paypal:"/images/paypal-qr.png"})}function dn(){var n=Date.now().toString(36).toUpperCase(),e=Math.random().toString(36).substr(2,5).toUpperCase();return"ORD".concat(n).concat(e)}function ln(){var n=null;if(window.pendingPayment&&window.pendingPayment.address)n=window.pendingPayment;else if(sessionStorage.getItem("pendingPayment"))try{n=JSON.parse(sessionStorage.getItem("pendingPayment")),window.pendingPayment=n}catch(n){}else window.checkoutAddress&&window.orderTotal&&(n={address:window.checkoutAddress,shipping:window.shippingCost||0,tax:window.taxAmount||0,amount:window.orderTotal},window.pendingPayment=n);n&&n.address?"function"==typeof window.showPaymentView&&window.showPaymentView(n.address,n.shipping,n.tax,n.amount):(alert("Payment information lost. Please restart checkout."),"function"==typeof window.loadCartItems&&window.loadCartItems())}function un(n,e){return pn.apply(this,arguments)}function pn(){return pn=m(u().m(function n(e,a){var i,o,s,c,d;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:i=[],o=r(a),n.p=1,c=u().m(function n(){var t,a,r,o,c,d,l,p,f,y,g,b,v,h,w,k,x,S,E;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:if((t=s.value).draft_id){n.n=1;break}return n.a(2,0);case 1:return n.p=1,a=function(){var n=m(u().m(function n(t,a){var r,i,o,s,c,d,l;return u().w(function(n){for(;;)switch(n.p=n.n){case 0:if(n.p=0,t){n.n=1;break}return n.a(2,null);case 1:if(!t.startsWith("data:")){n.n=4;break}return n.n=2,fetch(t);case 2:return i=n.v,n.n=3,i.blob();case 3:case 7:r=n.v,n.n=9;break;case 4:if(!t.startsWith("http")){n.n=8;break}return n.n=5,fetch(t);case 5:if((o=n.v).ok){n.n=6;break}throw new Error("Failed to fetch image");case 6:return n.n=7,o.blob();case 8:return n.a(2,null);case 9:return s="".concat(e,"/").concat(a),n.n=10,supabase.storage.from("orders").upload(s,r,{contentType:"image/png",upsert:!0});case 10:if(c=n.v,c.data,!c.error){n.n=11;break}return n.a(2,null);case 11:return d=supabase.storage.from("orders").getPublicUrl(s),l=d.data.publicUrl,n.a(2,l);case 12:return n.p=12,n.v,n.a(2,null)}},n,null,[[0,12]])}));return function(e,t){return n.apply(this,arguments)}}(),n.n=2,supabase.from("drafts").select("*").eq("id",t.draft_id).single();case 2:if(r=n.v,o=r.data,!r.error&&o){n.n=3;break}return n.a(2,0);case 3:if("tshirt"!==o.type){n.n=16;break}if(!o.front_preview_image){n.n=5;break}return n.n=4,a(o.front_preview_image,"tshirt_".concat(t.draft_id,"_front_preview.png"));case 4:(c=n.v)&&i.push({type:"front_preview",url:c});case 5:if(!o.back_preview_image){n.n=7;break}return n.n=6,a(o.back_preview_image,"tshirt_".concat(t.draft_id,"_back_preview.png"));case 6:(d=n.v)&&i.push({type:"back_preview",url:d});case 7:if(!o.data){n.n=15;break}if(!o.data.frontImages||!Array.isArray(o.data.frontImages)){n.n=11;break}l=0;case 8:if(!(l<o.data.frontImages.length)){n.n=11;break}if(f=o.data.frontImages[l],y=null,null!==(p=f.storageFile)&&void 0!==p&&p.publicUrl?y=f.storageFile.publicUrl:f.url?y=f.url:f.src&&(y=f.src),!y){n.n=10;break}return n.n=9,a(y,"tshirt_".concat(t.draft_id,"_front_design_").concat(l,".png"));case 9:(g=n.v)&&i.push({type:"front_design",index:l,url:g});case 10:l++,n.n=8;break;case 11:if(!o.data.backImages||!Array.isArray(o.data.backImages)){n.n=15;break}b=0;case 12:if(!(b<o.data.backImages.length)){n.n=15;break}if(h=o.data.backImages[b],w=null,null!==(v=h.storageFile)&&void 0!==v&&v.publicUrl?w=h.storageFile.publicUrl:h.url?w=h.url:h.src&&(w=h.src),!w){n.n=14;break}return n.n=13,a(w,"tshirt_".concat(t.draft_id,"_back_design_").concat(b,".png"));case 13:(k=n.v)&&i.push({type:"back_design",index:b,url:k});case 14:b++,n.n=12;break;case 15:n.n=20;break;case 16:if("svg"!==o.type){n.n=20;break}if(!o.front_preview_image){n.n=18;break}return n.n=17,a(o.front_preview_image,"svg_".concat(t.draft_id,"_preview.png"));case 17:(S=n.v)&&i.push({type:"svg_preview",url:S});case 18:if(null===(x=o.data)||void 0===x||!x.storageUrl){n.n=20;break}return n.n=19,a(o.data.storageUrl,"svg_".concat(t.draft_id,".svg"));case 19:(E=n.v)&&i.push({type:"svg_file",url:E});case 20:n.n=22;break;case 21:n.p=21,n.v;case 22:return n.a(2)}},n,null,[[1,21]])}),o.s();case 2:if((s=o.n()).done){n.n=5;break}return n.d(t(c()),3);case 3:if(0!==n.v){n.n=4;break}return n.a(3,4);case 4:n.n=2;break;case 5:n.n=7;break;case 6:n.p=6,d=n.v,o.e(d);case 7:return n.p=7,o.f(),n.f(7);case 8:return n.a(2,i)}},n,null,[[1,6,7,8]])})),pn.apply(this,arguments)}function fn(){return mn.apply(this,arguments)}function mn(){return(mn=m(u().m(function t(){var i,o,s,c,d,l,p,f,m,y,g,b,h,w,k,S,E,I,T,P,C,A,O,_,D,N;return u().w(function(t){for(;;)switch(t.p=t.n){case 0:return(i=document.getElementById("confirmPaymentBtn"))&&(i.disabled=!0,i.style.pointerEvents="none",i.style.opacity="0.6"),i.textContent="AWAITING VERIFICATION(请等待审核)",i.style.background="#999",window.currentOrder.status="awaiting_verification",window.currentOrder.paidAt=(new Date).toISOString(),t.p=1,o=function(n){return n&&Array.isArray(n)?n.map(function(n){var e={id:n.id,type:n.type,draft_id:n.draft_id,price:n.price||29.99,quantity:s(n),sizes:n.sizes||{}};return e.title=c(n),e}):[]},s=function(n){return n.type&&n.type.startsWith("console-")?n.quantity||0:n.sizes&&"object"===a(n.sizes)?Object.values(n.sizes).reduce(function(n,e){return n+e},0):n.quantity||0},c=function(n){if(n.type&&n.type.startsWith("console-")){if(n.item_data&&n.item_data.productName)return n.item_data.productName.toUpperCase();var e=n.type.replace("console-","");return"RETRO CONSOLE #".concat(e)}return n.type&&n.type.includes("blank-tshirt")?"BLANK T-SHIRT":n.draft_id?"CUSTOMIZED T-SHIRT":"T-SHIRT"},t.n=2,x();case 2:if(d=t.v){t.n=3;break}return i.disabled=!1,i.textContent="I HAVE PAID(我已完成支付)",i.style.background="black",t.a(2);case 3:return t.n=4,supabase.from("cart_items").select("*").eq("user_id",d.id);case 4:if(l=t.v,p=l.data,l.error&&e("cartItems"),f=[],!(p&&p.length>0)){t.n=18;break}i.textContent="SAVING DESIGNS(保存设计中)",t.p=5,m=r(p),t.p=6,m.s();case 7:if((y=m.n()).done){t.n=13;break}if((g=y.value).draft_id){t.n=8;break}return t.a(3,12);case 8:return t.n=9,supabase.from("drafts").select("*").eq("id",g.draft_id).single();case 9:if(b=t.v,h=b.data,!b.error&&h){t.n=10;break}return t.a(3,12);case 10:return t.n=11,un(window.currentOrder.orderId,[{draft_id:g.draft_id,draft:h}]);case 11:(w=t.v)&&w.length>0&&f.push.apply(f,n(w));case 12:t.n=7;break;case 13:t.n=15;break;case 14:t.p=14,D=t.v,m.e(D);case 15:return t.p=15,m.f(),t.f(15);case 16:t.n=18;break;case 17:t.p=17,t.v;case 18:return i.textContent="SUBMITTING ORDER(提交订单中)",k={order_id:window.currentOrder.orderId,user_id:d.id,manifesto:window.currentOrder.manifesto||"Anonymous",items:o(p),shipping_address:window.pendingPayment?window.pendingPayment.address:window.checkoutAddress,payment_method:window.currentOrder.paymentMethod,amount:window.currentOrder.amount,shipping_cost:window.pendingPayment?window.pendingPayment.shipping:window.shippingCost||0,tax_amount:window.pendingPayment?window.pendingPayment.tax:window.taxAmount||0,status:"awaiting_verification",payment_status:"pending_verification",created_at:window.currentOrder.createdAt,paid_at:window.currentOrder.paidAt},S=null,E=null,t.p=19,t.n=20,v("/api/orders",{method:"POST",body:JSON.stringify(k)});case 20:I=t.v,S=I,t.n=22;break;case 21:t.p=21,N=t.v,E=N;case 22:if(!E&&S){t.n=23;break}return P=(null===(T=E)||void 0===T?void 0:T.message)||"未知错误",alert("Error saving order: "+P+"\n\nPlease save your order number: "+window.currentOrder.orderId),i.disabled=!1,i.textContent="I HAVE PAID(我已完成支付)",i.style.background="black",t.a(2);case 23:return(C=document.getElementById("cartContent"))&&(C.innerHTML='\n                <div style="text-align: center; padding: 40px;">\n                    <h2 style="color: black;">✓ PAYMENT SUBMITTED</h2>\n                    <p style="font-size: 18px; margin: 20px 0;">\n                        Order #'.concat(window.currentOrder.orderId,'\n                    </p>\n                    <p style="color: black;">\n                        We will verify your payment within 24 hours<br>\n                        付款将在24小时内审核\n                    </p><br>\n                    <p style="color: black;">\n                    You can check your order progress in your profile<br>\n                    您可以在档案中查看订单进展\n                </p>\n                    <button class="cart-btn" data-action="go-home" style="\n                        margin-top: 30px;\n                        padding: 15px 30px;\n                        background: black;\n                        color: white;\n                        border: none;\n                        cursor: pointer;\n                        font-size: 16px;\n                    ">CONTINUE SHOPPING</button>\n                </div>\n            ')),t.p=24,t.n=25,v("/api/cart/clear",{method:"DELETE"});case 25:t.n=32;break;case 26:return t.p=26,t.v,t.p=27,t.n=28,supabase.auth.getUser();case 28:if(A=t.v,!(O=A.data.user)){t.n=30;break}return t.n=29,supabase.from("cart_items").delete().eq("user_id",O.id);case 29:_=t.v,_.error;case 30:t.n=32;break;case 31:t.p=31,t.v;case 32:if(!window.CartManager){t.n=33;break}return t.n=33,window.CartManager.updateCartBadge();case 33:sessionStorage.removeItem("pendingPayment"),alert("Order submitted successfully!\n订单提交成功！\n\nOrder #".concat(window.currentOrder.orderId,"\n\nWe will verify your payment within 24 hours.\n我们将在24小时内验证您的付款。")),t.n=35;break;case 34:t.p=34,t.v,alert("Unexpected error. Please save your order number: "+window.currentOrder.orderId),i&&(i.disabled=!1,i.style.pointerEvents="auto",i.style.opacity="1",i.textContent="I HAVE PAID(我已完成支付)",i.style.background="black");case 35:return t.a(2)}},t,null,[[27,31],[24,26],[19,21],[6,14,15,16],[5,17],[1,34]])}))).apply(this,arguments)}window.SHIPPING_CONFIG={CN:{name:"China (Mainland)",carrier:"ZTO Express (中通快递)",shipping:0,tax:0,currency:"CNY",estimatedDays:"2-5",trackingPrefix:"ZTO"},HK:{name:"Hong Kong",carrier:"SF Express International (顺丰国际)",shipping:25,tax:0,currency:"USD",estimatedDays:"3-7",trackingPrefix:"SF"},TW:{name:"Taiwan",carrier:"SF Express International (顺丰国际)",shipping:30,tax:5,currency:"USD",estimatedDays:"5-10",trackingPrefix:"SF"},JP:{name:"Japan",carrier:"SF Express International (顺丰国际)",shipping:45,tax:10,currency:"USD",estimatedDays:"7-14",trackingPrefix:"SF"},UK:{name:"United Kingdom",carrier:"SF Express International (顺丰国际)",shipping:65,tax:20,currency:"USD",estimatedDays:"10-15",trackingPrefix:"SF"},US:{name:"United States",carrier:"SF Express International (顺丰国际)",shipping:60,tax:8,currency:"USD",estimatedDays:"10-15",trackingPrefix:"SF"},OTHER:{name:"Other Countries",carrier:"SF Express International (顺丰国际)",shipping:75,tax:15,currency:"USD",estimatedDays:"15-30",trackingPrefix:"SF"}},void 0===window.PAYMENT_QR_CODES&&(window.PAYMENT_QR_CODES={alipay:"/images/alipay-qr.png",wechat:"/images/wechat-qr.png",paypal:"/images/paypal-qr.png"}),void 0===window.calculateAndShowPayment&&(window.calculateAndShowPayment=X),function(){var n=document.getElementById("cartContent"),e=document.getElementById("cartSummary");function t(){document.getElementById("cartContent")?a():setTimeout(function(){document.getElementById("cartContent")&&a()},500)}function a(){var n=setInterval(function(){window.authManager&&window.supabase&&(clearInterval(n),window.authManager.isAuthenticated()?E():function(){var n=document.getElementById("cartContent");n&&(n.innerHTML='\n                <div class="cart-empty">\n                    <h2>请登录查看购物车</h2>\n                    <p>登录后可以查看和编辑购物车中的商品</p>\n                    <button class="cart-btn" onclick="\n                        const event = new CustomEvent(\'showAuthModal\', { \n                            detail: { \n                                message: \'请登录后查看购物车\',\n                                redirect: window.location.href\n                            } \n                        });\n                        window.dispatchEvent(event);\n                    ">立即登录</button>\n                </div>\n            ');var e=document.getElementById("cartSummary");e&&(e.style.display="none")}())},100);setTimeout(function(){clearInterval(n),!window.authManager||window.supabase},5e3)}(n||e)&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t())}(),window.proceedToPayment=function(){var n=document.querySelector('input[name="selectedAddress"]:checked');if(n){var e=parseInt(n.value),t=(window.currentSavedAddresses||[])[e];t?(window.checkoutAddress=t,X(t)):alert("Selected address not found")}else alert("Please select a shipping address")},window.updateQuantity=q,window.removeItem=F,window.proceedToCheckout=L,window.goToHome=H,window.showPaymentView=an,window.generatePaymentOrder=rn,window.initializePaymentQRCodes=cn,window.confirmPayment=fn,window.displayPaymentInfo=sn,window.handleBackToReview=ln,window.handleCartClick=function(n){var e=n.target;if(e.classList.contains("back-button")||e.closest(".back-button")){n.preventDefault();var t=e.closest(".back-button");if(t){var a=t.getAttribute("data-action");if("back-to-cart"===a)nn();else if("back-to-shipping"===a)B();else if("back-to-review"===a)return void ln()}}else if(e.classList.contains("quantity-btn")){n.preventDefault();var r=e.getAttribute("data-cart-id"),i=e.getAttribute("data-size"),o=parseInt(e.getAttribute("data-change"));r&&i&&o&&q(r,i,o)}else if(e.classList.contains("cart-item-remove")){n.preventDefault();var s=e.getAttribute("data-cart-id");s&&F(s)}else{if("proceedCheckoutBtn"===e.id)return n.preventDefault(),void L();if("confirmPaymentBtn"===e.id)return n.preventDefault(),void fn();if(e.classList.contains("cart-btn"))switch(n.preventDefault(),e.getAttribute("data-action")){case"go-home":case"continue-shopping":H();break;case"complete-purchase":completePurchase()}else;}},window.saveOrderImagesToStorage=un})();