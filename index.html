<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><title>宣言俱乐部</title><link rel="icon" href="./images/000.ico" type="image/x-icon"><link rel="shortcut icon" href="./images/000.ico" type="image/x-icon"><script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script><script type="module">import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
        window.supabase = createClient(
            "https://zdahntyxdcmkmbgjtizc.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpkYWhudHl4ZGNta21iZ2p0aXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNDM3MjMsImV4cCI6MjA2NDYxOTcyM30.ew3haBr1qN5lSKQ8LWBRqlqrWw99b_s954GGjrK4brc"
        );</script><style>/* @font-face {
        font-family: "Mono";
        font-style: normal;
        font-weight: 400;
        src: url(/_nuxt/fonts/supply_mono.5330c62.woff2) format("woff2")
    } */

        * {
            box-sizing: border-box;
            /* font-family: Unica77LLWeb-Regular, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif; */
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
        }

        html {
            margin: 0;
            padding: 0
        }

        html.lock {
            overflow: hidden
        }

        body {
            font-size: 18px;
            margin: 0;
            padding: 0;
        }


        a {
            -webkit-text-decoration: none;
            text-decoration: none
        }

        a,
        a:focus,
        a:visited {
            color: #010101
        }

        .languages span {
            margin-left: 10px;
            border: 2px black solid;
            box-sizing: border-box;

            font-size: 18px;

        }

        .languages {
            margin-top: -45px;
            position: absolute;
            right: 0;
            margin-left: 20px;
            margin-right: 20px;
        }



        @media(max-width:899px) {

            .languages span {
                margin-left: 10px;
                border: 2px black solid;
                box-sizing: border-box;

                font-size: 18px;

            }

            .languages {
                margin-top: -45px;
                position: absolute;
                right: 0;
                margin-left: 10px;
                margin-right: 10px;
            }

        }</style><link href="/css/styles.2b4c472ffabc86239714.css" rel="stylesheet"></head><body><header class="header"><div class="header__inner"><div class="header__logo"><div class="header__logo-inner"><a href="" data-page="home"><img src="./images/000.jpg" alt="ManifestoClub"></a></div></div><aside class="header__radio"><div class="radio"><div class="radio__upper"><div id="play" class="radio__play"><input type="checkbox" id="playpause" name="check"> <label for="playpause"></label></div><div class="radio__live"></div><div class="header__mob-toggle"><img src="./images/000.jpg"></div></div><div class="radio__lower"><span>PLAYLIST</span> <span>CHAT</span></div></div></aside><nav class="header__nav"><ul><li><a href="" class="">(CD/LP)</a></li><li><a href="" data-page="merch">MERCH</a></li><li><a href="">(Print)</a></li><li><a href="" data-page="event">Event</a></li><li><a href="" data-page="about">About</a></li><li><span id="login-trigger">Login</span></li></ul></nav></div><div class="mobile-nav" id="mobileNav"><nav class="header__nav--mobile"><ul><li><a href="" data-page="home">HOME</a></li><li><a href="" class="">(CD/LP)</a></li><li><a href="" data-page="merch">MERCH</a></li><li><a href="">(PRINT)</a></li><li><a href="" data-page="event">EVENT</a></li><li><a href="" data-page="gallery">GALLERY</a></li><li><a href="" data-page="about">ABOUT</a></li><li><span>LOGIN</span></li></ul></nav></div><div class="cart" data-page="cart" id="cartIcon" style="display: none;">CART(<span id="cartBadge">0</span>)</div></header><main class="main--banner"><section class="page" id="dynamic-content"></section></main><div class="languages"><span>EN</span><span>中</span></div><div id="auth-modal" class="auth-modal"><div class="auth-modal-container"><div class="auth-modal-header" style="display: block;"><div id="barcode-container"><svg id="barcode"></svg></div></div><div id="login-form"><div class="login-wrapper"><input type="email" id="login-email" class="auth-form-input" placeholder="EMAIL/MANIFESTO"><p id="login-error" class="error-message" style="display: none;"></p></div><div class="password-input-wrapper"><input type="password" id="login-password" class="auth-form-input" placeholder="PASSWORD"> <span class="forgot-password-link">Forgot password?</span></div><p class="auth-form-btn" id="login-button">LOGIN</p><p class="auth-form-toggle signup">NOT A MEMBER YET?<span> SIGN UP</span></p></div><div id="signup-form"><div class="manifesto-wrapper"><input type="manifesto" id="manifesto" class="auth-form-input" placeholder="MANIFESTO" maxlength="30"><div class="check-manifesto check-icon"></div><p id="manifesto-error" class="error-message" style="display: none;"></p></div><div class="email-wrapper"><input type="email" id="signup-email" class="auth-form-input" placeholder="EMAIL"><div class="check-email check-icon"></div><p id="email-error" class="error-message" style="display: none;"></p></div><div class="password-wrapper"><input type="password" id="signup-password" class="auth-form-input" placeholder="PASSWORD"><div class="check-password check-icon"></div><p id="password-error" class="error-message" style="display: none;"></p></div><p class="auth-form-btn" id="signup-button">SIGN UP</p><p class="auth-form-toggle signup">ALREADY A MEMBER? <span>LOGIN</span></p></div><div id="password-reset-form" style="display:none;"><div class="reset-wrapper"><input type="email" id="reset-email" class="auth-form-input" placeholder="EMAIL"><p id="reset-error" class="error-message" style="display: none;"></p></div><p class="auth-form-btn" id="reset-link">SEND RESET LINK</p><p class="auth-form-toggle login">BACK TO LOGIN</p></div><div id="update-password-form" style="display:none;"><input type="email" id="reset-email-display" class="auth-form-input" placeholder="EMAIL" readonly="readonly" onfocus="this.blur()" style="background-color: #f5f5f5; cursor: default;"><div class="reset-password-wrapper"><input type="password" id="new-password" class="auth-form-input" placeholder="NEW PASSWORD"><div class="check-new-password check-icon"></div><p id="update-password-error" class="error-message" style="display: none;"></p></div><div class="confirm-password-wrapper"><input type="password" class="auth-form-input" id="confirm-password" placeholder="CONFIRM PASSWORD"><div class="check-confirm-password check-icon"></div><p id="confirm-password-error" class="error-message" style="display: none;"></p></div><p class="auth-form-btn" id="update-password">UPDATE PASSWORD</p></div><div id="signup-success-form" style="display:none;"><p>Registration Successful!</p><p>Your member code:</p><span id="manifesto-code"></span><div id="barcode-container"><svg id="barcode-success"></svg></div><p>We've sent a verification email to <span id="success-email"></span></p><div class="success-actions"><p class="auth-form-toggle" id="verify-button">Verify Later</p><p class="auth-form-btn" id="resend-button">Resend Verification Email</p></div></div></div></div><script>document.addEventListener('DOMContentLoaded', () => {
    console.log('Page loaded, current URL:', window.location.href);
    console.log('Base URL:', window.location.origin);
    
    document.addEventListener('click', function (e) {
        const pageLink = e.target.closest('[data-page]');
        if (pageLink) {
            e.preventDefault();
            const targetPage = pageLink.dataset.page;
            console.log('Clicked page:', targetPage);
            loadPage(targetPage);
            return;
        }
    })
    
    // 自动加载home页面
    loadPage('home');
})

document.addEventListener('gesturestart', function (e) {
    e.preventDefault();
});

function closeMobileMenu() {
    const mobileNav = document.getElementById('mobileNav');
    if (mobileNav) {
        mobileNav.style.display = 'none';
    }
}

// 简单的全局状态管理
window.APP_SIMPLE = window.APP_SIMPLE || {
    currentPage: null,
    loadedPages: new Set(),
    isLoading: false
};

async function loadPage(page) {
    console.log(`Attempting to load page: ${page}`);
    
    const content = document.getElementById("dynamic-content");
    if (!content) {
        console.error('Dynamic content container not found');
        return;
    }

    // 防止重复加载
    if (window.APP_SIMPLE.isLoading) {
        console.log('Already loading a page, skipping...');
        return;
    }

    if (window.APP_SIMPLE.currentPage === page && window.APP_SIMPLE.loadedPages.has(page)) {
        console.log(`Page ${page} already loaded and active`);
        return;
    }

    window.APP_SIMPLE.isLoading = true;
    content.classList.add("fade-out");

    try {
        // 获取HTML内容 - 简化路径逻辑
        const html = await fetchPageHTML(page);
        
        // 解析并更新内容
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        // 处理样式
        updatePageStyles(doc, page);

        // 更新内容
        const pageContent = doc.body.innerHTML || html;
        content.innerHTML = pageContent;

        // 更新状态
        window.APP_SIMPLE.currentPage = page;
        window.APP_SIMPLE.loadedPages.add(page);

        // 加载页面脚本（如果需要）
        await loadPageScript(page);

        // 处理内联脚本（防重复）
        await executePageScripts(page, content);

        console.log(`Successfully loaded page: ${page}`);

    } catch (error) {
        console.error(`Failed to load page ${page}:`, error);
        content.innerHTML = `
            <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
                <h2>页面加载失败</h2>
                <p>页面: ${page}</p>
                <p>错误: ${error.message}</p>
                <button onclick="loadPage('${page}')" style="padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; cursor: pointer;">
                    重试
                </button>
                <button onclick="loadPage('home')" style="padding: 10px 20px; margin: 5px; background: #28a745; color: white; border: none; cursor: pointer;">
                    返回首页
                </button>
            </div>
        `;
    } finally {
        content.classList.remove("fade-out");
        closeMobileMenu();
        window.APP_SIMPLE.isLoading = false;
    }
}

// 获取页面HTML - 修复生产环境路径问题
async function fetchPageHTML(page) {
    // 根据当前URL构建基础路径
    const currentPath = window.location.pathname;
    const isInSubdirectory = currentPath !== '/' && currentPath !== '/index.html';
    
    console.log('Current path:', currentPath);
    console.log('Is in subdirectory:', isInSubdirectory);
    
    // 构建可能的路径列表
    const possiblePaths = [];
    
    if (isInSubdirectory) {
        // 如果在子目录中，尝试相对于当前目录的路径
        possiblePaths.push(`./${page}.html`);
        possiblePaths.push(`../${page}.html`);
    }
    
    // 始终尝试这些基本路径
    possiblePaths.push(`${page}.html`);
    possiblePaths.push(`/${page}.html`);
    
    console.log('Trying paths:', possiblePaths);
    
    // 依次尝试每个路径
    for (const path of possiblePaths) {
        try {
            console.log(`Fetching: ${path}`);
            const response = await fetch(path);
            
            if (response.ok) {
                console.log(`Success with path: ${path}`);
                return await response.text();
            } else {
                console.log(`Failed ${path}: ${response.status} ${response.statusText}`);
            }
        } catch (error) {
            console.log(`Error with ${path}:`, error.message);
        }
    }
    
    throw new Error(`Could not load ${page}.html from any path: ${possiblePaths.join(', ')}`);
}

// 更新页面样式
function updatePageStyles(doc, page) {
    // 移除其他页面的样式
    document.querySelectorAll('style[data-page]').forEach(style => {
        if (style.getAttribute('data-page') !== page) {
            style.remove();
        }
    });

    // 添加当前页面样式
    const styles = doc.querySelectorAll('style');
    styles.forEach(styleEl => {
        if (!document.querySelector(`style[data-page="${page}"]`)) {
            const newStyle = document.createElement('style');
            newStyle.textContent = styleEl.textContent;
            newStyle.setAttribute('data-page', page);
            document.head.appendChild(newStyle);
        }
    });
}

// 加载页面脚本
async function loadPageScript(page) {
    const jsFileName = `page-${page}.js`;
    
    // 检查关键函数是否已存在（防重复加载）
    if (page === 'home') {
        if (typeof window.transferToTShirt === 'function') {
            console.log('Content page functions already loaded');
            return;
        }
    }

    // 检查脚本是否已加载
    if (document.querySelector(`script[data-page-script="${jsFileName}"]`)) {
        console.log(`Script ${jsFileName} already loaded`);
        return;
    }

    // 构建脚本路径
    const currentPath = window.location.pathname;
    const isInSubdirectory = currentPath !== '/' && currentPath !== '/index.html';
    
    const scriptPaths = [];
    
    if (isInSubdirectory) {
        scriptPaths.push(`./js/${jsFileName}`);
        scriptPaths.push(`../js/${jsFileName}`);
    }
    
    scriptPaths.push(`js/${jsFileName}`);
    scriptPaths.push(`/js/${jsFileName}`);

    console.log(`Trying to load script from paths:`, scriptPaths);

    // 尝试加载脚本
    for (const scriptPath of scriptPaths) {
        try {
            await loadScriptFromPath(scriptPath, jsFileName);
            console.log(`Successfully loaded script from: ${scriptPath}`);
            return;
        } catch (error) {
            console.log(`Failed to load script from ${scriptPath}:`, error.message);
        }
    }

    console.warn(`Could not load script: ${jsFileName}`);
}

// 从指定路径加载脚本
function loadScriptFromPath(scriptPath, fileName) {
    return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = scriptPath;
        script.setAttribute('data-page-script', fileName);
        
        script.onload = () => resolve();
        script.onerror = () => {
            script.remove();
            reject(new Error(`Failed to load ${scriptPath}`));
        };
        
        document.body.appendChild(script);
    });
}

// 执行页面脚本（防重复）
async function executePageScripts(page, content) {
    const scripts = content.querySelectorAll('script');
    
    if (!window.executedPageScripts) {
        window.executedPageScripts = new Set();
    }
    
    for (let i = 0; i < scripts.length; i++) {
        const script = scripts[i];
        
        if (script.src || !script.textContent.trim()) {
            continue; // 跳过外部脚本和空脚本
        }
        
        const scriptId = `${page}_script_${i}`;
        
        if (window.executedPageScripts.has(scriptId)) {
            console.log(`Script ${scriptId} already executed`);
            continue;
        }
        
        // 检查是否包含已存在的函数定义
        const scriptContent = script.textContent;
        if (containsExistingFunction(scriptContent)) {
            console.log(`Skipping script due to existing function definitions`);
            continue;
        }
        
        try {
            console.log(`Executing script: ${scriptId}`);
            window.executedPageScripts.add(scriptId);
            
            // 包装执行以提供更好的错误信息
            const wrappedScript = `
                try {
                    ${scriptContent}
                } catch (error) {
                    console.error('Script execution error in ${scriptId}:', error);
                    throw error;
                }
            `;
            
            eval(wrappedScript);
            
        } catch (error) {
            console.error(`Error executing script ${scriptId}:`, error);
        }
    }
}

// 检查是否包含已存在的函数
function containsExistingFunction(scriptContent) {
    const criticalFunctions = [
        'transferToTShirt',
        'saveToDraft',
        'initSVG',
        'initCanvasEventListeners'
    ];
    
    return criticalFunctions.some(funcName => {
        const functionExists = typeof window[funcName] === 'function';
        const scriptDefinesFunction = scriptContent.includes(`function ${funcName}`) || 
                                      scriptContent.includes(`${funcName} =`) ||
                                      scriptContent.includes(`${funcName}:`);
        
        if (functionExists && scriptDefinesFunction) {
            console.log(`Function ${funcName} already exists, skipping redefinition`);
            return true;
        }
        return false;
    });
}

// 调试函数
window.debugLoadPage = function() {
    console.log('=== Load Page Debug Info ===');
    console.log('Current URL:', window.location.href);
    console.log('Current path:', window.location.pathname);
    console.log('Current page:', window.APP_SIMPLE.currentPage);
    console.log('Loaded pages:', Array.from(window.APP_SIMPLE.loadedPages));
    console.log('Is loading:', window.APP_SIMPLE.isLoading);
    
    // 检查DOM元素
    console.log('Dynamic content exists:', !!document.getElementById('dynamic-content'));
    console.log('Home button exists:', !!document.querySelector('[data-page="home"]'));
    console.log('Cart element exists:', !!document.getElementById('cartIcon'));
    
    // 检查关键函数
    console.log('transferToTShirt exists:', typeof window.transferToTShirt);
    console.log('saveToDraft exists:', typeof window.saveToDraft);
};

// 页面加载完成后运行调试
setTimeout(() => {
    console.log('Running automatic debug...');
    window.debugLoadPage();
}, 1000);</script><script defer="defer" src="/js/vendors.08ee64c9e60251b5d335.js"></script><script defer="defer" src="/js/styles.7aae21adbc8ce89b8327.js"></script><script defer="defer" src="/js/828.f4fc89ede5a6efcab4d1.js"></script><script defer="defer" src="/js/33.545769f2acdaaebe9ae3.js"></script><script defer="defer" src="/js/798.b0cf1e47f6c8f7e444c1.js"></script><script defer="defer" src="/js/global.9e411c2b11604bb8b1b6.js"></script></body></html>