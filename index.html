<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><title>宣言俱乐部</title><link rel="icon" href="./images/000.ico" type="image/x-icon"><link rel="shortcut icon" href="./images/000.ico" type="image/x-icon"><script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script><script type="module">import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
        window.supabase = createClient(
            "https://zdahntyxdcmkmbgjtizc.supabase.co",
            "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpkYWhudHl4ZGNta21iZ2p0aXpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkwNDM3MjMsImV4cCI6MjA2NDYxOTcyM30.ew3haBr1qN5lSKQ8LWBRqlqrWw99b_s954GGjrK4brc"
        );</script><style>/* @font-face {
        font-family: "Mono";
        font-style: normal;
        font-weight: 400;
        src: url(/_nuxt/fonts/supply_mono.5330c62.woff2) format("woff2")
    } */

        * {
            box-sizing: border-box;
            /* font-family: Unica77LLWeb-Regular, Helvetica Neue, Helvetica, Arial, Lucida Grande, sans-serif; */
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
        }

        html {
            margin: 0;
            padding: 0
        }

        html.lock {
            overflow: hidden
        }

        body {
            font-size: 18px;
            margin: 0;
            padding: 0;
        }


        a {
            -webkit-text-decoration: none;
            text-decoration: none
        }

        a,
        a:focus,
        a:visited {
            color: #010101
        }

        .languages span {
            margin-left: 10px;
            border: 2px black solid;
            box-sizing: border-box;

            font-size: 18px;

        }

        .languages {
            margin-top: -45px;
            position: absolute;
            right: 0;
            margin-left: 20px;
            margin-right: 20px;
        }



        @media(max-width:899px) {

            .languages span {
                margin-left: 10px;
                border: 2px black solid;
                box-sizing: border-box;

                font-size: 18px;

            }

            .languages {
                margin-top: -45px;
                position: absolute;
                right: 0;
                margin-left: 10px;
                margin-right: 10px;
            }

        }</style><link href="/css/styles.2b4c472ffabc86239714.css" rel="stylesheet"></head><body><header class="header"><div class="header__inner"><div class="header__logo"><div class="header__logo-inner"><a href="" data-page="home"><img src="./images/000.jpg" alt="ManifestoClub"></a></div></div><aside class="header__radio"><div class="radio"><div class="radio__upper"><div id="play" class="radio__play"><input type="checkbox" id="playpause" name="check"> <label for="playpause"></label></div><div class="radio__live"></div><div class="header__mob-toggle"><img src="./images/000.jpg"></div></div><div class="radio__lower"><span>PLAYLIST</span> <span>CHAT</span></div></div></aside><nav class="header__nav"><ul><li><a href="" class="">(CD/LP)</a></li><li><a href="" data-page="merch">MERCH</a></li><li><a href="">(Print)</a></li><li><a href="" data-page="event">Event</a></li><li><a href="" data-page="about">About</a></li><li><span id="login-trigger">Login</span></li></ul></nav></div><div class="mobile-nav" id="mobileNav"><nav class="header__nav--mobile"><ul><li><a href="" data-page="home">HOME</a></li><li><a href="" class="">(CD/LP)</a></li><li><a href="" data-page="merch">MERCH</a></li><li><a href="">(PRINT)</a></li><li><a href="" data-page="event">EVENT</a></li><li><a href="" data-page="gallery">GALLERY</a></li><li><a href="" data-page="about">ABOUT</a></li><li><span>LOGIN</span></li></ul></nav></div><div class="cart" data-page="cart" id="cartIcon" style="display: none;">CART(<span id="cartBadge">0</span>)</div></header><main class="main--banner"><section class="page" id="dynamic-content"></section></main><div class="languages"><span>EN</span><span>中</span></div><div id="auth-modal" class="auth-modal"><div class="auth-modal-container"><div class="auth-modal-header" style="display: block;"><div id="barcode-container"><svg id="barcode"></svg></div></div><div id="login-form"><div class="login-wrapper"><input type="email" id="login-email" class="auth-form-input" placeholder="EMAIL/MANIFESTO"><p id="login-error" class="error-message" style="display: none;"></p></div><div class="password-input-wrapper"><input type="password" id="login-password" class="auth-form-input" placeholder="PASSWORD"> <span class="forgot-password-link">Forgot password?</span></div><p class="auth-form-btn" id="login-button">LOGIN</p><p class="auth-form-toggle signup">NOT A MEMBER YET?<span> SIGN UP</span></p></div><div id="signup-form"><div class="manifesto-wrapper"><input type="manifesto" id="manifesto" class="auth-form-input" placeholder="MANIFESTO" maxlength="30"><div class="check-manifesto check-icon"></div><p id="manifesto-error" class="error-message" style="display: none;"></p></div><div class="email-wrapper"><input type="email" id="signup-email" class="auth-form-input" placeholder="EMAIL"><div class="check-email check-icon"></div><p id="email-error" class="error-message" style="display: none;"></p></div><div class="password-wrapper"><input type="password" id="signup-password" class="auth-form-input" placeholder="PASSWORD"><div class="check-password check-icon"></div><p id="password-error" class="error-message" style="display: none;"></p></div><p class="auth-form-btn" id="signup-button">SIGN UP</p><p class="auth-form-toggle signup">ALREADY A MEMBER? <span>LOGIN</span></p></div><div id="password-reset-form" style="display:none;"><div class="reset-wrapper"><input type="email" id="reset-email" class="auth-form-input" placeholder="EMAIL"><p id="reset-error" class="error-message" style="display: none;"></p></div><p class="auth-form-btn" id="reset-link">SEND RESET LINK</p><p class="auth-form-toggle login">BACK TO LOGIN</p></div><div id="update-password-form" style="display:none;"><input type="email" id="reset-email-display" class="auth-form-input" placeholder="EMAIL" readonly="readonly" onfocus="this.blur()" style="background-color: #f5f5f5; cursor: default;"><div class="reset-password-wrapper"><input type="password" id="new-password" class="auth-form-input" placeholder="NEW PASSWORD"><div class="check-new-password check-icon"></div><p id="update-password-error" class="error-message" style="display: none;"></p></div><div class="confirm-password-wrapper"><input type="password" class="auth-form-input" id="confirm-password" placeholder="CONFIRM PASSWORD"><div class="check-confirm-password check-icon"></div><p id="confirm-password-error" class="error-message" style="display: none;"></p></div><p class="auth-form-btn" id="update-password">UPDATE PASSWORD</p></div><div id="signup-success-form" style="display:none;"><p>Registration Successful!</p><p>Your member code:</p><span id="manifesto-code"></span><div id="barcode-container"><svg id="barcode-success"></svg></div><p>We've sent a verification email to <span id="success-email"></span></p><div class="success-actions"><p class="auth-form-toggle" id="verify-button">Verify Later</p><p class="auth-form-btn" id="resend-button">Resend Verification Email</p></div></div></div></div><script>document.addEventListener('DOMContentLoaded', () => {
            document.addEventListener('click', function (e) {
                const pageLink = e.target.closest('[data-page]');
                if (pageLink) {
                    e.preventDefault();
                    loadPage(pageLink.dataset.page);
                    return;
                }
            })
            loadPage('home');
        })

        document.addEventListener('gesturestart', function (e) {
            e.preventDefault();
        });

        function closeMobileMenu() {
            document.getElementById('mobileNav').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', () => {
    document.addEventListener('click', function (e) {
        const pageLink = e.target.closest('[data-page]');
        if (pageLink) {
            e.preventDefault();
            loadPage(pageLink.dataset.page);
            return;
        }
    })
    loadPage('home');
})

document.addEventListener('gesturestart', function (e) {
    e.preventDefault();
});

function closeMobileMenu() {
    document.getElementById('mobileNav').style.display = 'none';
}

// 全局变量防止重复执行
window.pageStates = window.pageStates || {};
window.loadingPages = window.loadingPages || new Set();

async function loadPage(page) {
    const content = document.getElementById("dynamic-content");
    if (!content) return;

    // 防止重复加载同一页面
    if (window.loadingPages.has(page)) {
        console.log(`Page ${page} is already loading`);
        return;
    }
    
    // 如果是相同页面且已经加载过，直接返回
    if (window.currentPage === page && window.pageStates[page]?.initialized) {
        console.log(`Page ${page} already loaded`);
        return;
    }

    // 标记页面开始加载
    window.loadingPages.add(page);

    // 清理当前页面
    if (window.currentPage && window.currentPage !== page) {
        cleanupPage(window.currentPage);
    }

    content.classList.add("fade-out");

    try {
        // 尝试多个路径
        const paths = [`${page}.html`];
        let html = null;
        
        for (const path of paths) {
            try {
                const response = await fetch(path);
                if (response.ok) {
                    html = await response.text();
                    break;
                }
            } catch (e) {
                console.log(`Failed to load from ${path}`);
            }
        }

        if (!html) {
            throw new Error(`Could not load ${page}.html`);
        }

        // 解析 HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        // 处理样式
        const styles = doc.querySelectorAll('style');
        styles.forEach(styleEl => {
            // 移除其他页面样式
            const existingStyles = document.querySelectorAll(`style[data-page]`);
            existingStyles.forEach(existing => {
                if (existing.getAttribute('data-page') !== page) {
                    existing.remove();
                }
            });

            // 避免重复添加样式
            const existingStyle = document.querySelector(`style[data-page="${page}"]`);
            if (!existingStyle) {
                const newStyle = document.createElement('style');
                newStyle.textContent = styleEl.textContent;
                newStyle.setAttribute('data-page', page);
                document.head.appendChild(newStyle);
            }
        });

        // 更新页面内容
        const pageContent = doc.body.innerHTML || html;
        content.innerHTML = pageContent;

        // 记录当前页面
        window.currentPage = page;
        
        // 初始化页面状态
        if (!window.pageStates[page]) {
            window.pageStates[page] = {
                initialized: false,
                scriptsLoaded: false
            };
        }

        // 加载外部脚本（只加载一次）
        if (!window.pageStates[page].scriptsLoaded) {
            await loadPageScript(`page-${page}.js`);
            window.pageStates[page].scriptsLoaded = true;
        }

        // 处理内联脚本（防重复执行）
        await handleInlineScripts(page, content);

        // 标记页面已初始化
        window.pageStates[page].initialized = true;

        // 页面特定初始化
        handlePageInit(page);

    } catch (error) {
        console.error('页面加载失败:', error);
        content.innerHTML = `
            <div style="text-align: center; padding: 50px;">
                <h2>页面加载失败: ${page}</h2>
                <p>${error.message}</p>
                <button onclick="loadPage('${page}')">重新加载</button>
            </div>
        `;
    } finally {
        content.classList.remove("fade-out");
        closeMobileMenu();
        window.loadingPages.delete(page);
    }
}

// 处理内联脚本（防重复执行）
async function handleInlineScripts(page, content) {
    const scripts = content.querySelectorAll('script');
    
    for (let i = 0; i < scripts.length; i++) {
        const script = scripts[i];
        const scriptId = `${page}_inline_${i}`;
        
        if (script.src) {
            // 跳过外部脚本
            continue;
        }
        
        if (!script.textContent.trim()) {
            continue;
        }
        
        // 检查是否已执行
        if (!window.executedScripts) {
            window.executedScripts = new Set();
        }
        
        if (window.executedScripts.has(scriptId)) {
            console.log(`Script ${scriptId} already executed, skipping`);
            continue;
        }
        
        // 检查是否包含关键函数定义，如果函数已存在则跳过
        const scriptContent = script.textContent;
        if (shouldSkipScript(scriptContent)) {
            console.log(`Skipping script due to existing functions`);
            continue;
        }
        
        try {
            // 标记为已执行
            window.executedScripts.add(scriptId);
            
            // 执行脚本
            eval(scriptContent);
        } catch (error) {
            console.error(`Error executing script ${scriptId}:`, error);
        }
    }
}

// 检查是否应该跳过脚本执行
function shouldSkipScript(scriptContent) {
    const criticalFunctions = [
        'transferToTShirt',
        'saveToDraft', 
        'initSVG',
        'initCanvasEventListeners'
    ];
    
    for (const funcName of criticalFunctions) {
        // 如果脚本定义了这些函数，但函数已经存在，则跳过
        if (scriptContent.includes(`function ${funcName}`) || 
            scriptContent.includes(`${funcName} =`) || 
            scriptContent.includes(`${funcName}:`)) {
            
            if (typeof window[funcName] === 'function') {
                console.log(`Function ${funcName} already exists, skipping script`);
                return true;
            }
        }
    }
    
    return false;
}

// 清理页面
function cleanupPage(page) {
    console.log(`Cleaning up page: ${page}`);
    
    // 调用页面特定清理函数
    const cleanupFunctions = {
        'merch': 'cleanupMerchPage',
        'content': 'cleanupContentPage',
        'profile': 'cleanupProfilePage',
        'home': 'cleanupHomePage'
    };
    
    const cleanupFnName = cleanupFunctions[page];
    if (cleanupFnName && typeof window[cleanupFnName] === 'function') {
        try {
            window[cleanupFnName]();
        } catch (error) {
            console.error(`Error in cleanup function ${cleanupFnName}:`, error);
        }
    }
    
    // 重置页面状态
    if (window.pageStates[page]) {
        window.pageStates[page].initialized = false;
        // 不重置scriptsLoaded，避免重复加载外部脚本
    }
    
    // 清理内联脚本执行记录
    if (window.executedScripts) {
        const scriptsToRemove = Array.from(window.executedScripts).filter(scriptId => 
            scriptId.startsWith(`${page}_inline_`)
        );
        scriptsToRemove.forEach(scriptId => {
            window.executedScripts.delete(scriptId);
        });
    }
    
    // 清理页面特定状态
    if (page === 'home') {
        // 重要：清理SVG相关的重复事件监听器
        const svg = document.getElementById('mySVG');
        if (svg) {
            // 通过克隆节点清除所有事件监听器
            const newSvg = svg.cloneNode(true);
            svg.parentNode.replaceChild(newSvg, svg);
        }
        
        // 重置相关状态
        window.isTransferring = false;
        window.mousePressed = false;
        window.isDragging = false;
    }
}

// 页面特定初始化
function handlePageInit(page) {
    switch(page) {
        case 'profile':
            setTimeout(() => {
                window.dispatchEvent(new CustomEvent('profilePageLoaded'));
            }, 100);
            break;
            
        case 'gallery':
            setTimeout(() => {
                if (typeof initGallery === 'function') {
                    initGallery();
                } else {
                    // 等待函数加载
                    const checkInterval = setInterval(() => {
                        if (typeof initGallery === 'function') {
                            clearInterval(checkInterval);
                            initGallery();
                        }
                    }, 100);
                    
                    // 5秒后停止检查
                    setTimeout(() => clearInterval(checkInterval), 5000);
                }
            }, 200);
            break;
            
        case 'home':
            // 确保content页面的初始化只执行一次
            setTimeout(() => {
                if (!window.contentInitialized) {
                    window.contentInitialized = true;
                    console.log('Initializing content page...');
                }
            }, 100);
            break;
    }
}

function loadPageScript(jsFileName) {
    return new Promise((resolve) => {
        // 检查关键函数是否已存在
        if (jsFileName === 'page-home.js') {
            if (typeof window.transferToTShirt === 'function' && 
                typeof window.saveToDraft === 'function') {
                console.log('Content page functions already exist, skipping script load');
                resolve();
                return;
            }
        }
        
        // 检查脚本是否已加载
        const existingScript = document.querySelector(`script[data-page-script="${jsFileName}"]`);
        if (existingScript) {
            console.log(`Script ${jsFileName} already loaded`);
            resolve();
            return;
        }

        const script = document.createElement('script');
        
        // 尝试多个路径
        const paths = [`/js/${jsFileName}`, `./js/${jsFileName}`];
        let pathIndex = 0;
        
        function tryNextPath() {
            if (pathIndex >= paths.length) {
                console.warn(`Could not load script: ${jsFileName}`);
                resolve();
                return;
            }
            
            script.src = paths[pathIndex];
            pathIndex++;
        }
        
        script.setAttribute('data-page-script', jsFileName);
        script.onload = () => {
            console.log(`Loaded script: ${jsFileName}`);
            resolve();
        };
        script.onerror = () => {
            script.remove();
            if (pathIndex < paths.length) {
                const newScript = document.createElement('script');
                newScript.setAttribute('data-page-script', jsFileName);
                newScript.onload = script.onload;
                newScript.onerror = script.onerror;
                tryNextPath();
                newScript.src = paths[pathIndex - 1];
                document.body.appendChild(newScript);
            } else {
                console.warn(`Failed to load script: ${jsFileName}`);
                resolve();
            }
        };
        
        tryNextPath();
        script.src = paths[pathIndex - 1];
        document.body.appendChild(script);
    });
}</script><script defer="defer" src="/js/vendors.08ee64c9e60251b5d335.js"></script><script defer="defer" src="/js/styles.7aae21adbc8ce89b8327.js"></script><script defer="defer" src="/js/828.f4fc89ede5a6efcab4d1.js"></script><script defer="defer" src="/js/33.545769f2acdaaebe9ae3.js"></script><script defer="defer" src="/js/798.b0cf1e47f6c8f7e444c1.js"></script><script defer="defer" src="/js/global.9e411c2b11604bb8b1b6.js"></script></body></html>